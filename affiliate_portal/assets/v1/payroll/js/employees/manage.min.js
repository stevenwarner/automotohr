$((function(){let e=null,t=16,o="jsEmployeeFlowModal";function l(){if(0===t)return alertify.alert("Error!","Please select an employee.");Modal({Title:"Employee Onboard Flow",Id:o,Loader:`${o}Loader`,Body:`<div id="${o}Body"></div>`},(function(){a("documents")}))}function a(l){_ml(!0,`${o}Loader`),e=$.ajax({url:baseUrl("payrolls/flow/employee/"+t+"/"+l),method:"GET",caches:!1}).success((function(e){$(`#${o}Body`).html(e.view),function(e){"personal_details"===e&&($(".jsEmployeeFlowDateOfBirth").datepicker({format:"mm/dd/yyyy",changeYear:!0,changeMonth:!0,yearRange:"-100:+0"}),$(".jsEmployeeFlowStartDate").datepicker({format:"mm/dd/yyyy",changeYear:!0,changeMonth:!0,yearRange:"-100:+10"}))}(l)})).fail(handleErrorResponse).always((function(){e=null,_ml(!1,`${o}Loader`)}))}$(".jsPayrollEmployeeEdit").click((function(e){e.preventDefault(),t=$(this).closest("tr").data("id"),l()})),$(document).on("click",".jsMenuTrigger",(function(e){e.preventDefault(),a($(this).data("step"))})),$(document).on("click",".jsEmployeeFlowSavePersonalDetailsBtn",(function(l){if(l.preventDefault(),null!==e)return!1;let a={first_name:$(".jsEmployeeFlowFirstName").val().trim(),middle_initial:$(".jsEmployeeFlowMiddleInitial").val().trim(),last_name:$(".jsEmployeeFlowLastName").val().trim(),location_uuid:$(".jsEmployeeFlowWorkAddress option:selected").val(),start_date:$(".jsEmployeeFlowStartDate").val().trim(),email:$(".jsEmployeeFlowEmail").val().trim(),ssn:$(".jsEmployeeFlowSSN").val().trim(),date_of_birth:$(".jsEmployeeFlowDateOfBirth").val().trim()},n=[];if(a.first_name||n.push('"First name" is missing.'),a.last_name||n.push('"Last name" is missing.'),a.location_uuid||n.push('"Work address" is missing.'),a.start_date||n.push('"Start date" is missing.'),a.email||n.push('"Email" is missing.'),a.email.verifyEmail()||n.push('"Email" is invalid.'),a.ssn||n.push('"Social Security number (SSN)" is missing.'),9===a.ssn.replace(/-/g,"").length&&null===a.ssn.match(/([^0-9#-])/gi)||n.push('"Social Security number (SSN)" must be 9 digits long.'),a.date_of_birth||n.push('"Date of birth" is missing.'),n.length)return alertify.alert("Error!",getErrorsStringFromArray(n),CB);ml(!0,`${o}Loader`,"Please wait, while we are processing your request."),e=$.ajax({url:baseUrl("payrolls/flow/employee/"+t+"/personal_details"),method:"POST",data:a}).success((function(e){return alertify.alert("Success!",e.msg,CB)})).fail(handleErrorResponse).always((function(){e=null,ml(!1,`${o}Loader`)}))})),$(document).on("click",".jsEmployeeFlowSaveCompensationBtn",(function(l){if(l.preventDefault(),null!==e)return!1;let a={title:$(".jsEmployeeFlowJobTitle").val().trim(),amount:$(".jsEmployeeFlowAmount").val().trim(),classification:$(".jsEmployeeFlowEmployeeClassification option:selected").val(),per:$(".jsEmployeeFlowPer option:selected").val()},n=[];if(a.title||n.push('"Job title" is missing.'),(!a.amount||a.amount<0)&&n.push('"Amount" is missing.'),n.length)return alertify.alert("Error!",getErrorsStringFromArray(n),CB);ml(!0,`${o}Loader`,"Please wait, while we are processing your request."),e=$.ajax({url:baseUrl("payrolls/flow/employee/"+t+"/compensation"),method:"POST",data:a}).success((function(e){return alertify.alert("Success!",e.msg,CB)})).fail(handleErrorResponse).always((function(){e=null,ml(!1,`${o}Loader`)}))})),$(document).on("click",".jsEmployeeFlowSaveHomeAddressBtn",(function(l){if(l.preventDefault(),null!==e)return!1;let a={street_1:$(".jsEmployeeFlowStreet1").val().trim(),street_2:$(".jsEmployeeFlowStreet2").val().trim(),city:$(".jsEmployeeFlowCity").val().trim(),state:$(".jsEmployeeFlowState").val().trim(),zip:$(".jsEmployeeFlowZip").val().trim()},n=[];if(a.street_1||n.push('"street 1" is missing.'),a.city||n.push('"City" is missing.'),a.state||n.push('"State" is missing.'),a.zip||n.push('"Zip" is missing.'),n.length)return alertify.alert("Error!",getErrorsStringFromArray(n),CB);ml(!0,`${o}Loader`,"Please wait, while we are processing your request."),e=$.ajax({url:baseUrl("payrolls/flow/employee/"+t+"/home_address"),method:"POST",data:a}).success((function(e){return alertify.alert("Success!",e.msg,CB)})).fail(handleErrorResponse).always((function(){e=null,ml(!1,`${o}Loader`)}))})),$(document).on("click",".jsEmployeeFlowSaveFederalTaxBtn",(function(l){if(l.preventDefault(),null!==e)return!1;let a={filing_status:$(".jsEmployeeFlowFilingStatus option:selected").val(),two_jobs:$(".jsEmployeeFlowMultipleJobs:checked").val(),dependents_amount:$(".jsEmployeeFlowDependents").val().trim(),extra_withholding:$(".jsEmployeeFlowExtraWithholding").val().trim(),other_income:$(".jsEmployeeFlowOtherIncome").val().trim(),deductions:$(".jsEmployeeFlowDeductions").val().trim(),w4_data_type:"rev_2020_w4"},n=[];if(a.filing_status||n.push('"Filing status" is missing.'),n.length)return alertify.alert("Error!",getErrorsStringFromArray(n),CB);ml(!0,`${o}Loader`,"Please wait, while we are processing your request."),e=$.ajax({url:baseUrl("payrolls/flow/employee/"+t+"/federal_tax"),method:"POST",data:a}).success((function(e){return alertify.alert("Success!",e.msg,CB)})).fail(handleErrorResponse).always((function(){e=null,ml(!1,`${o}Loader`)}))})),$(document).on("click",".jsEmployeeFlowSaveStateTaxBtn",(function(l){if(l.preventDefault(),null!==e)return!1;let a={},n=[];if($(".jsEmployeeFlowStateTax").map((function(){"INPUT"===$(this).prop("tagName")&&"number"===$(this).prop("type")?(a[$(this).prop("name")]=$(this).val().trim(),$(this).val().trim()<0&&n.push('"'+$(this).prop("name").replace(/_/gi," ")+'" can not be less than 0.')):"SELECT"===$(this).prop("tagName")&&(a[$(this).prop("name")]=$('select[name="'+$(this).prop("name")+'"] option:selected').val(),$(this).val()||n.push('"'+$(this).prop("name").replace(/_/gi," ")+'" is missing.'))})),n.length)return alertify.alert("Error!",getErrorsStringFromArray(n),CB);ml(!0,`${o}Loader`,"Please wait, while we are processing your request."),e=$.ajax({url:baseUrl("payrolls/flow/employee/"+t+"/state_tax"),method:"POST",data:a}).success((function(e){return alertify.alert("Success!",e.msg,CB)})).fail(handleErrorResponse).always((function(){e=null,ml(!1,`${o}Loader`)}))})),$(document).on("click",".jsEmployeeFlowSaveBankAccountBtn",(function(l){if(l.preventDefault(),null!==e)return!1;let n={accountTitle:$(".jsEmployeeFlowBankAccountTitle").val().trim(),routingNumber:$(".jsEmployeeFlowBankAccountRoutingNumber").val().replace(/[^0-9]/gi,""),accountNumber:$(".jsEmployeeFlowBankAccountAccountNumber").val(),accountType:$(".jsEmployeeFlowBankAccountType option:selected").val()},s=[];if(n.accountTitle||s.push('"Account title" is missing.'),n.routingNumber||s.push('"Routing number" is missing.'),9!=n.routingNumber.length&&s.push('"Routing number" must be 9 digits long.'),n.accountNumber||s.push('"Routing number" is missing.'),n.accountType||s.push('"Account type" is missing.'),s.length)return alertify.alert("Error!",getErrorsStringFromArray(s),CB);ml(!0,`${o}Loader`,"Please wait, while we are processing your request."),e=$.ajax({url:baseUrl("payrolls/flow/employee/"+t+"/bank_account"),method:"POST",data:n}).success((function(e){return alertify.alert("Success!",e.msg,(function(){a("payment_method")}))})).fail(handleErrorResponse).always((function(){e=null,ml(!1,`${o}Loader`)}))})),$(document).on("click",".jsEmployeeFlowPaymentMethodSaveBtn",(function(l){if(l.preventDefault(),null!==e)return!1;let n={paymentType:$(".jsEmployeeFlowPaymentMethodType:checked").val()},s=[];if(n.paymentType||s.push('"Payment type" is missing.'),s.length)return alertify.alert("Error!",getErrorsStringFromArray(s),CB);ml(!0,`${o}Loader`,"Please wait, while we are processing your request."),e=$.ajax({url:baseUrl("payrolls/flow/employee/"+t+"/payment_method"),method:"POST",data:n}).success((function(e){return alertify.alert("Success!",e.msg,(function(){a("payment_method")}))})).fail(handleErrorResponse).always((function(){e=null,ml(!1,`${o}Loader`)}))})),$(document).on("click",".jsEmployeeFlowPaymentMethodAddBankAccountBtn",(function(e){e.preventDefault(),a("bank_account_add")})),$(document).on("click",".jsEmployeeFlowPaymentMethodToBtn",(function(e){e.preventDefault(),a("payment_method")})),$(document).on("click",".jsEmployeeFlowDeleteBankAccount",(function(l){l.preventDefault();const n=$(this).closest(".jsEmployeeFlowDeleteBankAccountRow").data("id");return alertify.confirm("Do you really want to delete the bank account?",(function(){var l;l=n,_ml(!0,`${o}Loader`),e=$.ajax({url:baseUrl("payrolls/flow/employee/"+t+"/bank_account/"+l),method:"DELETE",caches:!1}).success((function(){a("payment_method")})).fail(handleErrorResponse).always((function(){e=null,_ml(!1,`${o}Loader`)}))}))})),$(document).on("click",".jsEmployeeFlowUseBankAccount",(function(l){l.preventDefault();const n=$(this).closest(".jsEmployeeFlowDeleteBankAccountRow").data("id");var s;s=n,_ml(!0,`${o}Loader`),e=$.ajax({url:baseUrl("payrolls/flow/employee/"+t+"/bank_account/"+s),method:"PUT",caches:!1}).success((function(){a("payment_method")})).fail(handleErrorResponse).always((function(){e=null,_ml(!1,`${o}Loader`)}))})),$(document).on("click",".jsEmployeeFlowPaymentMethodType",(function(){"Check"===$(this).val()?$(".jsEmployeeFlowPaymentMethodAccountBox").addClass("hidden"):$(".jsEmployeeFlowPaymentMethodAccountBox").removeClass("hidden")})),$(document).on("click",".jsAssignDocument",(function(e){e.preventDefault();const l=$(this).closest("tr").data();return alertify.confirm("Do you really want to assign this document?",(function(){"direct_deposit"===l.type?function(e,l){_ml(!0,`${o}Loader`);let n={action:"assign_document"};n.documentType=e,n.companySid=companyId,n.companyName=window.company.Name,n.sid=l,n.userSid=t,n.userType="employee",$.post(baseUrl("hr_documents_management/handler"),n,(e=>{_ml(!1,`${o}Loader`),!1!==e.Status?alertify.alert("SUCCESS!",e.Response,(function(){a("documents")})):alertify.alert("WARNING!",e.Response,CB)}))}(l.type,l.did):"w4"===l.type&&(_ml(!0,`${o}Loader`),$.AJAX({url:baseUrl("forms/w4/employee/"+t+"/assign"),method:"POST",data:{}}).success((function(e){!1!==e.Status?alertify.alert("Success!",e.message,(function(){a("documents")})):alertify.alert("Error!",e.message,CB)})).fail(handleErrorResponse).always((function(){_ml(!1,`${o}Loader`)})))})).set("labels",{ok:"YES",cancel:"No"}).set("title","CONFIRM!")})),$(document).on("click",".jsRevokeDocument",(function(e){e.preventDefault();const l=$(this).closest("tr").data();return alertify.confirm("Do you really want to revoke this document?",(function(){"direct_deposit"===l.type?function(e,l){_ml(!0,`${o}Loader`);let n={action:"revoke_document"};n.documentType=e,n.companySid=companyId,n.companyName=window.company.Name,n.sid=l,n.userSid=t,n.userType="employee",$.post(baseUrl("hr_documents_management/handler"),n,(e=>{_ml(!1,`${o}Loader`),!1!==e.Status?alertify.alert("SUCCESS!",e.Response,(function(){a("documents")})):alertify.alert("WARNING!",e.Response,CB)}))}(l.type,l.did):"w4"===l.type&&(_ml(!0,`${o}Loader`),$.ajax({url:baseUrl("forms/w4/employee/"+t+"/revoke"),method:"DELETE",data:{}}).success((function(e){!1!==e.Status?alertify.alert("Success!",e.message,(function(){a("documents")})):alertify.alert("Error!",e.message,CB)})).fail(handleErrorResponse).always((function(){_ml(!1,`${o}Loader`)})))})).set("labels",{ok:"YES",cancel:"No"}).set("title","CONFIRM!")})),l(),$.ajaxSetup({cache:!1})}));