<?php
defined('BASEPATH') OR exit('No direct script access allowed');

class Invoice extends CI_Controller {
    function __construct() {
        parent::__construct();
        $this->load->model('invoice_model');
        $this->form_validation->set_error_delimiters('<p class="error_message"><i class="fa fa-exclamation-circle"></i>', '</p>');
    }

	public function index()
	{ 
        if ($this->session->userdata('affiliate_loggedin')) {
            $data = array();
            $data['title'] = 'Payment Vouchers';
    		    $session = $this->session->userdata('affiliate_loggedin');
            $data['name'] = $session['affiliate_users']['full_name'];
            $market_sid = $session['affiliate_users']['sid'];
            $all_vouchers = $this->invoice_model->get_all_invoices($market_sid);

            foreach($all_vouchers as $key => $voucher){
                if($voucher['commission_applied'] == 'secondary'){
                    $secondary_agency = $this->invoice_model->get_secondary_agency($voucher['secondary_commission_referrer_sid']);
                    $all_vouchers[$key]['secondary_agency'] = $secondary_agency['full_name'];
                }
            }
          
            $data['all_vouchers'] = $all_vouchers;
            $this->load->view('main/header', $data);
    		  $this->load->view('invoice/index');
    		  $this->load->view('main/footer');
        } else {
            redirect(base_url('login'), "refresh");
        }
	}
}
