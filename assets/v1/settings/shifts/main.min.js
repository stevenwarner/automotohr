$((function(){let e=null,t=null;const a="jsModalPage",n=a+"Loader",s=a+"Body",l=getSearchParam("mode")||"month";let i="",o="",r="";function c(t,l,i,o){Modal({Id:a,Title:t,Body:'<div id="'+s+'"></div>',Loader:n},(function(){!function(t,a,n){null!==e&&e.abort();e=$.ajax({url:baseUrl("settings/page/"+t+"/"+a),method:"GET"}).always((function(){e=null})).fail(handleErrorResponse).done((function(e){$("#"+s).html(e.view),n(e)}))}(l,i,o)}))}function d(a,n,s,l){if(null!==e)return;let i;n&&(i=callButtonHook(n,!0)),e=$.ajax({url:baseUrl(s),method:"POST",data:a,processData:!1,contentType:!1}).always((function(){n&&callButtonHook(i,!1),e=null})).fail(handleErrorResponse).done((function(e){return t?.destroy(),l(e)}))}function f(){let e="";if("month"===l){const t=getSearchParam("year")||moment().format("YYYY");e=(getSearchParam("month")||moment().format("MM"))+"/01/"+t}else e=getSearchParam("start_date")||moment().weekday(1).format("MM/DD/YYYY");return e}function m(e){let t="";if("week"===l)t=getSearchParam("end_date")||moment(e,"MM/DD/YYYY").endOf("week").add(1,"day").format("MM/DD/YYYY");else if("two_week"===l)t=getSearchParam("end_date")||moment(e,"MM/DD/YYYY").add(2,"week").subtract(1,"days").format("MM/DD/YYYY");else{const e=getSearchParam("year")||moment().format("YYYY"),a=getSearchParam("month")||moment().format("MM");t=moment(e+"-"+a+"-01").endOf("month").format("MM/DD/YYYY")}return t}function u(){$(".jsTimeField").timepicker({timeFormat:"h:mm p",dynamic:!1,dropdown:!1,scrollbar:!1})}function p(){$("#shift_date_from").daterangepicker({opens:"center",singleDatePicker:!0,showDropdowns:!0,autoApply:!0,startDate:f(),locale:{format:"MM/DD/YYYY"}}),$("#shift_date_to").daterangepicker({opens:"center",singleDatePicker:!0,showDropdowns:!0,autoApply:!0,startDate:m(),locale:{format:"MM/DD/YYYY"}})}$(".jsWeekDaySelect").daterangepicker({opens:"center",singleDatePicker:!0,showDropdowns:!0,autoApply:!0,startDate:f(),locale:{format:"MM/DD/YYYY"},isInvalidDate:function(e){return"month"===l?"01"!==e.format("DD"):1!==e.day()}}),$(".jsWeekDaySelect").on("apply.daterangepicker",(function(e,t){const a="month"===l?t.startDate.clone().startOf("month").format("MM/DD/YYYY"):t.startDate.clone().format("MM/DD/YYYY");let n=0;n="week"===l?6:"two_week"===l?13:t.startDate.endOf("month").format("MM/DD/YYYY");const s=t.startDate.add(n,"days").format("MM/DD/YYYY");if("month"==l)return window.location.href=baseUrl("settings/shifts/manage?mode="+l+"&year="+t.startDate.clone().format("YYYY")+"&month="+t.startDate.clone().format("MM"));window.location.href=baseUrl("settings/shifts/manage?mode="+l+"&start_date="+a+"&end_date="+s)})),$(".jsNavigateLeft").click((function(e){e.preventDefault();let t="";""!=filterTeam&&(t="&employees="+filterEmployeesSid+"&team="+filterTeam+"&jobtitle="+filterJobtitle);const a=$(".jsWeekDaySelect").data("daterangepicker").startDate;if("month"!==l)return window.location.href=baseUrl("settings/shifts/manage?mode="+l+"&start_date="+a.clone().subtract("week"===l?1:2,"week").format("MM/DD/YYYY")+"&end_date="+a.clone().subtract(1,"day").format("MM/DD/YYYY")+t);{const e=a.clone().subtract(1,"month");return window.location.href=baseUrl("settings/shifts/manage?mode="+l+"&year="+e.clone().format("YYYY")+"&month="+e.clone().format("MM")+t)}})),$(".jsNavigateRight").click((function(e){e.preventDefault();let t="";""!=filterTeam&&(t="&employees="+filterEmployeesSid+"&team="+filterTeam+"&jobtitle="+filterJobtitle);const a=$(".jsWeekDaySelect").data("daterangepicker").startDate;let n="",s=1;if("week"===l?n=a.clone().add(1,"week"):"two_week"===l?(s=2,n=a.clone().add(2,"week")):n=a.clone().endOf("month"),"month"!==l)return window.location.href=baseUrl("settings/shifts/manage?mode="+l+"&start_date="+n.clone().format("MM/DD/YYYY")+t+"&end_date="+n.clone().add(s,"week").subtract(1,"day").format("MM/DD/YYYY"));{const e=n.clone().add(1,"month");return window.location.href=baseUrl("settings/shifts/manage?mode="+l+"&year="+e.clone().format("YYYY")+"&month="+e.clone().format("MM")+t)}})),$(".schedule-employee-row").map((function(){$(".schedule-column-"+$(this).data("id")).height($(this).height())})),$(".schedule-column-clickable").click((function(e){var a,s;e.preventDefault(),a=$(this).data("eid"),s=$(this).closest(".schedule-column-container").data("date"),c("Create Shift","create_single_shift",a,(function(e){ml(!1,n),$('[name="shift_date"]').val(moment(s,"YYYY-MM-DD").format("MM/DD/YYYY")),u(),t=$("#jsPageCreateSingleShiftForm").validate({rules:{shift_employee:{required:!0},shift_date:{required:!0},start_time:{required:!0,timeIn12Format:!0},end_time:{required:!0,timeIn12Format:!0}},errorPlacement:function(e,t){$(t).parent().hasClass("input-group")?$(t).parent().after(e):$(t).after(e)},submitHandler:function(e){return d(formArrayToObj($(e).serializeArray()),$(".jsPageCreateSingleShiftBtn"),"settings/shifts/single/create",(function(e){_success(e.msg,(function(){window.location.reload()}))}))}})}))})),$(".jsEmployeesShifts").click((function(e){e.preventDefault(),c("Create Shift","create_multi_shift",0,(function(){ml(!1,n),u(),p(),$(".jsSelectAll").click((function(e){e.preventDefault(),$(".jsPageApplyTemplateEmployees").prop("checked",!0)})),$(".jsRemoveAll").click((function(e){e.preventDefault(),$(".jsPageApplyTemplateEmployees").prop("checked",!1)})),t=$("#jsPageCreateSingleShiftForm").validate({rules:{start_time:{required:!0,timeIn12Format:!0},end_time:{required:!0,timeIn12Format:!0}},errorPlacement:function(e,t){$(t).parent().hasClass("input-group")?$(t).parent().after(e):$(t).after(e)},submitHandler:function(e){$(e).serializeArray();const t={start_date:$("#shift_date_from").val(),end_date:$("#shift_date_to").val(),employees:[]};return $(".jsPageApplyTemplateEmployees:checked").map((function(){t.employees.push($(this).val())})),t.start_date.length?t.end_date.length?t.employees.length?void d(formArrayToObj($(e).serializeArray()),$(".jsPageCreateSingleShiftBtn"),"settings/shifts/multyshift/apply",(function(e){let t="";Object.keys(e.list).length>0&&$.each(e.list,(function(e,a){t+="<p>",t+=$('.jsPageApplyTemplateEmployees[value="'+e+'"]').parent().text().trim(),t+=" has already shift on the following dates;",t+="</p>",a.dates.map((function(e){t+="<span>"+moment(e,"YYYY-MM-DD").format("MM/DD/YYYY")+"</span>, "})),t+="<br />",t+="<br />"})),_success(e.msg+t,(function(){window.location.href=baseUrl("settings/shifts/manage"+window.location.search)}))})):_error("Please select at least one employee."):_error("Please select To Date."):_error("Please select From Date.")}})}))})),$(".jsEmployeeShiftsDelete").click((function(e){e.preventDefault(),c("Delete Shifts","delete_multi_shift",0,(function(){ml(!1,n),p(),$(".jsSelectAll").click((function(e){e.preventDefault(),$(".jsPageApplyTemplateEmployees").prop("checked",!0)})),$(".jsRemoveAll").click((function(e){e.preventDefault(),$(".jsPageApplyTemplateEmployees").prop("checked",!1)})),t=$("#jsPageCreateSingleShiftForm").validate({submitHandler:function(e){$(e).serializeArray();const t={start_date:$("#shift_date_from").val(),end_date:$("#shift_date_to").val(),employees:[]};return $(".jsPageApplyTemplateEmployees:checked").map((function(){t.employees.push($(this).val())})),t.start_date.length?t.end_date.length?t.employees.length?void alertify.confirm("Are You Sure?","Are you sure want to delete shifts?",(function(){d(formArrayToObj($(e).serializeArray()),$(".jsPageCreateSingleShiftBtn"),"settings/shifts/multyshift/delete",(function(e){_success(e.msg,(function(){window.location.href=baseUrl("settings/shifts/manage"+window.location.search)}))}))}),(function(){})):_error("Please select at least one employee."):_error("Please select To Date."):_error("Please select From Date.")}})}))})),$(".jsEmployeeShiftsCopy").click((function(e){c("Copy Shifts","copy_shift",0,(function(){ml(!1,n),$("#last_shift_date_from").daterangepicker({opens:"center",singleDatePicker:!0,showDropdowns:!0,autoApply:!0,startDate:f(),locale:{format:"MM/DD/YYYY"}}),$("#last_shift_date_to").daterangepicker({opens:"center",singleDatePicker:!0,showDropdowns:!0,autoApply:!0,startDate:m(),locale:{format:"MM/DD/YYYY"}}),p(),$(".jsSelectAll").click((function(e){e.preventDefault(),$(".jsPageApplyTemplateEmployees").prop("checked",!0)})),$(".jsRemoveAll").click((function(e){e.preventDefault(),$(".jsPageApplyTemplateEmployees").prop("checked",!1)})),t=$("#jsPageCreateSingleShiftForm").validate({submitHandler:function(e){$(e).serializeArray();const t={last_start_date:$("#shift_date_from").val(),last_end_date:$("#shift_date_to").val(),start_date:$("#shift_date_from").val(),end_date:$("#shift_date_to").val(),employees:[]};return $(".jsPageApplyTemplateEmployees:checked").map((function(){t.employees.push($(this).val())})),t.last_start_date.length?t.last_end_date.length?t.start_date.length?t.end_date.length?t.employees.length?void d(formArrayToObj($(e).serializeArray()),$(".jsPageCreateSingleShiftBtn"),"settings/shifts/multyshift/copy",(function(e){let t="";Object.keys(e.list).length>0&&$.each(e.list,(function(e,a){t+="<p>",t+=$('.jsPageApplyTemplateEmployees[value="'+e+'"]').parent().text().trim(),t+=" has already shift on the following dates;",t+="</p>",a.dates.map((function(e){t+="<span>"+moment(e,"YYYY-MM-DD").format("MM/DD/YYYY")+"</span>, "})),t+="<br />",t+="<br />"})),_success(e.msg+t,(function(){window.location.href=baseUrl("settings/shifts/manage"+window.location.search)}))})):_error("Please select at least one employee."):_error("Please select To Date."):_error("Please select From Date."):_error("Please select To Date."):_error("Please select From Date.")}})}))})),$(".schedule-item").click((function(e){e.preventDefault(),e.stopPropagation(),c("Edit Shift","edit_single_shift",$(this).data("id"),(function(e){ml(!1,n),u(),t=$("#jsPageCreateSingleShiftForm").validate({rules:{shift_employee:{required:!0},shift_date:{required:!0},start_time:{required:!0,timeIn12Format:!0},end_time:{required:!0,timeIn12Format:!0}},errorPlacement:function(e,t){$(t).parent().hasClass("input-group")?$(t).parent().after(e):$(t).after(e)},submitHandler:function(e){return d(formArrayToObj($(e).serializeArray()),$(".jsPageCreateSingleShiftBtn"),"settings/shifts/single/create",(function(e){_success(e.msg,(function(){window.location.reload()}))}))}})}))})),$(".jsApplyTemplate").click((function(a){a.preventDefault(),c("Apply shift template","apply_shift_templates",0,(function(){ml(!1,n),$(".jsSelectScheduleTemplate").click((function(e){e.preventDefault(),$(".jsSelectScheduleTemplate").removeClass("active"),$(this).addClass("active")})),$(".jsSelectAll").click((function(e){e.preventDefault(),$(".jsPageApplyTemplateEmployees").prop("checked",!0)})),$(".jsRemoveAll").click((function(e){e.preventDefault(),$(".jsPageApplyTemplateEmployees").prop("checked",!1)})),$("#jsPageApplyShiftTemplateForm").submit((function(a){a.preventDefault();const n={start_date:f(),schedule_id:$(".jsSelectScheduleTemplate.active").data("id"),employees:[]};return n.end_date=m(n.start_date),$(".jsPageApplyTemplateEmployees:checked").map((function(){n.employees.push($(this).val())})),n.schedule_id?n.employees.length?void function(a,n,s,l){if(null!==e)return;const i=callButtonHook(n,!0);e=$.ajax({url:baseUrl(s),method:"POST",data:a,processData:!0}).always((function(){callButtonHook(i,!1),e=null})).fail(handleErrorResponse).done((function(e){return t?.destroy(),l(e)}))}(n,$(".jsPageApplyShiftTemplateBtn"),"settings/shifts/template/apply",(function(e){let t="";Object.keys(e.list).length>0&&$.each(e.list,(function(e,a){t+="<p>",t+=$('.jsPageApplyTemplateEmployees[value="'+e+'"]').parent().text().trim(),t+=" has already shift on the following dates;",t+="</p>",a.dates.map((function(e){t+="<span>"+moment(e,"YYYY-MM-DD").format("MM/DD/YYYY")+"</span>, "})),t+="<br />",t+="<br />"})),_success(e.msg+t,(function(){window.location.href=baseUrl("settings/shifts/manage"+window.location.search)}))})):_error("Please select at least one employee."):_error("Please select a schedule.")}))}))})),$(document).on("click",".jsAddBreak",(function(e){e.preventDefault();const t=getRandomCode();$(".jsBreakContainer").append(function(e,t){let a="";a+="<option></option>",breaksObject.map((function(e){a+='<option value="'+e.break_name+'" data-duration="'+e.break_duration+'" '+(void 0!==t&&t.break===e.break_name?"selected":"")+">"+e.break_name+" ("+e.break_type+")</option>"}));let n="";return n+='<div class="row jsBreakRow" data-key="'+e+'">',n+="    <br> ",n+='     <div class="col-sm-5">',n+='        <label class="text-medium">',n+="            Break ",n+='            <strong class="text-red">*</strong>',n+="         </label>",n+='         <select name="breaks['+e+'][break]" class="form-control jsBreakSelect">',n+=a,n+="         </select>",n+="     </div>",n+='     <div class="col-sm-3">',n+='         <label class="text-medium">',n+="             Duration ",n+='             <strong class="text-red">*</strong>',n+="         </label>",n+='         <div class="input-group">',n+='             <input type="number" class="form-control jsDuration" name="breaks['+e+'][duration]" value="'+(t?.duration||"")+'" />',n+='             <div class="input-group-addon">mins</div>',n+="         </div>",n+="     </div>",n+='     <div class="col-sm-3">',n+='         <label class="text-medium">',n+="             Start TIme ",n+="         </label>",n+='         <input type="text" class="form-control jsTimeField jsStartTime" placeholder="HH:MM" name="breaks['+e+'][start_time]"value="'+(t?.start_time?moment(t.start_time,"HH:mm").format("h:mm a"):"")+'" />',n+="     </div>",n+='     <div class="col-sm-1">',n+="         <br>",n+='         <button class="btn btn-red jsDeleteBreakRow" title="Delete this break" type="button">',n+='             <i class="fa fa-trash" style="margin-right: 0"></i>',n+="         </button>",n+="     </div>",n+="</div>",n}(t)),$('[name="breaks['+t+'][break]"]').rules("add",{required:!0}),$('[name="breaks['+t+'][duration]"]').rules("add",{required:!0,number:!0,digits:!0,greaterThanZero:!0}),u()})),$(document).on("click",".jsMarkAsDayOff",(function(e){e.preventDefault();const t=$(this).data("id");alertify.confirm("Are You Sure?","Are you sure want to delete shifts?",(function(){const e=new FormData;e.append("id",t),d(e,"","settings/shifts/singleshift/delete",(function(e){_success(e.msg,(function(){window.location.reload()}))}))}),(function(){}))})),$(document).on("click",".jsDeleteBreakRow",(function(e){e.preventDefault();const t=$(this).closest(".jsBreakRow").data("key");$('.jsBreakRow[data-key="'+t+'"]').remove(),$('[name="breaks['+t+'][break]"]').rules("remove"),$('[name="breaks['+t+'][duration]"]').rules("remove")})),$(document).on("change",".jsBreakSelect",(function(){const e=$(this).closest(".jsBreakRow").data("key");$('[name="breaks['+e+'][duration]"]').val($(this).find("option:selected").data("duration"))})),$((function(){$(".expander").on("click",(function(){$("#TableData").toggle()}))})),1==filterToggle&&$("#TableData").toggle(),$(".js-filter-employee").select2(),$(".js-filter-jobtitle").select2(),$(".jsSelect2").select2(),$(".js-apply-filter-btn").click((function(e){e.preventDefault();const t=$(".jsWeekDaySelect").data("daterangepicker").startDate;let a=f(),n=m(t),s="",i=t.clone().format("YYYY"),o=t.clone().format("MM"),r=$(".js-filter-employee").val(),c=$(".jsSelect2").val(),d=$(".js-filter-jobtitle").val();return s=getSearchParam("year")?"settings/shifts/manage?mode="+l+"&year="+i+"&month="+o+"&employees="+r+"&team="+c+"&jobtitle="+d:getSearchParam("start_date")?"settings/shifts/manage?mode="+l+"&start_date="+a+"&end_date="+n+"&employees="+r+"&team="+c+"&jobtitle="+d:"settings/shifts/manage?mode="+l+"&employees="+r+"&team="+c+"&jobtitle="+d,window.location.href=baseUrl(s)})),$(".js-reset-filter-btn").click((function(e){e.preventDefault();const t=$(".jsWeekDaySelect").data("daterangepicker").startDate;let a=f(),n=m(t),s="",i=t.clone().format("YYYY"),o=t.clone().format("MM");$(".js-filter-employee").val(),$(".jsSelect2").val();return s=getSearchParam("year")?"settings/shifts/manage?mode="+l+"&year="+i+"&month="+o:getSearchParam("start_date")?"settings/shifts/manage?mode="+l+"&start_date="+a+"&end_date="+n:"settings/shifts/manage?mode="+l,window.location.href=baseUrl(s)}));let h=filterJobtitle.split(",");function g(e){const t=new FormData;t.append("shiftId",i),t.append("publichStatus",o),t.append("sendEmail",e),d(t,"","settings/shifts/singleshift/public-status",(function(e){_success(e.msg,(function(){window.location.reload()}))}))}$("#jobtitleId").val(h),$("#jobtitleId").trigger("change"),$(document).on("click",".jsPublishSingleShiftBtn",(function(e){e.preventDefault(),i=$(this).data("id"),o=$(this).data("publish"),function(){let e="";1==o?(o=0,e=" Unpublish "):(o=1,e=" Publish ");alertify.publishSingleShift().setHeader("Confirmation"),alertify.publishSingleShift().set("labels",{ok:e,PublishAndSendEmails:e}),alertify.publishSingleShift("Are you sure want to "+e+"  this shift?").set({onok:function(){g(0)},onPublishAndSendEmails:function(){g(1)},labels:{}})}()})),$(document).on("click",".jsUnpublishSingleShiftBtn",(function(e){e.preventDefault(),i=$(this).data("id"),o=$(this).data("publish"),_confirm("Do you really want to unpublish the shift?",(function(){!function(e){const t=new FormData;t.append("shiftId",e),t.append("publichStatus",0),t.append("sendEmail",1),d(t,"","settings/shifts/singleshift/public-status",(function(e){_success(e.msg,(function(){window.location.reload()}))}))}(i)}))})),$(document).on("click",".jsPublishSingleShiftBtnOk,.jsUnpublishSingleShiftBtnOkEmail",(function(e){e.preventDefault();let t="",a=$(this).data("sendemail");1==o?(o=0,t=" Unpublish "):(o=1,t=" Publish "),alertify.confirm("Are You Sure?","Are you sure want to "+t+" the shift?",(function(){const e=new FormData;e.append("shiftId",i),e.append("publichStatus",o),e.append("sendEmail",a),d(e,"","settings/shifts/singleshift/public-status",(function(e){_success(e.msg,(function(){window.location.reload()}))}))}),(function(){}))})),$(document).on("click",".jsModalCancel2",(function(e){alertify.genericDialog().close()})),$(document).on("click",".jsPublishMultiShiftBtn",(function(e){e.preventDefault(),i=$(this).data("ids"),r=$(this).data("shiftsids"),alertify.publishShift().setHeader("Confirmation"),alertify.publishShift("Are you sure want to publish shifts?").set({onok:function(){const e=new FormData;e.append("shiftIds",i),e.append("publichStatus",1),e.append("sendEmail",0),d(e,"","settings/shifts/multishift/public-status",(function(e){_success(e.msg,(function(){window.location.reload()}))}))},onPublishAndSendEmails:function(){!function(){let e="";e+=' <div class="hr-fields-wrap">',e+=' <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12">',e+='<label class="control control--radio " style="margin-left: -20px;">Send Email To Effected Employees<input type="radio" name="shifts_email_selection" class="shiftemailselection" value="effected" checked>',e+='    <div class="control__indicator"></div>',e+="   </label>",e+="</div>",e+=' <div class="hr-fields-wrap">',e+=' <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12">',e+='<label class="control control--radio " style="margin-left: -20px;">Send Email To All Employees<input type="radio" name="shifts_email_selection" class="shiftemailselection" value="all">',e+='    <div class="control__indicator"></div>',e+="   </label>",e+="</div>",e+="<br> ",e+="  </div>",e+=" <br>",alertify.ShiftEmailOption(e).set({onok:function(){let e=$("input[name='shifts_email_selection']:checked").val();const t=new FormData;t.append("shiftIds",i),t.append("publichStatus",1),t.append("sendEmail",1),t.append("sendShiftsEmailOption",e),t.append("allShiftsId",r),d(t,"","settings/shifts/multishift/public-status",(function(e){_success(e.msg,(function(){window.location.reload()}))}))},oncancel:function(){},labels:{ok:"Send"}})}()},oncancel:function(){},labels:{ok:"Publish"}})})),alertify.dialog("publishShift",(function(){return{setup:function(){var e=alertify.confirm().settings;for(var t in e)this.settings[t]=e[t];var a=alertify.confirm().setup();return a.buttons.push({text:"Publish & Send Emails",key:67,scope:"auxiliary",className:"ajs-ok"}),a},settings:{onPublishAndSendEmails:null},callback:function(e){2==e.index?"function"==typeof this.get("onPublishAndSendEmails")&&(returnValue=this.get("onPublishAndSendEmails").call(this,e),"undefined"!=typeof returnValue&&(e.cancel=!returnValue)):alertify.confirm().callback.call(this,e)}}}),!1,"confirm"),alertify.dialog("ShiftEmailOption",(function(){}),!1,"confirm"),alertify.dialog("publishSingleShift",(function(){return{setup:function(){var e=alertify.confirm().settings;for(var t in e)this.settings[t]=e[t];var a=alertify.confirm().setup();return a.buttons.push({text:"Publish & Send Email",key:67,scope:"auxiliary",className:"ajs-ok"}),a},settings:{onPublishAndSendEmails:null},callback:function(e){2==e.index?"function"==typeof this.get("onPublishAndSendEmails")&&(returnValue=this.get("onPublishAndSendEmails").call(this,e),"undefined"!=typeof returnValue&&(e.cancel=!returnValue)):alertify.confirm().callback.call(this,e)}}}),!1,"confirm")}));