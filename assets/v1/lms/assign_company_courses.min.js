$((function(){let e=null,o=0,t="jsEditCourseJobRoleModel",s="jsEditCourseJobRoleModelLoader",n={title:"",jobTitleIds:"all"},r=[],l=0,i=0,a=0;function c(){null!==e&&e.abort(),e=$.ajax({url:apiURL+"lms/company/view/edit_job_role/"+o,method:"GET"}).success((function(o){e=null,$("#"+t+"Body").html(o),$("#jsEditCourseJobTitles").select2({closeOnSelect:!1})})).fail(handleErrorResponse).done((function(){e=null,ml(!1,s)}))}function u(o,t){null!==e&&e.abort(),ml(!0,"jsPageLoader"),e=$.ajax({url:apiURL+`lms/course/store/course/${o}/${t}`,method:"PUT",headers:{Authorization:"Bearer "+apiAccessTokenStore}}).success((function(o){e=null,window.location.reload(),ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(){e=null,ml(!1,"jsPageLoader")}))}function d(){if(r.length>0&&void 0===r[a])return ml(!1,"jsPageLoader"),$("#js-loader-text").html(""),alertify.alert("Course Copy process is completed successfully!",(function(){r=[],l=0,i=0,a=0,p(),getLMSDefaultCourses()}));if(void 0===r[a])return ml(!1,"jsPageLoader"),void $("#js-loader-text").html("");var o=r[a];e=$.ajax({url:apiURL+"lms/course/assign",method:"POST",headers:{"content-type":"application/json"},data:JSON.stringify({courseID:o.course_sid})}).fail(handleErrorResponse).done((function(){a<=l?(a++,setTimeout((function(){d()}),1e3)):(ml(!1,"jsPageLoader"),alertify.alert("Course copy process is completed successfully!").set("onok",(function(e){r=[],l=0,i=0,a=0})))}))}function f(){let e="";return e+="title="+encodeURI(n.title),e+="&status="+encodeURI("active"),e+="&companyId="+encodeURI(companySid),e+="&job_titles="+("all"!=n.jobTitleIds?n.jobTitleIds.join(","):[]),e}function p(){null!==e&&e.abort(),ml(!0,"jsPageLoader"),e=$.ajax({url:apiURL+"lms/course/store/courses?"+f(),method:"GET",headers:{Authorization:"Bearer "+apiAccessTokenStore}}).success((function(o){e=null,$("#jsStoreCoursesView").html(o),ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(){e=null,ml(!1,"jsPageLoader")}))}$(".jsCourseJobTitleStoreCourse").select2(),$(".jsApplyFilterStoreCourse").click((function(e){e.preventDefault(),n.title=$(".jsCourseTitleStoreCourse").val()||"",n.jobTitleIds=$(".jsCourseJobTitleStoreCourse").select2("val"),p()})),$(document).on("click",".jsToggleViewAssignCompanyCourse",(function(e){e.preventDefault(),$('[data-key="jsView'+$(this).closest("tr").data("id")+'"]').toggleClass("hidden")})),$(document).on("click",".jsCheckAll",(function(){$(".jsStoreCourseRow").find('input[name="courses_ids[]"]').prop("checked",$(this).prop("checked"))})),$(document).on("click",".jsAssignCourses",(function(){$(".jsCheckAll").prop("checked",$(".jsAssignCourses").length==$(".jsAssignCourses:checked").length)})),$(document).on("click",".jsCopyCoursesBtn",(function(e){if(e.preventDefault(),r=function(){var e=[];return $.each($('input[name="courses_ids[]"]:checked'),(function(){var o={};o.course_sid=parseInt($(this).val()),o.course_name=$(this).closest("tr").find("td.js-course-name").text(),e.push(o)})),e}(),0===r.length)return alertify.alert("ERROR!","Please select at least one course to start the process.");a=0,l=r.length,ml(!0,"jsPageLoader"),$("#js-loader-text").html("Please wait, we are copying employee"),d()})),$(document).on("click",".jsDisableCourse",(function(e){var o=$(this).closest("tr").data("id");alertify.confirm("Are You Sure?","Are you sure want to disable this course?",(function(){u(o,"disable")}),(function(){}))})),$(document).on("click",".jsEnableCourse",(function(e){var o=$(this).closest("tr").data("id");alertify.confirm("Are You Sure?","Are you sure want to enable this course?",(function(){u(o,"enable")}),(function(){}))})),$(document).on("click",".jsManageJobRole",(function(e){$(this).closest("tr").data("id");!function(e,n){o=e,Modal({Id:t,Title:"Update Course <span>"+n+"</span>",Loader:s,Cl:"container",Ask:!0,Body:'<div id="'+t+'Body"></div>'},c)}($(this).data("course_id"),$(this).data("course_title"))})),$(document).on("click",".jsEditCourseJobRoleBtn",(function(e){e.preventDefault(),courseObj={job_titles:$("#jsEditCourseJobTitles").val()||[],revertJobTitles:$("#jsEditCourseJobTitleRevertOption").prop("checked")?"on":"off"},async function(e){const n=[];e.job_titles.length||n.push("Select at least one job title.");if(n.length)return alertify.alert("ERROR!",getErrorsStringFromArray(n),CB);ml(!0,s);try{const s=await function(e){return new Promise((function(t,s){$.ajax({url:apiURL+"lms/company/update_job_role/"+o,method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},data:JSON.stringify(e)}).success(t).fail((function(e){s(e.responseJSON)}))}))}(e);alertify.alert("SUCCESS!",s.data,(function(){$("#"+t).remove()}))}catch(e){return ml(!1,s),alertify.alert("ERROR!",getErrorsStringFromArray(e.errors,"Errors!!"),CB)}}(courseObj)})),window.sendCourseToSave=function(e){},p()}));