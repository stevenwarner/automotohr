$(function(){async function e(e){const t=[];if(e.job_titles.length||t.push("Select at least one job title."),t.length)return alertify.alert("ERROR!",getErrorsStringFromArray(t),CB);ml(!0,h);try{console.log("please call update call");const t=await o(e);return alertify.alert("SUCCESS!",t.data,function(){$("#"+m).remove()})}catch(e){return ml(!1,h),alertify.alert("ERROR!",getErrorsStringFromArray(e.errors,"Errors!!"),CB)}}function o(e){return console.log("update call"),new Promise(function(o,t){$.ajax({url:apiURL+"lms/company/update_job_role/"+j,method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},data:JSON.stringify(e)}).success(o).fail(function(e){t(e.responseJSON)})})}function t(e,o){j=e,Modal({Id:m,Title:"Update Course <span>"+o+"</span>",Loader:h,Cl:"container",Ask:!0,Body:'<div id="'+m+'Body"></div>'},s)}function s(){null!==p&&p.abort(),p=$.ajax({url:apiURL+"lms/company/view/edit_job_role/"+j,method:"GET"}).success(function(e){p=null,$("#"+m+"Body").html(e),$("#jsEditCourseJobTitles").select2({closeOnSelect:!1})}).fail(handleErrorResponse).done(function(){p=null,ml(!1,h)})}function n(e,o){null!==p&&p.abort(),ml(!0,"jsPageLoader"),p=$.ajax({url:apiURL+`lms/course/store/course/${e}/${o}`,method:"PUT",headers:{Authorization:"Bearer "+apiAccessTokenStore}}).success(function(e){p=null,window.location.reload(),ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(){p=null,ml(!1,"jsPageLoader")})}function r(){$(".jsStoreCourseRow").find('input[name="courses_ids[]"]').prop("checked",$(this).prop("checked"))}function l(){$(".jsCheckAll").prop("checked",$(".jsAssignCourses").length==$(".jsAssignCourses:checked").length)}function a(e){if(e.preventDefault(),g=c(),0===g.length)return alertify.alert("ERROR!","Please select at least one course to start the process.");R=0,y=g.length,ml(!0,"jsPageLoader"),$("#js-loader-text").html("Please wait, we are copying employee"),i()}function i(){if(g.length>0&&void 0===g[R])return ml(!1,"jsPageLoader"),$("#js-loader-text").html(""),alertify.alert("Course Copy process is completed successfully!",function(){g=[],y=0,b=0,R=0,d(),getLMSDefaultCourses()});if(void 0===g[R])return ml(!1,"jsPageLoader"),void $("#js-loader-text").html("");var e=g[R];p=$.ajax({url:apiURL+"lms/course/assign",method:"POST",headers:{"content-type":"application/json"},data:JSON.stringify({courseID:e.course_sid})}).fail(handleErrorResponse).done(function(){R<=y?(R++,setTimeout(function(){i()},1e3)):(ml(!1,"jsPageLoader"),alertify.alert("Course copy process is completed successfully!").set("onok",function(e){g=[],y=0,b=0,R=0}))})}function c(){var e=[];return $.each($('input[name="courses_ids[]"]:checked'),function(){var o={};o.course_sid=parseInt($(this).val()),o.course_name=$(this).closest("tr").find("td.js-course-name").text(),e.push(o)}),e}function u(){let e="";return e+="title="+encodeURI(C.title),e+="&status="+encodeURI("active"),e+="&companyId="+encodeURI(companySid),e+="&job_titles="+("all"!=C.jobTitleIds?C.jobTitleIds.join(","):[]),e}function d(){null!==p&&p.abort(),ml(!0,"jsPageLoader"),p=$.ajax({url:apiURL+"lms/course/store/courses?"+u(),method:"GET",headers:{Authorization:"Bearer "+apiAccessTokenStore}}).success(function(e){p=null,$("#jsStoreCoursesView").html(e),ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(){p=null,ml(!1,"jsPageLoader")})}function f(e){}let p=null,j=0,m="jsEditCourseJobRoleModel",h="jsEditCourseJobRoleModelLoader",C={title:"",jobTitleIds:"all"},g=[],y=0,b=0,R=0;$(".jsCourseJobTitleStoreCourse").select2(),$(".jsApplyFilterStoreCourse").click(function(e){e.preventDefault(),C.title=$(".jsCourseTitleStoreCourse").val()||"",C.jobTitleIds=$(".jsCourseJobTitleStoreCourse").select2("val"),d()}),$(document).on("click",".jsToggleViewAssignCompanyCourse",function(e){e.preventDefault(),$('[data-key="jsView'+$(this).closest("tr").data("id")+'"]').toggleClass("hidden")}),$(document).on("click",".jsCheckAll",r),$(document).on("click",".jsAssignCourses",l),$(document).on("click",".jsCopyCoursesBtn",a),$(document).on("click",".jsDisableCourse",function(e){var o=$(this).closest("tr").data("id");alertify.confirm("Are You Sure?","Are you sure want to disable this course?",function(){n(o,"disable")},function(){})}),$(document).on("click",".jsEnableCourse",function(e){var o=$(this).closest("tr").data("id");alertify.confirm("Are You Sure?","Are you sure want to enable this course?",function(){n(o,"enable")},function(){})}),$(document).on("click",".jsManageJobRole",function(e){$(this).closest("tr").data("id");var o=$(this).data("course_id"),s=$(this).data("course_title");t(o,s)}),$(document).on("click",".jsEditCourseJobRoleBtn",function(o){o.preventDefault(),courseObj={job_titles:$("#jsEditCourseJobTitles").val()||[]},e(courseObj)}),window.sendCourseToSave=f,d()});