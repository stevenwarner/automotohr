$(function(){function e(e,t){o=e,s=t,i=new msVideoRecorder({recorderPlayer:"jsAddQuestionRecordingLive",previewPlayer:"jsAddQuestionRecordingRecorded",recordButton:"jsAddQuestionRecordingStart",playRecordedVideoBTN:"jsAddQuestionRecordingPlay",pauseRecordedVideoBTN:"jsAddQuestionRecordingPause",resumeRecordedVideoBTN:"jsAddQuestionRecordingResume",removeRecordedVideoBTN:"jsAddQuestionRecordingRemove",errorSectionReference:"jsAddQuestionRecordingError"}),$("#jsAddQuestionUploadVideo").msFileUploader({fileLimit:"30mb",allowedTypes:["mp4"]}),$("#jsAddQuestionType").select2({minimumResultsForSearch:-1}),$("#jsAddQuestionTitle").val(""),$("#jsAddQuestionHelp").val(""),$("#jsAddQuestionRequired").prop("checked",!1),$("#jsAddQuestionType").select("val","text"),$(".jsAddQuestionPlace").addClass("hidden"),$('#jsAddQuestionYesNoYSelect option[value="0"]').prop("selected",!0),$('#jsAddQuestionYesNoYStatus option[value="pass"]').prop("selected",!0),$('#jsAddQuestionYesNoNSelect option[value="0"]').prop("selected",!0),$('#jsAddQuestionYesNoNStatus option[value="pass"]').prop("selected",!0),$(".jsAddQuestionChoiceAnswer").val(""),$(".csChoiceBox").html(""),$('#jsAddQuestionChoiceAnswerScore option[value="0"]').prop("selected",!0),$('#jsAddQuestionChoiceAnswerStatus option[value="pass"]').prop("selected",!0),$(".jsAddQuestionVideoType").prop("checked",!1),$(".jsAddQuestionUploadVideoBox").addClass("hidden"),$(".jsAddQuestionRecordVideoBox").addClass("hidden"),$(".jsAddQuestionLinkVideoBox").addClass("hidden"),$("#jsAddQuestionLink").val(""),d={question_id:0,question_title:"",question_content:"",question_type:"text",choice_list:{},video_type:"upload",video_file_name:""},$(".jsPageBox").addClass("hidden"),$('.jsPageBox[data-id="add_question"]').removeClass("hidden")}async function t(){const e=[];d.question_title=$("#jsAddQuestionTitle").val().trim(),d.question_content=$("#jsAddQuestionHelp").val().trim(),d.question_type=$("#jsAddQuestionType").select2("val"),d.choice_list={},d.video_type=$(".jsAddQuestionVideoType:checked").val()||null,d.video_file_name="",d.question_title||e.push('"Question" field is mandatory.'),d.question_type||e.push('"Question type" field is mandatory.'),"single_choice"===d.question_type||"multiple_choice"===d.question_type?$(".csChoiceRow").map(function(t){console.log($(this).find(".jsAddQuestionChoiceAnswer").val());const o={answer_choice:$(this).find(".jsAddQuestionChoiceAnswer").val().trim(),answer_score:$(this).find(".jsAddQuestionChoiceAnswerScore").val().trim(),answer_status:$(this).find(".jsAddQuestionChoiceAnswerStatus").val().trim()};o.answer_choice||e.push('"Answer Choice" is missing for row '+(t+1)+"."),d.choice_list[t]=o}):"yes_no"===d.question_type&&(d.choice_list.yes={score:$("#jsAddQuestionYesNoYSelect option:checked").val(),status:$("#jsAddQuestionYesNoYStatus option:checked").val()},d.choice_list.no={score:$("#jsAddQuestionYesNoNSelect option:checked").val(),status:$("#jsAddQuestionYesNoNStatus option:checked").val()}),d.video_type||e.push('"Video type" field is mandatory.');let t={},n={},l=!1;if("upload"===d.video_type?(t=$("#jsAddQuestionUploadVideo").msFileUploader("get"),Object.keys(t).length?t.errorCode&&e.push(t.errorCode):e.push('"Video file" is mandatory. Please upload a file.'),l=!0):"record"===d.video_type?(n=await i.getVideo(),5===n.length&&e.push('"Video Recording" is mandatory. Please record a video.'),l=!0):"link"===d.video_type&&(d.video_file_name=$("#jsAddQuestionLink").val().trim(),d.video_file_name?d.video_file_name.isValidYoutubeLink()||d.video_file_name.isValidVimeoLink()||e.push("Invalid YouTube / Vimeo link."):e.push("YouTube / Vimeo link is required.")),e.length)return alertify.alert("ERROR!",getErrorsStringFromArray(e),CB);if(ml(!0,o),l){let e={};if("upload"===d.video_type?(e=await uploadFile(t),"string"==typeof e&&(e=JSON.parse(e))):e=await uploadStream(n),!Object.keys(e).length)return ml(!1,o),alertify.alert("ERROR!","Failed to upload file.",CB);d.video_file_name=e.data}d.question_id=Date.now(),i.close(),$("#jsAddQuestionUploadVideo").msFileUploader("clear"),s(d)}let o,s,i,d={question_id:0,question_title:"",question_content:"",question_type:"text",choice_list:{},video_type:"upload",video_file_name:""};$(document).on("click",".jsModalCancel",function(){i.close()}),$(document).on("change","#jsAddQuestionType",function(){$(".jsAddQuestionPlace").addClass("hidden"),"multiple_choice"===$(this).val()||"single_choice"===$(this).val()?$(".jsAddQuestionChoice").removeClass("hidden"):"yes_no"===$(this).val()&&$(".jsAddQuestionYesNo").removeClass("hidden")}),$(document).on("change",".jsAddQuestionVideoType",function(){$(".jsAddQuestionUploadVideoBox").addClass("hidden"),$(".jsAddQuestionRecordVideoBox").addClass("hidden"),$(".jsAddQuestionLinkVideoBox").addClass("hidden"),i.close(),"upload"===$(this).val()?$(".jsAddQuestionUploadVideoBox").removeClass("hidden"):"record"===$(this).val()?($(".jsAddQuestionRecordVideoBox").removeClass("hidden"),i.init()):$(".jsAddQuestionLinkVideoBox").removeClass("hidden")}),$(document).on("click",".jsAddQuestionSaveBtn",function(e){e.preventDefault(),t()}),$(document).on("click",".jsAddChoiceAnswer",function(e){e.preventDefault();let t='\n\t\t<!-- secondary question row -->\n\t\t<div class="csChoiceRow">\n\t\t\t<div class="row">\n\t\t\t\t<div class="col-xs-12 col-sm-5">\n\t\t\t\t\t<label>Answer Choice <strong class="text-danger">*</strong></label>\n\t\t\t\t\t<input type="text" class="form-control jsAddQuestionChoiceAnswer" />\n\t\t\t\t</div>\n\t\t\t\t<div class="col-xs-12 col-sm-3">\n\t\t\t\t\t<label>Question Score <strong class="text-danger">*</strong></label>\n\t\t\t\t\t<select class="form-control jsAddQuestionChoiceAnswerScore">\n\t\t\t\t\t\t<option value="0">Not acceptable - 0</option>\n\t\t\t\t\t\t<option value="1">Acceptable - 1</option>\n\t\t\t\t\t\t<option value="2">Good - 2</option>\n\t\t\t\t\t\t<option value="3">Very Good - 3</option>\n\t\t\t\t\t\t<option value="4">Excellent - 4</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="col-xs-12 col-sm-2">\n\t\t\t\t\t<label>Status <strong class="text-danger">*</strong></label>\n\t\t\t\t\t<select class="form-control jsAddQuestionChoiceAnswerStatus">\n\t\t\t\t\t\t<option value="pass">Pass</option>\n\t\t\t\t\t\t<option value="fail">Fail</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="col-xs-12 col-sm-1">\n\t\t\t\t\t<p>&nbsp;</p>\n\t\t\t\t\t<button class="btn btn-danger jsDeleteChoiceAnswer" type="button" title="Remove answer" placement="top">\n\t\t\t\t\t\t<i class="fa fa-times-circle" aria-hidden="true"></i>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<br />\n\t\t</div>\n\t\t\t\t';$(".csChoiceBox").append(t)}),$(document).on("click",".jsDeleteChoiceAnswer",function(e){e.preventDefault(),$(this).closest(".csChoiceRow").remove()}),window.loadAddQuestionView=e});