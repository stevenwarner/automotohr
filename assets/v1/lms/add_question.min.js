$(function(){function e(e,i){d=e,o=i,s=new msVideoRecorder({recorderPlayer:"jsAddQuestionRecordingLive",previewPlayer:"jsAddQuestionRecordingRecorded",recordButton:"jsAddQuestionRecordingStart",playRecordedVideoBTN:"jsAddQuestionRecordingPlay",pauseRecordedVideoBTN:"jsAddQuestionRecordingPause",resumeRecordedVideoBTN:"jsAddQuestionRecordingResume",removeRecordedVideoBTN:"jsAddQuestionRecordingRemove",errorSectionReference:"jsAddQuestionRecordingError"}),$("#jsAddQuestionUploadVideo").msFileUploader({fileLimit:"30mb",allowedTypes:["mp4"]}),$("#jsAddQuestionType").select2({minimumResultsForSearch:-1}),$("#jsAddQuestionMultipleChoiceAnswer").select2({minimumResultsForSearch:-1}),$("#jsAddQuestionTitle").val(""),$("#jsAddQuestionHelp").val(""),$("#jsAddQuestionType").select("val","text"),$(".jsAddQuestionMultipleChoiceBox").addClass("hidden"),$("#jsAddQuestionMultipleChoiceAnswer").select("val","choice_1"),$(".jsAddQuestionVideoType").prop("checked",!1),$(".jsAddQuestionUploadVideoBox").addClass("hidden"),$(".jsAddQuestionRecordVideoBox").addClass("hidden"),$("#jsAddQuestionMultipleChoice1").val(""),$("#jsAddQuestionMultipleChoice2").val(""),$("#jsAddQuestionMultipleChoice3").val(""),$("#jsAddQuestionMultipleChoice4").val(""),t={question_id:0,question_title:"",question_content:"",question_type:"text",choice_list:{},video_type:"upload",video_file_name:""},$(".jsPageBox").addClass("hidden"),$('.jsPageBox[data-id="add_question"]').removeClass("hidden")}async function i(){const e=[];if(t.question_title=$("#jsAddQuestionTitle").val().trim(),t.question_content=$("#jsAddQuestionHelp").val().trim(),t.question_type=$("#jsAddQuestionType").select2("val"),t.choice_list=[],t.video_type=$(".jsAddQuestionVideoType:checked").val()||null,t.video_file_name="",t.question_title||e.push('"Question" field is mandatory.'),t.question_type||e.push('"Question type" field is mandatory.'),"multiple_choice"===t.question_type){let i=$("#jsAddQuestionMultipleChoice1").val().trim(),d=$("#jsAddQuestionMultipleChoice2").val().trim(),o=$("#jsAddQuestionMultipleChoice3").val().trim(),s=$("#jsAddQuestionMultipleChoice4").val().trim(),n=$("#jsAddQuestionMultipleChoiceAnswer").select2("val");t.choice_list={choice1:i,choice2:d,choice3:o,choice4:s,rightChoice:n},i||e.push('"Choice one" is mandatory.'),d||e.push('"Choice two" is mandatory.'),o||e.push('"Choice three" is mandatory.'),s||e.push('"Choice four" is mandatory.'),n||e.push('"Correct choice" is mandatory.')}t.video_type||e.push('"Video type" field is mandatory.');let i={},n={},l=!1;if("upload"===t.video_type?(i=$("#jsAddQuestionUploadVideo").msFileUploader("get"),Object.keys(i).length?i.errorCode&&e.push(i.errorCode):e.push('"Video file" is mandatory. Please upload a file.'),l=!0):"record"===t.video_type?(n=await s.getVideo(),5===n.length&&e.push('"Video Recording" is mandatory. Please record a video.'),l=!0):"link"===t.video_type&&(t.video_file_name=$("#jsAddQuestionLink").val().trim(),t.video_file_name?t.video_file_name.isValidYoutubeLink()||t.video_file_name.isValidVimeoLink()||e.push("Invalid YouTube / Vimeo link."):e.push("YouTube / Vimeo link is required.")),e.length)return alertify.alert("ERROR!",getErrorsStringFromArray(e),CB);if(ml(!0,d),l){let e={};if("upload"===t.video_type?(e=await uploadFile(i),"string"==typeof e&&(e=JSON.parse(e))):e=await uploadStream(n),!Object.keys(e).length)return ml(!1,d),alertify.alert("ERROR!","Failed to upload file.",CB);t.video_file_name=e.data}t.question_id=Date.now(),s.close(),$("#jsAddQuestionUploadVideo").msFileUploader("clear"),o(t)}let d,o,s,t={question_id:0,question_title:"",question_content:"",question_type:"text",choice_list:{},video_type:"upload",video_file_name:""};$(document).on("click",".jsModalCancel",function(){s.close()}),$(document).on("change","#jsAddQuestionType",function(){$(".jsAddQuestionMultipleChoiceBox").addClass("hidden"),"multiple_choice"===$(this).val()&&$(".jsAddQuestionMultipleChoiceBox").removeClass("hidden")}),$(document).on("change",".jsAddQuestionVideoType",function(){$(".jsAddQuestionUploadVideoBox").addClass("hidden"),$(".jsAddQuestionRecordVideoBox").addClass("hidden"),$(".jsAddQuestionLinkVideoBox").addClass("hidden"),s.close(),"upload"===$(this).val()?$(".jsAddQuestionUploadVideoBox").removeClass("hidden"):"record"===$(this).val()?($(".jsAddQuestionRecordVideoBox").removeClass("hidden"),s.init()):$(".jsAddQuestionLinkVideoBox").removeClass("hidden")}),$(document).on("click",".jsAddQuestionSaveBtn",function(e){e.preventDefault(),i()}),window.loadAddQuestionView=e});