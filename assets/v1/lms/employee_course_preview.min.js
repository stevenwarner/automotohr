$(function(){function t(){null!==n&&n.abort(),ml(!0,"jsPageLoader");var t=apiURL+"lms/report/"+subordinateId+"/"+courseId;console.log(courseLanguage),"scorm"==courseType&&(t+="/"+courseLanguage),n=$.ajax({url:t,method:"GET"}).success(function(t){n=null,$("#jsPreviewCourse").html(t),"manual"===courseType&&e(),ml(!1,"jsPageLoader")}).fail(handleErrorResponse).always(function(){n=null,ml(!1,"jsPageLoader")})}function e(){null!==n&&n.abort(),ml(!0,"jsPageLoader"),n=$.ajax({url:apiURL+"lms/report/"+subordinateId+"/"+courseId+"/questions/attempt",method:"GET"}).success(function(t){n=null,$("#jsPreviewCourseQuestion").html(t),ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(){n=null,ml(!1,"jsPageLoader")})}function s(t){null!==n&&n.abort(),ml(!0,"jsPageLoader"),n=$.ajax({url:apiURL+"lms/report/"+t+"/courses?title="+r.title+"&status="+r.status,method:"GET"}).success(function(e){n=null;let s="",a=e.data.count,o=e.data.courses;$("#jsAssignedCount").html(a.assigned),$("#jsPendingCount").html(a.pending),$("#jsCompletedCount").html(a.completed),$("#jsExpiredSoonCount").html(a.expire_soon),e.data.assignedIds.length||($(".jsFilterSectionBtn").hide(),$(".jsSendReminderEmail").hide()),o.length?o.map(function(a){if((null==a.employee_sid||a.employee_sid==employeeId)&&e.data.assignedIds.includes(a.sid)&&!htmlCheck.includes(a.sid)){if(htmlCheck.push(a.sid),e.data.expiredSoonIds.includes(a.sid)?s+='<article class="article-sec" style="background: #fcf8e3 !important">':e.data.expiredIds.includes(a.sid)?s+='<article class="article-sec" style="background: #f2dede !important">':s+='<article class="article-sec">',e.data.expiredSoonIds.includes(a.sid)){const t=moment(a.course_end_period,"YYYY-MM-DD"),e=moment(),n=t.diff(e,"days");var o="";o=0==n?"Expiring today":1==n?`Expiring in ${n} day`:`Expiring in ${n} days`,s+='    <div class="row">',s+='        <div class="col-md-12 col-xs-12 text-right">',s+=`        \t<a href="javascript:;" class="btn btn-warning btn-xs csRadius5 csF14" title="This course will expired in ${n} days" placement="top">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-info-circle csF14" aria-hidden="true"></i>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t&nbsp;${o}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>`,s+="        </div>",s+="    </div>"}if(e.data.expiredIds.includes(a.sid)){const t=moment(a.course_end_period,"YYYY-MM-DD"),e=moment(),o=Math.abs(t.diff(e,"days"));var n="";n=0==o?"Expired today":1==o?`Expired ${o} day ago`:`Expired ${o} days ago`,s+='    <div class="row">',s+='        <div class="col-md-12 col-xs-12 text-right">',s+=`        \t<a href="javascript:;" class="btn btn-danger btn-xs csRadius5 csF14" title="This course was expired ${o} days ago." placement="top">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-info-circle csF14" aria-hidden="true"></i>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t&nbsp;${n}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>`,s+="        </div>",s+="    </div>"}s+="    <h1>",s+=a.course_title,s+="    </h1>",s+="    <br>",s+='    <div class="row">',s+='        <div class="col-md-3 col-xs-12">',s+='            <p class="csColumSection"><strong>ASSIGNED DATE</strong></p>',s+=`            <p>${moment(a.course_start_period).format(i)}</p>`,s+="        </div>",s+='        <div class="col-md-3 col-xs-12">',s+='            <p class="csColumSection"><strong>DUE DATE</strong></p>',null===a.course_end_period?s+="--":s+=`            <p>${moment(a.course_end_period).format(i)}</p>`,s+="        </div>",s+='        <div class="col-md-3 col-xs-12">',s+='            <p class="csColumSection"><strong>STATUS</strong></p>',s+=`            <p>${"passed"==a.course_status?"COMPLETED":"PENDING"}</p>`,s+="        </div>",s+='        <div class="col-md-3 col-xs-12">',s+='            <p class="csColumSection"><strong>ASSIGNED TO</strong></p>',s+=`            <p>${e.data.employeeName}</p>`,s+="        </div>",s+="    </div>",s+='    <div class="row">',s+='        <div class="col-md-3 col-xs-12 hidden">',s+='            <p class="csColumSection"><strong>TIME REMAINING/TOTAL</strong></p>',s+="            <p>15 min / 15 min</p>",s+="        </div>",s+='        <div class="col-md-3 col-xs-12">',s+='            <p class="csColumSection"><strong>STARTED DATE </strong></p>',s+=`            <p>${a.created_at?moment(a.created_at).format(i):"-"}</p>`,s+="        </div>",s+='        <div class="col-md-3 col-xs-12">',s+='            <p class="csColumSection"><strong>LANGUAGE</strong></p>',s+=`            <select class="form-control jsSelectCourseLanguage jsCourseLanguage${a.sid}" data-course_id="${a.sid}">`,"scorm"==a.course_type?a.course_languages.map(function(t){s+=`            <option value="${t}">${t.charAt(0).toUpperCase()+t.slice(1)}</option>`}):s+='                <option value="english">English</option>',s+="            </select>",s+="        </div>",s+='        <div class="col-md-6 col-xs-12 text-right">',s+="            <p>&nbsp;</p>";var r="";r="scorm"==a.course_type?a.course_languages[0]:"english","passed"==a.course_status?(s+=`            <a class="btn btn-info csRadius5 csF16 jsStartCourse jsStartCourse${a.sid}" data-course_id="${a.sid}" href="${baseURI}lms/subordinate/course/${a.sid}/${t}/${reviewAs}/${r}">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-eye"></i>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tView Content\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>`,s+=`        <a class="btn btn-info csRadius5 csF16" href="${baseURI}lms/courses/${a.sid}/${t}/subordinate/certificate}">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-eye"></i>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tView Certificate\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>`):s+=`            <a class="btn btn-info csRadius5 csF16 jsStartCourse jsStartCourse${a.sid}" data-course_id="${a.sid}" href="${baseURI}lms/subordinate/course/${a.sid}/${t}/${reviewAs}/${r}">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-play"></i>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tLaunch Content\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>`,s+="        </div>",s+="    </div>",s+="</article>"}}):s='<p class="alert alert-info text-center">No course(s) found.</p>',$("#jsMyAssignedCourses").html(s),$("#jsEmployeeListing").hide(),$("#jsEmployeeCourses").show(),ml(!1,"jsPageLoader")}).fail(handleErrorResponse).always(function(){n=null,ml(!1,"jsPageLoader")})}function a(){var t=[],e={};return e.employee_sid=subordinateId,e.employee_name=subordinateName,t.push(e),t}function o(t,e){null!==n&&n.abort(),ml(!0,"jsPageLoader"),n=$.ajax({url:baseURI+"lms/courses/emailReminder/single",method:"POST",data:{employeeList:t,note:e}}).success(function(t){return n=null,ml(!1,"jsPageLoader"),alertify.alert("SUCCESS!","You have successfully sent an email reminder to <b>"+subordinateName+"</b>.")}).fail(handleErrorResponse).done(function(t){n=null})}let n=null,i="MMM DD YYYY, ddd",r={title:"",status:"all"};if(search.length&&(r.status=search),$(".jsFilterBox").click(function(t){t.preventDefault(),$(".jsCourseTitleMyCourse").val(""),$('.jsCourseStatus option[value="'+$(this).data("key")+'"]').prop("selected",!0),r.title=$(".jsCourseTitleMyCourse").val()||"",r.status=$(".jsCourseStatus").val(),s(subordinateId)}),$(".jsApplyFilterMyCourse").click(function(t){t.preventDefault(),r.title=$(".jsCourseTitleMyCourse").val()||"",r.status=$(".jsCourseStatus").val(),s(subordinateId)}),$(".jsClearFilterMyCourse").click(function(t){t.preventDefault(),$(".jsCourseTitleMyCourse").val(""),$('.jsCourseStatus option[value="all"]').prop("selected",!0),r.title=$(".jsCourseTitleMyCourse").val()||"",r.status=$(".jsCourseStatus").val(),s(subordinateId)}),"subordinate_course"===page&&"scorm"===courseType){function l(t){}window.sendCourseToSave=l}$(document).on("click",".jsStartCourse",function(t){t.preventDefault();var e=$(this).data("course_id"),s=$(".jsCourseLanguage"+e).val(),a=baseURI+"lms/subordinate/course/"+e+"/"+subordinateId+"/"+reviewAs+"/"+s;$(this).attr("href",a),window.location=$(this).attr("href").toString()}),$(document).on("change",".jsSelectCourseLanguage",function(t){t.preventDefault();var e=$(this).data("course_id"),s=$(this).val(),a=baseURI+"lms/subordinate/course/"+e+"/"+subordinateId+"/"+reviewAs+"/"+s;$(".jsStartCourse"+e).attr("href",a)}),$(document).on("change",".jsChangeScormLanguage",function(t){t.preventDefault();var e=$(this).data("course_id"),s=$(this).val(),a=baseURI+"lms/subordinate/course/"+e+"/"+subordinateId+"/"+reviewAs+"/"+s;alertify.confirm("Are you sure you want to change course language?",function(){window.location=a},CB).setHeader("Confirm")}),"subordinate_courses"===page?s(subordinateId):($(".jsSaveQuestionResult").hide(),t()),$(document).on("click",".jsSendReminderEmail",function(t){t.preventDefault(),alertify.confirm("Do you really want to send email reminder to <b>"+subordinateName+"</b>?",function(){alertify.prompt("Please Enter a Note","","",function(t,e){},function(){alertify.error("Cancel")}).setContent('<textarea style="resize: none;" rows="5" cols="50"> </textarea>').set("onok",function(t){employeeInfo=a(),o(employeeInfo,this.elements.content.querySelector("textarea").value)})})})});