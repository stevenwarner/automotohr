$(function(){function e(e){null!==a&&a.abort(),ml(!0,"jsPageLoader"),a=$.ajax({url:apiURL+"lms/trainings/"+employeeId+"/"+courseId+"/"+e,method:"PUT"}).success(function(s){a=null,"language_changed"===s.status&&(window.location=baseURI+"lms/courses/"+courseId+"/"+e),ml(!1,"jsPageLoader")}).fail(handleErrorResponse).always(function(){a=null,ml(!1,"jsPageLoader")})}function s(){null!==a&&a.abort(),ml(!0,"jsPageLoader"),a=$.ajax({url:apiURL+"lms/trainings/"+employeeId+"/"+courseId+"/"+courseLanguage+"/start?_has="+(-1!==window.location.host.indexOf("www.")?"y":"n"),method:"GET"}).success(function(e){a=null,"course_started"===e.status&&($("#jsStartCourseDiv").hide(),$(".jsSaveQuestionResult").show(),o()),ml(!1,"jsPageLoader")}).fail(handleErrorResponse).always(function(){a=null,ml(!1,"jsPageLoader")})}function o(){null!==a&&a.abort(),ml(!0,"jsPageLoader"),a=$.ajax({url:apiURL+"lms/trainings/"+employeeId+"/"+courseId+"/"+courseLanguage+"?_has="+(-1!==window.location.host.indexOf("www.")?"y":"n"),method:"GET"}).success(function(e){a=null,$("#jsPreviewCourse").html(e),"manual"===courseType&&t(),ml(!1,"jsPageLoader")}).fail(handleErrorResponse).always(function(){a=null,ml(!1,"jsPageLoader")})}function t(){null!==a&&a.abort(),ml(!0,"jsPageLoader"),a=$.ajax({url:apiURL+"lms/trainings/"+employeeId+"/"+courseId+"/questions/"+mode,method:"GET"}).success(function(e){a=null,$("#jsPreviewCourseQuestion").html(e),ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(){a=null,ml(!1,"jsPageLoader")})}function n(e){null!==a&&a.abort(),ml(!0,"jsPageLoader"),a=$.ajax({url:apiURL+"lms/trainings/"+employeeId,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify({courseId:courseId,answers:e})}).success(function(e){return a=null,"failed"===e.status?alertify.alert("WARNING!","Apologies for not passing this course. We highly encourage you to consider giving it another attempt.",function(){window.location=baseURI+"lms/courses/"+courseId}):"passed"===e.status?alertify.alert("SUCCESS!","Congratulations! you have successfully passed this course!",function(){window.location=baseURI+"lms/courses/my"}):void ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(){a=null,ml(!1,"jsPageLoader")})}let a=null;if($(".jsStartCourseButton").click(function(e){e.preventDefault(),alertify.confirm("Are you sure you want to start this course?",function(){s()},CB).setHeader("Confirm")}),$(document).on("change",".jsChangeScormLanguage",function(s){s.preventDefault();var o=$(this).val();alertify.confirm("Are you sure you want to change course language?",function(){e(o)},CB).setHeader("Confirm")}),"scorm"===courseType){function r(e){"completed"!=lessonStatus&&(a=$.ajax({url:apiURL+"lms/trainings/save_scorm/"+employeeId,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify({courseId:courseId,cmiElement:e,type:"scorm",version:scormVersion})}).success(function(e){return"failed"===e.status?alertify.alert("WARNING!","Apologies for not passing this course. We highly encourage you to consider giving it another attempt.",function(){window.location=baseURI+"lms/courses/"+courseId+"/"+courseLanguage}):"passed"===e.status?alertify.alert("SUCCESS!","Congratulations on successfully passing this course!",function(){window.location=baseURI+"lms/courses/my_lms_dashboard"}):void 0}).fail(handleErrorResponse).done(function(e){a=null}))}window.sendCourseToSave=r}$(document).on("click",".jsSaveQuestionResult",function(e){e.preventDefault();var s=[],o={};if(JSON.parse(questions).map(function(e){var t=e.question_type+"_"+e.question_id;if("yes_no"===e.question_type||"single_choice"===e.question_type){var n=$("input[name="+t+"]:checked").val();o[e.question_id]=n,n&&void 0!==n||1==e.question_required&&s.push(e.question_title)}else if("multiple_choice"===e.question_type){var a=[];$("input[name='"+t+"']:checked").each(function(){a.push($(this).val())}),o[e.question_id]=a,0==a.length&&1==e.question_required&&s.push(e.question_title)}else if("text"===e.question_type){var r=$('textarea[name="textarea_'+e.question_id+'"]').val();o[e.question_id]=r,r&&void 0!==r||1==e.question_required&&s.push(e.question_title)}}),s.length)return alertify.alert("WARNING!",getQuestionsFromArray(s),CB);try{return n(o),alertify.alert("SUCCESS!",createCourseResponse.data,function(){getLMSDefaultCourses(),$("#"+modalId).remove()})}catch(e){return ml(!1,modalLoaderId),alertify.alert("ERROR!",getErrorsStringFromArray(e.errors,"Errors!!"),CB)}}),"not_started"===lessonStatus?(ml(!1,"jsPageLoader"),$("#jsStartCourseDiv").show(),$(".jsSaveQuestionResult").hide()):"started"!==lessonStatus&&"completed"!==lessonStatus||(o(),"completed"===lessonStatus&&$(".jsSaveQuestionResult").hide())});