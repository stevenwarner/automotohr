$(function(){function t(t,e){null!==l&&l.abort(),ml(!0,"jsPageLoader"),l=$.ajax({url:apiURL+"lms/trainings/"+employeeId+"/"+e+"/"+t,method:"PUT"}).success(function(s){l=null,"language_changed"===s.status&&(window.location=baseURI+"lms/courses/"+e+"/"+t),ml(!1,"jsPageLoader")}).fail(handleErrorResponse).always(function(){l=null,ml(!1,"jsPageLoader")})}function e(){null!==l&&l.abort(),ml(!0,"jsPageLoader"),l=$.ajax({url:apiURL+"lms/trainings/"+employeeId+"?title="+i.title+"&status="+i.status,method:"GET"}).success(function(t){l=null;let e=t.data.count,i=t.data.courses;$("#jsAssignedCount").html(e.assigned),$("#jsPendingCount").html(e.pending),$("#jsCompletedCount").html(e.completed),$("#jsExpiredSoonCount").html(e.expire_soon),t.data.assignedIds.length||($(".jsFilterSectionBtn").hide(),$(".jsSendReminderEmail").hide()),i.length&&i.map(function(e){null!=e.employee_sid&&e.employee_sid!=employeeId||t.data.assignedIds.includes(e.sid)&&(t.data.inprogressIds.includes(e.sid)?u.push(e):t.data.expiredIds.includes(e.sid)?c.push(e):t.data.expiredSoonIds.includes(e.sid)?d.push(e):t.data.readyToStartIds.includes(e.sid)?g.push(e):t.data.passedIds.includes(e.sid)?m.push(e):p.push(e))}),s(u,"jsInprogressCourses"),s(c,"jsPastDueCourses"),s(d,"jsDueSoonCourses"),s(g,"jsAssignedCourses"),s(m,"jsPassedCourses"),e.assigned&&(o(e),a(e),n(e),r(e)),ml(!1,"jsPageLoader")}).fail(handleErrorResponse).always(function(){l=null,ml(!1,"jsPageLoader")})}function s(t,e){let s="";if(t.length)t.map(function(t){s+='    <div class="rows">',s+='    <div class="col-sm-4">',s+='    <article class="article-sec">',t.course_banner?s+=`    <div class="row">\n\t\t\t\t\t\t\t\t\t\t\t<div class="col-md-12 col-xs-12">\n\t\t\t\t\t\t\t\t\t\t\t\t<img src="https://automotohrattachments.s3.amazonaws.com/${t.course_banner}" style="height: 214px !important;" />\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t`:s+='    <div class="row">\n\t\t\t\t\t\t\t\t\t\t\t<div class="col-md-12 col-xs-12">\n\t\t\t\t\t\t\t\t\t\t\t\t<img src="https://automotohrattachments.s3.amazonaws.com/default_course_banner-Uk2W5O.jpg" style="height: 214px !important;" />\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t',s+='    <h1 style="height: 58px;">',s+=t.course_title,s+="    </h1>",s+='    <div class="row">',s+='        <div class="col-md-12 col-xs-12">',s+=`            <p>${t.course_content.substr(0,50)}&nbsp;</p>`,s+="        </div>",s+="    </div>","jsInprogressCourses"!=e&&"jsPassedCourses"!=e||(s+='    <div class="row">',s+='        <div class="col-md-6 col-xs-12">',s+='            <p class="csColumSection"><strong>START DATE</strong></p>',s+=`            <p>${moment(t.start_date).format(y)}</p>`,s+="        </div>",s+='        <div class="col-md-6 col-xs-12">',s+='            <p class="csColumSection"><strong>END DATE</strong></p>',t.end_date&&"jsPassedCourses"==e?s+=`            <p>${moment(t.end_date).format(y)}</p>`:s+="--",s+="        </div>",s+="    </div>"),s+='    <div class="row">',s+='        <div class="col-md-12 col-xs-12 text-center">',s+=`            <select class="form-control jsSelectCourseLanguage jsCourseLanguage${t.sid}" data-course_id="${t.sid}">`;var o="",a="";o="scorm"==t.course_type?t.course_languages[0]:"english","scorm"==t.course_type?t.course_languages.map(function(e){t.selected_language&&t.selected_language==e?(o=t.selected_language,a=t.selected_language,s+=`            <option value="${e}" selected="selected">${e.charAt(0).toUpperCase()+e.slice(1)}</option>`):s+=`            <option value="${e}">${e.charAt(0).toUpperCase()+e.slice(1)}</option>`}):s+='                <option value="english">English</option>',s+="            </select>",s+="        </div>",s+="    </div>",s+='    <div class="row">',s+='        <div class="col-md-12 col-xs-12 text-center">',s+="            <p>&nbsp;</p>","passed"==t.course_status?(s+=`        <button class="btn btn-info csRadius5 csF16 jsStartCourse jsStartCourse${t.sid}" data-previous_language="${a}" data-course_id="${t.sid}" href="${baseURI+"lms/courses/"+t.sid+"/"+o}">\n\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-eye"></i>\n\t\t\t\t\t\t\t\t\t\t\t\tView Content\n\t\t\t\t\t\t\t\t\t\t\t</button>`,s+=`        <a class="btn btn-info csRadius5 csF16" href="${window.location.origin}/lms/courses/${t.sid}/${employeeId}/my/certificate">\n\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-eye"></i>\n\t\t\t\t\t\t\t\t\t\t\t\tView Certificate\n\t\t\t\t\t\t\t\t\t\t\t</a>`):s+=`        <button class="btn btn-info csRadius5 csF16 jsStartCourse jsStartCourse${t.sid}" data-previous_language="${a}" data-course_id="${t.sid}" href="${baseURI+"lms/courses/"+t.sid+"/"+o}">\n\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-play"></i>\n\t\t\t\t\t\t\t\t\t\t\t\tLaunch Content\n\t\t\t\t\t\t\t\t\t\t\t</button>`,s+="        </div>",s+="    </div>",s+="</article>",s+="</div>",s+="</div>"});else{var o="Apologies, but no assigned course was found.";"jsInprogressCourses"==e?o="Apologies, but there are currently no courses in progress.":"jsPastDueCourses"==e?o="Apologies, but no past due courses were found.":"jsDueSoonCourses"==e&&(o="Apologies, but no courses with upcoming expiration dates were found."),s+='<div class="col-sm-12">',s+=' <p class="alert alert-info text-center">',s+=o,s+=" </p>",s+="</div>"}$("#"+e).html(s)}function o(t){var e=Math.round((t.assigned-t.pending)/t.assigned*100);$("#jsOverViewTrainings").html(e+"%"),$("#jsOverViewCourseDueSoon").html(t.pending),$("#jsOverViewCourseTotal").html(t.assigned)}function a(t){Highcharts.chart("container",{chart:{type:"pie"},title:{text:"Assigned Course(s)"},tooltip:{valueSuffix:""},plotOptions:{pie:{dataLabels:{enabled:!0,style:{fontSize:"12px"}}},series:{allowPointSelect:!0,cursor:"pointer",dataLabels:[{enabled:!0,distance:20},{enabled:!0,distance:-40,format:"{point.percentage:.1f}%",style:{fontSize:"1.2em",textOutline:"none",opacity:.7},filter:{operator:">",property:"percentage",value:10}}]}},series:[{name:"Course(s)",colorByPoint:!0,point:{events:{click:function(t){window.open(t.point.url,"_blank"),t.preventDefault()}}},data:[{name:"Due Soon",y:t.expire_soon,color:"#feb56a",url:baseURI+"lms/courses/my?type=due_soon"},{name:"Past Due",sliced:!0,selected:!0,y:t.expired,color:"#fa4b42",url:baseURI+"lms/courses/my?type=past_due"},{name:"In Progress",y:t.inprogress,color:"#544fc5",url:baseURI+"lms/courses/my?type=inprogress"},{name:"Ready To Start",y:t.readyToStart,color:"#2caffe",url:baseURI+"lms/courses/my?type=ready_to_start"},{name:"Passed",y:t.passed,color:"#00e272",url:baseURI+"lms/courses/my?type=completed"}]}],tooltip:{style:{fontSize:"14px"}}})}function n(t){Highcharts.chart("container1",{chart:{type:"column"},title:{align:"left",text:"Assigned Course(s) Bar Chart"},accessibility:{announceNewData:{enabled:!0}},xAxis:{type:"category",labels:{style:{fontSize:"12px"}}},yAxis:{title:{text:"Total number of assigned course(s)"},labels:{style:{fontSize:"12px"}}},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y}"}}},tooltip:{headerFormat:'<span style="font-size:14px">{series.name}</span><br>',pointFormat:'<span style="font-size:12px; color:{point.color}">{point.name}:</span> <b style="font-size:12px">{point.y} course(s)</b>'},series:[{name:"Course(s)",colorByPoint:!0,point:{events:{click:function(t){window.open(t.point.url,"_blank"),t.preventDefault()}}},data:[{name:"Assigned ",color:"#6B8ABB",y:t.assigned,url:baseURI+"lms/courses/my?type=assigned"},{name:"Pending",color:"#ff834e",y:t.pending,url:baseURI+"lms/courses/my?type=pending"},{name:"Ready To Start",color:"#2caffe",y:t.readyToStart,url:baseURI+"lms/courses/my?type=ready_to_start"},{name:"In Progress",color:"#544fc5",y:t.inprogress,url:baseURI+"lms/courses/my?type=inprogress"},{name:"Passed",color:"#00e272",y:t.passed,url:baseURI+"lms/courses/my?type=completed"},{name:"Past Due",color:"#fa4b42",y:t.expired,url:baseURI+"lms/courses/my?type=past_due"},{name:"Due Soon",color:"#feb56a",y:t.expire_soon,url:baseURI+"lms/courses/my?type=due_soon"}],dataLabels:{style:{fontSize:"12px"}}}]})}function r(t){Highcharts.chart("container2",{chart:{type:"gauge",plotBackgroundColor:null,plotBackgroundImage:null,plotBorderWidth:0,plotShadow:!1,height:"80%"},title:{text:"Course(s) Passing Rate"},pane:{startAngle:-90,endAngle:89.9,background:null,center:["50%","75%"],size:"110%"},yAxis:{min:0,max:t.assigned,tickPixelInterval:100,tickPosition:"inside",tickColor:Highcharts.defaultOptions.chart.backgroundColor||"#FFFFFF",tickLength:20,tickWidth:2,minorTickInterval:null,labels:{distance:20,style:{fontSize:"14px"}},lineWidth:0,plotBands:[{from:t.assigned,to:t.assigned/2,color:"#55BF3B",thickness:20,borderRadius:"50%"},{from:t.assigned/3,to:0,color:"#DF5353",thickness:20,borderRadius:"50%"},{from:t.assigned/1.9,to:t.assigned/3.1,color:"#DDDF0D",thickness:20}]},series:[{name:"Speed",data:[t.passed],tooltip:{valueSuffix:" km/h"},dataLabels:{format:"{y} Passed",borderWidth:0,color:Highcharts.defaultOptions.title&&Highcharts.defaultOptions.title.style&&Highcharts.defaultOptions.title.style.color||"#333333",style:{fontSize:"16px"}},dial:{radius:"80%",backgroundColor:"gray",baseWidth:12,baseLength:"0%",rearLength:"0%"},pivot:{backgroundColor:"gray",radius:6}}]})}let l=null,i={title:"",status:"all"},u=[],c=[],d=[],p=[],g=[],m=[],y="MMM DD YYYY, ddd";$(".jsFilterBox").click(function(t){t.preventDefault(),$(".jsCourseTitleMyCourse").val(""),$('.jsCourseStatus option[value="'+$(this).data("key")+'"]').prop("selected",!0),i.title=$(".jsCourseTitleMyCourse").val()||"",i.status=$(".jsCourseStatus").val(),e()}),$(".jsApplyFilterMyCourse").click(function(t){t.preventDefault(),i.title=$(".jsCourseTitleMyCourse").val()||"",i.status=$(".jsCourseStatus").val(),e()}),$(".jsClearFilterMyCourse").click(function(t){t.preventDefault(),$(".jsCourseTitleMyCourse").val(""),$('.jsCourseStatus option[value="all"]').prop("selected",!0),i.title=$(".jsCourseTitleMyCourse").val()||"",i.status=$(".jsCourseStatus").val(),e()}),$(document).on("click",".jsStartCourse",function(e){e.preventDefault();var s=$(this).data("course_id"),o=$(".jsCourseLanguage"+s).val(),a=baseURI+"lms/courses/"+s+"/"+o,n=$(this).data("previous_language");n.length&&n!=o?alertify.confirm("Are you sure you want to change course language?",function(){t(o,s)},CB).setHeader("Confirm"):($(this).attr("href",a),window.location=$(this).attr("href").toString())}),$(document).on("change",".jsSelectCourseLanguage",function(t){t.preventDefault();var e=$(this).data("course_id"),s=$(this).val(),o=baseURI+"lms/courses/"+e+"/"+s;$(".jsStartCourse"+e).attr("href",o)}),e()});