$((function(){let e=null,r=0,t="jsCreateCourseModel",o="jsCreateCourseModelLoader";function s(){null!==e&&e.abort(),e=$.ajax({url:apiURL+"lms/course/add/view",method:"GET"}).success((function(r){e=null,$("#"+t+"Body").html(r),$("#jsAddCourseJobTitles").select2({closeOnSelect:!1}),$("#jsAddCourseFile").msFileUploader({fileLimit:"30mb",allowedTypes:["zip"]}),ml(!1,o)})).fail((function(r){return e=null,ml(!1,"jsPageLoader"),alertify.alert("Errors!",r.responseJSON.errors.join("<br />"),CB)}))}$(document).on("click",".jsAddCourseCreateBtn",(function(e){e.preventDefault();!async function(e){const s=[];e.course_title||s.push("Course title is required.");e.job_titles.length||s.push("Select at least one job title.");e.course_type||s.push("Course type is required.");"scorm"===e.course_type&&(Object.keys(e.course_file).length?e.course_file.errorCode&&s.push(e.course_file.errorCode):s.push("Please upload the SCORM file."));if(s.length)return alertify.alert("ERROR!",getErrorsStringFromArray(s),CB);ml(!0,o);let l=await uploadFile(e.course_file);if(l=JSON.parse(l),!l.data)return alertify.alert("ERROR","Failed to upload file.",CB);e.course_file=l.data,e.company_code=r;try{const r=await function(e){return new Promise((function(r,t){$.ajax({url:apiURL+"lms/course",method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(e)}).success(r).fail((function(e){t(e.responseJSON)}))}))}(e);alertify.alert("SUCCESS!",r.data,(function(){$("#"+t).remove(),getLMSDefaultCourses()}))}catch(e){return alertify.alert("ERROR!",getErrorsStringFromArray(e.errors,"Errors!!"),CB)}}({course_title:$("#jsAddCourseTitle").val().trim(),course_content:$("#jsAddCourseAbout").val().trim(),job_titles:$("#jsAddCourseJobTitles").val()||[],course_type:$(".jsAddCourseType:checked").val(),course_file:$("#jsAddCourseFile").msFileUploader("get")||{}})})),window.startCreateCourseProcess=function(e){r=e,Modal({Id:t,Title:"Create Course",Loader:o,Cl:"container",Ask:!0,Body:'<div id="'+t+'Body"></div>'},s)},generateBrowserAlert()}));