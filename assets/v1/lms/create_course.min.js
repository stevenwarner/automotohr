$((function(){let e=null,t=0,s="jsCreateCourseModel",o="jsCreateCourseModelLoader",r=[];function n(e){t=e,Modal({Id:s,Title:"Create Course",Loader:o,Cl:"container",Ask:!0,Body:'<div id="'+s+'Body"></div>'},i)}function i(){null!==e&&e.abort(),e=$.ajax({url:apiURL+"lms/course/view",method:"GET"}).success((function(t){e=null,$("#"+s+"Body").html(t),$("#jsAddCourseVersion").select2({minimumResultsForSearch:-1}),$("#jsAddCourseJobTitles").select2({closeOnSelect:!1}),$("#jsAddCourseFile").msFileUploader({fileLimit:"30mb",allowedTypes:["zip"]}),ml(!1,o)})).fail((function(t){return e=null,ml(!1,"jsPageLoader"),alertify.alert("Errors!",t.responseJSON.errors.join("<br />"),CB)}))}function a(e){ml(!1,o),r.push(e),u(),$(".jsPageBox").addClass("hidden"),$('.jsPageBox[data-id="main"]').removeClass("hidden")}function u(){if(!r.length)return $("#jsAddCourseQuestionsList").html('<tr><th colspan="3"><p class="alert alert-info text-center">No questions found yet.</p></th></tr>');let e="";r.map((function(t){e+='<tr data-key="'+t.question_id+'">',e+='\t<td class="vam">'+t.question_title+"</td>",e+='\t<td class="vam">'+t.question_type+"</td>",e+='\t<td class="vam">',e+='\t\t<button type="button" class="btn btn-warning jsEditQuestion" title="Edit question" placement="top">',e+='\t\t\t<i class="fa fa-edit" aria-hidden="true"></i>',e+="\t\t</button>",e+='\t\t<button type="button" class="btn btn-danger jsDeleteQuestion" title="Delete question" placement="top">',e+='\t\t\t<i class="fa fa-times-circle" aria-hidden="true"></i>',e+="\t\t</button>",e+="\t</td>",e+="</tr>"})),$("#jsAddCourseQuestionsList").html(e)}$(document).on("click",".jsAddCourseCreateBtn",(function(e){e.preventDefault();!async function(e){const n=[];e.course_title||n.push("Course title is required.");e.job_titles.length||n.push("Select at least one job title.");e.course_type||n.push("Course type is required.");e.course_questions=r,"scorm"===e.course_type?Object.keys(e.course_file).length?e.course_file.errorCode&&n.push(e.course_file.errorCode):n.push("Please upload the SCORM file."):r.length||n.push("At least one question is required for manual course.");if(n.length)return alertify.alert("ERROR!",getErrorsStringFromArray(n),CB);ml(!0,o);let i=await uploadFile(e.course_file);if(i=JSON.parse(i),!i.data)return alertify.alert("ERROR","Failed to upload file.",CB);e.course_file=i.data,e.company_code=t;try{const t=await function(e){return new Promise((function(t,s){$.ajax({url:apiURL+"lms/course",method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(e)}).success(t).fail((function(e){s(e.responseJSON)}))}))}(e);alertify.alert("SUCCESS!",t.data,(function(){$("#"+s).remove(),getLMSDefaultCourses()}))}catch(e){return alertify.alert("ERROR!",getErrorsStringFromArray(e.errors,"Errors!!"),CB)}}({course_title:$("#jsAddCourseTitle").val().trim(),course_content:$("#jsAddCourseAbout").val().trim(),job_titles:$("#jsAddCourseJobTitles").val()||[],course_type:$(".jsAddCourseType:checked").val(),course_version:$("#jsAddCourseVersion").val(),course_file:$("#jsAddCourseFile").msFileUploader("get")||{},course_questions:r})})),$(document).on("click",".jsAddCourseType",(function(){$(".jsAddCourseScormBox").addClass("hidden"),$(".jsAddManualCourseBox").addClass("hidden"),"scorm"===$(this).val()?$(".jsAddCourseScormBox").removeClass("hidden"):($(".jsAddManualCourseBox").removeClass("hidden"),u())})),$(document).on("click",".jsAddQuestionBtn",(function(e){e.preventDefault(),loadAddQuestionView(o,a)})),$(document).on("click",".jsBackToAddCoursePage",(function(e){e.preventDefault(),$(".jsPageBox").addClass("hidden"),$('.jsPageBox[data-id="main"]').removeClass("hidden")})),$(document).on("click",".jsDeleteQuestion",(function(e){e.preventDefault();let t=$(this).closest("tr").data("key");return alertify.confirm("Are you certain about deleting the chosen question?",(function(){!function(e){r=r.filter((function(t){return t.question_id!=e})),u()}(t)}),CB)})),$(document).on("click",".jsEditQuestion",(function(e){e.preventDefault();let t=$(this).closest("tr").data("key");loadEditQuestionView(function(e){return r.filter((function(t){return t.question_id==e}))[0]}(t),o,(function(e){$(".jsPageBox").addClass("hidden"),$('.jsPageBox[data-id="main"]').removeClass("hidden");let s=[];r.map((function(o){o.question_id===t?s.push(e):s.push(o)})),r=s,u(),ml(!1,o)}))})),window.startCreateCourseProcess=n,generateBrowserAlert(),n(0)}));