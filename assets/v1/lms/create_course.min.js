$(function(){function e(e){c=e,Modal({Id:p,Title:"Create Course",Loader:m,Cl:"container",Ask:!0,Body:'<div id="'+p+'Body"></div>'},t)}function t(){f=[],null!==l&&l.abort(),l=$.ajax({url:apiURL+"lms/course/view",method:"GET"}).success(function(e){l=null,$("#"+p+"Body").html(e),$("#jsAddCourseVersion").select2({minimumResultsForSearch:-1}),$("#jsAddCourseJobTitles").select2({closeOnSelect:!1}),$("#jsAddCourseReassignType").val("year"),$("#jsAddCourseFile").msFileUploader({fileLimit:"50mb",allowedTypes:["zip"]}),$("#jsAddCourseVideoFile").msFileUploader({fileLimit:"50mb",allowedTypes:["mp4","ppt","pptx","mov"]}),$("#jsAddCourseStartPeriod").datepicker({dateFormat:"mm/dd/yy",changeYear:!0,changeMonth:!0,onSelect:function(e){$("#jsAddCourseEndPeriod").datepicker("option","minDate",e)}}).datepicker("option","maxDate",$("#jsAddCourseEndPeriod").val()),$("#jsAddCourseEndPeriod").datepicker({dateFormat:"mm/dd/yy",changeYear:!0,changeMonth:!0,onSelect:function(e){$("#jsAddCourseStartPeriod").datepicker("option","maxDate",e)}}).datepicker("option","minDate",$("#jsAddCourseStartPeriod").val()),$('.jsAddCourseFileType[value="'+C+'"]').trigger("click"),ml(!1,m)}).fail(handleErrorResponse).done(function(){l=null,ml(!1,"jsPageLoader")})}async function s(e){const t=[];if(e.course_title||t.push("Course title is required."),e.job_titles.length||t.push("Select at least one job title."),e.course_recurring_in?e.course_recurring_in.isValidInteger()||t.push("Please enter valid integer value."):t.push("Course recurring number is required."),e.course_start_period||t.push("Course start date is required."),e.course_end_period||t.push("Course end date is required."),e.course_recurring_type.length||t.push("Course recurring type is required."),e.course_type||t.push("Course type is required."),e.course_questions=f,"link"===e.course_file_type&&"manual"===e.course_type?e.course_file_link?e.course_file_link.isValidYoutubeLink()||e.course_file_link.isValidVimeoLink()||t.push("Invalid YouTube / Vimeo link."):t.push("YouTube / Vimeo link is required."):Object.keys(e.course_file).length?e.course_file.errorCode&&t.push(e.course_file.errorCode):t.push("Please upload the "+("manual"===e.course_type?"Course":"SCORM")+" file."),"manual"!==e.course_type||f.length||t.push("At least one question is required for manual course."),t.length)return alertify.alert("ERROR!",getErrorsStringFromArray(t),CB);if(ml(!0,m),Object.keys(e.course_file).length){let t=await uploadFile(e.course_file);if(t=JSON.parse(t),!t.data)return alertify.alert("ERROR","Failed to upload the file.",function(){ml(!1,m)});e.course_file=t.data}else e.course_file=e.course_file_link;delete e.course_file_link,e.company_code=c;try{const t=await o(e);return"scorm"===e.course_type&&await r(t.courseId,e.course_file),alertify.alert("SUCCESS!",t.data,function(){getLMSDefaultCourses(),$("#"+p).remove()})}catch(e){return ml(!1,m),alertify.alert("ERROR!",getErrorsStringFromArray(e.errors,"Errors!!"),CB)}}function o(e){return new Promise(function(t,s){$.ajax({url:apiURL+"lms/course",method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(e)}).success(t).fail(function(e){s(e.responseJSON)})})}function r(e,t){return new Promise(function(s,o){const r={scorm_file:t};$.ajax({url:baseURI+"lms/course/scorm/parse/"+e,method:"POST",data:r}).success(s).fail(function(e){o(e.responseJSON)})})}function i(e){ml(!1,m),f.push(e),d(),$(".jsPageBox").addClass("hidden"),$('.jsPageBox[data-id="main"]').removeClass("hidden")}function n(){$(".jsAddUploadFile").addClass("hidden"),$(".jsAddLinkFile").addClass("hidden"),"file"==C?$(".jsAddUploadFile").removeClass("hidden"):$(".jsAddLinkFile").removeClass("hidden")}function d(){if(!f.length)return $("#jsAddCourseQuestionsList").html('<tr><th colspan="3"><p class="alert alert-info text-center">No questions found yet.</p></th></tr>');let e="";f.map(function(t){e+='<tr data-key="'+t.question_id+'">',e+='\t<td class="vam">'+t.question_title+"</td>",e+='\t<td class="vam text-center">'+t.question_type.replace(/_/gi," ").toUpperCase()+"</td>",e+='\t<td class="vam text-center">',e+='\t\t<button type="button" class="btn btn-warning jsEditQuestion" title="Edit question" placement="top">',e+='\t\t\t<i class="fa fa-edit" aria-hidden="true"></i>',e+="\t\t</button>",e+='\t\t<button type="button" class="btn btn-danger jsDeleteQuestion" title="Delete question" placement="top">',e+='\t\t\t<i class="fa fa-times-circle" aria-hidden="true"></i>',e+="\t\t</button>",e+="\t</td>",e+="</tr>"}),$("#jsAddCourseQuestionsList").html(e)}function u(e){f=f.filter(function(t){return t.question_id!=e}),d()}function a(e){let t=f.filter(function(t){return t.question_id==e});return t[0]}let l=null,c=0,p="jsCreateCourseModel",m="jsCreateCourseModelLoader",f=[],C="file";$(document).on("click",".jsAddCourseCreateBtn",function(e){e.preventDefault();const t={course_title:$("#jsAddCourseTitle").val().trim(),course_content:$("#jsAddCourseAbout").val().trim(),job_titles:$("#jsAddCourseJobTitles").val()||[],course_type:$(".jsAddCourseType:checked").val(),course_recurring_in:$("#jsAddCourseReassignIn").val(),course_recurring_type:$("#jsAddCourseReassignType").val(),course_start_period:$("#jsAddCourseStartPeriod").val().trim(),course_end_period:$("#jsAddCourseEndPeriod").val().trim(),course_version:$("#jsAddCourseVersion").val(),course_file_type:$(".jsAddCourseFileType:checked").val(),course_file_link:$("#jsAddCourseLink").val(),course_file:$("#"+("scorm"===$(".jsAddCourseType:checked").val()?"jsAddCourseFile":"jsAddCourseVideoFile")).msFileUploader("get")||{},course_questions:f};s(t)}),$(document).on("click",".jsAddCourseType",function(){$(".jsAddCourseScormBox").addClass("hidden"),$(".jsAddManualCourseBox").addClass("hidden"),"scorm"===$(this).val()?$(".jsAddCourseScormBox").removeClass("hidden"):($(".jsAddManualCourseBox").removeClass("hidden"),n(),d())}),$(document).on("click",".jsAddCourseFileType",function(){C=$(this).val(),n()}),$(document).on("click",".jsAddQuestionBtn",function(e){e.preventDefault(),loadAddQuestionView(m,i)}),$(document).on("click",".jsBackToAddCoursePage",function(e){e.preventDefault(),$(".jsPageBox").addClass("hidden"),$('.jsPageBox[data-id="main"]').removeClass("hidden")}),$(document).on("click",".jsDeleteQuestion",function(e){e.preventDefault();let t=$(this).closest("tr").data("key");return alertify.confirm("Are you certain about deleting the chosen question?",function(){u(t)},CB)}),$(document).on("click",".jsEditQuestion",function(e){e.preventDefault();let t=$(this).closest("tr").data("key");loadEditQuestionView(a(t),m,function(e){$(".jsPageBox").addClass("hidden"),$('.jsPageBox[data-id="main"]').removeClass("hidden");let s=[];f.map(function(o){o.question_id===t?s.push(e):s.push(o)}),f=s,d(),ml(!1,m)})}),window.startCreateCourseProcess=e});