$((function(){let e=null,s=0,t="jsCreateCourseModel",o="jsCreateCourseModelLoader",r=[],i="file";function n(){r=[],null!==e&&e.abort(),e=$.ajax({url:apiURL+"lms/course/view",method:"GET"}).success((function(s){e=null,$("#"+t+"Body").html(s),$("#jsAddCourseVersion").select2({minimumResultsForSearch:-1}),$("#jsAddCourseJobTitles").select2({closeOnSelect:!1}),$("#jsAddCourseReassignType").val("year"),$("#jsAddCourseFile").msFileUploader({fileLimit:"100mb",allowedTypes:["zip"]}),$("#jsAddCourseVideoFile").msFileUploader({fileLimit:"100mb",allowedTypes:["mp4","ppt","pptx","mov"]}),$("#jsAddCourseStartPeriod").datepicker({dateFormat:"mm/dd/yy",changeYear:!0,changeMonth:!0,onSelect:function(e){$("#jsAddCourseEndPeriod").datepicker("option","minDate",e)}}).datepicker("option","maxDate",$("#jsAddCourseEndPeriod").val()),$("#jsAddCourseEndPeriod").datepicker({dateFormat:"mm/dd/yy",changeYear:!0,changeMonth:!0,onSelect:function(e){$("#jsAddCourseStartPeriod").datepicker("option","maxDate",e),$(".jsAddIndefiniteCourse").prop("checked",!1),$(".jsRecurringCourses").show()}}).datepicker("option","minDate",$("#jsAddCourseStartPeriod").val()),$('.jsAddCourseFileType[value="'+i+'"]').trigger("click"),ml(!1,o)})).fail(handleErrorResponse).done((function(){e=null,ml(!1,"jsPageLoader")}))}function d(e){ml(!1,o),r.push(e),a(),$(".jsPageBox").addClass("hidden"),$('.jsPageBox[data-id="main"]').removeClass("hidden")}function u(){$(".jsAddUploadFile").addClass("hidden"),$(".jsAddLinkFile").addClass("hidden"),"file"==i?$(".jsAddUploadFile").removeClass("hidden"):$(".jsAddLinkFile").removeClass("hidden")}function a(){if(!r.length)return $("#jsAddCourseQuestionsList").html('<tr><th colspan="3"><p class="alert alert-info text-center">No questions found yet.</p></th></tr>');let e="";r.map((function(s){e+='<tr data-key="'+s.question_id+'">',e+='\t<td class="vam">'+s.question_title+"</td>",e+='\t<td class="vam text-center">'+s.question_type.replace(/_/gi," ").toUpperCase()+"</td>",e+='\t<td class="vam text-center">',e+='\t\t<button type="button" class="btn btn-warning jsEditQuestion" title="Edit question" placement="top">',e+='\t\t\t<i class="fa fa-edit" aria-hidden="true"></i>',e+="\t\t</button>",e+='\t\t<button type="button" class="btn btn-danger jsDeleteQuestion" title="Delete question" placement="top">',e+='\t\t\t<i class="fa fa-times-circle" aria-hidden="true"></i>',e+="\t\t</button>",e+="\t</td>",e+="</tr>"})),$("#jsAddCourseQuestionsList").html(e)}$(document).on("click",".jsAddCourseCreateBtn",(function(e){e.preventDefault();const i={course_title:$("#jsAddCourseTitle").val().trim(),course_content:$("#jsAddCourseAbout").val().trim(),job_titles:$("#jsAddCourseJobTitles").val()||[],course_type:$(".jsAddCourseType:checked").val(),course_recurring_in:$("#jsAddCourseReassignIn").val(),course_recurring_type:$("#jsAddCourseReassignType").val(),course_start_period:$("#jsAddCourseStartPeriod").val().trim(),course_end_period:$("#jsAddCourseEndPeriod").val().trim(),course_version:$("#jsAddCourseVersion").val(),course_file_type:$(".jsAddCourseFileType:checked").val(),course_file_link:$("#jsAddCourseLink").val(),course_file:$("#"+("scorm"===$(".jsAddCourseType:checked").val()?"jsAddCourseFile":"jsAddCourseVideoFile")).msFileUploader("get")||{},course_questions:r};$(".jsAddIndefiniteCourse").is(":checked")&&(i.course_end_period=null),async function(e){const i=[];e.course_title||i.push("Course title is required.");e.job_titles.length||i.push("Select at least one job title.");e.course_recurring_in?e.course_recurring_in.isValidInteger()||i.push("Please enter valid integer value."):i.push("Course recurring number is required.");e.course_start_period||i.push("Course start date is required.");e.course_recurring_type.length||i.push("Course recurring type is required.");e.course_type||i.push("Course type is required.");e.course_questions=r,"link"===e.course_file_type&&"manual"===e.course_type?e.course_file_link?e.course_file_link.isValidYoutubeLink()||e.course_file_link.isValidVimeoLink()||i.push("Invalid YouTube / Vimeo link."):i.push("YouTube / Vimeo link is required."):Object.keys(e.course_file).length?e.course_file.errorCode&&i.push(e.course_file.errorCode):i.push("Please upload the "+("manual"===e.course_type?"Course":"SCORM")+" file.");"manual"!==e.course_type||r.length||i.push("At least one question is required for manual course.");if(i.length)return alertify.alert("ERROR!",getErrorsStringFromArray(i),CB);if(ml(!0,o),Object.keys(e.course_file).length){let s=await uploadFile(e.course_file);if(s=JSON.parse(s),!s.data)return alertify.alert("ERROR","Failed to upload the file.",(function(){ml(!1,o)}));e.course_file=s.data}else e.course_file=e.course_file_link;delete e.course_file_link,e.company_code=s;try{const s=await function(e){return new Promise((function(s,t){$.ajax({url:apiURL+"lms/course",method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(e)}).success(s).fail((function(e){t(e.responseJSON)}))}))}(e);return"scorm"===e.course_type&&await(n=s.courseId,d=e.course_file,new Promise((function(e,s){const t={scorm_file:d};$.ajax({url:baseURI+"lms/course/scorm/parse/"+n,method:"POST",data:t}).success(e).fail((function(e){s(e.responseJSON)}))}))),alertify.alert("SUCCESS!",s.data,(function(){getLMSDefaultCourses(),$("#"+t).remove()}))}catch(e){return ml(!1,o),alertify.alert("ERROR!",getErrorsStringFromArray(e.errors,"Errors!!"),CB)}var n,d}(i)})),$(document).on("click",".jsAddCourseType",(function(){$(".jsAddCourseScormBox").addClass("hidden"),$(".jsAddManualCourseBox").addClass("hidden"),"scorm"===$(this).val()?$(".jsAddCourseScormBox").removeClass("hidden"):($(".jsAddManualCourseBox").removeClass("hidden"),u(),a())})),$(document).on("click",".jsAddCourseFileType",(function(){i=$(this).val(),u()})),$(document).on("click",".jsAddQuestionBtn",(function(e){e.preventDefault(),loadAddQuestionView(o,d)})),$(document).on("click",".jsBackToAddCoursePage",(function(e){e.preventDefault(),$(".jsPageBox").addClass("hidden"),$('.jsPageBox[data-id="main"]').removeClass("hidden")})),$(document).on("click",".jsDeleteQuestion",(function(e){e.preventDefault();let s=$(this).closest("tr").data("key");return alertify.confirm("Are you certain about deleting the chosen question?",(function(){!function(e){r=r.filter((function(s){return s.question_id!=e})),a()}(s)}),CB)})),$(document).on("click",".jsEditQuestion",(function(e){e.preventDefault();let s=$(this).closest("tr").data("key");loadEditQuestionView(function(e){return r.filter((function(s){return s.question_id==e}))[0]}(s),o,(function(e){$(".jsPageBox").addClass("hidden"),$('.jsPageBox[data-id="main"]').removeClass("hidden");let t=[];r.map((function(o){o.question_id===s?t.push(e):t.push(o)})),r=t,a(),ml(!1,o)}))})),$(document).on("click",".jsAddIndefiniteCourse",(function(e){$(".jsAddIndefiniteCourse").is(":checked")?($("#jsAddCourseEndPeriod").val(""),$(".jsRecurringCourses").hide()):$(".jsRecurringCourses").show()})),window.startCreateCourseProcess=function(e){s=e,Modal({Id:t,Title:"Create Course",Loader:o,Cl:"container",Ask:!0,Body:'<div id="'+t+'Body"></div>'},n)}}));