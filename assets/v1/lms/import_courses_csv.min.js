$((function(){var e=[],r=["employeeid","employeesid","employeeId"],t=["employeenumber","employeeno"],s=["employee_ssn","socialsecurity","socialsecuritynumber","socialsecurity#","ssn","ss","ss#"],o=["employeeemail","email","emailaddress","personalemail","e-mail"],n=["employeephonenumber","phonenumber","contactnumber","contact","employeetelephonenumber","telephonenumber","primarynumber"],i=["coursetitle","title"],a=["coursetype","type"],l=["lessonstatus","progress"],u=["coursestatus","status"],d=["coursetaken","attemptcount","coursetakencount"],c=["start","startdate","startduration","startperiod","coursestartdate"],f=["end","enddate","endduration","endperiod","courseenddate"];function m(r){e=r}C("hide"),$("#js-import-form").submit((function(m){m.preventDefault();var p=e.target.result.split(/\r\n|\n/g),h=p[0].toLowerCase().replace(/[^a-z]/g,"").trim();if(!h.includes("coursetitle")&&!h.includes("title"))return alertify.alert("Not a valid format Debit Amount"),!1;if(!h.includes("lessonstatus")&&!h.includes("progress"))return alertify.alert("Not a valid format Credit Amount  is missing"),!1;if(!h.includes("coursestatus")&&!h.includes("status"))return alertify.alert("Not a valid format Start Period is missing"),!1;if(!h.includes("coursetaken")&&!h.includes("attemptcount"))return alertify.alert("Not a valid format Start Period is missing"),!1;if(!h.includes("startdate")&&!h.includes("startperiod")&&!h.includes("startduration"))return alertify.alert("Not a valid format  Transaction Date is missing"),!1;if(!h.includes("enddate")&&!h.includes("endperiod")&&!h.includes("endduration"))return alertify.alert("Not a valid format End Period is missing"),!1;var g=p[0].split(",");g=g.map((function(e,m){var p=function(e){var m,p,h;for(p=r.length,h=r,m=0;m<p;m++)if(e==h[m].trim())return"employee_id";for(p=t.length,h=t,m=0;m<p;m++)if(e==h[m].trim())return"employee_number";for(p=s.length,h=s,m=0;m<p;m++)if(e==h[m].trim())return"employee_ssn";for(p=o.length,h=o,m=0;m<p;m++)if(e==h[m].trim())return"employee_email";for(p=n.length,h=n,m=0;m<p;m++)if(e==h[m].trim())return"employee_phone";for(p=i.length,h=i,m=0;m<p;m++)if(e==h[m].trim())return"title";for(p=a.length,h=a,m=0;m<p;m++)if(e==h[m].trim())return"type";for(p=l.length,h=l,m=0;m<p;m++)if(e==h[m].trim())return"progress";for(p=u.length,h=u,m=0;m<p;m++)if(e==h[m].trim())return"status";for(p=d.length,h=d,m=0;m<p;m++)if(e==h[m].trim())return"count";for(p=c.length,h=c,m=0;m<p;m++)if(e==h[m].trim())return"start_date";for(p=f.length,h=f,m=0;m<p;m++)if(e==h[m].trim())return"end_date";return-1}(e.toLowerCase().replace(/[^a-z]/g,"").trim());return-1===p?"extra":p})),p.splice(0,1);var b="";if(p.map(((e,r)=>{var t=e.split(",");t.length!=g.length&&1!==t.length&&(b+="<p>",b+="  <strong>Row #: </strong>"+(r+2)+"<br />",b+="  <strong>Name: </strong>"+(t[0]+t[1]),b+="</p>")})),b.length)return alertify.alert("Error!","<p>Please make sure there are no <strong>','</strong> in values.</p><br /><p><strong>For instance </strong>422 Street, 3rd floor -> 422 Street 3rd floor</p><br />"+b,(function(){}));var v=[];const w=[];if(p.map((function(e,r){var t=e.split(","),s=new Object,o=0,n=t.length;if(n>2){for(;o<n;o++)s[g[o]]=t[o].trim();var i=!0,a=!0,l=!0,u=!0,d=!0,c=!0,f=!0,m=!0,p=!0;s.employee_id||(i=!1),s.employee_number||(a=!1),s.employee_ssn||(l=!1),s.employee_email||(u=!1),s.employee_phone||(d=!1),s.title||(c=!1),s.type||(f=!1),k(s.start_date)||(m=!1,w.push("The course start date is not valid for row "+(r+1)+".")),k(s.end_date)||(m=!1,w.push("The course end date is not valid for row "+(r+1)+".")),function(e){var r=new RegExp(/^\+?[0-9(),.-]+$/);if(e.match(r))return!0;return!1}(s.count)||(p=!1,w.push("The course attempted count is not valid for row "+(r+1)+".")),i||a||l||u||d?m&&p&&v.push(s):c?f?w.push("The employee identity is missing for row "+(r+1)+"."):w.push("The course type is missing for row "+(r+1)+"."):w.push("The course title is missing for row "+(r+1)+".")}})),w.length){if(0==v.length)return void alertify.alert(S(w,"Uploaded file doesn't contain any valid courses info."),(function(){})).set("title","Warning!");alertify.confirm(S(w,"Are you sure you want to continue, or would you prefer to fix the issue first?"),(()=>{y(v)})).set("labels",{ok:"Continue",cancel:"Cancel"}).set("title","Notice!")}else y(v)})),$("#userfile").mFileUploader({fileLimit:-1,allowedTypes:["csv"],onSuccess:function(e){if($(".js-submit-btn").prop("disabled",!0).addClass("disabled"),0!==Object.keys(e).length)if(!0!==e.hasError){$(".js-submit-btn").removeAttr("disabled").removeClass("disabled");var r=new FileReader;r.onload=m,r.readAsText(e)}else alertify.alert("WARNING!","Invalid file is uploaded.",(()=>{}));else alertify.alert("WARNING!","Please, select a file.",(()=>{}))},onError:()=>{$(".js-submit-btn").prop("disabled",!0).addClass("disabled")},onClear:()=>{$(".js-submit-btn").prop("disabled",!0).addClass("disabled")}});var p={current:0,chunkSize:8,loaded:0,records:[],totalChunks:0,recordsLength:0},h=0,g=0,b=0;function y(e){p.records=[],p.recordsLength=e.length,p.totalChunks=Math.ceil(p.recordsLength/Math.ceil(p.recordsLength/p.chunkSize)),1!=p.totalChunks?p.records=_.chunk(e,p.totalChunks):p.records.push(e),v()}function v(){void 0!==p.records[p.current]&&function(e){if(null!==w)return;if(void 0===p.records[p.current])return C("hide"),alertify.alert("SUCCESS!","You have successfully imported  courses.<br>Inserted records: <b>"+g+"</b><br>Duplicated records: <b>"+b+"</b> <br> Failed records: <b>"+h+"</b>"),void(h=b=g=p.loaded=p.current=p.totalChunks=p.recordsLength=0);p.loaded+=e.length;var r="Please, be patient as we import payrolls.<br />";r+="It may take a few minutes<br />",C("show",r+="Importing "+p.loaded+" of "+p.recordsLength+" payrolls."),w=$.post(baseURI+"lms/courses/import_course_csv_handler",{action:"add_courses",courses:e},(function(e){return w=null,!1===e.Status?(alertify.alert("ERROR!","Something went wrong"),void C("hide")):(h+=parseInt(e.Failed),b+=parseInt(e.Existed),g+=parseInt(e.Inserted),p.current++,p.current>=p.records.length?(C("hide"),alertify.alert("SUCCESS!","You have successfully imported  courses.<br>Inserted records: <b>"+g+"</b><br>Duplicated records: <b>"+b+"</b> <br> Failed records: <b>"+h+"</b>",(function(){window.location=baseURI+"lms/courses/import_course_csv"})),void(h=b=g=p.loaded=p.current=p.totalChunks=p.recordsLength=0)):void v())}))}(p.records[p.current])}var w=null;function C(e,r){show=void 0===e||!0===e||"show"===e?"show":e,r=void 0===r?"":r,"show"==e?($(".js-loader-text").html(r),$(".js-loader").show()):($(".js-loader-text").html(""),$(".js-loader").fadeOut(150))}function k(e){return null!=e.match(/^\d{1,2}\/\d{1,2}\/\d{4}$/)}function S(e,r){return"<strong><p>"+(r||"Please, resolve the following errors")+"</p></strong><br >"+e.join("<br />")}}));