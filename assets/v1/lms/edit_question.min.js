$(function(){function t(t,e,d){if(n=t,o=e,i=d,s=new msVideoRecorder({recorderPlayer:"jsEditQuestionRecordingLive",previewPlayer:"jsEditQuestionRecordingRecorded",recordButton:"jsEditQuestionRecordingStart",playRecordedVideoBTN:"jsEditQuestionRecordingPlay",pauseRecordedVideoBTN:"jsEditQuestionRecordingPause",resumeRecordedVideoBTN:"jsEditQuestionRecordingResume",removeRecordedVideoBTN:"jsEditQuestionRecordingRemove",errorSectionReference:"jsEditQuestionRecordingError"}),$("#jsEditQuestionUploadVideo").msFileUploader({fileLimit:"30mb",allowedTypes:["mp4","mov"],placeholderImage:n.video_file_name}),$('#jsEditQuestionType option[value="'+n.question_type+'"]').prop("selected",!0),$("#jsEditQuestionType").select2({minimumResultsForSearch:-1}),$("#jsEditQuestionMultipleChoiceAnswer").select2({minimumResultsForSearch:-1}),$("#jsEditQuestionTitle").val(n.question_title),$("#jsEditQuestionRequired").prop("checked",n.question_required),$("#jsEditQuestionHelp").val(n.question_content),$('.jsEditQuestionVideoType[value="'+n.video_type+'"]').prop("checked",!0),"link"===n.video_type?($('.jsEditQuestionVideoType[value="'+n.video_type+'"]').prop("checked",!0),$(".jsEditQuestionUploadVideoBox").addClass("hidden"),$(".jsEditQuestionRecordVideoBox").addClass("hidden"),$(".jsEditQuestionLinkVideoBox").removeClass("hidden"),$("#jsEditQuestionLink").val(n.video_file_name)):($('.jsEditQuestionVideoType[value="upload"]').prop("checked",!0),$(".jsEditQuestionRecordVideoBox").addClass("hidden"),$(".jsEditQuestionUploadVideoBox").removeClass("hidden")),$('#jsEditQuestionYesNoYSelect option[value="0"]').prop("selected",!0),$('#jsEditQuestionYesNoYStatus option[value="pass"]').prop("selected",!0),$('#jsEditQuestionYesNoNSelect option[value="0"]').prop("selected",!0),$('#jsEditQuestionYesNoNStatus option[value="pass"]').prop("selected",!0),$(".csEditChoiceBox").html(""),$(".jsEditQuestionChoiceAnswer").val(""),$('#jsEditQuestionChoiceAnswerScore option[value="0"]').prop("selected",!0),$('#jsEditQuestionChoiceAnswerStatus option[value="pass"]').prop("selected",!0),$(".jsEditQuestionPlace").addClass("hidden"),"yes_no"===n.question_type)$(".jsEditQuestionYesNo").removeClass("hidden"),$('#jsEditQuestionYesNoYSelect option[value="'+n.choice_list.yes.score+'"]').prop("selected",!0),$('#jsEditQuestionYesNoYStatus option[value="'+n.choice_list.yes.status+'"]').prop("selected",!0),$('#jsEditQuestionYesNoNSelect option[value="'+n.choice_list.no.score+'"]').prop("selected",!0),$('#jsEditQuestionYesNoNStatus option[value="'+n.choice_list.no.status+'"]').prop("selected",!0);else if("single_choice"===n.question_type||"multiple_choice"===n.question_type){$(".jsEditQuestionChoice").removeClass("hidden"),$(".jsEditQuestionChoiceAnswerPrimary").val(n.choice_list[0].answer_choice),$('.jsEditQuestionChoiceAnswerPrimaryScore option[value="'+n.choice_list[0].answer_score+'"]').prop("selected",!0),$('.jsEditQuestionChoiceAnswerPrimaryStatus option[value="'+n.choice_list[0].answer_status+'"]').prop("selected",!0);for(const t in n.choice_list)0!=t&&$(".csEditChoiceBox").append(`\n\t\t\t\t\t\t<!-- secondary question row -->\n\t\t\t\t\t\t<div class="csEditChoiceRow">\n\t\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t\t<div class="col-xs-12 col-sm-5">\n\t\t\t\t\t\t\t\t\t<label>Answer Choice <strong class="text-danger">*</strong></label>\n\t\t\t\t\t\t\t\t\t<input type="text" class="form-control jsEditQuestionChoiceAnswer" value="${n.choice_list[t].answer_choice}" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="col-xs-12 col-sm-3">\n\t\t\t\t\t\t\t\t\t<label>Question Score <strong class="text-danger">*</strong></label>\n\t\t\t\t\t\t\t\t\t<select class="form-control jsEditQuestionChoiceAnswerScore">\n\t\t\t\t\t\t\t\t\t\t<option ${"0"===n.choice_list[t].answer_score?"selected":""} value="0">Not acceptable - 0</option>\n\t\t\t\t\t\t\t\t\t\t<option ${"1"===n.choice_list[t].answer_score?"selected":""} value="1">Acceptable - 1</option>\n\t\t\t\t\t\t\t\t\t\t<option ${"2"===n.choice_list[t].answer_score?"selected":""} value="2">Good - 2</option>\n\t\t\t\t\t\t\t\t\t\t<option ${"3"===n.choice_list[t].answer_score?"selected":""} value="3">Very Good - 3</option>\n\t\t\t\t\t\t\t\t\t\t<option ${"4"===n.choice_list[t].answer_score?"selected":""} value="4">Excellent - 4</option>\n\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="col-xs-12 col-sm-2">\n\t\t\t\t\t\t\t\t\t<label>Status <strong class="text-danger">*</strong></label>\n\t\t\t\t\t\t\t\t\t<select class="form-control jsEditQuestionChoiceAnswerStatus">\n\t\t\t\t\t\t\t\t\t\t<option ${"pass"===n.choice_list[t].answer_status?"selected":""} value="pass">Pass</option>\n\t\t\t\t\t\t\t\t\t\t<option ${"fail"===n.choice_list[t].answer_status?"selected":""} value="fail">Fail</option>\n\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="col-xs-12 col-sm-1">\n\t\t\t\t\t\t\t\t\t<p>&nbsp;</p>\n\t\t\t\t\t\t\t\t\t<button class="btn btn-danger jsEditDeleteChoiceAnswer" type="button" title="Remove answer" placement="top">\n\t\t\t\t\t\t\t\t\t\t<i class="fa fa-times-circle" aria-hidden="true"></i>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t</div>\n\t\t\t\t`)}$(".jsPageBox").addClass("hidden"),$('.jsPageBox[data-id="edit_question"]').removeClass("hidden")}async function e(){const t=[];n.question_required=$("#jsEditQuestionRequired").prop("checked"),n.question_title=$("#jsEditQuestionTitle").val().trim(),n.question_content=$("#jsEditQuestionHelp").val().trim(),n.question_type=$("#jsEditQuestionType").select2("val"),n.choice_list={},n.video_type=$(".jsEditQuestionVideoType:checked").val()||null,n.question_title||t.push('"Question" field is mandatory.'),n.question_type||t.push('"Question type" field is mandatory.'),"single_choice"===n.question_type||"multiple_choice"===n.question_type?$(".csEditChoiceRow").map(function(e){const o={answer_choice:$(this).find(".jsEditQuestionChoiceAnswer").val().trim(),answer_score:$(this).find(".jsEditQuestionChoiceAnswerScore").val().trim(),answer_status:$(this).find(".jsEditQuestionChoiceAnswerStatus").val().trim()};o.answer_choice||t.push('"Answer Choice" is missing for row '+(e+1)+"."),n.choice_list[e]=o}):"yes_no"===n.question_type&&(n.choice_list.yes={score:$("#jsEditQuestionYesNoYSelect option:checked").val(),status:$("#jsEditQuestionYesNoYStatus option:checked").val()},n.choice_list.no={score:$("#jsEditQuestionYesNoNSelect option:checked").val(),status:$("#jsEditQuestionYesNoNStatus option:checked").val()}),n.video_type||t.push('"Video type" field is mandatory.');let e={},d={},l=!1;if("upload"===n.video_type?(e=$("#jsEditQuestionUploadVideo").msFileUploader("get"),Object.keys(e).length?(e.errorCode&&t.push(e.errorCode),l=!0):n.video_file_name||t.push('"Video file" is mandatory. Please upload a file.')):"record"===n.video_type?(d=await s.getVideo(),5!==d.length||n.video_file_name?l=!0:t.push('"Video Recording" is mandatory. Please record a video.')):"link"===n.video_type&&(n.video_file_name=$("#jsEditQuestionLink").val().trim(),n.video_file_name?n.video_file_name.isValidYoutubeLink()||n.video_file_name.isValidVimeoLink()||t.push("Invalid YouTube / Vimeo link."):t.push("YouTube / Vimeo link is required.")),t.length)return alertify.alert("ERROR!",getErrorsStringFromArray(t),CB);if(ml(!0,o),l){let t={};if("upload"===n.video_type?(t=await uploadFile(e),"string"==typeof t&&(t=JSON.parse(t))):t=await uploadStream(d),!Object.keys(t).length)return ml(!1,o),alertify.alert("ERROR!","Failed to upload file.",CB);n.video_file_name=t.data}s.close(),$("#jsEditQuestionUploadVideo").msFileUploader("clear"),i(n)}let o,i,s,n={question_id:0,question_title:"",question_required:!1,question_content:"",question_type:"text",choice_list:{},video_type:"upload",video_file_name:""};$(document).on("click",".jsModalCancel",function(){s.close()}),$(document).on("change","#jsEditQuestionType",function(){$(".jsEditQuestionPlace").addClass("hidden"),"multiple_choice"===$(this).val()||"single_choice"===$(this).val()?$(".jsEditQuestionChoice").removeClass("hidden"):"yes_no"===$(this).val()&&$(".jsEditQuestionYesNo").removeClass("hidden")}),$(document).on("change",".jsEditQuestionVideoType",function(){$(".jsEditQuestionUploadVideoBox").addClass("hidden"),$(".jsEditQuestionRecordVideoBox").addClass("hidden"),$(".jsEditQuestionLinkVideoBox").addClass("hidden"),s.close(),"upload"===$(this).val()?$(".jsEditQuestionUploadVideoBox").removeClass("hidden"):"record"===$(this).val()?($(".jsEditQuestionRecordVideoBox").removeClass("hidden"),s.init()):$(".jsEditQuestionLinkVideoBox").removeClass("hidden")}),$(document).on("click",".jsEditQuestionSaveBtn",function(t){t.preventDefault(),e()}),$(document).on("click",".jsEditChoiceAnswer",function(t){t.preventDefault();let e='\n\t\t<!-- secondary question row -->\n\t\t<div class="csEditChoiceRow">\n\t\t\t<div class="row">\n\t\t\t\t<div class="col-xs-12 col-sm-5">\n\t\t\t\t\t<label>Answer Choice <strong class="text-danger">*</strong></label>\n\t\t\t\t\t<input type="text" class="form-control jsEditQuestionChoiceAnswer" />\n\t\t\t\t</div>\n\t\t\t\t<div class="col-xs-12 col-sm-3">\n\t\t\t\t\t<label>Question Score <strong class="text-danger">*</strong></label>\n\t\t\t\t\t<select class="form-control jsEditQuestionChoiceAnswerScore">\n\t\t\t\t\t\t<option value="0">Not acceptable - 0</option>\n\t\t\t\t\t\t<option value="1">Acceptable - 1</option>\n\t\t\t\t\t\t<option value="2">Good - 2</option>\n\t\t\t\t\t\t<option value="3">Very Good - 3</option>\n\t\t\t\t\t\t<option value="4">Excellent - 4</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="col-xs-12 col-sm-2">\n\t\t\t\t\t<label>Status <strong class="text-danger">*</strong></label>\n\t\t\t\t\t<select class="form-control jsEditQuestionChoiceAnswerStatus">\n\t\t\t\t\t\t<option value="pass">Pass</option>\n\t\t\t\t\t\t<option value="fail">Fail</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="col-xs-12 col-sm-1">\n\t\t\t\t\t<p>&nbsp;</p>\n\t\t\t\t\t<button class="btn btn-danger jsEditDeleteChoiceAnswer" type="button" title="Remove answer" placement="top">\n\t\t\t\t\t\t<i class="fa fa-times-circle" aria-hidden="true"></i>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<br />\n\t\t</div>\n\t\t\t\t';$(".csEditChoiceBox").append(e)}),$(document).on("click",".jsEditDeleteChoiceAnswer",function(t){t.preventDefault(),$(this).closest(".csChoiceRowEdit").remove()}),window.loadEditQuestionView=t});