$(function(){function e(e,i,l){s=e,o=i,t=l,d=new msVideoRecorder({recorderPlayer:"jsEditQuestionRecordingLive",previewPlayer:"jsEditQuestionRecordingRecorded",recordButton:"jsEditQuestionRecordingStart",playRecordedVideoBTN:"jsEditQuestionRecordingPlay",pauseRecordedVideoBTN:"jsEditQuestionRecordingPause",resumeRecordedVideoBTN:"jsEditQuestionRecordingResume",removeRecordedVideoBTN:"jsEditQuestionRecordingRemove",errorSectionReference:"jsEditQuestionRecordingError"}),$("#jsEditQuestionUploadVideo").msFileUploader({fileLimit:"30mb",allowedTypes:["mp4"],placeholderImage:s.video_file_name}),$("#jsEditQuestionType").select2({minimumResultsForSearch:-1}),$("#jsEditQuestionMultipleChoiceAnswer").select2({minimumResultsForSearch:-1}),$("#jsEditQuestionTitle").val(s.question_title),$("#jsEditQuestionHelp").val(s.question_content),$("#jsEditQuestionType").select("val",s.question_type),$('.jsEditQuestionVideoType[value="'+s.video_type+'"]').prop("checked",!0),"link"===s.video_type?($('.jsEditQuestionVideoType[value="'+s.video_type+'"]').prop("checked",!0),$(".jsEditQuestionUploadVideoBox").addClass("hidden"),$(".jsEditQuestionRecordVideoBox").addClass("hidden"),$(".jsEditQuestionLinkVideoBox").removeClass("hidden"),$("#jsEditQuestionLink").val(s.video_file_name)):($('.jsEditQuestionVideoType[value="upload"]').prop("checked",!0),$(".jsEditQuestionRecordVideoBox").addClass("hidden"),$(".jsEditQuestionUploadVideoBox").removeClass("hidden")),$(".jsEditQuestionMultipleChoiceBox").addClass("hidden"),$("#jsEditQuestionMultipleChoiceAnswer").select("val","choice_1"),$("#jsEditQuestionMultipleChoice1").val(""),$("#jsEditQuestionMultipleChoice2").val(""),$("#jsEditQuestionMultipleChoice3").val(""),$("#jsEditQuestionMultipleChoice4").val(""),"multiple_choice"===s.question_type&&($(".jsEditQuestionMultipleChoiceBox").removeClass("hidden"),$("#jsEditQuestionMultipleChoiceAnswer").select("val",s.choice_list.rightChoice),$("#jsEditQuestionMultipleChoice1").val(s.choice_list.choice1),$("#jsEditQuestionMultipleChoice2").val(s.choice_list.choice2),$("#jsEditQuestionMultipleChoice3").val(s.choice_list.choice3),$("#jsEditQuestionMultipleChoice4").val(s.choice_list.choice4)),$(".jsPageBox").addClass("hidden"),$('.jsPageBox[data-id="edit_question"]').removeClass("hidden")}async function i(){const e=[];if(s.question_title=$("#jsEditQuestionTitle").val().trim(),s.question_content=$("#jsEditQuestionHelp").val().trim(),s.question_type=$("#jsEditQuestionType").select2("val"),s.choice_list=[],s.video_type=$(".jsEditQuestionVideoType:checked").val()||null,s.question_title||e.push('"Question" field is mandatory.'),s.question_type||e.push('"Question type" field is mandatory.'),"multiple_choice"===s.question_type){let i=$("#jsEditQuestionMultipleChoice1").val().trim(),o=$("#jsEditQuestionMultipleChoice2").val().trim(),t=$("#jsEditQuestionMultipleChoice3").val().trim(),d=$("#jsEditQuestionMultipleChoice4").val().trim(),l=$("#jsEditQuestionMultipleChoiceAnswer").select2("val");s.choice_list={choice1:i,choice2:o,choice3:t,choice4:d,rightChoice:l},i||e.push('"Choice one" is mandatory.'),o||e.push('"Choice two" is mandatory.'),t||e.push('"Choice three" is mandatory.'),d||e.push('"Choice four" is mandatory.'),l||e.push('"Correct choice" is mandatory.')}s.video_type||e.push('"Video type" field is mandatory.');let i={},l={},n=!1;if("upload"===s.video_type?(i=$("#jsEditQuestionUploadVideo").msFileUploader("get"),Object.keys(i).length?(i.errorCode&&e.push(i.errorCode),n=!0):s.video_file_name||e.push('"Video file" is mandatory. Please upload a file.')):"record"===s.video_type?(l=await d.getVideo(),5!==l.length||s.video_file_name?n=!0:e.push('"Video Recording" is mandatory. Please record a video.')):"link"===s.video_type&&(s.video_file_name=$("#jsEditQuestionLink").val().trim(),s.video_file_name?s.video_file_name.isValidYoutubeLink()||s.video_file_name.isValidVimeoLink()||e.push("Invalid YouTube / Vimeo link."):e.push("YouTube / Vimeo link is required."),n=!1),e.length)return alertify.alert("ERROR!",getErrorsStringFromArray(e),CB);if(ml(!0,o),n){let e={};if("upload"===s.video_type?(e=await uploadFile(i),"string"==typeof e&&(e=JSON.parse(e))):e=await uploadStream(l),!Object.keys(e).length)return ml(!1,o),alertify.alert("ERROR!","Failed to upload file.",CB);s.video_file_name=e.data}d.close(),$("#jsEditQuestionUploadVideo").msFileUploader("clear"),console.log(s),t(s)}let o,t,d,s={question_id:0,question_title:"",question_content:"",question_type:"text",choice_list:{},video_type:"upload",video_file_name:""};$(document).on("click",".jsModalCancel",function(){d.close()}),$(document).on("change","#jsEditQuestionType",function(){$(".jsEditQuestionMultipleChoiceBox").addClass("hidden"),"multiple_choice"===$(this).val()&&$(".jsEditQuestionMultipleChoiceBox").removeClass("hidden")}),$(document).on("change",".jsEditQuestionVideoType",function(){$(".jsEditQuestionUploadVideoBox").addClass("hidden"),$(".jsEditQuestionRecordVideoBox").addClass("hidden"),$(".jsEditQuestionLinkVideoBox").addClass("hidden"),d.close(),"upload"===$(this).val()?$(".jsEditQuestionUploadVideoBox").removeClass("hidden"):"record"===$(this).val()?($(".jsEditQuestionRecordVideoBox").removeClass("hidden"),d.init()):$(".jsEditQuestionLinkVideoBox").removeClass("hidden")}),$(document).on("click",".jsEditQuestionSaveBtn",function(e){e.preventDefault(),i()}),window.loadEditQuestionView=e});