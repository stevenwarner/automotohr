$((function(){let t,e,o,i={question_id:0,question_title:"",question_content:"",question_type:"text",choice_list:{},video_type:"upload",video_file_name:""};$(document).on("click",".jsModalCancel",(function(){o.close()})),$(document).on("change","#jsEditQuestionType",(function(){$(".jsEditQuestionPlace").addClass("hidden"),"multiple_choice"===$(this).val()||"single_choice"===$(this).val()?$(".jsEditQuestionChoice").removeClass("hidden"):"yes_no"===$(this).val()&&$(".jsEditQuestionYesNo").removeClass("hidden")})),$(document).on("change",".jsEditQuestionVideoType",(function(){$(".jsEditQuestionUploadVideoBox").addClass("hidden"),$(".jsEditQuestionRecordVideoBox").addClass("hidden"),$(".jsEditQuestionLinkVideoBox").addClass("hidden"),o.close(),"upload"===$(this).val()?$(".jsEditQuestionUploadVideoBox").removeClass("hidden"):"record"===$(this).val()?($(".jsEditQuestionRecordVideoBox").removeClass("hidden"),o.init()):$(".jsEditQuestionLinkVideoBox").removeClass("hidden")})),$(document).on("click",".jsEditQuestionSaveBtn",(function(s){s.preventDefault(),async function(){const s=[];i.question_title=$("#jsEditQuestionTitle").val().trim(),i.question_content=$("#jsEditQuestionHelp").val().trim(),i.question_type=$("#jsEditQuestionType").select2("val"),i.choice_list={},i.video_type=$(".jsEditQuestionVideoType:checked").val()||null,i.question_title||s.push('"Question" field is mandatory.');i.question_type||s.push('"Question type" field is mandatory.');"single_choice"===i.question_type||"multiple_choice"===i.question_type?$(".csEditChoiceBox").map((function(t){const e={answer_choice:$(this).find(".jsEditQuestionChoiceAnswer").val().trim(),answer_score:$(this).find(".jsEditQuestionChoiceAnswerScore").val().trim(),answer_status:$(this).find(".jsEditQuestionChoiceAnswerStatus").val().trim()};e.answer_choice||s.push('"Answer Choice" is missing for row '+(t+1)+"."),i.choice_list[t]=e})):"yes_no"===i.question_type&&(i.choice_list.yes={score:$("#jsEditQuestionYesNoYSelect option:checked").val(),status:$("#jsEditQuestionYesNoYStatus option:checked").val()},i.choice_list.no={score:$("#jsEditQuestionYesNoNSelect option:checked").val(),status:$("#jsEditQuestionYesNoNStatus option:checked").val()});i.video_type||s.push('"Video type" field is mandatory.');let n={},d={},l=!1;"upload"===i.video_type?(n=$("#jsEditQuestionUploadVideo").msFileUploader("get"),Object.keys(n).length?(n.errorCode&&s.push(n.errorCode),l=!0):i.video_file_name||s.push('"Video file" is mandatory. Please upload a file.')):"record"===i.video_type?(d=await o.getVideo(),5!==d.length||i.video_file_name?l=!0:s.push('"Video Recording" is mandatory. Please record a video.')):"link"===i.video_type&&(i.video_file_name=$("#jsEditQuestionLink").val().trim(),i.video_file_name?i.video_file_name.isValidYoutubeLink()||i.video_file_name.isValidVimeoLink()||s.push("Invalid YouTube / Vimeo link."):s.push("YouTube / Vimeo link is required."));if(s.length)return alertify.alert("ERROR!",getErrorsStringFromArray(s),CB);if(ml(!0,t),l){let e={};if("upload"===i.video_type?(e=await uploadFile(n),"string"==typeof e&&(e=JSON.parse(e))):e=await uploadStream(d),!Object.keys(e).length)return ml(!1,t),alertify.alert("ERROR!","Failed to upload file.",CB);i.video_file_name=e.data}o.close(),$("#jsEditQuestionUploadVideo").msFileUploader("clear"),e(i)}()})),$(document).on("click",".jsEditChoiceAnswer",(function(t){t.preventDefault();$(".csEditChoiceBox").append('\n\t\t\x3c!-- secondary question row --\x3e\n\t\t<div class="csChoiceRowEdit">\n\t\t\t<div class="row">\n\t\t\t\t<div class="col-xs-12 col-sm-5">\n\t\t\t\t\t<label>Answer Choice <strong class="text-danger">*</strong></label>\n\t\t\t\t\t<input type="text" class="form-control jsEditQuestionChoiceAnswer" />\n\t\t\t\t</div>\n\t\t\t\t<div class="col-xs-12 col-sm-3">\n\t\t\t\t\t<label>Question Score <strong class="text-danger">*</strong></label>\n\t\t\t\t\t<select class="form-control jsEditQuestionChoiceAnswerScore">\n\t\t\t\t\t\t<option value="0">Not acceptable - 0</option>\n\t\t\t\t\t\t<option value="1">Acceptable - 1</option>\n\t\t\t\t\t\t<option value="2">Good - 2</option>\n\t\t\t\t\t\t<option value="3">Very Good - 3</option>\n\t\t\t\t\t\t<option value="4">Excellent - 4</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="col-xs-12 col-sm-2">\n\t\t\t\t\t<label>Status <strong class="text-danger">*</strong></label>\n\t\t\t\t\t<select class="form-control jsEditQuestionChoiceAnswerStatus">\n\t\t\t\t\t\t<option value="pass">Pass</option>\n\t\t\t\t\t\t<option value="fail">Fail</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="col-xs-12 col-sm-1">\n\t\t\t\t\t<p>&nbsp;</p>\n\t\t\t\t\t<button class="btn btn-danger jsEditDeleteChoiceAnswer" type="button" title="Remove answer" placement="top">\n\t\t\t\t\t\t<i class="fa fa-times-circle" aria-hidden="true"></i>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<br />\n\t\t</div>\n\t\t\t\t')})),$(document).on("click",".jsEditDeleteChoiceAnswer",(function(t){t.preventDefault(),$(this).closest(".csChoiceRowEdit").remove()})),window.loadEditQuestionView=function(s,n,d){if(i=s,t=n,e=d,o=new msVideoRecorder({recorderPlayer:"jsEditQuestionRecordingLive",previewPlayer:"jsEditQuestionRecordingRecorded",recordButton:"jsEditQuestionRecordingStart",playRecordedVideoBTN:"jsEditQuestionRecordingPlay",pauseRecordedVideoBTN:"jsEditQuestionRecordingPause",resumeRecordedVideoBTN:"jsEditQuestionRecordingResume",removeRecordedVideoBTN:"jsEditQuestionRecordingRemove",errorSectionReference:"jsEditQuestionRecordingError"}),$("#jsEditQuestionUploadVideo").msFileUploader({fileLimit:"30mb",allowedTypes:["mp4"],placeholderImage:i.video_file_name}),$('#jsEditQuestionType option[value="'+i.question_type+'"]').prop("selected",!0),$("#jsEditQuestionType").select2({minimumResultsForSearch:-1}),$("#jsEditQuestionMultipleChoiceAnswer").select2({minimumResultsForSearch:-1}),$("#jsEditQuestionTitle").val(i.question_title),$("#jsEditQuestionHelp").val(i.question_content),$('.jsEditQuestionVideoType[value="'+i.video_type+'"]').prop("checked",!0),"link"===i.video_type?($('.jsEditQuestionVideoType[value="'+i.video_type+'"]').prop("checked",!0),$(".jsEditQuestionUploadVideoBox").addClass("hidden"),$(".jsEditQuestionRecordVideoBox").addClass("hidden"),$(".jsEditQuestionLinkVideoBox").removeClass("hidden"),$("#jsEditQuestionLink").val(i.video_file_name)):($('.jsEditQuestionVideoType[value="upload"]').prop("checked",!0),$(".jsEditQuestionRecordVideoBox").addClass("hidden"),$(".jsEditQuestionUploadVideoBox").removeClass("hidden")),$('#jsEditQuestionYesNoYSelect option[value="0"]').prop("selected",!0),$('#jsEditQuestionYesNoYStatus option[value="pass"]').prop("selected",!0),$('#jsEditQuestionYesNoNSelect option[value="0"]').prop("selected",!0),$('#jsEditQuestionYesNoNStatus option[value="pass"]').prop("selected",!0),$(".csEditChoiceBox").html(""),$(".jsEditQuestionChoiceAnswer").val(""),$('#jsEditQuestionChoiceAnswerScore option[value="0"]').prop("selected",!0),$('#jsEditQuestionChoiceAnswerStatus option[value="pass"]').prop("selected",!0),$(".jsEditQuestionPlace").addClass("hidden"),"yes_no"===i.question_type)$(".jsEditQuestionYesNo").removeClass("hidden"),$('#jsEditQuestionYesNoYSelect option[value="'+i.choice_list.yes.score+'"]').prop("selected",!0),$('#jsEditQuestionYesNoYStatus option[value="'+i.choice_list.yes.status+'"]').prop("selected",!0),$('#jsEditQuestionYesNoNSelect option[value="'+i.choice_list.no.score+'"]').prop("selected",!0),$('#jsEditQuestionYesNoNStatus option[value="'+i.choice_list.no.status+'"]').prop("selected",!0);else if("single_choice"===i.question_type||"multiple_choice"===i.question_type){$(".jsEditQuestionChoice").removeClass("hidden"),$(".jsEditQuestionChoiceAnswerPrimary").val(i.choice_list[0].answer_choice),$('.jsEditQuestionChoiceAnswerPrimaryScore option[value="'+i.choice_list[0].answer_score+'"]').prop("selected",!0),$('.jsEditQuestionChoiceAnswerPrimaryStatus option[value="'+i.choice_list[0].answer_status+'"]').prop("selected",!0);for(const t in i.choice_list)0!=t&&$(".csEditChoiceBox").append(`\n\t\t\t\t\t\t\x3c!-- secondary question row --\x3e\n\t\t\t\t\t\t<div class="csChoiceRow">\n\t\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t\t<div class="col-xs-12 col-sm-5">\n\t\t\t\t\t\t\t\t\t<label>Answer Choice <strong class="text-danger">*</strong></label>\n\t\t\t\t\t\t\t\t\t<input type="text" class="form-control jsAddQuestionChoiceAnswer" value="${i.choice_list[t].answer_choice}" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="col-xs-12 col-sm-3">\n\t\t\t\t\t\t\t\t\t<label>Question Score <strong class="text-danger">*</strong></label>\n\t\t\t\t\t\t\t\t\t<select class="form-control jsAddQuestionChoiceAnswerScore">\n\t\t\t\t\t\t\t\t\t\t<option ${"0"===i.choice_list[t].answer_score?"selected":""} value="0">Not acceptable - 0</option>\n\t\t\t\t\t\t\t\t\t\t<option ${"1"===i.choice_list[t].answer_score?"selected":""} value="1">Acceptable - 1</option>\n\t\t\t\t\t\t\t\t\t\t<option ${"2"===i.choice_list[t].answer_score?"selected":""} value="2">Good - 2</option>\n\t\t\t\t\t\t\t\t\t\t<option ${"3"===i.choice_list[t].answer_score?"selected":""} value="3">Very Good - 3</option>\n\t\t\t\t\t\t\t\t\t\t<option ${"4"===i.choice_list[t].answer_score?"selected":""} value="4">Excellent - 4</option>\n\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="col-xs-12 col-sm-2">\n\t\t\t\t\t\t\t\t\t<label>Status <strong class="text-danger">*</strong></label>\n\t\t\t\t\t\t\t\t\t<select class="form-control jsAddQuestionChoiceAnswerStatus">\n\t\t\t\t\t\t\t\t\t\t<option ${"pass"===i.choice_list[t].answer_status?"selected":""} value="pass">Pass</option>\n\t\t\t\t\t\t\t\t\t\t<option ${"fail"===i.choice_list[t].answer_status?"selected":""} value="fail">Fail</option>\n\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="col-xs-12 col-sm-1">\n\t\t\t\t\t\t\t\t\t<p>&nbsp;</p>\n\t\t\t\t\t\t\t\t\t<button class="btn btn-danger jsDeleteChoiceAnswer" type="button" title="Remove answer" placement="top">\n\t\t\t\t\t\t\t\t\t\t<i class="fa fa-times-circle" aria-hidden="true"></i>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t</div>\n\t\t\t\t`)}$(".jsPageBox").addClass("hidden"),$('.jsPageBox[data-id="edit_question"]').removeClass("hidden")}}));