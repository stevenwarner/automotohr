$((function(){let e=null,t=0,s=0,o="jsEditCourseModel",i="jsEditCourseModelLoader",r=[],n={fileLimit:"50mb",allowedTypes:["zip"]},l={fileLimit:"50mb",allowedTypes:["mp4","ppt","pptx"]},u={course_title:"",course_content:"",job_titles:[],course_type:"",course_version:"",course_file_name:"",course_file:{},course_questions:[]};function a(){null!==e&&e.abort(),e=$.ajax({url:apiURL+"lms/course/view/edit",method:"GET"}).success((function(t){e=null,$("#"+o+"Body").html(t),$("#jsEditCourseVersion").select2({minimumResultsForSearch:-1}),$("#jsEditCourseJobTitles").select2({closeOnSelect:!1}),e=$.ajax({url:apiURL+"lms/course/"+s,method:"GET",headers:{accept:"application/json","content-type":"application/json"}}).success((function(t){var s;e=null,s=t.data,$("#jsEditCourseTitleHeader").html(" - "+s.course_title),$("#jsEditCourseTitle").val(s.course_title),$("#jsEditCourseAbout").val(s.course_content),$("#jsEditCourseJobTitles").select2("val",s.job_titles),$('.jsEditCourseType[value="'+s.course_type+'"]').prop("checked",!0),$('.jsEditCourseType[value="'+s.course_type+'"]').trigger("click"),"scorm"===s.course_type?(n.placeholderImage=s.course_file_name,$("#jsEditCourseVersion").select2("val",s.course_version)):(l.placeholderImage=s.course_file_name,r=s.course_questions,d()),$("#jsEditCourseFile").msFileUploader(n),$("#jsEditCourseVideoFile").msFileUploader(l),u.course_file_name=s.course_file_name,ml(!1,i)})).fail((function(t){return e=null,ml(!1,"jsPageLoader"),alertify.alert("Errors!",t.responseJSON.errors.join("<br />"),CB)}))})).fail(handleErrorResponse).done((function(){e=null}))}function c(e){ml(!1,i),r.push(e),d(),$(".jsPageBox").addClass("hidden"),$('.jsPageBox[data-id="main"]').removeClass("hidden")}function d(){if(!r.length)return $("#jsEditCourseQuestionsList").html('<tr><th colspan="3"><p class="alert alert-info text-center">No questions found yet.</p></th></tr>');let e="";r.map((function(t){e+='<tr data-key="'+t.question_id+'">',e+='\t<td class="vam">'+t.question_title+"</td>",e+='\t<td class="vam text-center">'+t.question_type.replace(/_/gi," ").toUpperCase()+"</td>",e+='\t<td class="vam text-center">',e+='\t\t<button type="button" class="btn btn-warning jsEditQuestionEdit" title="Edit question" placement="top">',e+='\t\t\t<i class="fa fa-edit" aria-hidden="true"></i>',e+="\t\t</button>",e+='\t\t<button type="button" class="btn btn-danger jsDeleteQuestionEdit" title="Delete question" placement="top">',e+='\t\t\t<i class="fa fa-times-circle" aria-hidden="true"></i>',e+="\t\t</button>",e+="\t</td>",e+="</tr>"})),$("#jsEditCourseQuestionsList").html(e)}$(document).on("click",".jsEditCourseCreateBtn",(function(e){e.preventDefault(),u={course_title:$("#jsEditCourseTitle").val().trim(),course_content:$("#jsEditCourseAbout").val().trim(),job_titles:$("#jsEditCourseJobTitles").val()||[],course_type:$(".jsEditCourseType:checked").val(),course_version:$("#jsEditCourseVersion").val(),course_file_name:u.course_file_name,course_file:$("#"+("scorm"===$(".jsEditCourseType:checked").val()?"jsEditCourseFile":"jsEditCourseVideoFile")).msFileUploader("get")||{},course_questions:r},async function(e){const n=[];e.course_title||n.push("Course title is required.");e.job_titles.length||n.push("Select at least one job title.");e.course_type||n.push("Course type is required.");e.course_questions=r;let l=!1;"scorm"===e.course_type&&null!==e.course_file_name.match(/.zip$/)&&(l=!0);"manual"===e.course_type&&null===e.course_file_name.match(/.zip$/)&&(l=!0);Object.keys(e.course_file).length||l||(Object.keys(e.course_file).length?e.course_file.errorCode&&n.push(e.course_file.errorCode):n.push("Please upload the "+("manual"===e.course_type?"Course":"SCORM")+" file."));"manual"!==e.course_type||r.length||n.push("At least one question is required for manual course.");if(n.length)return alertify.alert("ERROR!",getErrorsStringFromArray(n),CB);if(ml(!0,i),l)e.course_file=e.course_file_name;else{let t=await uploadFile(e.course_file);if(t=JSON.parse(t),!t.data)return alertify.alert("ERROR","Failed to upload the file.",CB);e.course_file=t.data}e.company_code=t;try{const t=await function(e){return new Promise((function(t,o){$.ajax({url:apiURL+"lms/course/"+s,method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},data:JSON.stringify(e)}).success(t).fail((function(e){o(e.responseJSON)}))}))}(e);alertify.alert("SUCCESS!",t.data,(function(){$("#"+o).remove(),getLMSDefaultCourses()}))}catch(e){return ml(!1,i),alertify.alert("ERROR!",getErrorsStringFromArray(e.errors,"Errors!!"),CB)}}(u)})),$(document).on("click",".jsEditCourseType",(function(){$(".jsEditCourseScormBox").addClass("hidden"),$(".jsEditManualCourseBox").addClass("hidden"),"scorm"===$(this).val()?$(".jsEditCourseScormBox").removeClass("hidden"):($(".jsEditManualCourseBox").removeClass("hidden"),d())})),$(document).on("click",".jsEditQuestionBtn",(function(e){e.preventDefault(),loadAddQuestionView(i,c)})),$(document).on("click",".jsBackToAddCoursePage",(function(e){e.preventDefault(),$(".jsPageBox").addClass("hidden"),$('.jsPageBox[data-id="main"]').removeClass("hidden")})),$(document).on("click",".jsDeleteQuestionEdit",(function(e){e.preventDefault();let t=$(this).closest("tr").data("key");return alertify.confirm("Are you certain about deleting the chosen question?",(function(){!function(e){r=r.filter((function(t){return t.question_id!=e})),d()}(t)}),CB)})),$(document).on("click",".jsEditQuestionEdit",(function(e){e.preventDefault();let t=$(this).closest("tr").data("key");loadEditQuestionView(function(e){return r.filter((function(t){return t.question_id==e}))[0]}(t),i,(function(e){$(".jsPageBox").addClass("hidden"),$('.jsPageBox[data-id="main"]').removeClass("hidden");let s=[];r.map((function(o){o.question_id===t?s.push(e):s.push(o)})),r=s,d(),ml(!1,i)}))})),window.startEditCourseProcess=function(e,r){t=e,s=r,Modal({Id:o,Title:'Update Course <span id="jsEditCourseTitleHeader"></span>',Loader:i,Cl:"container",Ask:!0,Body:'<div id="'+o+'Body"></div>'},a)}}));