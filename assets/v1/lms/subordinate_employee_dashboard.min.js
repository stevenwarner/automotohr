$(function(){function e(){null!==u&&u.abort(),ml(!0,"jsPageLoader"),u=$.ajax({url:apiURL+"lms/report/"+subordinateId+"/"+courseId,method:"GET"}).success(function(e){u=null,$("#jsPreviewCourse").html(e),"manual"===courseType&&s(),ml(!1,"jsPageLoader")}).fail(handleErrorResponse).always(function(){u=null,ml(!1,"jsPageLoader")})}function s(){null!==u&&u.abort(),ml(!0,"jsPageLoader"),u=$.ajax({url:apiURL+"lms/report/"+subordinateId+"/"+courseId+"/questions/attempt",method:"GET"}).success(function(e){u=null,$("#jsPreviewCourseQuestion").html(e),ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(){u=null,ml(!1,"jsPageLoader")})}function t(e){null!==u&&u.abort(),ml(!0,"jsPageLoader"),u=$.ajax({url:apiURL+"lms/report/"+e+"/courses?title="+h.title+"&status="+h.status,method:"GET"}).success(function(e){u=null;let s=e.data.count,t=e.data.courses;$("#jsAssignedCount").html(s.assigned),$("#jsPendingCount").html(s.pending),$("#jsCompletedCount").html(s.completed),$("#jsExpiredSoonCount").html(s.expire_soon),e.data.assignedIds.length||($(".jsFilterSectionBtn").hide(),$(".jsSendReminderEmail").hide()),t.length&&t.map(function(s){null!=s.employee_sid&&s.employee_sid!=employeeId||e.data.assignedIds.includes(s.sid)&&(e.data.inprogressIds.includes(s.sid)?c.length<3&&c.push(s):e.data.expiredIds.includes(s.sid)?d.length<3&&d.push(s):e.data.expiredSoonIds.includes(s.sid)?p.length<3&&p.push(s):e.data.readyToStartIds.includes(s.sid)?g.length<3&&g.push(s):e.data.passedIds.includes(s.sid)?f.length<3&&f.push(s):m.length<3&&m.push(s))}),n(c,"jsInprogressCourses"),n(d,"jsPastDueCourses"),n(p,"jsDueSoonCourses"),n(g,"jsAssignedCourses"),n(f,"jsPassedCourses"),s.assigned&&(r(s),l(s),i(s)),ml(!1,"jsPageLoader")}).fail(handleErrorResponse).always(function(){u=null,ml(!1,"jsPageLoader")})}function o(){var e=[],s={};return s.employee_sid=subordinateId,s.employee_name=subordinateName,e.push(s),e}function a(e,s){null!==u&&u.abort(),ml(!0,"jsPageLoader"),u=$.ajax({url:baseURI+"lms/courses/emailReminder/single",method:"POST",data:{employeeList:e,note:s}}).success(function(e){return u=null,ml(!1,"jsPageLoader"),alertify.alert("SUCCESS!","You have successfully sent an email reminder to <b>"+subordinateName+"</b>.")}).fail(handleErrorResponse).done(function(e){u=null})}function n(e,s){let t="";if(e.length)e.map(function(e){t+='    <div class="col-sm-4">',t+='    <article class="article-sec">',t+="    <h1>",t+=e.course_title,t+="    </h1>",t+="    <br>",t+='    <div class="row">',t+='        <div class="col-md-12 col-xs-12">',t+=`            <p>${e.course_content.substr(0,50)}&nbsp;</p>`,t+="        </div>",t+="    </div>",t+='    <div class="row">',t+='        <div class="col-md-6 col-xs-12">',t+='            <p class="csColumSection"><strong>ASSIGNED DATE</strong></p>',t+=`            <p>${moment(e.course_start_period).format(y)}</p>`,t+="        </div>",t+='        <div class="col-md-6 col-xs-12">',t+='            <p class="csColumSection"><strong>DUE DATE</strong></p>',null===e.course_end_period?t+="--":t+=`            <p>${moment(e.course_end_period).format(y)}</p>`,t+="        </div>",t+="    </div>",t+='    <div class="row">',t+='        <div class="col-md-12 col-xs-12 text-center">',t+=`            <select class="form-control jsSelectCourseLanguage jsCourseLanguage${e.sid}" data-course_id="${e.sid}">`;"scorm"==e.course_type&&e.course_languages[0],"scorm"==e.course_type?e.course_languages.map(function(s){e.selected_language&&e.selected_language==s?(e.selected_language,t+=`            <option value="${s}" selected="selected">${s.charAt(0).toUpperCase()+s.slice(1)}</option>`):t+=`            <option value="${s}">${s.charAt(0).toUpperCase()+s.slice(1)}</option>`}):t+='                <option value="english">English</option>',t+="            </select>",t+="        </div>",t+="    </div>",t+='    <div class="row">',t+='        <div class="col-md-12 col-xs-12 text-center">',t+="            <p>&nbsp;</p>","passed"==e.course_status?(t+=`            <a class="btn btn-info csRadius5 csF16" href="${baseURI}lms/subordinate/course/${e.sid}/${subordinateId}/${reviewAs}">\n\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-eye"></i>\n\t\t\t\t\t\t\t\t\t\t\t\tView Content\n\t\t\t\t\t\t\t\t\t\t\t</a>`,t+=`        <a class="btn btn-info csRadius5 csF16" href="${baseURI}lms/courses/${e.sid}/${subordinateId}/subordinate/certificate}">\n\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-eye"></i>\n\t\t\t\t\t\t\t\t\t\t\t\tView Certificate\n\t\t\t\t\t\t\t\t\t\t\t</a>`):t+=`            <a class="btn btn-info csRadius5 csF16" href="${baseURI}lms/subordinate/course/${e.sid}/${subordinateId}/${reviewAs}">\n\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-play"></i>\n\t\t\t\t\t\t\t\t\t\t\t\tLaunch Content\n\t\t\t\t\t\t\t\t\t\t\t</a>`,t+="        </div>",t+="    </div>",t+="</article>",t+="</div>"});else{var o="Apologies, but no assigned course was found.";"jsInprogressCourses"==s?o="Apologies, but there are currently no courses in progress.":"jsPastDueCourses"==s?o="Apologies, but no past due courses were found.":"jsDueSoonCourses"==s&&(o="Apologies, but no courses with upcoming expiration dates were found."),t+='<div class="col-sm-12">',t+=' <p class="alert alert-info text-center">',t+=o,t+=" </p>",t+="</div>"}$("#"+s).html(t)}function r(e){Highcharts.chart("container",{chart:{type:"pie"},title:{text:"Assigned Course(s)"},tooltip:{valueSuffix:""},plotOptions:{series:{allowPointSelect:!0,cursor:"pointer",dataLabels:[{enabled:!0,distance:20},{enabled:!0,distance:-40,format:"{point.percentage:.1f}%",style:{fontSize:"1.2em",textOutline:"none",opacity:.7},filter:{operator:">",property:"percentage",value:10}}]}},series:[{name:"Course(s)",colorByPoint:!0,point:{events:{click:function(e){window.open(e.point.url,"_blank"),e.preventDefault()}}},data:[{name:"Due Soon",y:e.expire_soon,color:"#feb56a",url:baseURI+"lms/courses/my?type=due_soon"},{name:"Past Due",sliced:!0,selected:!0,y:e.expired,color:"#fa4b42",url:baseURI+"lms/courses/my?type=past_due"},{name:"In Progress",y:e.inprogress,color:"#544fc5",url:baseURI+"lms/courses/my?type=inprogress"},{name:"Ready To Start",y:e.readyToStart,color:"#2caffe",url:baseURI+"lms/courses/my?type=assigned"},{name:"Passed",y:e.passed,color:"#00e272",url:baseURI+"lms/courses/my?type=assigned"}]}]})}function l(e){Highcharts.chart("container1",{chart:{type:"column"},title:{align:"left",text:"Assigned Course(s) Bar Chart"},accessibility:{announceNewData:{enabled:!0}},xAxis:{type:"category"},yAxis:{title:{text:"Total number of assigned course(s)"}},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y}"}}},tooltip:{headerFormat:'<span style="font-size:11px">{series.name}</span><br>',pointFormat:'<span style="color:{point.color}">{point.name}</span>: <b>{point.y}</b> course(s)<br/>'},series:[{name:"Course(s)",colorByPoint:!0,point:{events:{click:function(e){window.open(e.point.url,"_blank"),e.preventDefault()}}},data:[{name:"Assigned ",color:"#2caffe",y:e.assigned,url:baseURI+"lms/courses/my?type=assigned"},{name:"Pending",color:"#ff834e",y:e.pending,url:baseURI+"lms/courses/my?type=pending"},{name:"In Progress",color:"#544fc5",y:e.inprogress,url:baseURI+"lms/courses/my?type=inprogress"},{name:"Passed",color:"#00e272",y:e.passed,url:baseURI+"lms/courses/my?type=inprogress"},{name:"Past Due",color:"#fa4b42",y:e.expired,url:baseURI+"lms/courses/my?type=past_due"},{name:"Due Soon",color:"#feb56a",y:e.expire_soon,url:baseURI+"lms/courses/my?type=due_soon"}]}]})}function i(e){Highcharts.chart("container2",{chart:{type:"gauge",plotBackgroundColor:null,plotBackgroundImage:null,plotBorderWidth:0,plotShadow:!1,height:"80%"},title:{text:"Course(s) Passing Rate"},pane:{startAngle:-90,endAngle:89.9,background:null,center:["50%","75%"],size:"110%"},yAxis:{min:0,max:e.assigned,tickPixelInterval:100,tickPosition:"inside",tickColor:Highcharts.defaultOptions.chart.backgroundColor||"#FFFFFF",tickLength:20,tickWidth:2,minorTickInterval:null,labels:{distance:20,style:{fontSize:"14px"}},lineWidth:0,plotBands:[{from:e.assigned,to:e.assigned/2,color:"#55BF3B",thickness:20,borderRadius:"50%"},{from:e.assigned/3,to:0,color:"#DF5353",thickness:20,borderRadius:"50%"},{from:e.assigned/1.9,to:e.assigned/3.1,color:"#DDDF0D",thickness:20}]},series:[{name:"Speed",data:[e.passed],tooltip:{valueSuffix:" km/h"},dataLabels:{format:"{y} Passed",borderWidth:0,color:Highcharts.defaultOptions.title&&Highcharts.defaultOptions.title.style&&Highcharts.defaultOptions.title.style.color||"#333333",style:{fontSize:"16px"}},dial:{radius:"80%",backgroundColor:"gray",baseWidth:12,baseLength:"0%",rearLength:"0%"},pivot:{backgroundColor:"gray",radius:6}}]})}let u=null,c=[],d=[],p=[],m=[],g=[],f=[],y="MMM DD YYYY, ddd",h={title:"",status:"all"};if($(".jsFilterBox").click(function(e){e.preventDefault(),$(".jsCourseTitleMyCourse").val(""),$('.jsCourseStatus option[value="'+$(this).data("key")+'"]').prop("selected",!0),h.title=$(".jsCourseTitleMyCourse").val()||"",h.status=$(".jsCourseStatus").val(),t(subordinateId)}),$(".jsApplyFilterMyCourse").click(function(e){e.preventDefault(),h.title=$(".jsCourseTitleMyCourse").val()||"",h.status=$(".jsCourseStatus").val(),t(subordinateId)}),$(".jsClearFilterMyCourse").click(function(e){e.preventDefault(),$(".jsCourseTitleMyCourse").val(""),$('.jsCourseStatus option[value="all"]').prop("selected",!0),h.title=$(".jsCourseTitleMyCourse").val()||"",h.status=$(".jsCourseStatus").val(),t(subordinateId)}),"subordinate_course"===page&&"scorm"===courseType){function b(e){}window.sendCourseToSave=b}"subordinate_courses"===page?t(subordinateId):($(".jsSaveQuestionResult").hide(),e()),$(document).on("click",".jsSendReminderEmail",function(e){e.preventDefault(),alertify.confirm("Do you really want to send email reminder to <b>"+subordinateName+"</b>?",function(){alertify.prompt("Please Enter a Note","","",function(e,s){},function(){alertify.error("Cancel")}).setContent('<textarea style="resize: none;" rows="5" cols="50"> </textarea>').set("onok",function(e){employeeInfo=o(),a(employeeInfo,this.elements.content.querySelector("textarea").value)})})})});