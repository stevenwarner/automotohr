$((function(){let e=null,t=[],s=[],o=[],a=[],n=[],r=[],i="MMM DD YYYY, ddd",l={title:"",status:"all"};if($(".jsFilterBox").click((function(e){e.preventDefault(),$(".jsCourseTitleMyCourse").val(""),$('.jsCourseStatus option[value="'+$(this).data("key")+'"]').prop("selected",!0),l.title=$(".jsCourseTitleMyCourse").val()||"",l.status=$(".jsCourseStatus").val(),u(subordinateId)})),$(".jsApplyFilterMyCourse").click((function(e){e.preventDefault(),l.title=$(".jsCourseTitleMyCourse").val()||"",l.status=$(".jsCourseStatus").val(),u(subordinateId)})),$(".jsClearFilterMyCourse").click((function(e){e.preventDefault(),$(".jsCourseTitleMyCourse").val(""),$('.jsCourseStatus option[value="all"]').prop("selected",!0),l.title=$(".jsCourseTitleMyCourse").val()||"",l.status=$(".jsCourseStatus").val(),u(subordinateId)})),$(".jsCategoryCourses").click((function(e){e.preventDefault();var t=$(this).data("url");window.open(t,"_blank")})),"subordinate_course"===page&&"scorm"===courseType){window.sendCourseToSave=function(e){}}function u(i){null!==e&&e.abort(),ml(!0,"jsPageLoader"),e=$.ajax({url:apiURL+"lms/report/"+i+"/courses?title="+l.title+"&status="+l.status,method:"GET"}).success((function(i){e=null;let l=i.data.count,u=i.data.courses;i.data.assignedIds.length||($(".jsFilterSectionBtn").hide(),$(".jsSendReminderEmail").hide()),u.length&&u.map((function(e){null!=e.employee_sid&&e.employee_sid!=employeeId||i.data.assignedIds.includes(e.sid)&&(i.data.inprogressIds.includes(e.sid)?t.push(e):i.data.expiredIds.includes(e.sid)?s.push(e):i.data.expiredSoonIds.includes(e.sid)?o.push(e):i.data.readyToStartIds.includes(e.sid)?n.push(e):i.data.passedIds.includes(e.sid)?r.push(e):a.push(e))})),$("#jsInProgressCount").html(t.length),$("#jsReadyToStartCount").html(n.length),$("#jsPastDueCount").html(s.length),$("#jsDueSoon").html(o.length),$("#jsCompletedCount").html(r.length),d(t,"jsInprogressCourses"),d(s,"jsPastDueCourses"),d(o,"jsDueSoonCourses"),d(n,"jsAssignedCourses"),d(r,"jsPassedCourses"),l.assigned&&(function(e){var t=Math.round((e.assigned-e.pending)/e.assigned*100);$("#jsOverViewTrainings").html(t+"%"),$("#jsOverViewCourseDueSoon").html(e.pending),$("#jsOverViewCourseTotal").html(e.assigned)}(l),c(l),p(l),function(e){Highcharts.chart("container2",{chart:{type:"gauge",plotBackgroundColor:null,plotBackgroundImage:null,plotBorderWidth:0,plotShadow:!1,height:"80%"},title:{text:"Course(s) Passing Rate"},pane:{startAngle:-90,endAngle:89.9,background:null,center:["50%","75%"],size:"110%"},yAxis:{min:0,max:e.assigned,tickPixelInterval:100,tickPosition:"inside",tickColor:Highcharts.defaultOptions.chart.backgroundColor||"#FFFFFF",tickLength:20,tickWidth:2,minorTickInterval:null,labels:{distance:20,style:{fontSize:"14px"}},lineWidth:0,plotBands:[{from:e.assigned,to:e.assigned/2,color:"#55BF3B",thickness:20,borderRadius:"50%"},{from:e.assigned/3,to:0,color:"#DF5353",thickness:20,borderRadius:"50%"},{from:e.assigned/1.9,to:e.assigned/3.1,color:"#DDDF0D",thickness:20}]},series:[{name:"Speed",data:[e.passed],tooltip:{valueSuffix:" km/h"},dataLabels:{format:"{y} Passed",borderWidth:0,color:Highcharts.defaultOptions.title&&Highcharts.defaultOptions.title.style&&Highcharts.defaultOptions.title.style.color||"#333333",style:{fontSize:"16px"}},dial:{radius:"80%",backgroundColor:"gray",baseWidth:12,baseLength:"0%",rearLength:"0%"},pivot:{backgroundColor:"gray",radius:6}}]})}(l)),ml(!1,"jsPageLoader")})).fail(handleErrorResponse).always((function(){e=null,ml(!1,"jsPageLoader")}))}function d(e,t){let s="";if(e.length)e.map((function(e){s+='    <div class="col-sm-4">',s+='    <article class="article-sec">',e.course_banner&&(s+=`    <div class="row">\n\t\t\t\t\t\t\t\t\t\t\t<div class="col-md-12 col-xs-12">\n\t\t\t\t\t\t\t\t\t\t\t\t<img src="https://automotohrattachments.s3.amazonaws.com/${e.course_banner}" class="" />\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t`),s+='    <h1 style="height: 58px;">',s+=e.course_title,s+="    </h1>",s+="    <br>",s+='    <div class="row">',s+='        <div class="col-md-12 col-xs-12">',s+=`            <p>${e.course_content.substr(0,50)}&nbsp;</p>`,s+="        </div>",s+="    </div>",s+='    <div class="row">',s+='        <div class="col-md-6 col-xs-12">',s+='            <p class="csColumSection"><strong>ASSIGNED DATE</strong></p>',s+=`            <p>${moment(e.course_start_period).format(i)}</p>`,s+="        </div>",s+='        <div class="col-md-6 col-xs-12">',s+='            <p class="csColumSection"><strong>DUE DATE</strong></p>',null===e.course_end_period?s+="--":s+=`            <p>${moment(e.course_end_period).format(i)}</p>`,s+="        </div>",s+="    </div>",s+='    <div class="row">',s+='        <div class="col-md-12 col-xs-12 text-center">',s+=`            <select class="form-control jsSelectCourseLanguage jsCourseLanguage${e.sid}" data-course_id="${e.sid}">`;var t="";t="scorm"==e.course_type?e.course_languages[0]:"english","scorm"==e.course_type?e.course_languages.map((function(o){e.selected_language&&e.selected_language==o?(t=e.selected_language,s+=`            <option value="${o}" selected="selected">${o.charAt(0).toUpperCase()+o.slice(1)}</option>`):s+=`            <option value="${o}">${o.charAt(0).toUpperCase()+o.slice(1)}</option>`})):s+='                <option value="english">English</option>',s+="            </select>",s+="        </div>",s+="    </div>",s+='    <div class="row">',s+='        <div class="col-md-12 col-xs-12 text-center">',s+="            <p>&nbsp;</p>","passed"==e.course_status?(s+=`            <a class="btn btn-info csRadius5 csF16 jsStartCourse${e.sid}" href="${baseURI}lms/subordinate/course/${e.sid}/${subordinateId}/${reviewAs}/${t}">\n\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-eye"></i>\n\t\t\t\t\t\t\t\t\t\t\t\tView Content\n\t\t\t\t\t\t\t\t\t\t\t</a>`,s+=`        <a class="btn btn-info csRadius5 csF16" href="${baseURI}lms/courses/${e.sid}/${subordinateId}/subordinate/certificate">\n\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-eye"></i>\n\t\t\t\t\t\t\t\t\t\t\t\tView Certificate\n\t\t\t\t\t\t\t\t\t\t\t</a>`):s+=`            <a class="btn btn-info csRadius5 csF16 jsStartCourse${e.sid}" href="${baseURI}lms/subordinate/course/${e.sid}/${subordinateId}/${reviewAs}/${t}">\n\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-eye"></i>\n\t\t\t\t\t\t\t\t\t\t\t\tView Content\n\t\t\t\t\t\t\t\t\t\t\t</a>`,s+="        </div>",s+="    </div>",s+="</article>",s+="</div>"}));else{var o="Apologies, but no assigned course was found.";"jsInprogressCourses"==t?o="Apologies, but there are currently no courses in progress.":"jsPastDueCourses"==t?o="Apologies, but no past due courses were found.":"jsDueSoonCourses"==t&&(o="Apologies, but no courses with upcoming expiration dates were found."),s+='<div class="col-sm-12">',s+=' <p class="alert alert-info text-center">',s+=o,s+=" </p>",s+="</div>"}$("#"+t).html(s)}function c(e){Highcharts.chart("container",{chart:{type:"pie"},title:{text:"Assigned Course(s)"},tooltip:{valueSuffix:""},plotOptions:{pie:{dataLabels:{enabled:!0,style:{fontSize:"12px"}}},series:{allowPointSelect:!0,cursor:"pointer",dataLabels:[{enabled:!0,distance:20},{enabled:!0,distance:-40,format:"{point.percentage:.1f}%",style:{fontSize:"1.5em",textOutline:"none",opacity:.7},filter:{operator:">",property:"percentage",value:10}}]}},series:[{name:"Course(s)",colorByPoint:!0,point:{events:{click:function(e){window.open(e.point.url,"_blank"),e.preventDefault()}}},data:[{name:"Due Soon",y:e.expire_soon,color:"#feb56a",url:baseURI+"lms/subordinate/courses/"+subordinateId+"?type=due_soon"},{name:"Past Due",sliced:!0,selected:!0,y:e.expired,color:"#fa4b42",url:baseURI+"lms/subordinate/courses/"+subordinateId+"?type=past_due"},{name:"In Progress",y:e.inprogress,color:"#544fc5",url:baseURI+"lms/subordinate/courses/"+subordinateId+"?type=inprogress"},{name:"Ready To Start",y:e.readyToStart,color:"#2caffe",url:baseURI+"lms/subordinate/courses/"+subordinateId+"?type=ready_to_start"},{name:"Passed",y:e.passed,color:"#00e272",url:baseURI+"lms/subordinate/courses/"+subordinateId+"?type=completed"}]}],tooltip:{style:{fontSize:"14px"}}})}function p(e){Highcharts.chart("container1",{chart:{type:"column"},title:{align:"left",text:"Assigned Course(s) Bar Chart"},accessibility:{announceNewData:{enabled:!0}},xAxis:{type:"category",labels:{style:{fontSize:"12px"}}},yAxis:{title:{text:"Total number of assigned course(s)"},labels:{style:{fontSize:"12px"}}},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y}"}}},tooltip:{headerFormat:'<span style="font-size:14px">{series.name}</span><br>',pointFormat:'<span style="font-size:12px; color:{point.color}">{point.name}:</span> <b style="font-size:12px">{point.y} course(s)</b>'},series:[{name:"Course(s)",colorByPoint:!0,point:{events:{click:function(e){window.open(e.point.url,"_blank"),e.preventDefault()}}},data:[{name:"Assigned ",color:"#6B8ABB",y:e.assigned,url:baseURI+"lms/subordinate/courses/"+subordinateId+"?type=assigned"},{name:"Pending",color:"#ff834e",y:e.pending,url:baseURI+"lms/subordinate/courses/"+subordinateId+"?type=pending"},{name:"Ready To Start",color:"#2caffe",y:e.readyToStart,url:baseURI+"lms/subordinate/courses/"+subordinateId+"?type=ready_to_start"},{name:"In Progress",color:"#544fc5",y:e.inprogress,url:baseURI+"lms/subordinate/courses/"+subordinateId+"?type=inprogress"},{name:"Passed",color:"#00e272",y:e.passed,url:baseURI+"lms/subordinate/courses/"+subordinateId+"?type=completed"},{name:"Past Due",color:"#fa4b42",y:e.expired,url:baseURI+"lms/subordinate/courses/"+subordinateId+"?type=past_due"},{name:"Due Soon",color:"#feb56a",y:e.expire_soon,url:baseURI+"lms/subordinate/courses/"+subordinateId+"?type=due_soon"}],dataLabels:{style:{fontSize:"12px"}}}]})}"subordinate_courses"===page?(u(subordinateId),$(".jsIPLoader").hide()):($(".jsSaveQuestionResult").hide(),null!==e&&e.abort(),ml(!0,"jsPageLoader"),e=$.ajax({url:apiURL+"lms/report/"+subordinateId+"/"+courseId,method:"GET"}).success((function(t){e=null,$("#jsPreviewCourse").html(t),"manual"===courseType&&(null!==e&&e.abort(),ml(!0,"jsPageLoader"),e=$.ajax({url:apiURL+"lms/report/"+subordinateId+"/"+courseId+"/questions/attempt",method:"GET"}).success((function(t){e=null,$("#jsPreviewCourseQuestion").html(t),ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(){e=null,ml(!1,"jsPageLoader")}))),ml(!1,"jsPageLoader")})).fail(handleErrorResponse).always((function(){e=null,ml(!1,"jsPageLoader")}))),$(document).on("click",".jsSendReminderEmail",(function(t){t.preventDefault(),alertify.confirm("Do you really want to send email reminder to <b>"+subordinateName+"</b>?",(function(){alertify.prompt("Please Enter a Note","","",(function(e,t){}),(function(){alertify.error("Cancel")})).setContent('<textarea style="resize: none;" rows="5" cols="50"> </textarea>').set("onok",(function(t){var s,o;employeeInfo=(s=[],(o={}).employee_sid=subordinateId,o.employee_name=subordinateName,s.push(o),s),function(t,s){null!==e&&e.abort();ml(!0,"jsPageLoader"),e=$.ajax({url:baseURI+"lms/courses/emailReminder/single",method:"POST",data:{employeeList:t,note:s}}).success((function(t){return e=null,ml(!1,"jsPageLoader"),alertify.alert("SUCCESS!","You have successfully sent an email reminder to <b>"+subordinateName+"</b>.")})).fail(handleErrorResponse).done((function(t){e=null}))}(employeeInfo,this.elements.content.querySelector("textarea").value)}))}))})),$(document).on("change",".jsSelectCourseLanguage",(function(e){e.preventDefault();var t=$(this).data("course_id"),s=$(this).val(),o=baseURI+"lms/subordinate/course/"+t+"/"+subordinateId+"/"+reviewAs+"/"+s;$(".jsStartCourse"+t).attr("href",o)}))}));