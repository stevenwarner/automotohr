$(function(){function e(){$(".jsSelectSubordinate").prop("checked",$(this).prop("checked"))}function s(){$(this).find('input[name="employees_ids[]"]').prop("checked",!$(this).find('input[name="employees_ids[]"]').prop("checked")),$(".jsCheckAll").prop("checked",$(".jsSelectSubordinate").length==$(".jsSelectSubordinate:checked").length)}function t(){var e=[];return $.each($('input[name="employees_ids[]"]:checked'),function(){var s={};s.employee_sid=parseInt($(this).val()),s.employee_name=$(this).closest("tr").find("td.js-employee-name").text(),e.push(s)}),e}function o(e){null!==l&&l.abort(),ml(!0,"jsPageLoader"),l=$.ajax({url:baseURI+"lms/courses/emailReminder/bulk",method:"POST",data:{employeeList:e}}).success(function(e){return l=null,ml(!1,"jsPageLoader"),alertify.alert("SUCCESS!","You have successfully sent an email reminder to selected employees.")}).fail(handleErrorResponse).done(function(e){l=null})}function a(){Highcharts.chart("container1",{chart:{type:"column"},title:{align:"left",text:"Assigned Course(s) Bar Chart"},accessibility:{announceNewData:{enabled:!0}},xAxis:{type:"category",labels:{style:{fontSize:"12px"}}},yAxis:{title:{text:"Total number of assigned course(s)"},labels:{style:{fontSize:"12px"}}},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y}"}}},tooltip:{headerFormat:'<span style="font-size:14px">{series.name}</span><br>',pointFormat:'<span style="font-size:12px; color:{point.color}">{point.name}:</span> <b style="font-size:12px">{point.y} course(s)</b>'},series:[{name:"Course(s)",colorByPoint:!0,data:[{name:"Assigned ",color:"#6B8ABB",y:totalCourses},{name:"Pending",color:"#ff834e",y:totalCourses-completedCourses},{name:"Ready To Start",color:"#2caffe",y:readyToStart},{name:"In Progress",color:"#544fc5",y:inProgressCourses},{name:"Passed",color:"#00e272",y:completedCourses},{name:"Past Due",color:"#fa4b42",y:pastDueCourses},{name:"Due Soon",color:"#feb56a",y:dueSoonCourses}],dataLabels:{style:{fontSize:"12px"}}}]})}let l=null;$("#jsSubordinateDepartments").select2({closeOnSelect:!1}),void 0!==departments&&$("#jsSubordinateDepartments").length&&$("#jsSubordinateDepartments").select2("val",departments.split(",")),$("#jsSubordinateTeams").select2({closeOnSelect:!1}),void 0!==teams&&$("#jsSubordinateTeams").length&&$("#jsSubordinateTeams").select2("val",teams.split(",")),$("#jsSubordinateEmployees").select2({closeOnSelect:!1}),void 0!==employees&&$("#jsSubordinateEmployees").length&&$("#jsSubordinateEmployees").select2("val",employees.split(",")),$("#jsSubordinateCourses").select2({closeOnSelect:!1}),void 0!==courses&&$("#jsSubordinateCourses").length&&$("#jsSubordinateCourses").select2("val",courses.split(",")),$(document).on("click",".jsSearchEmployees",function(e){e.preventDefault();var s=$("#jsSubordinateDepartments").val(),t=$("#jsSubordinateTeams").val(),o=$("#jsSubordinateEmployees").val(),a=$("#jsSubordinateCourses").val();null!==l&&l.abort(),ml(!0,"jsPageLoader"),l=$.ajax({url:baseURL+"lms/courses/report",method:"GET",data:{departments:s,teams:t,employees:o,courses:a}}).success(function(e){l=null;var s="";$.each(e.employees,function(e,t){t.team_sid,t.department_sid;var o=t.assign_courses?t.assign_courses.split(","):[],a=(o&&o.length,t.coursesInfo.completed/t.coursesInfo.total_course*100),l="bg-danger";"100"==a?l="bg-success":a<"90"&&a>"1"&&(l="bg-warning"),s+=`<tr class="js-tr ${l}">`,s+="<td>",t.coursesInfo.total_course>0&&t.coursesInfo.total_course!=t.coursesInfo.completed&&(s+='\t<label class="control control--checkbox">',s+=`\t\t<input type="checkbox" name="employees_ids[]" value="${t.employee_sid}" />`,s+='\t\t<div class="control__indicator"></div>',s+="\t</label>"),s+="</td>",s+='<td class="_csVm">',s+='\t<div class="row">',s+='\t\t<div class="col-sm-3">',s+=`\t\t\t<img style="width: 80px; height: 80px; border-radius: 50% !important;" src="${t.profile_picture_url}" alt="" />`,s+="\t\t</div>",s+='\t\t<div class="col-sm-9">',s+='\t\t\t<p class="text-small weight-6 myb-0" style="font-size: 20px;">',s+=t.only_name,s+="\t\t\t</p>",s+='\t\t\t<p class="text-small">',s+=t.designation,s+="\t\t\t</p>",s+='\t\t\t<p class="text-small">',s+=t.email,s+="\t\t\t</p>",s+="\t\t</div>",s+="\t</div>",s+="</td>",s+=`<td class="_csVm">${t.department_name}</td>`,s+=`<td class="_csVm">${t.team_name}</td>`,s+=`<td class="_csVm">${t.coursesInfo?t.coursesInfo.total_course:0}</td>`,s+=`<td class="_csVm">${t.coursesInfo?t.coursesInfo.completed:0}</td>`,s+=`<td class="_csVm">${t.coursesInfo?t.coursesInfo.started:0}</td>`,s+=`<td class="_csVm">${t.coursesInfo?t.coursesInfo.ready_to_start:0}</td>`,s+=`<td class="_csVm">${t.coursesInfo?t.coursesInfo.expire_soon:0}</td>`,s+=`<td class="_csVm">${t.coursesInfo?t.coursesInfo.expired:0}</td>`,s+=`<td class="_csVm"><a href="${baseURL}lms/subordinate/courses/${t.employee_sid}" class="btn btn-info btn-block csRadius5 csF16">View</a></td>`,s+="</tr>"}),$("#jsSubordinateList").html(s),ml(!1,"jsPageLoader")}).fail(handleErrorResponse).always(function(){l=null,ml(!1,"jsPageLoader")})}),$(document).on("click",".jsCheckAll",e),$(document).on("click",".jsSelectSubordinate",s),$(document).on("click",".jsSendReminderEmail",function(e){e.preventDefault(),senderList=t(),0!==senderList.length?alertify.confirm("Do you really want to send email reminders to the selected employees?",function(){o(senderList)}):alertify.alert("ERROR!","Please select at least one employee to start the process.")}),ml(!1,"jsPageLoader"),a()});