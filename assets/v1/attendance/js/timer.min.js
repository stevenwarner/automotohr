$(function(){function t(){Modal({Id:"jsJobSiteModal",Title:"Select a job site.",Loader:"jsJobSiteModalLoader",Body:o()},function(){ml(!1,"jsJobSiteModalLoader"),$("#jsJobSiteModalBody").submit(function(t){t.preventDefault(),m("clocked_in",$(".jsJobSiteModalSelect option:selected").val()),$("#jsJobSiteModal").find(".jsModalCancel").click()})})}function e(){Modal({Id:"jsBreaksModal",Title:"Select a break.",Loader:"jsBreaksModalLoader",Body:n()},function(){ml(!1,"jsBreaksModalLoader"),$("#jsBreaksModalBody").submit(function(t){t.preventDefault();const e=$(".jsBreaksModelSelect option:selected").val();if(w.allowed_breaks&&w.allowed_breaks.length==w.breaks)return _error("You have already taken allowed breaks.");let o=w.allowed_breaks.filter(function(t){return t.id==e});return o[0].start_time&&""!=o[0].start_time&&moment()<moment(o[0].start_time,"hh:mm a")?_error('You can not start break before "'+o[0].start_time+'".'):o[0].end_time&&""!=o[0].end_time&&moment()>moment(o[0].end_time,"hh:mm a")?_error('You can not start break after "'+o[0].end_time+'".'):(m("break_started",e),void $("#jsBreaksModal").find(".jsModalCancel").click())})})}function o(){let t="";return t+='<div class="container" id="jsJobSiteModalBody">',t+='\t<br /><div class="row">',t+='\t\t<div class="col-sm-12">',t+='\t\t\t<form id="jsJobSiteModalForm">',t+='\t\t\t\t<div class="form-group">',t+='\t\t\t\t\t<label class="tex-medium">',t+="\t\t\t\t\t\tPlease select a job site",t+='\t\t\t\t\t\t<strong class="text-danger"></strong>',t+="\t\t\t\t\t</label>",t+='\t\t\t\t\t<select class="form-control jsJobSiteModalSelect">',t+='\t\t\t\t\t\t<option value="0">Clock in without job site</option>',w.job_sites.map(function(e){t+='\t\t\t\t\t\t<option value="'+e.sid+'">'+e.site_name+"</option>"}),t+="\t\t\t\t\t</select>",t+="\t\t\t\t</div>",t+='\t\t\t\t<div class="form-group text-right">',t+='\t\t\t\t\t<button class="btn btn-success">',t+="\t\t\t\t\t\tClock In",t+="\t\t\t\t\t</button>",t+="\t\t\t\t</div>",t+="\t\t\t</form>",t+="\t\t</div>",t+="\t</div>",t+="</div>",t}function n(){let t="";return t+='<div class="container" id="jsBreaksModalBody">',t+='\t<br /><div class="row">',t+='\t\t<div class="col-sm-12">',t+='\t\t\t<form id="jsBreaksModelForm">',t+='\t\t\t\t<div class="form-group">',t+='\t\t\t\t\t<label class="tex-medium">',t+="\t\t\t\t\t\tPlease select a break",t+='\t\t\t\t\t\t<strong class="text-danger"></strong>',t+="\t\t\t\t\t</label>",t+='\t\t\t\t\t<select class="form-control jsBreaksModelSelect">',w.allowed_breaks.map(function(e){let o=e.duration+"m";e.start_time&&(o=e.start_time+" - "+e.end_time);let n=f(e.id);t+="\t\t\t\t\t\t<option "+(n?"disabled":"")+' value="'+e.id+'">'+e.break+" ("+o+")</option>"}),t+="\t\t\t\t\t</select>",t+="\t\t\t\t</div>",t+='\t\t\t\t<div class="form-group text-right">',t+='\t\t\t\t\t<button class="btn btn-success">',t+="\t\t\t\t\t\tStart Break",t+="\t\t\t\t\t</button>",t+="\t\t\t\t</div>",t+="\t\t\t</form>",t+="\t\t</div>",t+="\t</div>",t+="</div>",t}function a(t){t||r(),$.ajax({url:baseUrl("v1/clock"),method:"GET"}).always(function(){C=null}).fail(handleErrorResponse).done(function(t){w=t,clearInterval(_),clearInterval(v),""===t.state||"clocked_out"==t.state?r():(g=t.clock_time,p=t.time,j=t.timezone,_=setInterval(l,1e3)),d(t.state),"clocked_out"==t.state&&c(t.time),v=setInterval(i,1e3),t.blocked&&($(".jsAttendanceBTNs").html(""),$(".jsAttendanceClockHeaderBTNs").html(""))})}function s(t,e,o,n,r){if(null!==C)return;const l=callButtonHook($(`.jsAttendanceBtn[data-type="${t}"]`),!0),c={type:t,latitude:e,longitude:o,job_site:n};void 0!==r&&(c.confirmed=r),C=$.ajax({url:baseUrl("v1/clock/mark"),method:"POST",data:JSON.stringify(c),headers:{"content-type":"application/json"}}).always(function(){callButtonHook(l,!1),C=null}).fail(handleErrorResponse).done(function(r){if(console.log(r),r.confirm)return _confirm(r.msg,function(){s(t,e,o,n,!0)});_success("You have successfully "+b(t)+"."),a()})}function r(){g="",p="",clearInterval(_),$(".jsAttendanceClockHour").html("00"),$(".jsAttendanceClockMinute").html("00"),$(".jsAttendanceClockSeconds").html("00"),$(".jsAttendanceClockSeparator").html(":"),$(".jsAttendanceBTNs").html(""),$(".jsAttendanceClockHeaderBTNs").html("")}function l(){if(!g)return $(".jsAttendanceClockHour").html("00"),$(".jsAttendanceClockMinute").html("00"),$(".jsAttendanceClockSeconds").html("00"),void $(".jsAttendanceClockSeparator").html(":");const t=moment.utc(g).tz(j).subtract(p,"seconds"),e=moment.utc().tz(j);console.log(e);const o=e.diff(t),n=moment(o).utc().tz(j);$(".jsAttendanceClockHour").html(n.format("HH")),$(".jsAttendanceClockMinute").html(n.format("mm")),$(".jsAttendanceClockSeconds").html(n.format("ss")),$(".jsAttendanceClockSeparator").html(":")}function c(t){const e=h(t);$(".jsAttendanceClockHour").html(e.hours),$(".jsAttendanceClockMinute").html(e.minutes),$(".jsAttendanceClockSeconds").html(e.seconds),$(".jsAttendanceClockSeparator").html(":")}function i(){let t=moment.tz(w.timezone),e=moment.tz(w.timerDateTime,w.timezone);const o=t.diff(w.timerDateTime);e.add(o,"milliseconds"),$(".jsAttendanceCurrentClockDateTime").text(e.format("MMM D YYYY, ddd HH:mm:ss")),$(".jsAttendanceLoader").hide()}function d(t){let e="";"clocked_in"===t||"break_ended"===t?(e+=u("break_start"),e+=u("clocked_out")):"break_started"===t?(e+=u("break_end"),e+=u("clocked_out")):e+=u("clocked_in"),$(".jsAttendanceBTNs").html(e),$(".jsAttendanceClockHeaderBTNs").html(e)}function u(t){let e="";return"clocked_in"===t?(e+='<button class="btn btn-orange jsAttendanceBtn" data-type="clocked_in">',e+='\t<i class="fa fa-play-circle csF16" aria-hidden="true"></i>',e+="\t&nbsp;Clock in",e+="</button>"):"clocked_out"===t?(e+='&nbsp;<button class="btn btn-red jsAttendanceBtn" data-type="clocked_out">',e+='\t<i class="fa fa-stop-circle csF16" aria-hidden="true"></i>',e+="\t&nbsp;Clock out",e+="</button>"):"break_start"===t?(e+='&nbsp;<button class="btn btn-black jsAttendanceBtn" data-type="break_started">',e+='\t<i class="fa fa-pause-circle csF16" aria-hidden="true"></i>',e+="\t&nbsp;Break start",e+="</button>"):"break_end"===t&&(e+='&nbsp;<button class="btn btn-yellow jsAttendanceBtn" data-type="break_ended">',e+='\t<i class="fa fa-stop csF16" aria-hidden="true"></i>',e+="\t&nbsp;Break end",e+="</button>"),e}function m(t,e=null){if(navigator.geolocation){function o(o){s(t,o.coords.latitude,o.coords.longitude,e)}function n(){return alertify.alert("Location permission denied!",k())}navigator.geolocation.getCurrentPosition(o,n)}else s(t,0,0),console.log("Geolocation is required for this page, but your browser doesn't support it. Try it with a browser that does")}function k(){let t="";return t+='<p>The "location" permission is denied on your browser. Please allow the location before you can mark your attendance \t\t\t\tPlease follow the following steps to allow location permission.</p><br /> \t\t\t\t<ol>   \t\t\t\t<li>On your computer, open Chrome <img src="//storage.googleapis.com/support-kms-prod/Y57p9LEW3v1cnw4Svh3a53DOnyRPFkiDfTDc" width="18" height="18" alt="Chrome" data-mime-type="image/png">.</li>   \t\t\t\t<li>At the top right, click More <img src="//lh3.googleusercontent.com/E2q6Vj9j60Dw0Z6NZFEx5vSB9yoZJp7C8suuvQXVA_2weMCXstGD7JEvNrzX3wuQrPtL=w36-h36" width="18" height="18" alt="More" data-mime-type="image/png" data-alt-src="//lh3.googleusercontent.com/E2q6Vj9j60Dw0Z6NZFEx5vSB9yoZJp7C8suuvQXVA_2weMCXstGD7JEvNrzX3wuQrPtL"> <img src="//lh3.googleusercontent.com/3_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw=w36-h36" width="18" height="18" alt="and then" data-mime-type="image/png" data-alt-src="//lh3.googleusercontent.com/3_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw"> <strong>Settings</strong>.</li>   \t\t\t\t<li>Click <strong>Privacy and security</strong>&nbsp;<img src="//lh3.googleusercontent.com/3_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw=w36-h36" width="18" height="18" alt="and then" data-mime-type="image/png" data-alt-src="//lh3.googleusercontent.com/3_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw">&nbsp;<strong>Site Settings</strong>.</li>   \t\t\t\t<li data-outlined="false" class="">Click <strong>Location</strong>.</li>   \t\t\t\t<li>Choose the option you want as your default setting.</li> \t\t\t</ol>',t}function h(t){const e={hours:Math.floor(t/3600),minutes:Math.floor(t%3600/60),seconds:t%60};return e.hours=1===e.hours.toString().length?"0"+e.hours:e.hours,e.minutes=1===e.minutes.toString().length?"0"+e.minutes:e.minutes,e.seconds=1===e.seconds.toString().length?"0"+e.seconds:e.seconds,e}function b(t){const e={clocked_in:"Clocked In",clocked_out:"Clocked Out",break_started:"Started your break",break_ended:"Ended your break",clocked_in_confirm:"clock in",clocked_out_confirm:"clock out",break_started_confirm:"start your break",break_ended_confirm:"end your break"};return e[t]}function f(t){let e=!1;const o=w.breaks.length;for(let n=0;n<o;n++){const o=w.breaks[n];if(o.id==t){e=!0;break}}return e}let g,p,j,_,v,C=null,w={};$(document).on("click",".jsAttendanceBtn",function(o){o.preventDefault(),o.stopPropagation();const n=$(this).data("type");return _confirm("Do you want to "+b(n+"_confirm")+"?",function(){"clocked_in"===n&&w.job_sites.length?t():"break_started"===n&&w.allowed_breaks.length?e():m(n)})}),setInterval(function(){a(!0)},1e4),v=setInterval(i,1e3),a()});