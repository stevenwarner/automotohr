$((function(){let t,e,o,n,a=null,s={};function l(){let t="";return t+='<div class="container" id="jsJobSiteModalBody">',t+='\t<br /><div class="row">',t+='\t\t<div class="col-sm-12">',t+='\t\t\t<form id="jsJobSiteModalForm">',t+='\t\t\t\t<div class="form-group">',t+='\t\t\t\t\t<label class="tex-medium">',t+="\t\t\t\t\t\tPlease select a job site",t+='\t\t\t\t\t\t<strong class="text-danger"></strong>',t+="\t\t\t\t\t</label>",t+='\t\t\t\t\t<select class="form-control jsJobSiteModalSelect">',t+='\t\t\t\t\t\t<option value="0">Clock in without job site</option>',s.job_sites.map((function(e){t+='\t\t\t\t\t\t<option value="'+e.sid+'">'+e.site_name+"</option>"})),t+="\t\t\t\t\t</select>",t+="\t\t\t\t</div>",t+='\t\t\t\t<div class="form-group text-right">',t+='\t\t\t\t\t<button class="btn btn-success">',t+="\t\t\t\t\t\tClock In",t+="\t\t\t\t\t</button>",t+="\t\t\t\t</div>",t+="\t\t\t</form>",t+="\t\t</div>",t+="\t</div>",t+="</div>",t}function r(){let t="";return t+='<div class="container" id="jsBreaksModalBody">',t+='\t<br /><div class="row">',t+='\t\t<div class="col-sm-12">',t+='\t\t\t<form id="jsBreaksModelForm">',t+='\t\t\t\t<div class="form-group">',t+='\t\t\t\t\t<label class="tex-medium">',t+="\t\t\t\t\t\tPlease select a break",t+='\t\t\t\t\t\t<strong class="text-danger"></strong>',t+="\t\t\t\t\t</label>",t+='\t\t\t\t\t<select class="form-control jsBreaksModelSelect">',s.allowed_breaks.map((function(e){let o=e.duration+"m";e.start_time&&(o=e.start_time+" - "+e.end_time);let n=function(t){let e=!1;const o=s.breaks.length;for(let n=0;n<o;n++){if(s.breaks[n].id==t){e=!0;break}}return e}(e.id);t+="\t\t\t\t\t\t<option "+(n?"disabled":"")+' value="'+e.id+'">'+e.break+" ("+o+")</option>"})),t+="\t\t\t\t\t</select>",t+="\t\t\t\t</div>",t+='\t\t\t\t<div class="form-group text-right">',t+='\t\t\t\t\t<button class="btn btn-success">',t+="\t\t\t\t\t\tStart Break",t+="\t\t\t\t\t</button>",t+="\t\t\t\t</div>",t+="\t\t\t</form>",t+="\t\t</div>",t+="\t</div>",t+="</div>",t}function c(l){l||d(),$.ajax({url:baseUrl("v1/clock"),method:"GET"}).always((function(){a=null})).fail(handleErrorResponse).done((function(a){s=a,clearInterval(o),clearInterval(n),""===a.state||"clocked_out"==a.state?d():(t=a.clock_time,e=a.time,o=setInterval(u,1e3)),function(t){let e="";"clocked_in"===t||"break_ended"===t?(e+=k("break_start"),e+=k("clocked_out")):e+=k("break_started"===t?"break_end":"clocked_in");$(".jsAttendanceBTNs").html(e),$(".jsAttendanceClockHeaderBTNs").html(e)}(a.state),"clocked_out"==a.state&&function(t){const e=function(t){const e={hours:Math.floor(t/3600),minutes:Math.floor(t%3600/60),seconds:t%60};return e.hours=1===e.hours.toString().length?"0"+e.hours:e.hours,e.minutes=1===e.minutes.toString().length?"0"+e.minutes:e.minutes,e.seconds=1===e.seconds.toString().length?"0"+e.seconds:e.seconds,e}(t);$(".jsAttendanceClockHour").html(e.hours),$(".jsAttendanceClockMinute").html(e.minutes),$(".jsAttendanceClockSeconds").html(e.seconds),$(".jsAttendanceClockSeparator").html(":")}(a.time),n=setInterval(m,1e3)}))}function i(t,e,o,n){if(null!==a)return;const s=callButtonHook($(`.jsAttendanceBtn[data-type="${t}"]`),!0);a=$.ajax({url:baseUrl("v1/clock/mark"),method:"POST",data:JSON.stringify({type:t,latitude:e,longitude:o,job_site:n}),headers:{"content-type":"application/json"}}).always((function(){callButtonHook(s,!1),a=null})).fail(handleErrorResponse).done((function(){_success("You have successfully "+b(t)+"."),c()}))}function d(){t="",e="",clearInterval(o),$(".jsAttendanceClockHour").html("00"),$(".jsAttendanceClockMinute").html("00"),$(".jsAttendanceClockSeconds").html("00"),$(".jsAttendanceClockSeparator").html(":"),$(".jsAttendanceBTNs").html(""),$(".jsAttendanceClockHeaderBTNs").html("")}function u(){if(!t)return $(".jsAttendanceClockHour").html("00"),$(".jsAttendanceClockMinute").html("00"),$(".jsAttendanceClockSeconds").html("00"),void $(".jsAttendanceClockSeparator").html(":");const o=moment.utc(t).subtract(e,"seconds"),n=moment.utc().diff(o),a=moment(n).utc();$(".jsAttendanceClockHour").html(a.format("HH")),$(".jsAttendanceClockMinute").html(a.format("mm")),$(".jsAttendanceClockSeconds").html(a.format("ss")),$(".jsAttendanceClockSeparator").html(":")}function m(){let t=moment.tz(s.timezone),e=moment.tz(s.timerDateTime,s.timezone);const o=t.diff(s.timerDateTime);e.add(o,"milliseconds"),$(".jsAttendanceCurrentClockDateTime").text(e.format("MMM D YYYY, ddd HH:mm:ss")),$(".jsAttendanceLoader").hide()}function k(t){let e="";return"clocked_in"===t?(e+='<button class="btn btn-orange jsAttendanceBtn" data-type="clocked_in">',e+='\t<i class="fa fa-play-circle csF16" aria-hidden="true"></i>',e+="\t&nbsp;Clock in",e+="</button>"):"clocked_out"===t?(e+='&nbsp;<button class="btn btn-red jsAttendanceBtn" data-type="clocked_out">',e+='\t<i class="fa fa-stop-circle csF16" aria-hidden="true"></i>',e+="\t&nbsp;Clock out",e+="</button>"):"break_start"===t?(e+='&nbsp;<button class="btn btn-black jsAttendanceBtn" data-type="break_started">',e+='\t<i class="fa fa-pause-circle csF16" aria-hidden="true"></i>',e+="\t&nbsp;Break start",e+="</button>"):"break_end"===t&&(e+='&nbsp;<button class="btn btn-yellow jsAttendanceBtn" data-type="break_ended">',e+='\t<i class="fa fa-stop csF16" aria-hidden="true"></i>',e+="\t&nbsp;Break end & clock in",e+="</button>"),e}function h(t,e=null){if(navigator.geolocation){navigator.geolocation.getCurrentPosition((function(o){i(t,o.coords.latitude,o.coords.longitude,e)}),(function(){return alertify.alert("Location permission denied!",function(){let t="";return t+='<p>The "location" permission is denied on your browser. Please allow the location before you can mark your attendance \t\t\t\tPlease follow the following steps to allow location permission.</p><br /> \t\t\t\t<ol>   \t\t\t\t<li>On your computer, open Chrome <img src="//storage.googleapis.com/support-kms-prod/Y57p9LEW3v1cnw4Svh3a53DOnyRPFkiDfTDc" width="18" height="18" alt="Chrome" data-mime-type="image/png">.</li>   \t\t\t\t<li>At the top right, click More <img src="//lh3.googleusercontent.com/E2q6Vj9j60Dw0Z6NZFEx5vSB9yoZJp7C8suuvQXVA_2weMCXstGD7JEvNrzX3wuQrPtL=w36-h36" width="18" height="18" alt="More" data-mime-type="image/png" data-alt-src="//lh3.googleusercontent.com/E2q6Vj9j60Dw0Z6NZFEx5vSB9yoZJp7C8suuvQXVA_2weMCXstGD7JEvNrzX3wuQrPtL"> <img src="//lh3.googleusercontent.com/3_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw=w36-h36" width="18" height="18" alt="and then" data-mime-type="image/png" data-alt-src="//lh3.googleusercontent.com/3_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw"> <strong>Settings</strong>.</li>   \t\t\t\t<li>Click <strong>Privacy and security</strong>&nbsp;<img src="//lh3.googleusercontent.com/3_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw=w36-h36" width="18" height="18" alt="and then" data-mime-type="image/png" data-alt-src="//lh3.googleusercontent.com/3_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw">&nbsp;<strong>Site Settings</strong>.</li>   \t\t\t\t<li data-outlined="false" class="">Click <strong>Location</strong>.</li>   \t\t\t\t<li>Choose the option you want as your default setting.</li> \t\t\t</ol>',t}())}))}else i(t,0,0)}function b(t){return{clocked_in:"Clocked In",clocked_out:"Clocked Out",break_started:"Started your break",break_ended:"Ended your break",clocked_in_confirm:"clock in",clocked_out_confirm:"clock out",break_started_confirm:"start your break",break_ended_confirm:"end your break"}[t]}$(document).on("click",".jsAttendanceBtn",(function(t){t.preventDefault(),t.stopPropagation();const e=$(this).data("type");return _confirm("Do you want to "+b(e+"_confirm")+"?",(function(){"clocked_in"===e&&s.job_sites.length?Modal({Id:"jsJobSiteModal",Title:"Select a job site.",Loader:"jsJobSiteModalLoader",Body:l()},(function(){ml(!1,"jsJobSiteModalLoader"),$("#jsJobSiteModalBody").submit((function(t){t.preventDefault(),h("clocked_in",$(".jsJobSiteModalSelect option:selected").val()),$("#jsJobSiteModal").find(".jsModalCancel").click()}))})):"break_started"===e&&s.allowed_breaks.length?Modal({Id:"jsBreaksModal",Title:"Select a break.",Loader:"jsBreaksModalLoader",Body:r()},(function(){ml(!1,"jsBreaksModalLoader"),$("#jsBreaksModalBody").submit((function(t){t.preventDefault();const e=$(".jsBreaksModelSelect option:selected").val();if(s.allowed_breaks&&s.allowed_breaks.length==s.breaks)return _error("You have already taken allowed breaks.");let o=s.allowed_breaks.filter((function(t){return t.id==e}));return o[0].start_time&&moment()<moment(o[0].start_time,"hh:mm a")?_error('You can not start break before "'+o[0].start_time+'".'):o[0].end_time&&moment()>moment(o[0].end_time,"hh:mm a")?_error('You can not start break after "'+o[0].end_time+'".'):(h("break_started",e),void $("#jsBreaksModal").find(".jsModalCancel").click())}))})):h(e)}))})),setInterval((function(){c(!0)}),1e4),n=setInterval(m,1e3),c()}));