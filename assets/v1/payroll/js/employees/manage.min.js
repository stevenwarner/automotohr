$(function(){function e(e){_ml(!0,"pageLoader"),$.ajax({url:baseUrl("payrolls/flow/employee/"+e+"/finish_onboard"),method:"POST",data:{}}).success(function(e){if(e.view)return Modal({Id:"jsSummaryModel",Loader:"jsSummaryModelLoader",Body:'<div id="jsSummaryModelBody">'+e.view+"</div>",Title:"Summary"},function(){_ml(!1,"jsSummaryModelLoader")});alertify.alert("Success!",e.msg,function(){window.location.reload()})}).fail(handleErrorResponse).always(function(){_ml(!1,"pageLoader")})}function t(e){_ml(!0,"pageLoader"),$.ajax({url:baseUrl("payrolls/flow/employee/"+e+"/delete"),method:"DELETE"}).success(function(e){_success(e.msg,function(){window.location.reload()})}).fail(handleErrorResponse).always(function(){_ml(!1,"pageLoader")})}function o(){_ml(!0,`${p}Loader`),$.ajax({url:baseUrl("forms/w4/employee/"+d+"/assign"),method:"POST",data:{}}).success(function(e){!1!==e.Status?alertify.alert("Success!",e.message,function(){s("documents")}):alertify.alert("Error!",e.message,CB)}).fail(handleErrorResponse).always(function(){_ml(!1,`${p}Loader`)})}function l(){_ml(!0,`${p}Loader`),$.ajax({url:baseUrl("forms/w4/employee/"+d+"/revoke"),method:"DELETE",data:{}}).success(function(e){!1!==e.Status?alertify.alert("Success!",e.message,function(){s("documents")}):alertify.alert("Error!",e.message,CB)}).fail(handleErrorResponse).always(function(){_ml(!1,`${p}Loader`)})}function a(e,t){_ml(!0,`${p}Loader`);let o={action:"assign_document"};o.documentType=e,o.companySid=companyId,o.companyName=window.company.Name,o.sid=t,o.userSid=d,o.userType="employee",$.post(baseUrl("hr_documents_management/handler"),o,e=>{_ml(!1,`${p}Loader`),!1!==e.Status?alertify.alert("SUCCESS!",e.Response,function(){s("documents")}):alertify.alert("WARNING!",e.Response,CB)})}function n(e,t){_ml(!0,`${p}Loader`);let o={action:"revoke_document"};o.documentType=e,o.companySid=companyId,o.companyName=window.company.Name,o.sid=t,o.userSid=d,o.userType="employee",$.post(baseUrl("hr_documents_management/handler"),o,e=>{_ml(!1,`${p}Loader`),!1!==e.Status?alertify.alert("SUCCESS!",e.Response,function(){s("documents")}):alertify.alert("WARNING!",e.Response,CB)})}function r(){if(0===d)return alertify.alert("Error!","Please select an employee.");Modal({Title:"Employee Onboard Flow",Id:p,Loader:`${p}Loader`,Body:`<div id="${p}Body"></div>`},function(){s("summary")})}function s(e){_ml(!0,`${p}Loader`),u=$.ajax({url:baseUrl("payrolls/flow/employee/"+d+"/"+e),method:"GET",caches:!1}).success(function(t){$(`#${p}Body`).html(t.view),m(e)}).fail(handleErrorResponse).always(function(){u=null,_ml(!1,`${p}Loader`)})}function i(e){_ml(!0,`${p}Loader`),u=$.ajax({url:baseUrl("payrolls/flow/employee/"+d+"/bank_account/"+e),method:"DELETE",caches:!1}).success(function(){s("payment_method")}).fail(handleErrorResponse).always(function(){u=null,_ml(!1,`${p}Loader`)})}function c(e){_ml(!0,`${p}Loader`),u=$.ajax({url:baseUrl("payrolls/flow/employee/"+d+"/bank_account/"+e),method:"PUT",caches:!1}).success(function(){s("payment_method")}).fail(handleErrorResponse).always(function(){u=null,_ml(!1,`${p}Loader`)})}function m(e){"personal_details"===e&&($(".jsEmployeeFlowDateOfBirth").datepicker({format:"mm/dd/yyyy",changeYear:!0,changeMonth:!0,yearRange:"-100:+0"}),$(".jsEmployeeFlowStartDate").datepicker({format:"mm/dd/yyyy",changeYear:!0,changeMonth:!0,yearRange:"-100:+10"}))}let u=null,d=0,p="jsEmployeeFlowModal";$(".jsPayrollEmployeeEdit").click(function(e){e.preventDefault(),d=$(this).closest("tr").data("id"),r()}),$(document).on("click",".jsMenuTrigger",function(e){e.preventDefault(),s($(this).data("step"))}),$(document).on("click",".jsEmployeeFlowSavePersonalDetailsBtn",function(e){if(e.preventDefault(),null!==u)return!1;let t={first_name:$(".jsEmployeeFlowFirstName").val().trim(),middle_initial:$(".jsEmployeeFlowMiddleInitial").val().trim(),last_name:$(".jsEmployeeFlowLastName").val().trim(),location_uuid:$(".jsEmployeeFlowWorkAddress option:selected").val(),start_date:$(".jsEmployeeFlowStartDate").val().trim(),email:$(".jsEmployeeFlowEmail").val().trim(),ssn:$(".jsEmployeeFlowSSN").val().trim(),date_of_birth:$(".jsEmployeeFlowDateOfBirth").val().trim()},o=[];if(t.first_name||o.push('"First name" is missing.'),t.last_name||o.push('"Last name" is missing.'),t.location_uuid||o.push('"Work address" is missing.'),t.start_date||o.push('"Start date" is missing.'),t.email||o.push('"Email" is missing.'),t.email.verifyEmail()||o.push('"Email" is invalid.'),t.ssn||o.push('"Social Security number (SSN)" is missing.'),9===t.ssn.replace(/-/g,"").length&&null===t.ssn.match(/([^0-9#-])/gi)||o.push('"Social Security number (SSN)" must be 9 digits long.'),t.date_of_birth||o.push('"Date of birth" is missing.'),o.length)return alertify.alert("Error!",getErrorsStringFromArray(o),CB);ml(!0,`${p}Loader`,"Please wait, while we are processing your request."),u=$.ajax({url:baseUrl("payrolls/flow/employee/"+d+"/personal_details"),method:"POST",data:t}).success(function(e){return alertify.alert("Success!",e.msg,CB)}).fail(handleErrorResponse).always(function(){u=null,ml(!1,`${p}Loader`)})}),$(document).on("click",".package-info-box",function(e){$(".select-package:not(:checked)").parent().removeClass("selected-package"),$(".select-package:checked").parent().addClass("selected-package")}),$(document).on("click",".jsEmployeeFlowSaveCompensationBtn",function(e){if(e.preventDefault(),null!==u)return!1;var t=$(".select-package:checkbox:checked").map(function(){return this.value}).get();let o={title:$(".jsEmployeeFlowJobTitle").val().trim(),amount:$(".jsEmployeeFlowAmount").val().trim(),classification:$(".jsEmployeeFlowEmployeeClassification option:selected").val(),per:$(".jsEmployeeFlowPer option:selected").val(),minimumWage:$(".jsEmployeeFlowMinimumWage option:selected").val(),wagesId:t},l=[];if(o.title||l.push('"Job title" is missing.'),(!o.amount||o.amount<0)&&l.push('"Amount" is missing.'),l.length)return alertify.alert("Error!",getErrorsStringFromArray(l),CB);ml(!0,`${p}Loader`,"Please wait, while we are processing your request."),u=$.ajax({url:baseUrl("payrolls/flow/employee/"+d+"/compensation"),method:"POST",data:o}).success(function(e){return alertify.alert("Success!",e.msg,CB)}).fail(handleErrorResponse).always(function(){u=null,ml(!1,`${p}Loader`)})}),$(document).on("click",".jsEmployeeFlowSaveHomeAddressBtn",function(e){if(e.preventDefault(),null!==u)return!1;let t={street_1:$(".jsEmployeeFlowStreet1").val().trim(),street_2:$(".jsEmployeeFlowStreet2").val().trim(),city:$(".jsEmployeeFlowCity").val().trim(),state:$(".jsEmployeeFlowState").val().trim(),zip:$(".jsEmployeeFlowZip").val().trim()},o=[];if(t.street_1||o.push('"street 1" is missing.'),t.city||o.push('"City" is missing.'),t.state||o.push('"State" is missing.'),t.zip||o.push('"Zip" is missing.'),o.length)return alertify.alert("Error!",getErrorsStringFromArray(o),CB);ml(!0,`${p}Loader`,"Please wait, while we are processing your request."),u=$.ajax({url:baseUrl("payrolls/flow/employee/"+d+"/home_address"),method:"POST",data:t}).success(function(e){return alertify.alert("Success!",e.msg,CB)}).fail(handleErrorResponse).always(function(){u=null,ml(!1,`${p}Loader`)})}),$(document).on("click",".jsEmployeeFlowSaveFederalTaxBtn",function(e){if(e.preventDefault(),null!==u)return!1;let t={filing_status:$(".jsEmployeeFlowFilingStatus option:selected").val(),two_jobs:$(".jsEmployeeFlowMultipleJobs:checked").val(),dependents_amount:$(".jsEmployeeFlowDependents").val().trim(),extra_withholding:$(".jsEmployeeFlowExtraWithholding").val().trim(),other_income:$(".jsEmployeeFlowOtherIncome").val().trim(),deductions:$(".jsEmployeeFlowDeductions").val().trim(),w4_data_type:"rev_2020_w4"},o=[];if(t.filing_status||o.push('"Filing status" is missing.'),o.length)return alertify.alert("Error!",getErrorsStringFromArray(o),CB);ml(!0,`${p}Loader`,"Please wait, while we are processing your request."),u=$.ajax({url:baseUrl("payrolls/flow/employee/"+d+"/federal_tax"),method:"POST",data:t}).success(function(e){return alertify.alert("Success!",e.msg,CB)}).fail(handleErrorResponse).always(function(){u=null,ml(!1,`${p}Loader`)})}),$(document).on("click",".jsEmployeeFlowSaveStateTaxBtn",function(e){if(e.preventDefault(),null!==u)return!1;let t={},o=[];if($(".jsEmployeeFlowStateTax").map(function(){"INPUT"===$(this).prop("tagName")&&"number"===$(this).prop("type")?(t[$(this).prop("name")]=$(this).val().trim(),$(this).val().trim()<0&&o.push('"'+$(this).prop("name").replace(/_/gi," ")+'" can not be less than 0.')):"SELECT"===$(this).prop("tagName")&&(t[$(this).prop("name")]=$('select[name="'+$(this).prop("name")+'"] option:selected').val(),$(this).val()||o.push('"'+$(this).prop("name").replace(/_/gi," ")+'" is missing.'))}),o.length)return alertify.alert("Error!",getErrorsStringFromArray(o),CB);ml(!0,`${p}Loader`,"Please wait, while we are processing your request."),u=$.ajax({url:baseUrl("payrolls/flow/employee/"+d+"/state_tax"),method:"POST",data:t}).success(function(e){return alertify.alert("Success!",e.msg,CB)}).fail(handleErrorResponse).always(function(){u=null,ml(!1,`${p}Loader`)})}),$(document).on("click",".jsEmployeeFlowSaveBankAccountBtn",function(e){if(e.preventDefault(),null!==u)return!1;let t={accountTitle:$(".jsEmployeeFlowBankAccountTitle").val().trim(),routingNumber:$(".jsEmployeeFlowBankAccountRoutingNumber").val().replace(/[^0-9]/gi,""),accountNumber:$(".jsEmployeeFlowBankAccountAccountNumber").val(),accountType:$(".jsEmployeeFlowBankAccountType option:selected").val()},o=[];if(t.accountTitle||o.push('"Account title" is missing.'),t.routingNumber||o.push('"Routing number" is missing.'),9!=t.routingNumber.length&&o.push('"Routing number" must be 9 digits long.'),t.accountNumber||o.push('"Routing number" is missing.'),t.accountType||o.push('"Account type" is missing.'),o.length)return alertify.alert("Error!",getErrorsStringFromArray(o),CB);ml(!0,`${p}Loader`,"Please wait, while we are processing your request."),u=$.ajax({url:baseUrl("payrolls/flow/employee/"+d+"/bank_account"),method:"POST",data:t}).success(function(e){return alertify.alert("Success!",e.msg,function(){s("payment_method")})}).fail(handleErrorResponse).always(function(){u=null,ml(!1,`${p}Loader`)})}),$(document).on("click",".jsEmployeeFlowPaymentMethodSaveBtn",function(e){if(e.preventDefault(),null!==u)return!1;let t={paymentType:$(".jsEmployeeFlowPaymentMethodType:checked").val()},o=[];if(t.paymentType||o.push('"Payment type" is missing.'),o.length)return alertify.alert("Error!",getErrorsStringFromArray(o),CB);ml(!0,`${p}Loader`,"Please wait, while we are processing your request."),u=$.ajax({url:baseUrl("payrolls/flow/employee/"+d+"/payment_method"),method:"POST",data:t}).success(function(e){return alertify.alert("Success!",e.msg,function(){s("payment_method")})}).fail(handleErrorResponse).always(function(){u=null,ml(!1,`${p}Loader`)})}),$(document).on("click",".jsEmployeeFlowPaymentMethodAddBankAccountBtn",function(e){e.preventDefault(),s("bank_account_add")}),$(document).on("click",".jsEmployeeFlowPaymentMethodToBtn",function(e){e.preventDefault(),s("payment_method")}),$(document).on("click",".jsEmployeeFlowDeleteBankAccount",function(e){e.preventDefault();const t=$(this).closest(".jsEmployeeFlowDeleteBankAccountRow").data("id");return alertify.confirm("Do you really want to delete the bank account?",function(){i(t)})}),$(document).on("click",".jsEmployeeFlowUseBankAccount",function(e){e.preventDefault();const t=$(this).closest(".jsEmployeeFlowDeleteBankAccountRow").data("id");c(t)}),$(document).on("click",".jsEmployeeFlowPaymentMethodType",function(){"Check"===$(this).val()?$(".jsEmployeeFlowPaymentMethodAccountBox").addClass("hidden"):$(".jsEmployeeFlowPaymentMethodAccountBox").removeClass("hidden")}),$(document).on("click",".jsAssignDocument",function(e){e.preventDefault();const t=$(this).closest("tr").data();return alertify.confirm("Do you really want to assign this document?",function(){"direct_deposit"===t.type?a(t.type,t.did):"w4"===t.type&&o()}).set("labels",{ok:"YES",cancel:"No"}).set("title","CONFIRM!")}),$(document).on("click",".jsRevokeDocument",function(e){e.preventDefault();const t=$(this).closest("tr").data();return alertify.confirm("Do you really want to revoke this document?",function(){"direct_deposit"===t.type?n(t.type,t.did):"w4"===t.type&&l()}).set("labels",{ok:"YES",cancel:"No"}).set("title","CONFIRM!")}),$(document).on("click",".jsPayrollEmployeeFinishOnboard",function(t){t.preventDefault();const o=$(this).closest("tr").data("id");return alertify.confirm("Are you certain about proceeding with the completion of the selected employee's payroll onboarding? <br />Once an employee is onboarded, you will be unable to delete them, but you will still have the option to modify their details.",function(){e(o)}).setHeader("Confirm")}),$(document).on("click",".jsPayrollEmployeeDelete",function(e){e.preventDefault();const o=$(this).closest("tr").data("id");return _confirm("Do you really want to remove the selected employee from Payroll?<br /> This action is not-revertible. However, you can re-add the selected employee for payroll.",function(){t(o)})}),$.ajaxSetup({cache:!1}),_ml(!1,"pageLoader")});