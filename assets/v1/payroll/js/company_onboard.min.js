$(function(){function e(){null!==p&&p.abort(),p=$.ajax({url:window.location.origin+"/payroll/company/"+d+"/requirements",method:"GET"}).success(function(){p=null,y.welcomeStep()}).fail(u)}function n(){if(null!==p)return!1;p=$.ajax({url:window.location.origin+"/payroll/cpc/1/"+d,method:"GET"}).success(function(e){if(p=null,$(`#${f}Body`).html(e.view),void 0!==e.onboard){if("terms"===e.onboard)return y.gustoTerms();window.location.reload()}_ml(!1,f+"Loader"),$(".jsPayrollLoadSelectEmployees").click(function(e){e.preventDefault(),_ml(!0,f+"Loader"),y.employeeListingStep()})}).fail(u)}function l(){if(null!==p)return!1;p=$.ajax({url:window.location.origin+"/payroll/cpc/2/"+d,method:"GET"}).success(function(e){p=null,$(`#${f}Body`).html(e.view),_ml(!1,f+"Loader"),$(".jsPayrollLoadOnboard").click(function(e){e.preventDefault(),i()}),$(".jsBackToStep1").click(function(e){e.preventDefault(),_ml(!0,f+"Loader"),y.welcomeStep()})}).fail(u)}function o(){if(null!==p)return!1;p=$.ajax({url:window.location.origin+"/payroll/cpc/3/"+d,method:"GET"}).success(function(e){p=null,$(`#${f}Body`).html(e.view),_ml(!1,f+"Loader"),$(".jsPayrollSetAdmin").click(function(e){e.preventDefault(),t()}),$(".jsBackToStep2").click(function(e){e.preventDefault(),_ml(!0,f+"Loader"),y.employeeListingStep()})}).fail(u)}function t(){if(null!==p)return!1;p=$.ajax({url:window.location.origin+"/payroll/cpc/4/"+d,method:"GET"}).success(function(e){p=null,$(`#${f}Body`).html(e.view),_ml(!1,f+"Loader")}).fail(u)}function i(){if(h=[],$(".jsEmployeesList:checked").map(function(){h.push($(this).val())}),!h.length)return alertify.alert("ERROR","Please select at least one employee.",CB);_ml(!0,f+"Loader"),y.adminStep()}function a(){let e={firstName:$(".jsAdminFirstName").val().trim(),lastName:$(".jsAdminLastName").val().trim(),email:$(".jsAdminEmailAddress").val().trim(),id:$(".jsAdminUserId").val().trim()},n=[];if(e.firstName||n.push('"First name" is missing.'),e.lastName||n.push('"Last name" is missing.'),e.email||n.push('"Email" is missing.'),e.email.verifyEmail()||n.push('"Email" is invalid.'),n.length)return alertify.alert("ERROR",getErrorsStringFromArray(n),CB);_ml(!0,f+"Loader"),p=$.ajax({url:window.location.origin+"/payroll/cpc/5/"+d,method:"POST",data:e}).success(function(){return p=null,_ml(!1,f+"Loader"),alertify.alert("SUCCESS","Congratulations! You have successfully added a payroll admin for the company.",function(){y.adminStep()})}).fail(s)}function r(){_ml(!0,f+"Loader"),p=$.ajax({url:window.location.origin+"/payroll/cpc/6/"+d,method:"GET"}).success(function(e){p=null,$(`#${f}Body`).html(e.view),_ml(!1,f+"Loader")}).fail(u)}function c(){p=$.ajax({url:window.location.origin+"/payroll/company/7/"+d,method:"POST",data:{employees:h}}).success(function(){if(p=null,"undefined"==typeof gustoServiceAgreement)return window.location.reload();gustoServiceAgreement(d)}).fail(s)}function s(e){return _ml(!1,f+"Loader"),p=null,handleErrorResponse(e)}function u(e){return $(`#${f} .jsModalCancel`).trigger("click"),handleErrorResponse(e)}function m(e){ml(!0,"jsCreateLoader","Please wait, while we are generating view."),$.ajax({url:baseUrl("/payrolls/employees/"+e+"/get"),method:"GET"}).success(function(e){$(".jsAdminFirstName").val(e.first_name||""),$(".jsAdminLastName").val(e.last_name||""),$(".jsAdminEmailAddress").val(e.email||""),$(".jsAdminUserId").val(e.id||0)}).fail(function(e){return window.scrollTo(0,0),$(".jsErrorDiv").html(getErrorsStringFromArray((e.responseJSON||JSON.parse(e.responseText)).errors)).removeClass("hidden")}).always(function(){ml(!1,"jsCreateLoader")})}let d=0,f="jsCreatePartnerCompanyModal",p=null,y={checkRequirements:e,welcomeStep:n,employeeListingStep:l,adminStep:o,createPartnerCompany:c},h=[];$(document).on("click",".jsModalCancel",function(){p=null}),$(document).on("click",".jsSelectAll",function(){$(".jsSingleEmployee").prop("checked",!0)}),$(document).on("click",".jsUnSelectAll",function(){$(".jsSingleEmployee").prop("checked",!1)}),$(".jsCreatePartnerCompanyBtn").click(function(e){if(e.preventDefault(),d=parseInt($(this).data("cid")),0===d)return alertify.alert("ERROR","Company code is missing.",CB);Modal({Id:f,Title:"",Loader:f+"Loader",Body:`<div id="${f}Body"></div>`},y.checkRequirements)}),$(document).on("click",".jsPayrollViewAdminDetails",function(e){e.preventDefault(),r()}),$(document).on("click",".jsPayrollSaveAdmin",function(e){e.preventDefault(),a()}),$(document).on("click",".jsBackToStep3",function(e){e.preventDefault(),_ml(!0,f+"Loader"),y.adminStep()}),$(document).on("click",".jsCreatePartnerCompanyProcessBtn",function(e){e.preventDefault(),_ml(!0,f+"Loader","Please wait patiently while we set up the payroll system. This procedure may take a few minutes."),y.createPartnerCompany()}),$(document).on("change","#jsEmployeeChoose",function(){const e=$(this).val();0!=e&&(ml(!0,"jsCreateLoader"),m(e))})});