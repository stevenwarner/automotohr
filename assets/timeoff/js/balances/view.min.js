$((function(){let callOBJ={Balances:{Main:{action:"get_balances",companyId:companyId,employerId:employerId,employeeId:employeeId,level:level,filter:{employees:"all",policies:"all",type:$(".jsEditResetCheckbox:checked").val()},public:0,inset:0,offset:10}}},xhr=null,balancePolicyOBJ={};function resetFilter(e){e.preventDefault(),$("#js-filter-employee").select2("val","all"),$("#js-filter-policies").select2("val","all"),callOBJ.Balances.Main.inset=0,callOBJ.Balances.Main.offset=10,callOBJ.Balances.Main.filter.employees="all",callOBJ.Balances.Main.filter.policies="all",callOBJ.Balances.Main.filter.type=$(".jsEditResetCheckbox:checked").val(),fetchBalances()}function applyFilter(e){e.preventDefault(),callOBJ.Balances.Main.inset=0,callOBJ.Balances.Main.offset=10,callOBJ.Balances.Main.filter.employees=$("#js-filter-employee").val(),callOBJ.Balances.Main.filter.policies=null==$("#js-filter-policies").val()?"all":$("#js-filter-policies").val(),callOBJ.Balances.Main.filter.type=$(".jsEditResetCheckbox:checked").val(),fetchBalances()}function fetchBalances(){void 0!==window.timeoff.employees?null==xhr&&(ml(!0,"balance"),$(".js-error-row").remove(),xhr=$.post(handlerURL,callOBJ.Balances.Main,(function(resp){if(xhr=null,!0!==resp.Redirect)if(0!=resp.Data.Balances.length){if(!1===resp.Status&&1==callOBJ.Balances.Main.page)return $(".js-ip-pagination").html(""),$("#js-data-area").html(`<tr class="js-error-row"><td colspan="${$(".js-table-head").find("th").length}"><p class="alert alert-info text-center">${resp.Response}</p></td></tr>`),void ml(!1,"balance");if(!1===resp.Status)return $(".js-ip-pagination").html(""),void ml(!1,"balance");0==callOBJ.Balances.Main.inset&&loadMoreBalance(),setTable(resp)}else ml(!1,"balance");else alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()})}))):setTimeout(()=>{fetchBalances()},1e3)}function setTable(resp,typo){let rows="";0!=resp.Data.Balances.length&&($.each(resp.Data.Balances,(function(i,v){let userRow=getUserById(v.total.UserId,resp.Data.Employees,"userId");0!=Object.keys(userRow).length&&(rows+=getBalanceBox(v,userRow),balancePolicyOBJ[v.total.UserId]={allowed:[],pending:[]},$.each(v,(index,poli)=>{if("total"==index)return"";balancePolicyOBJ[v.total.UserId].allowed.push({policy:index,time:poli.AllowedTime.text}),balancePolicyOBJ[v.total.UserId].pending.push({policy:index,time:poli.RemainingTime.text})}))})),void 0===typo?$(".csBalanceBoxInner").html(rows):$(".csBalanceBoxInner").append(rows),$(".jsCustomPopover").popover({html:!0,trigger:"hover",placement:"auto right",template:'<div class="popover"><div class="arrow"></div><div class="popover-content"></div></div>'}).on("inserted.bs.popover",(function(e){let rows="<ul>";balancePolicyOBJ[$(this).closest(".jsBox").data("id")][$(this).data("type")].map((function(li){rows+=`<li>${li.time} <br /> <strong>${li.policy}</strong></li>`})),rows+="</ul>",$(this).next(".popover").find(".popover-content").html(rows)})),$(".jsTooltip").tooltip(),ml(!1,"balance"))}function fetchEmployeeApprovers(employeeId){return new Promise(res=>{$.post(handlerURL,{action:"get_employee_approvers",companyId:companyId,employerId:employerId,employeeId:employeeId,public:0},resp=>{res(resp)})})}function loadMoreBalance(){callOBJ.Balances.Main.inset+=10,$.post(handlerURL,callOBJ.Balances.Main,(function(resp){0!=resp.Data.Balances.length&&loadMoreBalance(),setTable(resp,"append")}))}function getBalanceBox(v,userRow,popo){return`\n        \x3c!--  --\x3e\n        <div class="col-sm-3">\n            <div class="csBox jsBox csShadow csRadius5"  data-id="${v.total.UserId}" data-name="${userRow.first_name} ${userRow.last_name}">\n                \x3c!-- Box Header --\x3e\n                <div class="csBoxHeader csRadius5 csRadiusBL0 csRadiusBR0">\n                    <span class="pull-right">\n                        <span target="_blank" class="csCircleBtn csRadius50 jsViewPolicies jsTooltip" title="View Policies" placement="top"><i class="fa fa-eye"></i></span>\n                        <span target="_blank" class="csCircleBtn csRadius50 jsViewBalance jsTooltip" title="Manage Balance" placement="top"><i class="fa fa-balance-scale"></i></span>\n                        <span target="_blank" class="csCircleBtn csRadius50 jsViewApprovers jsTooltip" title="View Approvers" placement="top"><i class="fa fa-users"></i></span>\n                    </span>\n                    <div class="clearfix"></div>\n                </div>\n                \x3c!-- Box Content --\x3e\n                <div class="csBoxContent">\n                    \x3c!-- Section 1 --\x3e\n                    <div class="csBoxContentEmpployeeSection">\n                        <a href="${baseURL}employee_profile/${userRow.userId}" target="_blank">\n                        <div class="col-sm-2">\n                            <img src="${getImageURL(userRow.image)}" class="csRoundImg" />\n                        </div>\n                        <div class="col-sm-10 pr0">\n                            <p><strong>${userRow.first_name} ${userRow.last_name}</strong> <br /> ${remakeEmployeeName(userRow,!1)}</p>\n                        </div>\n                        </a>\n                        <div class="clearfix"></div>\n                    </div>\n                    \x3c!-- Section 2 --\x3e\n                    <div class="csBoxBalanceSection">\n                        <div class="col-sm-12">\n                            <p><strong>${""==v.total.AllowedTime.text?"0 hours":v.total.AllowedTime.text}</strong></p>\n                            <p>Allowed Time</p>\n                            \x3c!--  --\x3e\n                            <div class="csFixedToRight jsCustomPopover" data-type="allowed" title="p" placement="right">\n                                <i class="fa fa-plus-circle"></i>\n                            </div>\n                        </div>\n                        <div class="clearfix"></div>\n                    </div>\n                    \x3c!-- Section 3 --\x3e\n                    <div class="csBoxBalanceSection">\n                        <div class="col-sm-12">\n                            <p><strong>${""==v.total.ConsumedTime.text?"0 hours":v.total.ConsumedTime.text}</strong></p>\n                            <p>Consumed Paid Time</p>\n                        </div>\n                        <div class="clearfix"></div>\n                    </div>\n                    \x3c!-- Section 4 --\x3e\n                    <div class="csBoxBalanceSection">\n                        <div class="col-sm-12">\n                            <p><strong>${""==v.total.UnpaidConsumedTime.text?"0 hours":v.total.UnpaidConsumedTime.text}</strong></p>\n                            <p>Consume Unpaid Time</p>\n                        </div>\n                        <div class="clearfix"></div>\n                    </div>\n                    \x3c!-- Section 5 --\x3e\n                    <div class="csBoxBalanceSection">\n                        <div class="col-sm-12">\n                            <p><strong>${""==v.total.RemainingTime.text?"0 hours":v.total.RemainingTime.text}</strong></p>\n                            <p>Pending Time</p>\n                            \x3c!--  --\x3e\n                            <div class="csFixedToRight jsCustomPopover" data-type="pending" title="p">\n                                <i class="fa fa-plus-circle"></i>\n                            </div>\n                        </div>\n                        <div class="clearfix"></div>\n                    </div>\n                </div>\n                \x3c!-- Box Footer --\x3e\n                <div class="csBoxFooter">\n                    <div class="col-sm-12 pl0 pr0">\n                        <button class="btn btn-orange form-control jsCreateRequest"><i class="fa fa-plus-circle"></i> Create time-off</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n        `}window.timeoff.fetchBalances=fetchBalances,fetchBalances(),$("#js-filter-from-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0,onSelect:function(v){$("#js-filter-to-date").datepicker("option","minDate",v)}}),$("#js-filter-to-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0}).datepicker("option","minDate",$("#js-filter-from-date").val()),$(document).on("click",".js-apply-filter-btn",applyFilter),$(document).on("click",".js-reset-filter-btn",resetFilter),$(document).on("change",".jsEditResetCheckbox",applyFilter),$(document).on("click",".jsViewPolicies",(function(e){e.preventDefault(),startPolicyProcess($(this).closest(".jsBox").data("id"),$(this).closest(".jsBox").data("name"))})),$(document).on("click",".jsViewBalance",(function(e){e.preventDefault(),startBalanceProcess($(this).closest(".jsBox").data("id"),$(this).closest(".jsBox").data("name"))})),$(document).on("click",".jsViewApprovers",(function(e){e.preventDefault(),Modal({Id:"employeeApproverModal",Title:`Approvers for ${$(this).closest(".jsBox").data("name")}`,Body:"",Loader:"employeeApproverModalLoader"},async()=>{const approvers=await fetchEmployeeApprovers($(this).closest(".jsBox").data("id"));if(!0===approvers.Redirect)return void alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()});if(!1===approvers.Status||0==approvers.Data.length)return $("#employeeApproverModal .csModalBody").html('<p class="alert alert-success text-center">No approvers are assigned to this employee.</p>'),void ml(!1,"employeeApproverModalLoader");let rows='\n            <div class="tabel-responsive">\n                <table class="table table-striped csCustomTableHeader">\n                    <thead>\n                        <tr>\n                            <th>Employee</th>\n                            <th>Can Approve</th>\n                        </tr>\n                    </thead>\n                    <tbody id="employeeApproverModalTable"></tbody>\n                </table>\n            </div>';$("#employeeApproverModal .csModalBody").html(rows),rows="",approvers.Data.map(approver=>{rows+="<tr>",rows+=`   <td>${remakeEmployeeName(approver)}</td>`,rows+=`   <td style="font-weight: 900"; class="${1==approver.approver_percentage?"text-success":"text-danger"}">${1==approver.approver_percentage?"Yes":"No"}</td>`,rows+="</tr>"}),$("#employeeApproverModalTable").html(rows),ml(!1,"employeeApproverModalLoader")})}))}));