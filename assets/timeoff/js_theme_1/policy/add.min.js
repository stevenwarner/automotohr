$((function(){let policyOBJ={type:0,title:0,order:1,policyCategory:1,entitledEmployees:[],isEntitledEmployees:0,approver:0,deactivate:0,include:1,employeeTypes:[],offDays:[],method:"none",time:"none",frequency:"none",frequencyVal:0,rate:0,rateType:"hours",applicableTime:0,applicableTimeType:"hours",carryOverCheck:"no",carryOverType:"hours",carryOverVal:0,negativeBalanceCheck:"no",negativeBalanceVal:0,negativeBalanceType:"hours",applicableDateType:"hireDate",applicableDate:0,resetDateType:"policyDateCustom",resetDate:0,newHireTime:0,newHireTimeType:0,newHireRate:0,plans:[]};function stepCompletedAdd(step){return 1===step?(policyOBJ.policyCategory=getField("#js-policy-type-add"),policyOBJ.type=getField("#js-category-add"),0==policyOBJ.type?(alertify.alert("WARNING!","Please, select the policy type.",()=>{}),!1):(policyOBJ.title=getField("#js-policy-title-add"),0==policyOBJ.title?(alertify.alert("WARNING!","Please, add the policy title.",()=>{}),!1):(policyOBJ.order=getField("#js-sort-order-add"),policyOBJ.entitledEmployees=getField("#js-employee-add"),policyOBJ.approver=!0===$("#js-approver-check-add").prop("checked")?1:0,policyOBJ.deactivate=!0===$("#js-archive-check-add").prop("checked")?1:0,policyOBJ.include=!0===$("#js-include-check-add").prop("checked")?1:0,policyOBJ.employeeTypes=$("#js-employee-type-add").val(),policyOBJ.isEntitledEmployees=$(".jsIsEntitledEmployee:checked").val(),policyOBJ.offDays=getField("#js-off-days-add"),null==policyOBJ.employeeTypes?(alertify.alert("WARNING!","Please, add the employee type.",()=>{}),!1):(saveStep(policyOBJ),!0)))):2===step?(policyOBJ.method="hours_per_month",policyOBJ.time=getField("#js-accrual-time-add"),policyOBJ.frequency=getField("#js-accrual-frequency-add"),policyOBJ.frequencyVal=getField("#js-accrual-frequency-val-add"),policyOBJ.rate=getField("#js-accrual-rate-add"),policyOBJ.rateType=getField("#js-accrual-rate-type-add option:selected"),policyOBJ.applicableTimeType=getField(".js-minimum-applicable-time-add:checked"),policyOBJ.applicableTime=getField("#js-minimum-applicable-hours-add"),policyOBJ.plans=getAccrualPlans("add"),!0===policyOBJ.plans?(alertify.alert("WARNING!","Please, add the proper plans.",()=>{}),!1):(saveStep(policyOBJ),!0)):3===step?(policyOBJ.carryOverCheck=getField("#js-carryover-cap-check-add"),policyOBJ.carryOverVal=getField("#js-carryover-cap-add"),policyOBJ.carryOverType=getField("#js-accrual-carryover-type option:selected"),saveStep(policyOBJ),!0):4===step?(policyOBJ.negativeBalanceCheck=getField("#js-accrual-balance-add"),policyOBJ.negativeBalanceVal=getField("#js-maximum-balance-add"),policyOBJ.newHireTimeType=getField("#js-accrual-negative-balance-type option:selected"),saveStep(policyOBJ),!0):5===step?(policyOBJ.applicableDateType=getField(".js-hire-date-add:checked"),policyOBJ.applicableDate=getField("#js-custom-date-add"),"hiredate"!=policyOBJ.applicableDateType.toLowerCase()&&0==policyOBJ.applicableDate?(alertify.alert("WARNING!","Please, select a policy applicable date.",()=>{}),!1):(saveStep(policyOBJ),!0)):6===step?(policyOBJ.resetDateType=getField(".js-policy-reset-date-add:checked"),policyOBJ.resetDate=getField("#js-custom-reset-date-add"),"policydate"!=policyOBJ.resetDateType.toLowerCase()&&0==policyOBJ.resetDate?(alertify.alert("WARNING!","Please, select a policy reset date.",()=>{}),!1):(saveStep(policyOBJ),!0)):7===step&&(policyOBJ.newHireTime=getField("#js-accrue-new-hire-add"),policyOBJ.newHireTimeType=getField("#js-accrual-new-hire-time-type option:selected"),policyOBJ.newHireRate=getField("#js-newhire-prorate-add"),saveStep(policyOBJ),!0)}function finalStepCompletedAdd(policy){ml(!0,"policy");let post=Object.assign({},policy,{action:"create_policy",companyId:companyId,employeeId:employeeId,employerId:employerId,public:0});$.post(handlerURL,post,resp=>{ml(!1,"policy"),!0!==resp.Redirect?!1!==resp.Status?alertify.alert("SUCCESS!",resp.Response,()=>{loadViewPage()}):alertify.alert("WARNING!",resp.Response,()=>{}):alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()})})}window.timeoff.stepCompletedAdd=stepCompletedAdd,window.timeoff.finalStepCompletedAdd=finalStepCompletedAdd,$("#js-category-add").on("change",(function(){var i;null!==$('#js-category-add option[value="'+$(this).val()+'"]').text().toLowerCase().trim().match(/(fmla)/g)?$(".js-fmla-range-wrap-add").show():($(".js-fmla-range-wrap-add").hide(0),$(".js-fmla-range-add").prop("checked",!1),$('.js-fmla-range-add[value="standard_year"]').prop("checked",!0))})),$("#js-employee-add").on("select2:select",(function(event){if("All"!=event.params.data.text){let newVals=$(this).val().filter((function(ef){return"all"!=ef}));$("#js-employee-add").val(newVals)}else $("#js-employee-add").val("all");$("#js-employee-add").trigger("change.select2")})),$("#js-accrual-frequency-add").on("change",(function(){"none"==$(this).val()?"Jan To Dec"!=$('#js-accrual-time-add[value="none"]').text()&&($("#js-accrual-time-add").html('\n                <option value="none" selected="true">Jan To Dec</option>\n                <option value="start_of_period">Jan to Jun</option>\n                <option value="end_of_period">Jul to Dec</option>\n                '),$("#js-accrual-time-add").select2()):"1st To 30th"!=$('#js-accrual-time-add[value="none"]').text()&&($("#js-accrual-time-add").html('\n                    <option value="none" selected="true">1st To 30th</option>\n                    <option value="start_of_period">1st To 15th</option>\n                    <option value="end_of_period">15th To 30th</option>\n                '),$("#js-accrual-time-add").select2()),"custom"==$(this).val()?($(".jsCustomBoxAdd").show(0),$("#js-accrual-time-add").prop("disabled",!0),$("#js-accrual-time-text-add").show()):($(".jsCustomBoxAdd").hide(0),$("#js-accrual-time-add").prop("disabled",!1),$("#js-accrual-time-text-add").hide()),setAccrualText()})),$("#js-carryover-cap-check-add").change((function(){$(".js-carryover-box-add").find("input").val(0),"no"===$(this).val()?$(".js-carryover-box-add").hide():$(".js-carryover-box-add").show()})),$("#js-accrual-balance-add").change((function(){$(".js-accrual-balance-add").find("input").val(0),"no"===$(this).val()?$(".js-negative-box-add").hide():$(".js-negative-box-add").show()})),$(".js-hire-date-add").on("change",(function(){"hireDate"==$(this).val()?($(".jsImplementDateBox-add").hide(0),$("#js-custom-date-add").val("")):$(".jsImplementDateBox-add").show(0)})),$(".js-policy-reset-date-add").on("change",(function(){"policyDate"==$(this).val()?($(".jsResetDateBox-add").hide(0),$("#js-custom-reset-date-add").val("")):$(".jsResetDateBox-add").show(0)})),$(".js-plan-btn-add").click((function(e){e.preventDefault(),loadAccrualPlans($(this).data("type"))})),$(document).on("click",".js-plan-remove-btn",(function(e){e.preventDefault(),""!=$(this).parent().find(".js-pt").val().trim()||""!=$(this).parent().find(".js-py").val().trim()?alertify.confirm("Do you really want to delete this accrual plan?",()=>{$(this).parent().remove()}).set("labels",{ok:"Yes",cancel:"No"}):$(this).parent().remove()})),$('[data-hint="js-hint"]').click((function(e){e.preventDefault(),$(`.js-hint-${$(this).data("target")}`).toggle()})),$(document).on("select2:selecting","#js-plans-select-add",(function(e){makePlanRow(e.params.args.data.id,"add")})),$(document).on("select2:unselecting","#js-plans-select-add",(function(e){removePlan(e.params.args.data.id,"add")})),$(document).on("click",".js-remove-plan-add",(function(e){removePlan($(this).closest("li").data("id"),"add"),$("#js-plans-select-add").select2("val",newValues($("#js-plans-select-add").val(),$(this).closest("li").data("id")))})),$("#js-unlimited-policy-check-add").click((function(){!0===$(this).prop("checked")?$("#js-plan-box-add").hide():$("#js-plan-box-add").show()})),$("#js-accrual-time-add").change(setAccrualText),$("#js-accrual-rate-type-add").change(setAccrualText),$("#js-accrual-rate-add").keyup((function(){""==$(this).val().trim()?($("#js-accrual-time-add").prop("disabled",!0),$("#js-accrual-time-text-add").show()):null!=$(this).val().match(/[a-zA-Z]/)?($(this).val(0),$("#js-accrual-time-add").prop("disabled",!0),$("#js-accrual-time-text-add").show()):$(this).val()<0?($(this).val(0),$("#js-accrual-time-add").prop("disabled",!0),$("#js-accrual-time-text-add").show()):($("#js-accrual-time-add").prop("disabled",!1),$("#js-accrual-time-text-add").hide()),0==$(this).val()?$(".js-plan-btn-add").prop("disabled",!0):$(".js-plan-btn-add").prop("disabled",!1),setAccrualText()})),$("#js-accrual-frequency-val-add").keyup((function(){$(this).val().trim()<=0?$(this).val(1):$(this).val().trim()>12&&$(this).val(12),setAccrualText()})),$("#js-policy-title-add").keyup((function(){$("#jsPolicyTitleAdd").text(" - "+$(this).val())})),$("#js-accrue-new-hire-add").keyup(setNewHireAccrual),$("#js-newhire-prorate-add").keyup(setNewHireAccrual),$("#js-accrual-new-hire-time-type").change(setNewHireAccrual)}));