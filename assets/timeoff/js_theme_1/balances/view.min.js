$((function(){let callOBJ={Balances:{Main:{action:"get_balances",companyId:companyId,employerId:employerId,employeeId:employeeId,level:level,filter:{employees:getParams("id"),policies:getParams("pid"),type:$(".jsEditResetCheckbox:checked").val()},public:0,inset:0,offset:10}}},xhr=null;function resetFilter(e){e.preventDefault(),$("#js-filter-employee").select2("val","all"),$("#js-filter-policies").select2("val","all"),callOBJ.Balances.Main.inset=0,callOBJ.Balances.Main.offset=10,callOBJ.Balances.Main.filter.employees="all",callOBJ.Balances.Main.filter.policies="all",callOBJ.Balances.Main.filter.type=$(".jsEditResetCheckbox:checked").val(),window.location="?id=all&pid=all"}function applyFilter(e){e.preventDefault(),callOBJ.Balances.Main.inset=0,callOBJ.Balances.Main.offset=10,callOBJ.Balances.Main.filter.employees=$("#js-filter-employee").val(),callOBJ.Balances.Main.filter.policies=null==$("#js-filter-policies").val()?"all":$("#js-filter-policies").val(),callOBJ.Balances.Main.filter.type=$(".jsEditResetCheckbox:checked").val(),window.location="?id="+callOBJ.Balances.Main.filter.employees+"&pid="+callOBJ.Balances.Main.filter.policies}function fetchBalances(){void 0!==window.timeoff.employees?null==xhr&&($("#js-filter-employee").select2("val",getParams("id")),$("#js-filter-policies").select2("val",getParams("pid")),ml(!0,"balance"),$(".js-error-row").remove(),xhr=$.post(handlerURL,callOBJ.Balances.Main,(function(resp){if(xhr=null,!0!==resp.Redirect)if(0!=resp.Data.Balances.length){if(!1===resp.Status&&1==callOBJ.Balances.Main.page)return $(".js-ip-pagination").html(""),$("#js-data-area").html(`<tr class="js-error-row"><td colspan="${$(".js-table-head").find("th").length}"><p class="alert alert-info text-center">${resp.Response}</p></td></tr>`),void ml(!1,"balance");if(!1===resp.Status)return $(".js-ip-pagination").html(""),void ml(!1,"balance");0==callOBJ.Balances.Main.inset&&loadMoreBalance(),setTable(resp)}else ml(!1,"balance");else alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()})}))):setTimeout(()=>{fetchBalances()},1e3)}function setTable(resp,typo){let rows="";0!=resp.Data.Balances.length&&($.each(resp.Data.Balances,(function(i,v){let userRow=getUserById(v.total.UserId,resp.Data.Employees,"userId");0!=Object.keys(userRow).length&&(rows+=`<tr data-id="${v.total.UserId}" data-name="${userRow.first_name} ${userRow.last_name}">`,rows+='    <td scope="row">',rows+='        <div class="employee-info">',rows+="            <figure>",rows+=`                <img src="${getImageURL(userRow.image)}" class="img-circle emp-image" />`,rows+="            </figure>",rows+='            <div class="text">',rows+=`                <h4>${userRow.first_name} ${userRow.last_name}</h4>`,rows+=`                <p>${remakeEmployeeName(userRow,!1)}</p>`,rows+=`                <p><a href="${baseURL}employee_profile/${userRow.userId}" target="_blank">Id: ${getEmployeeId(userRow.userId,userRow.employee_number)}</a></p>`,rows+="            </div>",rows+="        </div>",rows+="    </td>",rows+="    <td>",rows+='        <div class="text">',rows+=`            <p>${""==userRow.joined_at||null==userRow.joined_at?"-":moment(userRow.joined_at).format(timeoffDateFormat)}</p>`,rows+="        </div>",rows+="    </td>",rows+="    <td>",rows+='        <div class="text">',rows+=`            <p>${""==v.total.AllowedTime.text?"0 hours":v.total.AllowedTime.text} <a href="" data-target="jsBreakdownDivAllowed${v.total.UserId}" class="csExpandBalance jsExpandBalance" title="See breakdown" placement="top" class="btn btn-xs"><i class="fa fa-plus-circle"></i></a></p>`,rows+=`        <div class="dn" id="jsBreakdownDivAllowed${v.total.UserId}">`,$.each(v,(index,poli)=>{if("total"==index)return"";rows+=`<p><strong>${index}</strong><br /> (${poli.AllowedTime.text})</p>`}),rows+="        </div>",rows+="        </div>",rows+="    </td>",rows+='    <td style="vertical-align: middle;">',rows+='        <div class="text">',rows+=`            <span><strong>Paid:</strong> ${""==v.total.ConsumedTime.text?"0 hours":v.total.ConsumedTime.text}</span><br />`,rows+=`            <span><strong>Unpaid:</strong> ${""==v.total.UnpaidConsumedTime.text?"0 hours":v.total.UnpaidConsumedTime.text}</span>`,rows+="        </div>",rows+="    </td>",rows+="    <td>",rows+='        <div class="text">',rows+=`            <p>${""==v.total.RemainingTime.text?"0 hours":v.total.RemainingTime.text}<a href="" data-target="jsBreakdownDivRemaining${v.total.UserId}" class="csExpandBalance jsExpandBalance" title="See breakdown" placement="top" class="btn btn-xs"><i class="fa fa-plus-circle"></i></a></p>`,rows+=`        <div class="dn" id="jsBreakdownDivRemaining${v.total.UserId}">`,$.each(v,(index,poli)=>{if("total"==index)return"";rows+=`<p><strong>${index}</strong><br /> (${poli.RemainingTime.text})</p>`}),rows+="        </div>",rows+="        </div>",rows+="    </td>",rows+="    <td>",rows+='    <div class="dropdown" style="margin-top: 10px;">\n                        <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">\n                        Action\n                        <span class="caret"></span>\n                        </button>\n                        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="right:0; left: auto;">\n                        <li><a href="#" class="jsViewPolicies">View Policies</a></li>\n                        <li><a href="#" class="jsViewBalance">Manage Balance</a></li>\n                        <li><a href="#" class="jsViewApprovers">View Approvers</a></li>\n                        <li role="separator" class="divider"></li>\n                        <li><a href="#" class="jsCreateRequest">Create Time-off</a></li>\n                        </ul>\n                    </div>',rows+="    </td>",rows+="</tr>")})),void 0===typo?$("#js-data-area").html(rows):$("#js-data-area").append(rows),$(".js-type-popover").popover({html:!0,trigger:"hover"}),$('[data-toggle="tooltip"]').tooltip(),ml(!1,"balance"),loadTitles())}function fetchEmployeeApprovers(employeeId){return new Promise(res=>{$.post(handlerURL,{action:"get_employee_approvers",companyId:companyId,employerId:employerId,employeeId:employeeId,public:0},resp=>{res(resp)})})}function loadMoreBalance(){callOBJ.Balances.Main.inset+=10,$.post(handlerURL,callOBJ.Balances.Main,(function(resp){0!=resp.Data.Balances.length&&loadMoreBalance(),setTable(resp,"append")}))}window.timeoff.fetchBalances=fetchBalances,fetchBalances(),$("#js-filter-from-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0,onSelect:function(v){$("#js-filter-to-date").datepicker("option","minDate",v)}}),$("#js-filter-to-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0}).datepicker("option","minDate",$("#js-filter-from-date").val()),$(document).on("click",".js-apply-filter-btn",applyFilter),$(document).on("click",".js-reset-filter-btn",resetFilter),$(document).on("change",".jsEditResetCheckbox",applyFilter),$(document).on("click",".jsViewPolicies",(function(e){e.preventDefault(),startPolicyProcess($(this).closest("tr").data("id"),$(this).closest("tr").data("name"))})),$(document).on("click",".jsViewBalance",(function(e){e.preventDefault(),startBalanceProcess($(this).closest("tr").data("id"),$(this).closest("tr").data("name"))})),$(document).on("click",".jsViewApprovers",(function(e){e.preventDefault(),Modal({Id:"employeeApproverModal",Title:`Approvers for ${$(this).closest("tr").data("name")}`,Body:"",Loader:"employeeApproverModalLoader"},async()=>{const approvers=await fetchEmployeeApprovers($(this).closest("tr").data("id"));if(!0===approvers.Redirect)return void alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()});if(!1===approvers.Status||0==approvers.Data.length)return $("#employeeApproverModal .csModalBody").html('<p class="alert alert-success text-center">No approvers are assigned to this employee.</p>'),void ml(!1,"employeeApproverModalLoader");let rows='\n            <div class="tabel-responsive">\n                <table class="table table-striped csCustomTableHeader">\n                    <thead>\n                        <tr>\n                            <th>Employee</th>\n                            <th>Can Approve</th>\n                        </tr>\n                    </thead>\n                    <tbody id="employeeApproverModalTable"></tbody>\n                </table>\n            </div>';$("#employeeApproverModal .csModalBody").html(rows),rows="",approvers.Data.map(approver=>{rows+="<tr>",rows+=`   <td>${remakeEmployeeName(approver)}</td>`,rows+=`   <td style="font-weight: 900"; class="${1==approver.approver_percentage?"text-success":"text-danger"}">${1==approver.approver_percentage?"Yes":"No"}</td>`,rows+="</tr>"}),$("#employeeApproverModalTable").html(rows),ml(!1,"employeeApproverModalLoader")})}))}));