$((function(){let selectedEmployeeId=employeeId,selectedEmployeeName=employeeName,cOBJ={policyId:0,startDate:0,endDate:0,dateRows:"",status:0,reason:0,comment:0,sendEmailNotification:0,fromAdmin:1};function getModalBody(type){return new Promise(res=>{$.post(handlerURL,{action:"get_modal",companyId:companyId,employerId:employerId,employeeId:employeeId,type:type},resp=>{res(resp)})})}function getEmployeePolicies(employeeId){return new Promise(res=>{$.post(handlerURL,{action:"get_employee_policies",companyId:companyId,employerId:employerId,employeeId:selectedEmployeeId},resp=>{res(resp)})})}function getSideBarPolicies(){$(".jsAsOfTodayPolicies").html(""),$.post(handlerURL,{action:"get_employee_policies_by_date",companyId:companyId,employerId:employerId,employeeId:selectedEmployeeId,fromDate:$("#jsStartDate").val()},resp=>{if(resp.Data.length>0){window.timeoff.cPolicies=resp.Data;let rows="";resp.Data.map(policy=>{""==policy.Reason&&(rows+=`\n                        <div>\n                            <strong>${policy.Title}</strong>\n                            <br />\n                            <span>Remaining Time: ${0==policy.AllowedTime.M.minutes&&""==policy.Reason?"Unlimited":policy.RemainingTime.text}</span>\n                            <br />\n                            <span>Employement Status: ${ucwords(policy.EmployementStatus)}</span>  \n                        </div>\n                        <hr />\n                    `)}),$(".jsAsOfTodayPolicies").html(rows)}})}function unavailable(date){var dmy=moment(date).format("MM-DD-YYYY");let d=moment(date).format("dddd").toString().toLowerCase(),t=1;return t=-1!==$.inArray(d,timeOffDays)?{work_on_holiday:0,holiday_title:"Weekly off"}:inObject(dmy,holidayDates),-1==t?[!0,""]:1==t.work_on_holiday?[!0,"set_disable_date_color",t.holiday_title]:[!1,"",t.holiday_title]}$(document).on("click",".jsCreateTimeOffBTN",(function(e){if(e.preventDefault(),cOBJ.policyId=getField("#jsAddPolicy"),cOBJ.startDate=getField("#jsStartDate"),cOBJ.endDate=getField("#jsEndDate"),cOBJ.status=getField("#jsStatus"),cOBJ.reason=CKEDITOR.instances.jsReason.getData(),cOBJ.comment=CKEDITOR.instances.jsComment.getData(),cOBJ.sendEmailNotification=getField(".js-send-email:checked"),cOBJ.dateRows=getRequestedDays(".jsDurationBox"),0==cOBJ.policyId)return void alertify.alert("WARNING!","Please select a policy.",()=>{});if(0==cOBJ.startDate)return void alertify.alert("WARNING!","Please select the start date.",()=>{});if(0==cOBJ.endDate)return void alertify.alert("WARNING!","Please select an end date.",()=>{});if(null===window.location.pathname.match(/(lms)|(employee_management_system)|(dashboard)/gi)&&"pending"==cOBJ.status)return void alertify.alert("WARNING!","Please, either select approve or reject.",()=>{});if(cOBJ.dateRows.error)return;let selectedPolicy=getPolicy(cOBJ.policyId,window.timeoff.cPolicies);0!=selectedPolicy.AllowedTime.M.minutes&&cOBJ.dateRows.totalTime>selectedPolicy.RemainingTimeWithNegative.M.minutes?alertify.alert("WARNING!",`Requested time-off can not be greater than the allowed time i.e. "${selectedPolicy.RemainingTimeWithNegative.text}"`,()=>{}):(cOBJ.fromAdmin=1,ml(!0,"addTimeoffModalLoader"),$.post(handlerURL,Object.assign({action:"create_timeoff",companyId:companyId,employerId:employerId,employeeId:selectedEmployeeId},cOBJ),resp=>{if(!1===resp.Status)return ml(!1,"addTimeoffModalLoader"),void alertify.alert("WARNING!",resp.Response,()=>{});ml(!1,"addTimeoffModalLoader"),alertify.alert("SUCCESS!",resp.Response,()=>{$(".jsModalCancel").removeAttr("data-ask"),$(".jsModalCancel").trigger("click"),window.location.reload()})}))})),$(document).on("click","#jsCreateTimeOffForEmployee",(function(e){e.preventDefault();let employeeId=0,employeeName="";void 0!==$(this).data("id")?(employeeId=selectedEmployeeId,employeeName=selectedEmployeeName):(employeeId=$(this).closest("tr").data("id"),employeeName=$(this).closest("tr").data("name")),selectedEmployeeId=employeeId,Modal({Id:"addTimeoffModal",Title:"Create Time-off",Body:"",Buttons:['<button class="btn btn-success dn jsCreateTimeOffEmployeeBTN">Create<button>'],Loader:"addTimeoffModalLoader",Ask:!1},async()=>{ml(!1,"addTimeoffModalLoader")})}))}));