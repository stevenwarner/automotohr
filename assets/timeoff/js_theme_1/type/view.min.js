$((function(){let callOBJ={CompanyTypes:{Main:{action:"get_types_by_company",companyId:companyId,employerId:employerId,employeeId:employeeId,filter:{archived:0,type:"",startDate:"",endDate:"",status:""},public:0,page:1},cb:fetchCompanyTypes,limit:0,count:0,pages:0},TypeSort:{Main:{action:"update_sort_order",companyId:companyId,employerId:employerId,employeeId:employeeId,public:0}},TypeHistory:{Main:{action:"get_type_history",companyId:companyId,employerId:employerId,employeeId:employeeId,public:0}}},oldState={},xhr=null;function resetFilter(e){e.preventDefault(),$("#js-filter-types").select2("val","-1"),$("#js-filter-from-date").val(""),$("#js-filter-to-date").val(""),$('#js-filter-status option[value="-1"]').prop("selected",!0),callOBJ.CompanyTypes.Main.filter.type="-1",callOBJ.CompanyTypes.Main.filter.startDate="",callOBJ.CompanyTypes.Main.filter.endDate="",callOBJ.CompanyTypes.Main.filter.status="-1",callOBJ.CompanyTypes.Main.filter.archived=0,callOBJ.CompanyTypes.Main.page=1,callOBJ.CompanyTypes.Main.limit=0,callOBJ.CompanyTypes.Main.count=0,fetchCompanyTypes()}function applyFilter(e){e.preventDefault(),callOBJ.CompanyTypes.Main.filter.type=$("#js-filter-types").val(),callOBJ.CompanyTypes.Main.filter.startDate=$("#js-filter-from-date").val(),callOBJ.CompanyTypes.Main.filter.endDate=$("#js-filter-to-date").val(),callOBJ.CompanyTypes.Main.filter.status=$("#js-filter-status").val(),callOBJ.CompanyTypes.Main.page=1,callOBJ.CompanyTypes.Main.limit=0,callOBJ.CompanyTypes.Main.count=0,fetchCompanyTypes()}function fetchCompanyTypes(){null==xhr&&(ml(!0,"type"),$(".js-error-row").remove(),xhr=$.post(handlerURL,callOBJ.CompanyTypes.Main,(function(resp){if(xhr=null,!0!==resp.Redirect){if(!1===resp.Status&&1==callOBJ.CompanyTypes.Main.page)return $(".js-ip-pagination").html(""),$("#js-data-area").html(`<tr class="js-error-row"><td colspan="${$(".js-table-head").find("th").length}"><p class="alert alert-info text-center">${resp.Response}</p></td></tr>`),void ml(!1,"type");if(!1===resp.Status)return $(".js-ip-pagination").html(""),void ml(!1,"type");1==callOBJ.CompanyTypes.Main.page&&(callOBJ.CompanyTypes.limit=resp.Limit,callOBJ.CompanyTypes.count=resp.TotalRecords,callOBJ.CompanyTypes.pages=resp.TotalPages),setTable(resp)}else alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()})})))}function setTable(resp){oldState={};let title=0!=callOBJ.CompanyTypes.Main.filter.archived?"Activate Type":"Deactivate type",icon=0!=callOBJ.CompanyTypes.Main.filter.archived?"fa-check-square-o":"fa-archive",cl=0!=callOBJ.CompanyTypes.Main.filter.archived?"js-activate-btn":"js-archive-btn",rows="";if(0==resp.Data.length)return ml(!1,"type"),void $("#js-data-area").html(`<tr><td colspan="4"><p class="alert alert-info text-center">${resp.Response}</p></td></tr>`);$.each(resp.Data,(function(i,v){oldState[v.type_sid]=i,rows+=`<tr class="jsDragAble" data-id="${v.type_sid}" data-name="${v.type_title}">`,rows+="    <td>",rows+='        <div class="text">',rows+=`            <p> ${ucwords(v.type_title)}</p>`,rows+="        </div>",rows+="    </td>",rows+="    <td>",rows+='        <div class="text">',rows+=`            <p class="js-type-popovers">${null!==v.policies?v.policies.join(", "):"-"}</p>`,rows+="        </div>",rows+="    </td>",rows+="    <td>",rows+='        <div class="text">',rows+=`            <p class="js-type-popovers">${null===v.created_at?"Joining Date":moment(v.created_at,"").format(timeoffDateFormat)}</p>`,rows+="        </div>",rows+="    </td>",rows+="    <td>",0==v.default_type?(rows+='        <div class="action-employee">',rows+='            <a href="javascript:void(0)" class="action-edit js-edit-row-btn"><i class="fa fa-pencil-square-o fa-fw icon_blue" data-toggle="tooltip" title="Edit type"></i></a>',rows+='            <a href="javascript:void(0)" class="action-activate custom-tooltip jsTypeHistory"><i class="fa fa-history fa-fw" data-toggle="tooltip" title="View history"></i></a>',rows+=`            <a href="javascript:void(0)" class="action-activate custom-tooltip ${cl}"><i class="fa ${icon} fa-fw" data-toggle="tooltip" title="${title}"></i></a>`,rows+="        </div>"):rows+='        <div class="action-employee">-</div>',rows+="    </td>",rows+="</tr>"})),load_pagination(callOBJ.CompanyTypes.limit,5,$(".js-ip-pagination"),"CompanyTypes"),$("#js-data-area").html(rows),$('[data-toggle="tooltip"]').tooltip({placement:"top"}),$(".js-type-popover").popover({html:!0,trigger:"hover"}),callDrager("#js-data-area"),ml(!1,"type")}function callDrager(target){$(target).sortable({placeholder:"ui-state-highlight"}),$(target).disableSelection()}function callSort(){for(var i=1,s={},l=$("#js-data-area").find("tr").length;i<=l;i++)s[$("#js-data-area").find("tr:nth-child("+i+")").data("id")]=i;updateSortInDb(s)}function updateSortInDb(s){let o=Object.assign({},callOBJ.TypeSort.Main,{sort:s,type:"categories"});$.post(handlerURL,o,resp=>{ml(!1,"type")})}function getHistoryTemplate(){let html;return'\n            <div class="tabel-responsive">\n                <table class="table table-striped csCustomTableHeader">\n                    <thead>\n                        <tr>\n                            <th>Employee</th>\n                            <th>Action</th>\n                            <th>Action Taken</th>\n                        </tr>\n                    </thead>\n                    <tbody id="jsTypeHistoryTable"></tbody>\n                </table>\n            </div>\n        '}function fetchTypeyHistory(typeId){ml(!0,"jsTypeHistoryLoader"),$("#jsTypeHistoryTable").html(""),xhr=$.post(handlerURL,Object.assign(callOBJ.TypeHistory.Main,{typeId:typeId}),resp=>{if(xhr=null,!0===resp.Redirect)return void alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()});if(!1===resp.Status)return alertify.alert("WARNING!",resp.Response,()=>{}),void ml(!1,"jsTypeHistoryLoader");let rows="";0===resp.Data.length?rows=`\n                    <tr>\n                        <td colspan="3">\n                            <p class="alert alert-info text-center">${resp.Response}</p>\n                        </td>\n                    </tr>\n                `:resp.Data.map(v=>{rows+=`\n                        <tr>\n                            <td>${remakeEmployeeName(v)}</td>\n                            <td>${v.action.toUpperCase()}</td>\n                            <td>${moment(v.created_at).format(timeoffDateFormatWithTime)}</td>\n                        </tr>\n                    `}),$("#jsTypeHistoryTable").html(rows),ml(!1,"jsTypeHistoryLoader")})}window.timeoff.PaginationOBJ.CompanyTypes=callOBJ.CompanyTypes,window.timeoff.fetchCompanyTypes=fetchCompanyTypes,""!=page&&"view"!=page||fetchCompanyTypes(),$("#js-filter-from-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0,onSelect:function(v){$("#js-filter-to-date").datepicker("option","minDate",v)}}),$("#js-filter-to-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0}).datepicker("option","minDate",$("#js-filter-from-date").val()),$(".js-tab").click((function(){callOBJ.CompanyTypes.Main.filter.archived="archived"===$(this).data("type")?1:0,fetchCompanyTypes()})),$(document).on("click",".js-apply-filter-btn",applyFilter),$(document).on("click",".js-reset-filter-btn",resetFilter),$("#js-data-area").on("sortstop",callSort),$(document).on("click",".js-archive-btn",(function(e){e.preventDefault();var _this=$(this);alertify.confirm("Do you really want to deactivate this type?",(function(){var post={action:"archive_company_type"};post.companyId=companyId,post.employeeId=employeeId,post.employerId=employerId,post.public=0,post.typeId=_this.closest("tr").data("id"),ml(!0,"type"),$.post(handlerURL,post,(function(resp){ml(!1,"type"),!0!==resp.Redirect?!1!==resp.Status?alertify.alert("SUCCESS!",resp.Response,(function(){loadViewPage()})):alertify.alert("WARNING!",resp.Response,(function(){})):alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()})}))})).set("labels",{ok:"YES",cancel:"NO"}).setHeader("CONFIRM!")})),$(document).on("click",".js-activate-btn",(function(e){e.preventDefault();var _this=$(this);alertify.confirm("Do you really want to activate this type?",(function(){var post={action:"activate_company_type"};post.companyId=companyId,post.employeeId=employeeId,post.employerId=employerId,post.public=0,post.typeId=_this.closest("tr").data("id"),ml(!0,"type"),$.post(handlerURL,post,(function(resp){ml(!1,"type"),!0!==resp.Redirect?!1!==resp.Status?alertify.alert("SUCCESS!",resp.Response,(function(){loadViewPage()})):alertify.alert("WARNING!",resp.Response,(function(){})):alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()})}))})).set("labels",{ok:"YES",cancel:"NO"}).setHeader("CONFIRM!")})),$(document).on("click",".jsTypeHistory",(function(){Modal({Id:1,Title:`Type History for ${$(this).closest("tr").data("name")}`,Body:getHistoryTemplate(),Loader:"jsTypeHistoryLoader"},()=>{fetchTypeyHistory($(this).closest("tr").data("id"))})}))}));