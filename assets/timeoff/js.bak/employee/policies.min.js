$((function(){async function fetchPoliciesLMS(){const policies=await fetchEmployeePolicies();if(0==policies.Data.length)return void console.log("No policies found.");window.timeoff.employeePolicies=policies.Data;let rows="";policies.Data.map(policy=>{rows+=` \n            <div class = "item active">\n                <div class = "col-sm-4 col-xs-12" >\n                    <div class = "card csCard" data-id="${policy.PolicyId}">\n                        <div class = "card-body" >\n                            <h4 class = "card-title" >\n                                <strong> ${policy.Title} </strong> <br />\n                                <small> (${policy.Category}) \n                                ${policy.Plans.length>0?'<button class="btn btn-success btn-xs jsShowTime pull-right"><i class="fa fa-eye" title="Show time" placement="left"></i> View Time</button>':""}\n                                \n                                </small> \n                            </h4> \n                            <div class="csSeprator"></div>\n                            <p class = "card-text" >${0==policy.IsUnlimited?policy.RemainingTime.text:"Unlimited"} remaining</p> \n                            <p class = "card-text" >${policy.ConsumedTime.text} scheduled</p> \n                            <p class = "card-text" >${policy.Approved} time-off${0==policy.Approved||policy.Approved>1?"s":""} scheduled \n                                <span class = "pull-right" >\n                                    <button class = "btn btn-success btn-xs jsScheduledTimeoOfBTN" title = "Show scheduled time-offs" placement = "top" > \n                                        <i class = "fa fa-eye"></i>\n                                    </button >\n                                </span> \n                            </p> \n                            <p class = "card-text" > ${policy.Pending} time-off${0==policy.Pending||policy.Pending>1?"s":""} requested\n                                <span class = "pull-right" >\n                                    <button class = "btn btn-success jsRemainingTimeOffBTN btn-xs" title = "Show requested time-offs" placement = "top" > \n                                        <i class = "fa fa-eye" ></i>\n                                    </button>\n                                </span> \n                            </p> \n                            <p class = "card-text" > Employment Status: ${ucwords(policy.EmployementStatus)} </p> \n                            <p class = "card-text" > ${ucwords(policy.Reason)} </p>`,rows+='<div class="csCardFoot">',""!=policy.Reason||0==policy.IsUnlimited&&0==policy.RemainingTime.M.minutes?rows+='\n                                <button class = "btn btn-success form-control" disabled> \n                                    <i class = "fa fa-plus" > </i> &nbsp;REQUEST A TIME-OFF\n                                </button>\n                    ':rows+=` \n                                <button class = "btn btn-success jsCreateRequest form-control" data-id = "${employeeId}" data-policyId = "${policy.PolicyId}" > \n                                    <i class = "fa fa-plus" > </i> &nbsp;REQUEST A TIME-OFF\n                                </button>`,rows+="\n                        </div> \n                        </div> \n                    </div> \n                </div> \n            </div>"}),$("#jsEMSCraousal div").html(rows),loadTitles()}function fetchEmployeePolicies(){return new Promise((res,rej)=>{$.post(handlerURL,{action:"get_employee_policies_with_timeoffs",companyId:companyId,employerId:employerId,employeeId:employeeId},(function(resp){res(resp)}))})}function employeeRequests(status,policyId){return new Promise((res,rej)=>{$.post(handlerURL,{action:"get_employee_requests_by_status",companyId:companyId,employerId:employerId,employeeId:employeeId,status:status,policyId:policyId},(function(resp){res(resp)}))})}fetchPoliciesLMS(),$(document).on("click",".jsScheduledTimeoOfBTN",(function(e){e.preventDefault(),Modal({Id:"jsViewTimeOffModal",Loader:"jsViewTimeOffModalLoader",Title:`Time-offs scheduled for the year ${moment().format("YYYY")}`,Body:' \n                <div class="tabel-responsive">\n                    <div id="jsData"></div>\n                    <table class="table table-striped csCustomTableHeader">\n                        <thead>\n                            <tr>\n                                <th>Policy</th>\n                                <th>Status</th>\n                                <th>Progress</th>\n                                <th>Reason</th>\n                                <th>Requested On</th>\n                            </tr>\n                        </thead>\n                        <tbody id="jsViewTimeOffModalTable"></tbody>\n                    </table>\n                </div>\n            '},async()=>{const requests=await employeeRequests("approved",$(this).closest(".csCard").data("id"));if(0==requests.Data.length)return ml(!1,"jsViewTimeOffModalLoader"),void $("#jsViewTimeOffModalTable").html('<tr><td colspan="5"><p class="alert alert-info text-center">No time-offs found.</p></td></tr>');let rows="";requests.Data.map(v=>{rows+=`\n                    <tr>\n                        <td> \n                            <div class="upcoming-time-info">            \n                                <div class="icon-image">                   \n                                    <img src="${baseURL}assets/images/upcoming-time-off-icon.png" class="emp-image" alt="emp-1">             \n                                </div>             \n                                <div class="text">                  \n                                    <h4>${v.request_from_date==v.request_to_date?moment(v.request_from_date).format(timeoffDateFormat):moment(v.request_from_date).format(timeoffDateFormat)+" - "+moment(v.request_to_date).format(timeoffDateFormat)}</h4>                  \n                                    <span>${v.title}</span><br />          \n                                    <span>${v.breakdown.text}</span>          \n                                </div>       \n                            </div>\n                        </td>`,rows+=`\n                        <td>\n                          <p class="">${ucwords(v.status)}</p>\n                        </td>\n                    `,rows+=`\n                    <td>\n                        <div class="progress" style="margin-top: 10px;">\n                            <div class="progress-bar progress-bar-success" role="progressbar" style="width: ${"pending"==v.status?"pending"!=v.level_status?50:0:100}%;">\n                                <span class="sr-only"> ${"pending"==v.status?"pending"!=v.level_status?50:0:100} % Complete</span>\n                            </div>\n                            <p>${"pending"==v.status?"pending"!=v.level_status?50:0:100}%</p>\n                        </div>\n                        ${getApproverLisiting(v.history)}\n                    </td>`,rows+=`\n                        <td>\n                          <p class="">${ucwords(v.reason)}</p>\n                        </td>\n                    `,rows+=`\n                        <td>\n                          <p class="">${moment(v.created_at).format(timeoffDateFormatWithTime)}</p>\n                        </td>\n                    `,rows+="</tr>"}),ml(!1,"jsViewTimeOffModalLoader"),$("#jsViewTimeOffModalTable").html(rows),$(".csApproverBox").popover({html:!0,trigger:"hover",placement:"left"})})})),$(document).on("click",".jsRemainingTimeOffBTN",(function(e){e.preventDefault(),Modal({Id:"jsViewTimeOffModal",Loader:"jsViewTimeOffModalLoader",Title:`Time-offs requested for the year ${moment().format("YYYY")}`,Body:' \n                <div class="tabel-responsive">\n                    <div id="jsData"></div>\n                    <table class="table table-striped csCustomTableHeader">\n                        <thead>\n                            <tr>\n                                <th>Policy</th>\n                                <th>Status</th>\n                                <th>Progress</th>\n                                <th>Reason</th>\n                                <th>Requested On</th>\n                            </tr>\n                        </thead>\n                        <tbody id="jsViewTimeOffModalTable"></tbody>\n                    </table>\n                </div>\n            '},async()=>{const requests=await employeeRequests("pending",$(this).closest(".csCard").data("id"));if(0==requests.Data.length)return ml(!1,"jsViewTimeOffModalLoader"),void $("#jsViewTimeOffModalTable").html('<tr><td colspan="5"><p class="alert alert-info text-center">No time-off requests found.</p></td></tr>');let rows="";requests.Data.map(v=>{rows+=`\n                    <tr>\n                        <td> \n                            <div class="upcoming-time-info">            \n                                <div class="icon-image">                   \n                                    <img src="${baseURL}assets/images/upcoming-time-off-icon.png" class="emp-image" alt="emp-1" />             \n                                </div>             \n                                <div class="text">                  \n                                    <h4>${v.request_from_date==v.request_to_date?moment(v.request_from_date).format(timeoffDateFormat):moment(v.request_from_date).format(timeoffDateFormat)+" - "+moment(v.request_to_date).format(timeoffDateFormat)}</h4>                  \n                                    <span>${v.title}</span><br />          \n                                    <span>${v.breakdown.text}</span>          \n                                </div>       \n                            </div>\n                        </td>`,rows+=`\n                        <td>\n                          <p class="">${ucwords(v.status)}</p>\n                        </td>\n                    `,rows+=`\n                    <td>\n                        <div class="progress" style="margin-top: 10px;">\n                            <div class="progress-bar progress-bar-success" role="progressbar" style="width: ${"pending"==v.status?"pending"!=v.level_status?50:0:100}%;">\n                                <span class="sr-only"> ${"pending"==v.status?"pending"!=v.level_status?50:0:100} % Complete</span>\n                            </div>\n                            <p>${"pending"==v.status?"pending"!=v.level_status?50:0:100}%</p>\n                        </div>\n                        ${getApproverLisiting(v.history)}\n                    </td>`,rows+=`\n                        <td>\n                          <p class="">${ucwords(v.reason)}</p>\n                        </td>\n                    `,rows+=`\n                        <td>\n                          <p class="">${moment(v.created_at).format(timeoffDateFormatWithTime)}</p>\n                        </td>\n                    `,rows+="</tr>"}),ml(!1,"jsViewTimeOffModalLoader"),$("#jsViewTimeOffModalTable").html(rows),$(".csApproverBox").popover({html:!0,trigger:"hover",placement:"left"})})})),$(document).on("click",".jsShowTime",(function(e){e.preventDefault();let policy=getPolicy($(this).closest(".csCard").data("id"),window.timeoff.employeePolicies);Modal({Id:"jsViewTimeModal",Loader:"jsViewTimeModalLoader",Title:`Time for ${policy.Title}`,Body:' \n                <div class="tabel-responsive">\n                    <table class="table table-striped csCustomTableHeader">\n                        <tbody id="jsViewTimeModalTable"></tbody>\n                    </table>\n                </div>\n            '},async()=>{if(0===policy.Plans.length)return $("#jsViewTimeModalTable").html('<tr><td><p class="alert alert-info">No time is available to use</p></td></tr>'),void ml(!1,"jsViewTimeModalLoader");let rows="";policy.Plans.map(pl=>{rows+=`<tr><td>${pl.time} will be available on ${moment(pl.date,"YYYY-MM-DD").format(timeoffDateFormat)}</td></tr>`}),$("#jsViewTimeModalTable").html(rows),ml(!1,"jsViewTimeModalLoader")})}))}));