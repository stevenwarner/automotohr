$((function(){let callOBJ={CompanyApprovers:{Main:{action:"get_approvers_by_company",companyId:companyId,employerId:employerId,employeeId:employeeId,filter:{archived:0,employees:"all",departments:[],teams:[],startDate:"",endDate:"",status:""},public:0,page:1},cb:fetchCompanyApprovers,limit:0,count:0,pages:0},ApproverHistory:{Main:{action:"get_approver_history",companyId:companyId,employerId:employerId,employeeId:employeeId,public:0}}},xhr=null;function resetFilter(e){e.preventDefault(),$("#js-filter-employee").select2("val","all"),$("#js-filter-departments").select2("val","-1"),$("#js-filter-teams").select2("val","-1"),$("#js-filter-from-date").val(""),$("#js-filter-to-date").val(""),$('#js-filter-status option[value="-1"]').prop("selected",!0),callOBJ.CompanyApprovers.Main.filter.employees="all",callOBJ.CompanyApprovers.Main.filter.departments=[],callOBJ.CompanyApprovers.Main.filter.teams=[],callOBJ.CompanyApprovers.Main.filter.startDate="",callOBJ.CompanyApprovers.Main.filter.endDate="",callOBJ.CompanyApprovers.Main.filter.status="-1",callOBJ.CompanyApprovers.Main.filter.archived=0,callOBJ.CompanyApprovers.Main.page=1,callOBJ.CompanyApprovers.Main.limit=0,callOBJ.CompanyApprovers.Main.count=0,$('.js-tab[data-type="active"]').click()}function applyFilter(e){e.preventDefault(),callOBJ.CompanyApprovers.Main.filter.employees=$("#js-filter-employee").val(),callOBJ.CompanyApprovers.Main.filter.departments=$("#js-filter-departments").val(),callOBJ.CompanyApprovers.Main.filter.teams=$("#js-filter-teams").val(),callOBJ.CompanyApprovers.Main.filter.startDate=$("#js-filter-from-date").val(),callOBJ.CompanyApprovers.Main.filter.endDate=$("#js-filter-to-date").val(),callOBJ.CompanyApprovers.Main.filter.status=$("#js-filter-status").val(),callOBJ.CompanyApprovers.Main.page=1,callOBJ.CompanyApprovers.Main.limit=0,callOBJ.CompanyApprovers.Main.count=0,fetchCompanyApprovers()}function fetchCompanyApprovers(){void 0!==window.timeoff.employees?null==xhr&&(ml(!0,"approver"),$(".js-error-row").remove(),xhr=$.post(handlerURL,callOBJ.CompanyApprovers.Main,(function(resp){if(xhr=null,!0!==resp.Redirect){if(!1===resp.Status&&1==callOBJ.CompanyApprovers.Main.page)return $(".js-ip-pagination").html(""),$("#js-data-area").html(`<tr class="js-error-row"><td colspan="${$(".js-table-head").find("th").length}"><p class="alert alert-info text-center">${resp.Response}</p></td></tr>`),void ml(!1,"approver");if(!1===resp.Status)return $(".js-ip-pagination").html(""),void ml(!1,"approver");1==callOBJ.CompanyApprovers.Main.page&&(callOBJ.CompanyApprovers.limit=resp.Limit,callOBJ.CompanyApprovers.count=resp.TotalRecords,callOBJ.CompanyApprovers.pages=resp.TotalPages),setTable(resp)}else alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()})}))):setTimeout(()=>{fetchCompanyApprovers()},1e3)}function setTable(resp){oldState={};let rows="";0!=resp.Data.length&&($.each(resp.Data,(function(i,v){rows+=getApproverBox(v)})),load_pagination(callOBJ.CompanyApprovers.limit,5,$(".js-ip-pagination"),"CompanyApprovers"),$(".csLisitingArea").html(rows),$(".jsTooltip").tooltip({placement:"top"}),ml(!1,"approver"))}function getHistoryTemplate(){let html;return'\n            <div class="tabel-responsive">\n                <table class="table table-striped csCustomTableHeader">\n                    <thead>\n                        <tr>\n                            <th>Employee</th>\n                            <th>Action</th>\n                            <th>Action Taken</th>\n                        </tr>\n                    </thead>\n                    <tbody id="jsApproverHistoryTable"></tbody>\n                </table>\n            </div>\n        '}function fetchApproverHistory(approverId){ml(!0,"jsApproverHistoryLoader"),$("#jsApproverHistoryTable").html(""),xhr=$.post(handlerURL,Object.assign(callOBJ.ApproverHistory.Main,{approverId:approverId}),resp=>{if(xhr=null,!0===resp.Redirect)return void alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()});if(!1===resp.Status)return alertify.alert("WARNING!",resp.Response,()=>{}),void ml(!1,"jsApproverHistoryLoader");let rows="";0===resp.Data.length?rows=`\n                    <tr>\n                        <td colspan="3">\n                            <p class="alert alert-info text-center">${resp.Response}</p>\n                        </td>\n                    </tr>\n                `:resp.Data.map(v=>{rows+=`\n                        <tr>\n                            <td>${remakeEmployeeName(v)}</td>\n                            <td>${v.action.toUpperCase()}</td>\n                            <td>${moment(v.created_at).format(timeoffDateFormatWithTime)}</td>\n                        </tr>\n                    `}),$("#jsApproverHistoryTable").html(rows),ml(!1,"jsApproverHistoryLoader")})}function getApproverBox(v,userRow){let title=0!=callOBJ.CompanyApprovers.Main.filter.archived?"Activate approver":"Deactivate approver",icon=0!=callOBJ.CompanyApprovers.Main.filter.archived?"fa-check-square-o":"fa-archive",cl=0!=callOBJ.CompanyApprovers.Main.filter.archived?"js-activate-btn":"js-archive-btn";return`\n        <div class="col-sm-3">\n            <div class="csBox csShadow csRadius5 mt10 jsBox" data-id="${v.approver_id}" data-name="${v.first_name} ${v.last_name}">\n                \x3c!-- Box Header --\x3e\n                <div class="csBoxHeader csRadius5 csRadiusBL0 csRadiusBR0">\n                    <span class="pull-right">\n                        <span class="csCircleBtn csRadius50 jsTooltip js-edit-row-btn" title="Edit history"\n                            placement="top"><i class="fa fa-pencil"></i></span>\n                        <span class="csCircleBtn csRadius50 jsTooltip jsApproverHistory" title="View history"\n                            placement="top"><i class="fa fa-history"></i></span>\n                    </span>\n                    <div class="clearfix"></div>\n                </div>\n                \x3c!-- Box Content --\x3e\n                <div class="csBoxContent">\n                    \x3c!-- Section 1 --\x3e\n                    <div class="csBoxContentEmpployeeSection">\n                        <a href="${baseURL}employee_profile/${v.employee_id}" target="_blank">\n                            <div class="col-sm-2">\n                                <img src="${getImageURL(v.img)}" class="csRoundImg" />\n                            </div>\n                            <div class="col-sm-10 pr0">\n                                <p><strong>${v.first_name} ${v.last_name}</strong> <br />\n                                    ${remakeEmployeeName(v,!1)}</p>\n                            </div>\n                        </a>\n                        <div class="clearfix"></div>\n                    </div>\n                    \x3c!-- Section 2 --\x3e\n                    <div class="csBoxBalanceSection">\n                        <div class="col-sm-12">\n                            <p class="${1==v.approver_percentage?"csTxtSuccess":"csTxtDanger"}"><strong>${1==v.approver_percentage?"Yes":"No"}</strong></p>\n                            <p>Can Approver</p>\n                        </div>\n                        <div class="clearfix"></div>\n                    </div>\n                    \x3c!-- Section 2 --\x3e\n                    <div class="csBoxBalanceSection">\n                        <div class="col-sm-12">\n                            <p><strong>${1==v.is_department?null==v.department_name?"All Departments":ucwords(v.department_name):null==v.team_name?"All Teams":ucwords(v.team_name)}</strong></p>\n                            <p>Department / Teams</p>\n                        </div>\n                        <div class="clearfix"></div>\n                    </div>\n                    \x3c!-- Section 3 --\x3e\n                    <div class="csBoxBalanceSection">\n                        <div class="col-sm-12">\n                            <p><strong>${moment(v.created_at,"YYYY-MM-DD H:i:s").format(timeoffDateFormatWithTime)}</strong></p>\n                            <p>Created On</p>\n                        </div>\n                        <div class="clearfix"></div>\n                    </div>\n                </div>\n                \x3c!-- Box Footer --\x3e\n                <div class="csBoxFooter">\n                    <button class="btn btn-orange form-control ${cl}">\n                        <i class="fa ${icon}"></i> ${title}\n                    </button>\n                </div>\n            </div>\n\n        </div>\n        `}window.timeoff.PaginationOBJ.CompanyApprovers=callOBJ.CompanyApprovers,window.timeoff.fetchCompanyApprovers=fetchCompanyApprovers,""!=page&&"view"!=page||fetchCompanyApprovers(),$("#js-filter-from-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0,onSelect:function(v){$("#js-filter-to-date").datepicker("option","minDate",v)}}),$("#js-filter-to-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0}).datepicker("option","minDate",$("#js-filter-from-date").val()),$(".js-tab").click((function(){callOBJ.CompanyApprovers.Main.filter.archived="archived"===$(this).data("type")?1:0,$(".js-tab").parent().removeClass("active"),$(this).parent().addClass("active"),fetchCompanyApprovers()})),$(document).on("click",".js-apply-filter-btn",applyFilter),$(document).on("click",".js-reset-filter-btn",resetFilter),$(document).on("click",".js-archive-btn",(function(e){e.preventDefault();var _this=$(this);alertify.confirm("Do you really want to deactivate this approver?",(function(){var post={action:"archive_company_approver"};post.companyId=companyId,post.employeeId=employeeId,post.employerId=employerId,post.public=0,post.approverId=_this.closest(".jsBox").data("id"),ml(!0,"approver"),$.post(handlerURL,post,(function(resp){ml(!1,"approver"),!0!==resp.Redirect?!1!==resp.Status?alertify.alert("SUCCESS!",resp.Response,(function(){loadViewPage()})):alertify.alert("WARNING!",resp.Response,(function(){})):alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()})}))})).set("labels",{ok:"YES",cancel:"NO"}).setHeader("CONFIRM!")})),$(document).on("click",".js-activate-btn",(function(e){e.preventDefault();var _this=$(this);alertify.confirm("Do you really want to activate this approver?",(function(){var post={action:"activate_company_approver"};post.companyId=companyId,post.employeeId=employeeId,post.employerId=employerId,post.public=0,post.approverId=_this.closest(".jsBox").data("id"),ml(!0,"approver"),$.post(handlerURL,post,(function(resp){ml(!1,"approver"),!0!==resp.Redirect?!1!==resp.Status?alertify.alert("SUCCESS!",resp.Response,(function(){loadViewPage()})):alertify.alert("WARNING!",resp.Response,(function(){})):alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()})}))})).set("labels",{ok:"YES",cancel:"NO"}).setHeader("CONFIRM!")})),$(document).on("click",".jsApproverHistory",(function(){Modal({Id:1,Title:`Approver History for ${$(this).closest(".jsBox").data("name")}`,Body:getHistoryTemplate(),Loader:"jsApproverHistoryLoader"},()=>{fetchApproverHistory($(this).closest(".jsBox").data("id"))})}))}));