$((function(){let callOBJ={CompanyTypes:{Main:{action:"get_types_by_company",companyId:companyId,employerId:employerId,employeeId:employeeId,filter:{archived:0,type:"",startDate:"",endDate:"",status:""},public:0,page:1},cb:fetchCompanyTypes,limit:0,count:0,pages:0},TypeSort:{Main:{action:"update_sort_order",companyId:companyId,employerId:employerId,employeeId:employeeId,public:0}},TypeHistory:{Main:{action:"get_type_history",companyId:companyId,employerId:employerId,employeeId:employeeId,public:0}}},oldState={},xhr=null;function resetFilter(e){e.preventDefault(),$("#js-filter-types").select2("val","-1"),$("#js-filter-from-date").val(""),$("#js-filter-to-date").val(""),$('#js-filter-status option[value="-1"]').prop("selected",!0),callOBJ.CompanyTypes.Main.filter.type="-1",callOBJ.CompanyTypes.Main.filter.startDate="",callOBJ.CompanyTypes.Main.filter.endDate="",callOBJ.CompanyTypes.Main.filter.status="-1",callOBJ.CompanyTypes.Main.filter.archived=0,callOBJ.CompanyTypes.Main.page=1,callOBJ.CompanyTypes.Main.limit=0,callOBJ.CompanyTypes.Main.count=0,fetchCompanyTypes()}function applyFilter(e){e.preventDefault(),callOBJ.CompanyTypes.Main.filter.type=$("#js-filter-types").val(),callOBJ.CompanyTypes.Main.filter.startDate=$("#js-filter-from-date").val(),callOBJ.CompanyTypes.Main.filter.endDate=$("#js-filter-to-date").val(),callOBJ.CompanyTypes.Main.filter.status=$("#js-filter-status").val(),callOBJ.CompanyTypes.Main.page=1,callOBJ.CompanyTypes.Main.limit=0,callOBJ.CompanyTypes.Main.count=0,fetchCompanyTypes()}function fetchCompanyTypes(){null==xhr&&(ml(!0,"type"),$(".js-error-row").remove(),xhr=$.post(handlerURL,callOBJ.CompanyTypes.Main,(function(resp){if(xhr=null,!0!==resp.Redirect){if(!1===resp.Status&&1==callOBJ.CompanyTypes.Main.page)return $(".js-ip-pagination").html(""),$(".csLisitingArea").html(`<p class="alert alert-info text-center">${resp.Response}</p>`),void ml(!1,"type");if(!1===resp.Status)return $(".js-ip-pagination").html(""),void ml(!1,"type");1==callOBJ.CompanyTypes.Main.page&&(callOBJ.CompanyTypes.limit=resp.Limit,callOBJ.CompanyTypes.count=resp.TotalRecords,callOBJ.CompanyTypes.pages=resp.TotalPages),setTable(resp)}else alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()})})))}function setTable(resp){oldState={};let rows="";if(0==resp.Data.length)return ml(!1,"type"),void $(".csLisitingArea").html(`<p class="alert alert-info text-center">${resp.Response}</p>`);$.each(resp.Data,(function(i,v){oldState[v.type_sid]=i,rows+=getTypeBox(v)})),load_pagination(callOBJ.CompanyTypes.limit,5,$(".js-ip-pagination"),"CompanyTypes"),$(".csLisitingArea").html(rows),$(".jsTooltip").tooltip({placement:"top"}),callDrager(".csLisitingArea"),ml(!1,"type")}function callDrager(target){$(target).sortable({placeholder:"ui-state-highlight"}),$(target).disableSelection()}function callSort(){for(var i=0,s={},l=$(".csLisitingArea").find(".jsBox").length;i<l;i++)s[$(".csLisitingArea").find(".jsBox:eq("+i+")").data("id")]=i;updateSortInDb(s)}function updateSortInDb(s){let o=Object.assign({},callOBJ.TypeSort.Main,{sort:s,type:"categories"});$.post(handlerURL,o,resp=>{ml(!1,"type")})}function getHistoryTemplate(){let html;return'\n            <div class="tabel-responsive">\n                <table class="table table-striped csCustomTableHeader">\n                    <thead>\n                        <tr>\n                            <th>Employee</th>\n                            <th>Action</th>\n                            <th>Action Taken</th>\n                        </tr>\n                    </thead>\n                    <tbody id="jsTypeHistoryTable"></tbody>\n                </table>\n            </div>\n        '}function fetchTypeyHistory(typeId){ml(!0,"jsTypeHistoryLoader"),$("#jsTypeHistoryTable").html(""),xhr=$.post(handlerURL,Object.assign(callOBJ.TypeHistory.Main,{typeId:typeId}),resp=>{if(xhr=null,!0===resp.Redirect)return void alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()});if(!1===resp.Status)return alertify.alert("WARNING!",resp.Response,()=>{}),void ml(!1,"jsTypeHistoryLoader");let rows="";0===resp.Data.length?rows=`\n                    <tr>\n                        <td colspan="3">\n                            <p class="alert alert-info text-center">${resp.Response}</p>\n                        </td>\n                    </tr>\n                `:resp.Data.map(v=>{rows+=`\n                        <tr>\n                            <td>${remakeEmployeeName(v)}</td>\n                            <td>${v.action.toUpperCase()}</td>\n                            <td>${moment(v.created_at).format(timeoffDateFormatWithTime)}</td>\n                        </tr>\n                    `}),$("#jsTypeHistoryTable").html(rows),ml(!1,"jsTypeHistoryLoader")})}function getTypeBox(v){let title=0!=callOBJ.CompanyTypes.Main.filter.archived?"Activate Type":"Deactivate type",icon=0!=callOBJ.CompanyTypes.Main.filter.archived?"fa-check-square-o":"fa-archive",cl=0!=callOBJ.CompanyTypes.Main.filter.archived?"js-activate-btn":"js-archive-btn";return`\n        <div class="col-sm-3">\n            <div class="csBox csShadow csRadius5 csHShort mt10 jsBox" data-id="${v.type_sid}" data-name="${v.type_title}">\n                \x3c!-- Box Header --\x3e\n                <div class="csBoxHeader csRadius5 csRadiusBL0 csRadiusBR0">\n                    <span class="pull-right">\n                        <span class="csCircleBtn csRadius50 jsTooltip js-edit-row-btn" title="Edit history" placement="top"><i\n                                class="fa fa-pencil"></i></span>\n                        <span class="csCircleBtn csRadius50 jsTooltip jsTypeHistory" title="View history"\n                            placement="top"><i class="fa fa-history"></i></span>\n                    </span>\n                    <div class="clearfix"></div>\n                </div>\n                \x3c!-- Box Content --\x3e\n                <div class="csBoxContent">\n                    \x3c!-- Section 1 --\x3e\n                    <div class="csBoxContentDateSection pt10 pb10">\n                        <div class="col-sm-12">\n                            <h3>${ucwords(v.type_title)}</h3>\n                        </div>\n                        <div class="clearfix"></div>\n                    </div>\n                    \x3c!-- Section 3 --\x3e\n                    <div class="csBoxBalanceSection">\n                        <div class="col-sm-12">\n                            <p><strong>${null!==v.policies?v.policies.join(", "):"-"}</strong></p>\n                            <p>Policies</p>\n                        </div>\n                        <div class="clearfix"></div>\n                    </div>\n                    \x3c!-- Section 2 --\x3e\n                    <div class="csBoxBalanceSection">\n                        <div class="col-sm-12">\n                            <p><strong>${moment(v.created_at,"").format(timeoffDateFormatWithTime)}</strong></p>\n                            <p>Created On</p>\n                        </div>\n                        <div class="clearfix"></div>\n                    </div>\n                </div>\n                \x3c!-- Box Footer --\x3e\n                <div class="csBoxFooter">\n                <button class="btn btn-orange btn-lg form-control ${cl}">\n                    <i class="fa ${icon}"></i> ${title}\n                </button>\n                </div>\n            </div>\n\n        </div>\n        `}window.timeoff.PaginationOBJ.CompanyTypes=callOBJ.CompanyTypes,window.timeoff.fetchCompanyTypes=fetchCompanyTypes,""!=page&&"view"!=page||fetchCompanyTypes(),$("#js-filter-from-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0,onSelect:function(v){$("#js-filter-to-date").datepicker("option","minDate",v)}}),$("#js-filter-to-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0}).datepicker("option","minDate",$("#js-filter-from-date").val()),$(".js-tab").click((function(){callOBJ.CompanyTypes.Main.filter.archived="archived"===$(this).data("type")?1:0,$(".js-tab").parent().removeClass("active"),$(this).parent().addClass("active"),fetchCompanyTypes()})),$(document).on("click",".js-apply-filter-btn",applyFilter),$(document).on("click",".js-reset-filter-btn",resetFilter),$(".csLisitingArea").on("sortstop",callSort),$(document).on("click",".js-archive-btn",(function(e){e.preventDefault();var _this=$(this);alertify.confirm("Do you really want to deactivate this type?",(function(){var post={action:"archive_company_type"};post.companyId=companyId,post.employeeId=employeeId,post.employerId=employerId,post.public=0,post.typeId=_this.closest(".jsBox").data("id"),ml(!0,"type"),$.post(handlerURL,post,(function(resp){ml(!1,"type"),!0!==resp.Redirect?!1!==resp.Status?alertify.alert("SUCCESS!",resp.Response,(function(){loadViewPage()})):alertify.alert("WARNING!",resp.Response,(function(){})):alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()})}))})).set("labels",{ok:"YES",cancel:"NO"}).setHeader("CONFIRM!")})),$(document).on("click",".js-activate-btn",(function(e){e.preventDefault();var _this=$(this);alertify.confirm("Do you really want to activate this type?",(function(){var post={action:"activate_company_type"};post.companyId=companyId,post.employeeId=employeeId,post.employerId=employerId,post.public=0,post.typeId=_this.closest(".jsBox").data("id"),ml(!0,"type"),$.post(handlerURL,post,(function(resp){ml(!1,"type"),!0!==resp.Redirect?!1!==resp.Status?alertify.alert("SUCCESS!",resp.Response,(function(){loadViewPage()})):alertify.alert("WARNING!",resp.Response,(function(){})):alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()})}))})).set("labels",{ok:"YES",cancel:"NO"}).setHeader("CONFIRM!")})),$(document).on("click",".jsTypeHistory",(function(){Modal({Id:1,Title:`Type History for ${$(this).closest(".jsBox").data("name")}`,Body:getHistoryTemplate(),Loader:"jsTypeHistoryLoader"},()=>{fetchTypeyHistory($(this).closest(".jsBox").data("id"))})}))}));