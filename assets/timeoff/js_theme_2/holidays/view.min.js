$((function(){let callOBJ={CompanyHolidays:{Main:{action:"get_holidays_by_company",companyId:companyId,employerId:employerId,employeeId:employeeId,filter:{archived:0,years:moment().format("YYYY")},public:0,page:1},cb:fetchCompanyHolidays,limit:0,count:0,pages:0},HolidayHistory:{Main:{action:"get_holiday_history",companyId:companyId,employerId:employerId,employeeId:employeeId,public:0}}},xhr=null;function resetFilter(e){e.preventDefault(),$('#js-filter-years option[value="'+moment().format("YYYY")+'"]').prop("selected",!0),callOBJ.CompanyHolidays.Main.filter.years=moment().format("YYYY"),callOBJ.CompanyHolidays.Main.filter.archived=0,callOBJ.CompanyHolidays.Main.page=1,callOBJ.CompanyHolidays.Main.limit=0,callOBJ.CompanyHolidays.Main.count=0,$(".js-tab[data-type='active']").click()}function applyFilter(e){e.preventDefault(),callOBJ.CompanyHolidays.Main.filter.years=$("#js-filter-year").val(),callOBJ.CompanyHolidays.Main.page=1,callOBJ.CompanyHolidays.Main.limit=0,callOBJ.CompanyHolidays.Main.count=0,fetchCompanyHolidays()}function fetchCompanyHolidays(){null==xhr&&(ml(!0,"holiday"),$(".js-error-row").remove(),xhr=$.post(handlerURL,callOBJ.CompanyHolidays.Main,(function(resp){if(xhr=null,!0!==resp.Redirect){if(!1===resp.Status&&1==callOBJ.CompanyHolidays.Main.page)return $(".js-ip-pagination").html(""),$(".csLisitingArea").html(`<p class="alert alert-info text-center">${resp.Response}</p>`),void ml(!1,"holiday");if(!1===resp.Status)return $(".js-ip-pagination").html(""),void ml(!1,"holiday");1==callOBJ.CompanyHolidays.Main.page&&(callOBJ.CompanyHolidays.limit=resp.Limit,callOBJ.CompanyHolidays.count=resp.TotalRecords,callOBJ.CompanyHolidays.pages=resp.TotalPages),setTable(resp)}else alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()})})))}function setTable(resp){oldState={};let rows="";0!=resp.Data.length&&($.each(resp.Data,(function(i,v){let d1=moment(v.from_date,"YYYY-MM-DD"),d2=moment(v.to_date,"YYYY-MM-DD");rows+=getHolidayBox(v,d1,d2)})),load_pagination(callOBJ.CompanyHolidays.limit,5,$(".js-ip-pagination"),"CompanyHolidays"),$(".csLisitingArea").html(rows),$(".csLisitingArea").prepend("<br />"),$(".csLisitingArea").append('<div class="clearfix"></div>'),ml(!1,"holiday"),$(".jsTooltip").tooltip())}function getHolidayTemplate(){let html;return'\n            <div class="tabel-responsive">\n                <table class="table table-striped csCustomTableHeader">\n                    <thead>\n                        <tr>\n                            <th>Employee</th>\n                            <th>Action</th>\n                            <th>Action Taken</th>\n                        </tr>\n                    </thead>\n                    <tbody id="jsHolidayHistoryTable"></tbody>\n                </table>\n            </div>\n        '}function fetchHolidayHistory(holidayId){ml(!0,"jsHolidayHistoryLoader"),$("#jsHolidayHistoryTable").html(""),xhr=$.post(handlerURL,Object.assign(callOBJ.HolidayHistory.Main,{holidayId:holidayId}),resp=>{if(xhr=null,!0===resp.Redirect)return void alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()});if(!1===resp.Status)return alertify.alert("WARNING!",resp.Response,()=>{}),void ml(!1,"jsHolidayHistoryLoader");let rows="";0===resp.Data.length?rows=`\n                    <tr>\n                        <td colspan="3">\n                            <p class="alert alert-info text-center">${resp.Response}</p>\n                        </td>\n                    </tr>\n                `:resp.Data.map(v=>{rows+=`\n                        <tr>\n                            <td>${remakeEmployeeName(v)}</td>\n                            <td>${v.action.toUpperCase()}</td>\n                            <td>${moment(v.created_at).format(timeoffDateFormatWithTime)}</td>\n                        </tr>\n                    `}),$("#jsHolidayHistoryTable").html(rows),ml(!1,"jsHolidayHistoryLoader")})}function getHolidayBox(v,d1,d2){let title=0!=callOBJ.CompanyHolidays.Main.filter.archived?"Activate Holiday":"Deactivate Holiday",icon=0!=callOBJ.CompanyHolidays.Main.filter.archived?"fa-check-square-o":"fa-archive",cl=0!=callOBJ.CompanyHolidays.Main.filter.archived?"js-activate-btn":"js-archive-btn";return`\n                <div class="col-sm-3">\n                    <div class="csBox csShadow csRadius5 csHShort mt10 jsBox" data-id="${v.sid}" data-name="${v.holiday_title}">\n                        \x3c!-- Box Header --\x3e\n                        <div class="csBoxHeader csRadius5 csRadiusBL0 csRadiusBR0">\n                            <span class="pull-right">\n                                <span class="csCircleBtn csRadius50 jsTooltip js-edit-row-btn" title="Edit history" placement="top"><i\n                                        class="fa fa-pencil"></i></span>\n                                <span class="csCircleBtn csRadius50 jsTooltip jsHolidayHistory" title="View history"\n                                    placement="top"><i class="fa fa-history"></i></span>\n                            </span>\n                            <div class="clearfix"></div>\n                        </div>\n                        \x3c!-- Box Content --\x3e\n                        <div class="csBoxContent">\n                            \x3c!-- Section 1 --\x3e\n                            <div class="csBoxContentDateSection pt10 pb10">\n                                <div class="col-sm-5">\n                                    <h3>${d1.format(timeoffDateFormatB)}</h3>\n                                    <p>${d1.format(timeoffDateFormatBD)}</p>\n                                </div>\n                                <div class="col-sm-2 pl0 pr0">\n                                    <strong class="text-center">\n                                        <i class="fa fa-long-arrow-right"></i>\n                                    </strong>\n                                </div>\n                                <div class="col-sm-5">\n                                    <h3>${d2.format(timeoffDateFormatB)}</h3>\n                                    <p>${d2.format(timeoffDateFormatBD)}</p>\n                                </div>\n                                <div class="clearfix"></div>\n                            </div>\n                            \x3c!-- Section 2 --\x3e\n                            <div class="csBoxContentHolidaySection">\n                                <div class="col-sm-12">\n                                    <p>\n                                        <strong>${ucwords(v.holiday_title)}</strong> \n                                        <span class="pull-right">${""!=v.icon&&null!==v.icon&&0!=v.icon?`<img style="padding: 0; height: 30px;" src="${baseURL}assets/images/holidays/${v.icon}" />`:""}\n                                        </span>\n                                    </p>\n                                </div>\n                                <div class="clearfix"></div>\n                            </div>\n                            \x3c!-- Section 3 --\x3e\n                            <div class="csBoxBalanceSection">\n                                <div class="col-sm-12">\n                                    <p><strong>${v.holiday_year}</strong></p>\n                                    <p>Year</p>\n                                </div>\n                                <div class="clearfix"></div>\n                            </div>\n                            \x3c!-- Section 4 --\x3e\n                            <div class="csBoxBalanceSection">\n                                <div class="col-sm-12">\n                                    <p><strong>${moment(v.created_at,"").format(timeoffDateFormatWithTime)}</strong></p>\n                                    <p>Created On</p>\n                                </div>\n                                <div class="clearfix"></div>\n                            </div>\n                        </div>\n                        \x3c!-- Box Footer --\x3e\n                        <div class="csBoxFooter">\n                        <button class="btn btn-orange form-control ${cl}">\n                            <i class="fa ${icon}"></i> ${title}\n                        </button>\n                        </div>\n                    </div>\n\n                </div>\n                `}window.timeoff.PaginationOBJ.CompanyHolidays=callOBJ.CompanyHolidays,window.timeoff.fetchCompanyHolidays=fetchCompanyHolidays,""!=page&&"view"!=page||fetchCompanyHolidays(),$("#js-filter-from-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0,onSelect:function(v){$("#js-filter-to-date").datepicker("option","minDate",v)}}),$("#js-filter-to-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0}).datepicker("option","minDate",$("#js-filter-from-date").val()),$(".js-tab").click((function(){callOBJ.CompanyHolidays.Main.filter.archived="archived"===$(this).data("type")?1:0,$(".js-tab").parent().removeClass("active"),$(this).parent().addClass("active"),fetchCompanyHolidays()})),$(document).on("click",".js-apply-filter-btn",applyFilter),$(document).on("click",".js-reset-filter-btn",resetFilter),$(document).on("click",".js-archive-btn",(function(e){e.preventDefault();var _this=$(this);alertify.confirm("Do you really want to deactivate this holiday?",(function(){var post={action:"archive_company_holiday"};post.companyId=companyId,post.employeeId=employeeId,post.employerId=employerId,post.public=0,post.holidayId=_this.closest(".jsBox").data("id"),ml(!0,"holiday"),$.post(handlerURL,post,(function(resp){ml(!1,"holiday"),!0!==resp.Redirect?!1!==resp.Status?alertify.alert("SUCCESS!",resp.Response,(function(){loadViewPage()})):alertify.alert("WARNING!",resp.Response,(function(){})):alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()})}))})).set("labels",{ok:"YES",cancel:"NO"}).setHeader("CONFIRM!")})),$(document).on("click",".js-activate-btn",(function(e){e.preventDefault();var _this=$(this);alertify.confirm("Do you really want to activate this holiday?",(function(){var post={action:"activate_company_holiday"};post.companyId=companyId,post.employeeId=employeeId,post.employerId=employerId,post.public=0,post.holidayId=_this.closest(".jsBox").data("id"),ml(!0,"holiday"),$.post(handlerURL,post,(function(resp){ml(!1,"holiday"),!0!==resp.Redirect?!1!==resp.Status?alertify.alert("SUCCESS!",resp.Response,(function(){loadViewPage()})):alertify.alert("WARNING!",resp.Response,(function(){})):alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()})}))})).set("labels",{ok:"YES",cancel:"NO"}).setHeader("CONFIRM!")})),$(document).on("click",".jsHolidayHistory",(function(){Modal({Id:1,Title:`Holiday History for ${$(this).closest(".jsBox").data("name")}`,Body:getHolidayTemplate(),Loader:"jsHolidayHistoryLoader"},()=>{fetchHolidayHistory($(this).closest(".jsBox").data("id"))})}))}));