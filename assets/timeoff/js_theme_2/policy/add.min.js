$(function(){function e(e){return 1===e?(t.policyCategory=getField("#js-policy-type-add"),t.type=getField("#js-category-add"),0==t.type?(alertify.alert("WARNING!","Please, select the policy type.",()=>{}),!1):(t.title=getField("#js-policy-title-add"),0==t.title?(alertify.alert("WARNING!","Please, add the policy title.",()=>{}),!1):(t.order=getField("#js-sort-order-add"),t.entitledEmployees=getField("#js-employee-add"),t.approver=!0===$("#js-approver-check-add").prop("checked")?1:0,t.approverList=[],1==t.approver&&(t.approverList=getField("#js-approvers-list-add")||[]),t.deactivate=!0===$("#js-archive-check-add").prop("checked")?1:0,t.include=!0===$("#js-include-check-add").prop("checked")?1:0,t.isESST=!0===$("#js-is-esst-add").prop("checked")?1:0,t.isESTA=!0===$("#js-is-esta-add").prop("checked")?1:0,t.isEntitledEmployees=$(".jsIsEntitledEmployee:checked").val(),t.employeeTypes=$("#js-employee-type-add").val(),t.offDays=getField("#js-off-days-add"),null==t.employeeTypes?(alertify.alert("WARNING!","Please, add the employee type.",()=>{}),!1):(saveStep(t),!0)))):2===e?(t.method="hours_per_month",t.time=getField("#js-accrual-time-add"),t.frequency=getField("#js-accrual-frequency-add"),t.frequencyVal=getField("#js-accrual-frequency-val-add"),t.rate=getField("#js-accrual-rate-add"),t.rateType=getField("#js-accrual-rate-type-add option:selected"),t.applicableTimeType=getField(".js-minimum-applicable-time-add:checked"),t.applicableTime=getField("#js-minimum-applicable-hours-add"),t.plans=getAccrualPlans("add"),t.accuralDefaultFlow=!0===$("#js-accrual-default-flow-add").prop("checked")?1:0,!0===t.plans?(alertify.alert("WARNING!","Please, add the proper plans.",()=>{}),!1):(saveStep(t),!0)):3===e?(t.carryOverCheck=getField("#js-carryover-cap-check-add"),t.carryOverVal=getField("#js-carryover-cap-add"),t.carryOverType=getField("#js-accrual-carryover-type option:selected"),t.carryOverCycle=getField("#js-carryover-cycle-add"),saveStep(t),!0):4===e?(t.negativeBalanceCheck=getField("#js-accrual-balance-add"),t.negativeBalanceVal=getField("#js-maximum-balance-add"),t.newHireTimeType=getField("#js-accrual-negative-balance-type option:selected"),saveStep(t),!0):5===e?(t.applicableDateType=getField(".js-hire-date-add:checked"),t.applicableDate=getField("#js-custom-date-add"),"hiredate"!=t.applicableDateType.toLowerCase()&&0==t.applicableDate?(alertify.alert("WARNING!","Please, select a policy applicable date.",()=>{}),!1):(saveStep(t),!0)):6===e?(t.resetDateType=getField(".js-policy-reset-date-add:checked"),t.resetDate=getField("#js-custom-reset-date-add"),"policydate"!=t.resetDateType.toLowerCase()&&0==t.resetDate?(alertify.alert("WARNING!","Please, select a policy reset date.",()=>{}),!1):(saveStep(t),!0)):7===e&&(t.newHireTime=getField("#js-accrue-new-hire-add"),t.newHireTimeType=getField("#js-accrual-new-hire-time-type option:selected"),t.newHireRate=getField("#js-newhire-prorate-add"),saveStep(t),!0)}function a(e){ml(!0,"policy");let a=Object.assign({},e,{action:"create_policy",companyId:companyId,employeeId:employeeId,employerId:employerId,public:0});$.post(handlerURL,a,e=>{ml(!1,"policy"),!0!==e.Redirect?!1!==e.Status?alertify.alert("SUCCESS!",e.Response,()=>{loadViewPage()}):alertify.alert("WARNING!",e.Response,()=>{}):alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()})})}let t={type:0,title:0,order:1,policyCategory:1,entitledEmployees:[],isEntitledEmployees:0,offDays:[],approver:0,approverList:[],deactivate:0,include:1,isESST:0,isESTA:0,employeeTypes:[],method:"none",time:"none",frequency:"none",frequencyVal:0,rate:0,rateType:"hours",applicableTime:0,applicableTimeType:"hours",carryOverCheck:"no",carryOverType:"hours",carryOverVal:0,carryOverCycle:1,negativeBalanceCheck:"no",negativeBalanceVal:0,negativeBalanceType:"hours",applicableDateType:"hireDate",applicableDate:0,resetDateType:"policyDateCustom",resetDate:0,newHireTime:0,newHireTimeType:0,newHireRate:0,plans:[]};window.timeoff.stepCompletedAdd=e,window.timeoff.finalStepCompletedAdd=a,$("#js-category-add").on("change",function(){var e=$('#js-category-add option[value="'+$(this).val()+'"]').text().toLowerCase().trim();null!==e.match(/(fmla)/g)?$(".js-fmla-range-wrap-add").show():($(".js-fmla-range-wrap-add").hide(0),$(".js-fmla-range-add").prop("checked",!1),$('.js-fmla-range-add[value="standard_year"]').prop("checked",!0))}),$("#js-employee-add").on("select2:select",function(e){if("All"!=e.params.data.text){let e=$(this).val().filter(function(e){return"all"!=e});$("#js-employee-add").val(e)}else $("#js-employee-add").val("all");$("#js-employee-add").trigger("change.select2")}),$("#js-approvers-list-add").on("select2:select",function(e){if("All"!=e.params.data.text){let e=$(this).val().filter(function(e){return"all"!=e});$("#js-approvers-list-add").val(e)}else $("#js-approvers-list-add").val("all");$("#js-approvers-list-add").trigger("change.select2")}),$("#js-accrual-frequency-add").on("change",function(){"none"==$(this).val()?"Jan To Dec"!=$('#js-accrual-time-add[value="none"]').text()&&($("#js-accrual-time-add").html('\n                <option value="none" selected="true">Jan To Dec</option>\n                <option value="start_of_period">Jan to Jun</option>\n                <option value="end_of_period">Jul to Dec</option>\n                '),$("#js-accrual-time-add").select2()):"1st To 30th"!=$('#js-accrual-time-add[value="none"]').text()&&($("#js-accrual-time-add").html('\n                    <option value="none" selected="true">1st To 30th</option>\n                    <option value="start_of_period">1st To 15th</option>\n                    <option value="end_of_period">15th To 30th</option>\n                '),$("#js-accrual-time-add").select2()),"custom"==$(this).val()?($(".jsCustomBoxAdd").show(0),$("#js-accrual-time-add").prop("disabled",!0),$("#js-accrual-time-text-add").show()):($(".jsCustomBoxAdd").hide(0),$("#js-accrual-time-add").prop("disabled",!1),$("#js-accrual-time-text-add").hide()),setAccrualText()}),$("#js-carryover-cap-check-add").change(function(){$(".js-carryover-box-add").find("input").val(0),"no"===$(this).val()?$(".js-carryover-box-add").hide():$(".js-carryover-box-add").show()}),$("#js-accrual-balance-add").change(function(){$(".js-accrual-balance-add").find("input").val(0),"no"===$(this).val()?$(".js-negative-box-add").hide():$(".js-negative-box-add").show()}),$(".js-hire-date-add").on("change",function(){"hireDate"==$(this).val()?($(".jsImplementDateBox-add").hide(0),$("#js-custom-date-add").val("")):$(".jsImplementDateBox-add").show(0)}),$(".js-policy-reset-date-add").on("change",function(){"policyDate"==$(this).val()?($(".jsResetDateBox-add").hide(0),$("#js-custom-reset-date-add").val("")):$(".jsResetDateBox-add").show(0)}),$(".js-plan-btn-add").click(function(e){e.preventDefault(),loadAccrualPlans($(this).data("type"))}),$(document).on("click",".js-plan-remove-btn",function(e){e.preventDefault(),""!=$(this).parent().find(".js-pt").val().trim()||""!=$(this).parent().find(".js-py").val().trim()?alertify.confirm("Do you really want to delete this accrual plan?",()=>{$(this).parent().remove()}).set("labels",{ok:"Yes",cancel:"No"}):$(this).parent().remove()}),$('[data-hint="js-hint"]').click(function(e){e.preventDefault(),$(`.js-hint-${$(this).data("target")}`).toggle()}),$(document).on("select2:selecting","#js-plans-select-add",function(e){makePlanRow(e.params.args.data.id,"add")}),$(document).on("select2:unselecting","#js-plans-select-add",function(e){removePlan(e.params.args.data.id,"add")}),$(document).on("click",".js-remove-plan-add",function(e){removePlan($(this).closest("li").data("id"),"add"),$("#js-plans-select-add").select2("val",newValues($("#js-plans-select-add").val(),$(this).closest("li").data("id")))}),$("#js-unlimited-policy-check-add").click(function(){!0===$(this).prop("checked")?$("#js-plan-box-add").hide():$("#js-plan-box-add").show()}),$("#js-accrual-time-add").change(setAccrualText),$("#js-accrual-rate-type-add").change(setAccrualText),$("#js-accrual-rate-add").keyup(function(){""==$(this).val().trim()?($("#js-accrual-time-add").prop("disabled",!0),$("#js-accrual-time-text-add").show()):null!=$(this).val().match(/[a-zA-Z]/)?($(this).val(0),$("#js-accrual-time-add").prop("disabled",!0),$("#js-accrual-time-text-add").show()):$(this).val()<0?($(this).val(0),$("#js-accrual-time-add").prop("disabled",!0),$("#js-accrual-time-text-add").show()):($("#js-accrual-time-add").prop("disabled",!1),$("#js-accrual-time-text-add").hide()),0==$(this).val()?$(".js-plan-btn-add").prop("disabled",!0):$(".js-plan-btn-add").prop("disabled",!1),setAccrualText()}),$("#js-accrual-frequency-val-add").keyup(function(){$(this).val().trim()<=0?$(this).val(1):$(this).val().trim()>12&&$(this).val(12),setAccrualText()}),$("#js-policy-title-add").keyup(function(){$("#jsPolicyTitleAdd").text(" - "+$(this).val())}),$("#js-accrue-new-hire-add").keyup(setNewHireAccrual),$("#js-newhire-prorate-add").keyup(setNewHireAccrual),$("#js-accrual-new-hire-time-type").change(setNewHireAccrual)});