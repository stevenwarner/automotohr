$((function(){let e={type:0,title:0,order:1,policyCategory:1,entitledEmployees:[],isEntitledEmployees:0,offDays:[],approver:0,approverList:[],deactivate:0,include:1,isESST:0,isESTA:0,employeeTypes:[],method:"none",time:"none",frequency:"none",frequencyVal:0,rate:0,rateType:"hours",applicableTime:0,applicableTimeType:"hours",carryOverCheck:"no",carryOverType:"hours",carryOverVal:0,carryOverCycle:1,negativeBalanceCheck:"no",negativeBalanceVal:0,negativeBalanceType:"hours",applicableDateType:"hireDate",applicableDate:0,resetDateType:"policyDateCustom",resetDate:0,newHireTime:0,newHireTimeType:0,newHireRate:0,plans:[]};window.timeoff.stepCompletedAdd=function(a){if(1===a)return e.policyCategory=getField("#js-policy-type-add"),e.type=getField("#js-category-add"),0==e.type?(alertify.alert("WARNING!","Please, select the policy type.",(()=>{})),!1):(e.title=getField("#js-policy-title-add"),0==e.title?(alertify.alert("WARNING!","Please, add the policy title.",(()=>{})),!1):(e.order=getField("#js-sort-order-add"),e.entitledEmployees=getField("#js-employee-add"),e.approver=!0===$("#js-approver-check-add").prop("checked")?1:0,e.approverList=[],1==e.approver&&(e.approverList=getField("#js-approvers-list-add")||[]),e.deactivate=!0===$("#js-archive-check-add").prop("checked")?1:0,e.include=!0===$("#js-include-check-add").prop("checked")?1:0,e.isESST=!0===$("#js-is-esst-add").prop("checked")?1:0,e.isESTA=!0===$("#js-is-esta-add").prop("checked")?1:0,e.isEntitledEmployees=$(".jsIsEntitledEmployee:checked").val(),e.employeeTypes=$("#js-employee-type-add").val(),e.offDays=getField("#js-off-days-add"),null==e.employeeTypes?(alertify.alert("WARNING!","Please, add the employee type.",(()=>{})),!1):(saveStep(e),!0)));if(2===a)return e.method="hours_per_month",e.time=getField("#js-accrual-time-add"),e.frequency=getField("#js-accrual-frequency-add"),e.frequencyVal=getField("#js-accrual-frequency-val-add"),e.rate=getField("#js-accrual-rate-add"),e.rateType=getField("#js-accrual-rate-type-add option:selected"),e.applicableTimeType=getField(".js-minimum-applicable-time-add:checked"),e.applicableTime=getField("#js-minimum-applicable-hours-add"),e.plans=getAccrualPlans("add"),e.accuralDefaultFlow=!0===$("#js-accrual-default-flow-add").prop("checked")?1:0,!0===e.plans?(alertify.alert("WARNING!","Please, add the proper plans.",(()=>{})),!1):(saveStep(e),!0);if(3===a)return e.carryOverCheck=getField("#js-carryover-cap-check-add"),e.carryOverVal=getField("#js-carryover-cap-add"),e.carryOverType=getField("#js-accrual-carryover-type option:selected"),e.carryOverCycle=getField("#js-carryover-cycle-add"),saveStep(e),!0;if(4===a)return e.negativeBalanceCheck=getField("#js-accrual-balance-add"),e.negativeBalanceVal=getField("#js-maximum-balance-add"),e.newHireTimeType=getField("#js-accrual-negative-balance-type option:selected"),saveStep(e),!0;if(5===a)return e.applicableDateType=getField(".js-hire-date-add:checked"),e.applicableDate=getField("#js-custom-date-add"),"hiredate"!=e.applicableDateType.toLowerCase()&&0==e.applicableDate?(alertify.alert("WARNING!","Please, select a policy applicable date.",(()=>{})),!1):(saveStep(e),!0);if(6===a)return e.resetDateType=getField(".js-policy-reset-date-add:checked"),e.resetDate=getField("#js-custom-reset-date-add"),"policydate"!=e.resetDateType.toLowerCase()&&0==e.resetDate?(alertify.alert("WARNING!","Please, select a policy reset date.",(()=>{})),!1):(saveStep(e),!0);if(7===a)return e.newHireTime=getField("#js-accrue-new-hire-add"),e.newHireTimeType=getField("#js-accrual-new-hire-time-type option:selected"),e.newHireRate=getField("#js-newhire-prorate-add"),saveStep(e),!0;return!1},window.timeoff.finalStepCompletedAdd=function(e){ml(!0,"policy");let a=Object.assign({},e,{action:"create_policy",companyId:companyId,employeeId:employeeId,employerId:employerId,public:0});$.post(handlerURL,a,(e=>{ml(!1,"policy"),!0!==e.Redirect?!1!==e.Status?alertify.alert("SUCCESS!",e.Response,(()=>{loadViewPage()})):alertify.alert("WARNING!",e.Response,(()=>{})):alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",(()=>{window.location.reload()}))}))},$("#js-category-add").on("change",(function(){null!==$('#js-category-add option[value="'+$(this).val()+'"]').text().toLowerCase().trim().match(/(fmla)/g)?$(".js-fmla-range-wrap-add").show():($(".js-fmla-range-wrap-add").hide(0),$(".js-fmla-range-add").prop("checked",!1),$('.js-fmla-range-add[value="standard_year"]').prop("checked",!0))})),$("#js-employee-add").on("select2:select",(function(e){if("All"!=e.params.data.text){let e=$(this).val().filter((function(e){return"all"!=e}));$("#js-employee-add").val(e)}else $("#js-employee-add").val("all");$("#js-employee-add").trigger("change.select2")})),$("#js-approvers-list-add").on("select2:select",(function(e){if("All"!=e.params.data.text){let e=$(this).val().filter((function(e){return"all"!=e}));$("#js-approvers-list-add").val(e)}else $("#js-approvers-list-add").val("all");$("#js-approvers-list-add").trigger("change.select2")})),$("#js-accrual-frequency-add").on("change",(function(){"none"==$(this).val()?"Jan To Dec"!=$('#js-accrual-time-add[value="none"]').text()&&($("#js-accrual-time-add").html('\n                <option value="none" selected="true">Jan To Dec</option>\n                <option value="start_of_period">Jan to Jun</option>\n                <option value="end_of_period">Jul to Dec</option>\n                '),$("#js-accrual-time-add").select2()):"1st To 30th"!=$('#js-accrual-time-add[value="none"]').text()&&($("#js-accrual-time-add").html('\n                    <option value="none" selected="true">1st To 30th</option>\n                    <option value="start_of_period">1st To 15th</option>\n                    <option value="end_of_period">15th To 30th</option>\n                '),$("#js-accrual-time-add").select2()),"custom"==$(this).val()?($(".jsCustomBoxAdd").show(0),$("#js-accrual-time-add").prop("disabled",!0),$("#js-accrual-time-text-add").show()):($(".jsCustomBoxAdd").hide(0),$("#js-accrual-time-add").prop("disabled",!1),$("#js-accrual-time-text-add").hide()),setAccrualText()})),$("#js-carryover-cap-check-add").change((function(){$(".js-carryover-box-add").find("input").val(0),"no"===$(this).val()?$(".js-carryover-box-add").hide():$(".js-carryover-box-add").show()})),$("#js-accrual-balance-add").change((function(){$(".js-accrual-balance-add").find("input").val(0),"no"===$(this).val()?$(".js-negative-box-add").hide():$(".js-negative-box-add").show()})),$(".js-hire-date-add").on("change",(function(){"hireDate"==$(this).val()?($(".jsImplementDateBox-add").hide(0),$("#js-custom-date-add").val("")):$(".jsImplementDateBox-add").show(0)})),$(".js-policy-reset-date-add").on("change",(function(){"policyDate"==$(this).val()?($(".jsResetDateBox-add").hide(0),$("#js-custom-reset-date-add").val("")):$(".jsResetDateBox-add").show(0)})),$(".js-plan-btn-add").click((function(e){e.preventDefault(),loadAccrualPlans($(this).data("type"))})),$(document).on("click",".js-plan-remove-btn",(function(e){e.preventDefault(),""!=$(this).parent().find(".js-pt").val().trim()||""!=$(this).parent().find(".js-py").val().trim()?alertify.confirm("Do you really want to delete this accrual plan?",(()=>{$(this).parent().remove()})).set("labels",{ok:"Yes",cancel:"No"}):$(this).parent().remove()})),$('[data-hint="js-hint"]').click((function(e){e.preventDefault(),$(`.js-hint-${$(this).data("target")}`).toggle()})),$(document).on("select2:selecting","#js-plans-select-add",(function(e){makePlanRow(e.params.args.data.id,"add")})),$(document).on("select2:unselecting","#js-plans-select-add",(function(e){removePlan(e.params.args.data.id,"add")})),$(document).on("click",".js-remove-plan-add",(function(e){removePlan($(this).closest("li").data("id"),"add"),$("#js-plans-select-add").select2("val",newValues($("#js-plans-select-add").val(),$(this).closest("li").data("id")))})),$("#js-unlimited-policy-check-add").click((function(){!0===$(this).prop("checked")?$("#js-plan-box-add").hide():$("#js-plan-box-add").show()})),$("#js-accrual-time-add").change(setAccrualText),$("#js-accrual-rate-type-add").change(setAccrualText),$("#js-accrual-rate-add").keyup((function(){""==$(this).val().trim()?($("#js-accrual-time-add").prop("disabled",!0),$("#js-accrual-time-text-add").show()):null!=$(this).val().match(/[a-zA-Z]/)||$(this).val()<0?($(this).val(0),$("#js-accrual-time-add").prop("disabled",!0),$("#js-accrual-time-text-add").show()):($("#js-accrual-time-add").prop("disabled",!1),$("#js-accrual-time-text-add").hide()),0==$(this).val()?$(".js-plan-btn-add").prop("disabled",!0):$(".js-plan-btn-add").prop("disabled",!1),setAccrualText()})),$("#js-accrual-frequency-val-add").keyup((function(){$(this).val().trim()<=0?$(this).val(1):$(this).val().trim()>12&&$(this).val(12),setAccrualText()})),$("#js-policy-title-add").keyup((function(){$("#jsPolicyTitleAdd").text(" - "+$(this).val())})),$("#js-accrue-new-hire-add").keyup(setNewHireAccrual),$("#js-newhire-prorate-add").keyup(setNewHireAccrual),$("#js-accrual-new-hire-time-type").change(setNewHireAccrual)}));