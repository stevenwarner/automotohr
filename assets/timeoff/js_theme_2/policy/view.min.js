$((function(){let i={CompanyPolicies:{Main:{action:"get_policies_by_company",companyId:companyId,employerId:employerId,employeeId:employeeId,filter:{archived:0,policy:"",startDate:"",endDate:"",status:""},public:0,page:1},cb:o,limit:0,count:0,pages:0},PolicySort:{Main:{action:"update_sort_order",companyId:companyId,employerId:employerId,employeeId:employeeId,public:0}},PolicyHistory:{Main:{action:"get_policy_history",companyId:companyId,employerId:employerId,employeeId:employeeId,public:0}}},e={},t=null;function o(){void 0!==window.timeoff.categories?null==t&&(ml(!0,"policy"),t=$.post(handlerURL,i.CompanyPolicies.Main,(function(o){if(t=null,!0!==o.Redirect){if(!1===o.Status&&1==i.CompanyPolicies.Main.page)return $(".js-ip-pagination").html(""),$(".csLisitingArea").html(`<p class="alert alert-info text-center">${o.Response}</p>`),void ml(!1,"policy");if(!1===o.Status)return $(".js-ip-pagination").html(""),void ml(!1,"policy");1==i.CompanyPolicies.Main.page&&(i.CompanyPolicies.limit=o.Limit,i.CompanyPolicies.count=o.TotalRecords,i.CompanyPolicies.pages=o.TotalPages),function(t){e={};let o="";if(0==t.Data.length)return;$.each(t.Data,(function(t,a){e[a.policy_id]=t,o+=function(e){let t=0!=i.CompanyPolicies.Main.filter.archived?"Activate Policy":"Deactivate Policy",o=0!=i.CompanyPolicies.Main.filter.archived?"fa-check-square-o":"fa-archive",a=0!=i.CompanyPolicies.Main.filter.archived?"js-activate-btn":"js-archive-btn",l=JSON.parse(e.accruals),s="";s+='<div class="col-sm-4">',s+=`    <div class="csBox csShadow csRadius5 jsBox" data-id="${e.policy_id}" data-name="${e.policy_title}">`,s+="        \x3c!-- Box Header --\x3e",s+='        <div class="csBoxHeader csRadius5 csRadiusBL0 csRadiusBR0">',s+='            <span class="pull-right">',s+='                <span class="csCircleBtn csRadius50 jsTooltip jsPolicyHistoryBtn" title="History" placement="top"><i class="fa fa-history"></i></span>',s+='                <span class="csCircleBtn csRadius50 jsTooltip js-edit-row-btn" title="Edit" placement="top"><i class="fa fa-pencil"></i></span>',s+='                <span class="csCircleBtn csRadius50 jsTooltip jsPolicyHistory" title="View history" placement="top"><i class="fa fa-history"></i></span>',s+="            </span>",s+='            <div class="clearfix"></div>',s+="        </div>",s+="        \x3c!-- Box Content --\x3e",s+='        <div class="csBoxContent">',s+="            \x3c!-- Section 1 --\x3e",s+='            <div class="csBoxContentDateSection pt10 pb10">',s+='                <div class="col-sm-12">',s+=`                    <h3>${ucwords(e.policy_title)} (<span class="text-${1==e.category_type?"":"danger"}">${1==e.category_type?"Paid":"Unpaid"}</span>)</h3>`,s+=`                    <p>(${getTypeNames(e.type_sid)})</p>`,s+="                </div>",s+='                <div class="clearfix"></div>',s+="            </div>",s+="            \x3c!-- Section 3 --\x3e",s+='            <div class="csBoxBalanceSection">',s+='                <div class="col-sm-12">',s+=`                    <p><strong>${null===l.applicableDate||""==l.applicableDate||0==l.applicableDate?"Joining Date":moment(l.applicableDate,"").format(timeoffDateFormat)}</strong></p>`,s+="                    <p>Applicable Date</p>",s+="                </div>",s+='                <div class="clearfix"></div>',s+="            </div>",s+="            \x3c!-- Section 3 --\x3e",s+='            <div class="csBoxBalanceSection">',s+='                <div class="col-sm-12">',s+=`                    <p><strong>${"yes"==l.carryOverCheck?"Yes":"No"}</strong></p>`,s+="                    <p>Carryover</p>",s+="                </div>",s+='                <div class="clearfix"></div>',s+="            </div>",s+="            \x3c!-- Section 3 --\x3e",s+='            <div class="csBoxBalanceSection">',s+='                <div class="col-sm-12">',s+=`                    <p><strong>${getAccrualText(l)}</strong></p>`,s+="                    <p>Accruals</p>",s+="                </div>",s+='                <div class="clearfix"></div>',s+="            </div>",s+="            \x3c!-- Section 3 --\x3e",s+='            <div class="csBoxBalanceSection">',s+='                <div class="col-sm-12">',s+=`                    <p><strong>${getAccrualText(l,!0)}</strong></p>`,s+="                    <p>New Hire</p>",s+="                </div>",s+='                <div class="clearfix"></div>',s+="            </div>",s+="        </div>",s+="            ",s+="        \x3c!-- Box Footer --\x3e",s+='        <div class="csBoxFooter">',s+='            <div class="col-sm-12">',0==e.default_policy&&(s+=`                <button class="btn btn-orange form-control ${a}"><i class="fa ${o}"></i>${t}</button>`);return s+="            </div>",s+="        </div>",s+="    </div>",s+="</div>",s}(a)})),load_pagination(i.CompanyPolicies.limit,5,$(".js-ip-pagination"),"CompanyPolicies"),$(".csLisitingArea").html(o),a=".csLisitingArea",$(a).sortable({placeholder:"ui-state-highlight"}),$(a).disableSelection(),$(".jsTooltip").tooltip({placement:"top"}),ml(!1,"policy");var a}(o)}else alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",(()=>{window.location.reload()}))}))):setTimeout((()=>{o()}),1e3)}function a(){return'\n            <div class="tabel-responsive">\n                <table class="table table-striped csCustomTableHeader">\n                    <thead>\n                        <tr>\n                            <th>Employee</th>\n                            <th>Action</th>\n                            <th>Action Type</th>\n                            <th>Action Taken</th>\n                        </tr>\n                    </thead>\n                    <tbody id="jsPolicyHistoryTable"></tbody>\n                </table>\n            </div>\n        '}function l(i){$.get(window.location.origin+"/timeoff/policy/"+i+"/history").success((function(i){$("#jsPolicyHistoryModalBody").html(i.view),ml(!1,"jsPolicyHistoryModalLoader")})).fail((function(i){let e=JSON.parse(i.responseText);if(401==i.status)return alertify.alert("ERROR!",e.errors.join("<br />"),(function(){}))}))}window.timeoff.PaginationOBJ.CompanyPolicies=i.CompanyPolicies,window.timeoff.fetchCompanyPolicies=o,""!=page&&"view"!=page||o(),$("#js-filter-from-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0,onSelect:function(i){$("#js-filter-to-date").datepicker("option","minDate",i)}}),$("#js-filter-to-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0}).datepicker("option","minDate",$("#js-filter-from-date").val()),$(".js-tab").click((function(){i.CompanyPolicies.Main.filter.archived="archived"===$(this).data("type")?1:0,o()})),$(document).on("click",".jsPolicyHistory",(function(){Modal({Id:1,Title:`Policy History for ${$(this).closest(".jsBox").data("name")}`,Body:a(),Loader:"jsPolicyHistoryLoader"},(()=>{var e;e=$(this).closest(".jsBox").data("id"),ml(!0,"jsPolicyHistoryLoader"),$("#jsPolicyHistoryTable").html(""),t=$.post(handlerURL,Object.assign(i.PolicyHistory.Main,{policyId:e}),(i=>{if(t=null,!0===i.Redirect)return void alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",(()=>{window.location.reload()}));if(!1===i.Status)return alertify.alert("WARNING!",i.Response,(()=>{})),void ml(!1,"jsPolicyHistoryLoader");let e="";0===i.Data.length?e=`\n                    <tr>\n                        <td colspan="4">\n                            <p class="alert alert-info text-center">${i.Response}</p>\n                        </td>\n                    </tr>\n                `:i.Data.map((i=>{e+=`\n                        <tr>\n                            <td>${remakeEmployeeName(i)}</td>\n                            <td>${i.action.toUpperCase()}</td>\n                            <td>${i.action_type.toUpperCase()}</td>\n                            <td>${moment(i.created_at).format(timeoffDateFormatWithTime)}</td>\n                        </tr>\n                    `})),$("#jsPolicyHistoryTable").html(e),ml(!1,"jsPolicyHistoryLoader")}))}))})),$(document).on("click",".js-apply-filter-btn",(function(e){e.preventDefault(),i.CompanyPolicies.Main.filter.policy=$("#js-filter-policies").val(),i.CompanyPolicies.Main.filter.startDate=$("#js-filter-from-date").val(),i.CompanyPolicies.Main.filter.endDate=$("#js-filter-to-date").val(),i.CompanyPolicies.Main.filter.status=$("#js-filter-status").val(),i.CompanyPolicies.Main.page=1,i.CompanyPolicies.Main.limit=0,i.CompanyPolicies.Main.count=0,o()})),$(document).on("click",".js-reset-filter-btn",(function(e){e.preventDefault(),$("#js-filter-policies").select2("val","all"),$("#js-filter-from-date").val(""),$("#js-filter-to-date").val(""),$('#js-filter-status option[value="-1"]').prop("selected",!0),i.CompanyPolicies.Main.filter.policy="all",i.CompanyPolicies.Main.filter.startDate="",i.CompanyPolicies.Main.filter.endDate="",i.CompanyPolicies.Main.filter.status="-1",i.CompanyPolicies.Main.filter.archived=0,i.CompanyPolicies.Main.page=1,i.CompanyPolicies.Main.limit=0,i.CompanyPolicies.Main.count=0,o()})),$(".csLisitingArea").on("sortstop",(function(){var e=0,t={},o=$(".csLisitingArea").find(".jsBox").length;for(;e<o;e++)t[$(".csLisitingArea").find(".jsBox:eq("+e+")").data("id")]=e;!function(e){let t=Object.assign({},i.PolicySort.Main,{sort:e,type:"policies"});$.post(handlerURL,t,(i=>{ml(!1,"policy")}))}(t)})),$(document).on("click",".js-archive-btn",(function(i){i.preventDefault();var e=$(this);alertify.confirm("Do you really want to deactivate this policy?",(function(){var i={action:"archive_company_policy"};i.companyId=companyId,i.employeeId=employeeId,i.employerId=employerId,i.public=0,i.policySid=e.closest(".jsBox").data("id"),ml(!0,"policy"),$.post(handlerURL,i,(function(i){ml(!1,"policy"),!0!==i.Redirect?!1!==i.Status?alertify.alert("SUCCESS!",i.Response,(function(){loadViewPage()})):alertify.alert("WARNING!",i.Response,(function(){})):alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",(()=>{window.location.reload()}))}))})).set("labels",{ok:"YES",cancel:"NO"}).setHeader("CONFIRM!")})),$(document).on("click",".js-activate-btn",(function(i){i.preventDefault();var e=$(this);alertify.confirm("Do you really want to activate this policy?",(function(){var i={action:"activate_company_policy"};i.companyId=companyId,i.employeeId=employeeId,i.employerId=employerId,i.public=0,i.policySid=e.closest(".jsBox").data("id"),ml(!0,"policy"),$.post(handlerURL,i,(function(i){ml(!1,"policy"),!0!==i.Redirect?!1!==i.Status?alertify.alert("SUCCESS!",i.Response,(function(){loadViewPage()})):alertify.alert("WARNING!",i.Response,(function(){})):alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",(()=>{window.location.reload()}))}))})).set("labels",{ok:"YES",cancel:"NO"}).setHeader("CONFIRM!")})),$(document).on("click",".jsPolicyHistoryBtn",(function(i){i.preventDefault();let e=$(this).closest(".jsBox").data("id"),t=$(this).closest(".jsBox").data("name");Modal({Id:"jsPolicyHistoryModal",Title:'History for "'+t+'"',Loader:"jsPolicyHistoryModalLoader",Body:"<div id='jsPolicyHistoryModalBody'></div>"},l.bind(this,e))}))}));