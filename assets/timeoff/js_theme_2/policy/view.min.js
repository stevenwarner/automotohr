$((function(){let callOBJ={CompanyPolicies:{Main:{action:"get_policies_by_company",companyId:companyId,employerId:employerId,employeeId:employeeId,filter:{archived:0,policy:"",startDate:"",endDate:"",status:""},public:0,page:1},cb:fetchCompanyPolicies,limit:0,count:0,pages:0},PolicySort:{Main:{action:"update_sort_order",companyId:companyId,employerId:employerId,employeeId:employeeId,public:0}},PolicyHistory:{Main:{action:"get_policy_history",companyId:companyId,employerId:employerId,employeeId:employeeId,public:0}}},oldState={},xhr=null;function resetFilter(e){e.preventDefault(),$("#js-filter-policies").select2("val","all"),$("#js-filter-from-date").val(""),$("#js-filter-to-date").val(""),$('#js-filter-status option[value="-1"]').prop("selected",!0),callOBJ.CompanyPolicies.Main.filter.policy="all",callOBJ.CompanyPolicies.Main.filter.startDate="",callOBJ.CompanyPolicies.Main.filter.endDate="",callOBJ.CompanyPolicies.Main.filter.status="-1",callOBJ.CompanyPolicies.Main.filter.archived=0,callOBJ.CompanyPolicies.Main.page=1,callOBJ.CompanyPolicies.Main.limit=0,callOBJ.CompanyPolicies.Main.count=0,fetchCompanyPolicies()}function applyFilter(e){e.preventDefault(),callOBJ.CompanyPolicies.Main.filter.policy=$("#js-filter-policies").val(),callOBJ.CompanyPolicies.Main.filter.startDate=$("#js-filter-from-date").val(),callOBJ.CompanyPolicies.Main.filter.endDate=$("#js-filter-to-date").val(),callOBJ.CompanyPolicies.Main.filter.status=$("#js-filter-status").val(),callOBJ.CompanyPolicies.Main.page=1,callOBJ.CompanyPolicies.Main.limit=0,callOBJ.CompanyPolicies.Main.count=0,fetchCompanyPolicies()}function fetchCompanyPolicies(){void 0!==window.timeoff.categories?null==xhr&&(ml(!0,"policy"),xhr=$.post(handlerURL,callOBJ.CompanyPolicies.Main,(function(resp){if(xhr=null,!0!==resp.Redirect){if(!1===resp.Status&&1==callOBJ.CompanyPolicies.Main.page)return $(".js-ip-pagination").html(""),$(".csLisitingArea").html(`<p class="alert alert-info text-center">${resp.Response}</p>`),void ml(!1,"policy");if(!1===resp.Status)return $(".js-ip-pagination").html(""),void ml(!1,"policy");1==callOBJ.CompanyPolicies.Main.page&&(callOBJ.CompanyPolicies.limit=resp.Limit,callOBJ.CompanyPolicies.count=resp.TotalRecords,callOBJ.CompanyPolicies.pages=resp.TotalPages),setTable(resp)}else alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()})}))):setTimeout(()=>{fetchCompanyPolicies()},1e3)}function setTable(resp){oldState={};let rows="";0!=resp.Data.length&&($.each(resp.Data,(function(i,v){oldState[v.policy_id]=i,rows+=getPolicyBox(v)})),load_pagination(callOBJ.CompanyPolicies.limit,5,$(".js-ip-pagination"),"CompanyPolicies"),$(".csLisitingArea").html(rows),callDrager(".csLisitingArea"),$(".jsTooltip").tooltip({placement:"top"}),ml(!1,"policy"))}function callDrager(target){$(target).sortable({placeholder:"ui-state-highlight"}),$(target).disableSelection()}function callSort(){for(var i=0,s={},l=$(".csLisitingArea").find(".jsBox").length;i<l;i++)s[$(".csLisitingArea").find(".jsBox:eq("+i+")").data("id")]=i;updateSortInDb(s)}function updateSortInDb(s){let o=Object.assign({},callOBJ.PolicySort.Main,{sort:s,type:"policies"});$.post(handlerURL,o,resp=>{ml(!1,"policy")})}function getHistoryTemplate(){let html;return'\n            <div class="tabel-responsive">\n                <table class="table table-striped csCustomTableHeader">\n                    <thead>\n                        <tr>\n                            <th>Employee</th>\n                            <th>Action</th>\n                            <th>Action Type</th>\n                            <th>Action Taken</th>\n                        </tr>\n                    </thead>\n                    <tbody id="jsPolicyHistoryTable"></tbody>\n                </table>\n            </div>\n        '}function fetchPolicyHistory(policyId){ml(!0,"jsPolicyHistoryLoader"),$("#jsPolicyHistoryTable").html(""),xhr=$.post(handlerURL,Object.assign(callOBJ.PolicyHistory.Main,{policyId:policyId}),resp=>{if(xhr=null,!0===resp.Redirect)return void alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()});if(!1===resp.Status)return alertify.alert("WARNING!",resp.Response,()=>{}),void ml(!1,"jsPolicyHistoryLoader");let rows="";0===resp.Data.length?rows=`\n                    <tr>\n                        <td colspan="4">\n                            <p class="alert alert-info text-center">${resp.Response}</p>\n                        </td>\n                    </tr>\n                `:resp.Data.map(v=>{rows+=`\n                        <tr>\n                            <td>${remakeEmployeeName(v)}</td>\n                            <td>${v.action.toUpperCase()}</td>\n                            <td>${v.action_type.toUpperCase()}</td>\n                            <td>${moment(v.created_at).format(timeoffDateFormatWithTime)}</td>\n                        </tr>\n                    `}),$("#jsPolicyHistoryTable").html(rows),ml(!1,"jsPolicyHistoryLoader")})}function getPolicyBox(v){let title=0!=callOBJ.CompanyPolicies.Main.filter.archived?"Activate Policy":"Deactivate Policy",icon=0!=callOBJ.CompanyPolicies.Main.filter.archived?"fa-check-square-o":"fa-archive",cl=0!=callOBJ.CompanyPolicies.Main.filter.archived?"js-activate-btn":"js-archive-btn",accruals=JSON.parse(v.accruals),rows="";return rows+='<div class="col-sm-4">',rows+=`    <div class="csBox csShadow csRadius5 jsBox" data-id="${v.policy_id}" data-name="${v.policy_title}">`,rows+="        \x3c!-- Box Header --\x3e",rows+='        <div class="csBoxHeader csRadius5 csRadiusBL0 csRadiusBR0">',rows+='            <span class="pull-right">',rows+='                <span class="csCircleBtn csRadius50 jsTooltip js-edit-row-btn" title="Edit" placement="top"><i class="fa fa-pencil"></i></span>',rows+='                <span class="csCircleBtn csRadius50 jsTooltip jsPolicyHistory" title="View history" placement="top"><i class="fa fa-history"></i></span>',rows+="            </span>",rows+='            <div class="clearfix"></div>',rows+="        </div>",rows+="        \x3c!-- Box Content --\x3e",rows+='        <div class="csBoxContent">',rows+="            \x3c!-- Section 1 --\x3e",rows+='            <div class="csBoxContentDateSection pt10 pb10">',rows+='                <div class="col-sm-12">',rows+=`                    <h3>${ucwords(v.policy_title)} (<span class="text-${1==v.category_type?"":"danger"}">${1==v.category_type?"Paid":"Unpaid"}</span>)</h3>`,rows+=`                    <p>(${getTypeNames(v.type_sid)})</p>`,rows+="                </div>",rows+='                <div class="clearfix"></div>',rows+="            </div>",rows+="            \x3c!-- Section 3 --\x3e",rows+='            <div class="csBoxBalanceSection">',rows+='                <div class="col-sm-12">',rows+=`                    <p><strong>${null===accruals.applicableDate||""==accruals.applicableDate||0==accruals.applicableDate?"Joining Date":moment(accruals.applicableDate,"").format(timeoffDateFormat)}</strong></p>`,rows+="                    <p>Applicable Date</p>",rows+="                </div>",rows+='                <div class="clearfix"></div>',rows+="            </div>",rows+="            \x3c!-- Section 3 --\x3e",rows+='            <div class="csBoxBalanceSection">',rows+='                <div class="col-sm-12">',rows+=`                    <p><strong>${"yes"==accruals.carryOverCheck?"Yes":"No"}</strong></p>`,rows+="                    <p>Carryover</p>",rows+="                </div>",rows+='                <div class="clearfix"></div>',rows+="            </div>",rows+="            \x3c!-- Section 3 --\x3e",rows+='            <div class="csBoxBalanceSection">',rows+='                <div class="col-sm-12">',rows+=`                    <p><strong>${getAccrualText(accruals)}</strong></p>`,rows+="                    <p>Accruals</p>",rows+="                </div>",rows+='                <div class="clearfix"></div>',rows+="            </div>",rows+="            \x3c!-- Section 3 --\x3e",rows+='            <div class="csBoxBalanceSection">',rows+='                <div class="col-sm-12">',rows+=`                    <p><strong>${getAccrualText(accruals,!0)}</strong></p>`,rows+="                    <p>New Hire</p>",rows+="                </div>",rows+='                <div class="clearfix"></div>',rows+="            </div>",rows+="        </div>",rows+="            ",rows+="        \x3c!-- Box Footer --\x3e",rows+='        <div class="csBoxFooter">',rows+='            <div class="col-sm-12">',0==v.default_policy&&(rows+=`                <button class="btn btn-orange form-control ${cl}"><i class="fa ${icon}"></i>${title}</button>`),rows+="            </div>",rows+="        </div>",rows+="    </div>",rows+="</div>",rows}window.timeoff.PaginationOBJ.CompanyPolicies=callOBJ.CompanyPolicies,window.timeoff.fetchCompanyPolicies=fetchCompanyPolicies,""!=page&&"view"!=page||fetchCompanyPolicies(),$("#js-filter-from-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0,onSelect:function(v){$("#js-filter-to-date").datepicker("option","minDate",v)}}),$("#js-filter-to-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0}).datepicker("option","minDate",$("#js-filter-from-date").val()),$(".js-tab").click((function(){callOBJ.CompanyPolicies.Main.filter.archived="archived"===$(this).data("type")?1:0,fetchCompanyPolicies()})),$(document).on("click",".jsPolicyHistory",(function(){Modal({Id:1,Title:`Policy History for ${$(this).closest(".jsBox").data("name")}`,Body:getHistoryTemplate(),Loader:"jsPolicyHistoryLoader"},()=>{fetchPolicyHistory($(this).closest(".jsBox").data("id"))})})),$(document).on("click",".js-apply-filter-btn",applyFilter),$(document).on("click",".js-reset-filter-btn",resetFilter),$(".csLisitingArea").on("sortstop",callSort),$(document).on("click",".js-archive-btn",(function(e){e.preventDefault();var _this=$(this);alertify.confirm("Do you really want to deactivate this policy?",(function(){var post={action:"archive_company_policy"};post.companyId=companyId,post.employeeId=employeeId,post.employerId=employerId,post.public=0,post.policySid=_this.closest(".jsBox").data("id"),ml(!0,"policy"),$.post(handlerURL,post,(function(resp){ml(!1,"policy"),!0!==resp.Redirect?!1!==resp.Status?alertify.alert("SUCCESS!",resp.Response,(function(){loadViewPage()})):alertify.alert("WARNING!",resp.Response,(function(){})):alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()})}))})).set("labels",{ok:"YES",cancel:"NO"}).setHeader("CONFIRM!")})),$(document).on("click",".js-activate-btn",(function(e){e.preventDefault();var _this=$(this);alertify.confirm("Do you really want to activate this policy?",(function(){var post={action:"activate_company_policy"};post.companyId=companyId,post.employeeId=employeeId,post.employerId=employerId,post.public=0,post.policySid=_this.closest(".jsBox").data("id"),ml(!0,"policy"),$.post(handlerURL,post,(function(resp){ml(!1,"policy"),!0!==resp.Redirect?!1!==resp.Status?alertify.alert("SUCCESS!",resp.Response,(function(){loadViewPage()})):alertify.alert("WARNING!",resp.Response,(function(){})):alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()})}))})).set("labels",{ok:"YES",cancel:"NO"}).setHeader("CONFIRM!")}))}));