$((function(){let e={CompanyPolicies:{Main:{action:"get_policies_by_company",companyId:companyId,employerId:employerId,employeeId:employeeId,filter:{archived:0,policy:"",startDate:"",endDate:"",status:""},public:0,page:1},cb:l,limit:0,count:0,pages:0},PolicySort:{Main:{action:"update_sort_order",companyId:companyId,employerId:employerId,employeeId:employeeId,public:0}},PolicyHistory:{Main:{action:"get_policy_history",companyId:companyId,employerId:employerId,employeeId:employeeId,public:0}},ManagePolicy:{Main:{action:"get_policy_requests_with_employees",companyId:companyId,employerId:employerId,employeeId:employeeId,public:0}},MigratePolicy:{Main:{action:"migrate_employee_requests_policy",companyId:companyId,employerId:employerId,employeeId:employeeId,public:0}},AllowedEmployees:{Main:{action:"get_allowed_employees",companyId:companyId,employerId:employerId,employeeId:employeeId,public:0}}},i={},o=null,t=0;function l(){void 0!==window.timeoff.categories?null==o&&(ml(!0,"policy"),o=$.post(handlerURL,e.CompanyPolicies.Main,(function(t){if(o=null,!0!==t.Redirect){if(!1===t.Status&&1==e.CompanyPolicies.Main.page)return $(".js-ip-pagination").html(""),$(".csLisitingArea").html(`<p class="alert alert-info text-center">${t.Response}</p>`),void ml(!1,"policy");if(!1===t.Status)return $(".js-ip-pagination").html(""),void ml(!1,"policy");1==e.CompanyPolicies.Main.page&&(e.CompanyPolicies.limit=t.Limit,e.CompanyPolicies.count=t.TotalRecords,e.CompanyPolicies.pages=t.TotalPages),function(o){i={};let t="";if(0==o.Data.length)return;$.each(o.Data,(function(o,l){i[l.policy_id]=o,t+=function(i){let o=0!=e.CompanyPolicies.Main.filter.archived?"Activate Policy":"Deactivate Policy",t=0!=e.CompanyPolicies.Main.filter.archived?"fa-check-square-o":"fa-archive",l=0!=e.CompanyPolicies.Main.filter.archived?"js-activate-btn":"js-archive-btn",a=JSON.parse(i.accruals),s="";s+='<div class="col-sm-4">',s+=`    <div class="csBox csShadow csRadius5 jsBox" data-id="${i.policy_id}" data-name="${i.policy_title}">`,s+="        \x3c!-- Box Header --\x3e",s+='        <div class="csBoxHeader csRadius5 csRadiusBL0 csRadiusBR0">',s+='            <span class="pull-right">',s+='                <span class="csCircleBtn csRadius50 jsTooltip jsAllowedPolicyEmployees" title="Policy applicable employee(s)" placement="top"><i class="fa fa-users"></i></span>',s+='                <span class="csCircleBtn csRadius50 jsTooltip jsManagePolicy" title="Manage Policy" placement="top"><i class="fa fa-cog"></i></span>',s+='                <span class="csCircleBtn csRadius50 jsTooltip jsPolicyHistoryBtn" title="History" placement="top"><i class="fa fa-history"></i></span>',s+='                <span class="csCircleBtn csRadius50 jsTooltip js-edit-row-btn" title="Edit" placement="top"><i class="fa fa-pencil"></i></span>',s+="            </span>",s+='            <div class="clearfix"></div>',s+="        </div>",s+="        \x3c!-- Box Content --\x3e",s+='        <div class="csBoxContent">',s+="            \x3c!-- Section 1 --\x3e",s+='            <div class="csBoxContentDateSection pt10 pb10">',s+='                <div class="col-sm-12">',s+=`                    <h3>${ucwords(i.policy_title)} (<span class="text-${1==i.category_type?"":"danger"}">${1==i.category_type?"Paid":"Unpaid"}</span>)</h3>`,s+=`                    <p>(${getTypeNames(i.type_sid)})</p>`,s+="                </div>",s+='                <div class="clearfix"></div>',s+="            </div>",s+="            \x3c!-- Section 3 --\x3e",s+='            <div class="csBoxBalanceSection">',s+='                <div class="col-sm-12">',s+=`                    <p><strong>${null===a.applicableDate||""==a.applicableDate||0==a.applicableDate?"Joining Date":moment(a.applicableDate,"").format(timeoffDateFormat)}</strong></p>`,s+="                    <p>Applicable Date</p>",s+="                </div>",s+='                <div class="clearfix"></div>',s+="            </div>",s+="            \x3c!-- Section 3 --\x3e",s+='            <div class="csBoxBalanceSection">',s+='                <div class="col-sm-12">',s+=`                    <p><strong>${"yes"==a.carryOverCheck?"Yes":"No"}</strong></p>`,s+="                    <p>Carryover</p>",s+="                </div>",s+='                <div class="clearfix"></div>',s+="            </div>",s+="            \x3c!-- Section 3 --\x3e",s+='            <div class="csBoxBalanceSection">',s+='                <div class="col-sm-12">',s+=`                    <p><strong>${getAccrualText(a)}</strong></p>`,s+="                    <p>Accruals</p>",s+="                </div>",s+='                <div class="clearfix"></div>',s+="            </div>",s+="            \x3c!-- Section 3 --\x3e",s+='            <div class="csBoxBalanceSection">',s+='                <div class="col-sm-12">',s+=`                    <p><strong>${getAccrualText(a,!0)}</strong></p>`,s+="                    <p>New Hire</p>",s+="                </div>",s+='                <div class="clearfix"></div>',s+="            </div>",s+="        </div>",s+="            ",s+="        \x3c!-- Box Footer --\x3e",s+='        <div class="csBoxFooter">',s+='            <div class="col-sm-12">',0==i.default_policy&&(s+=`                <button class="btn btn-orange form-control ${l}"><i class="fa ${t}"></i>${o}</button>`);return s+="            </div>",s+="        </div>",s+="    </div>",s+="</div>",s}(l)})),load_pagination(e.CompanyPolicies.limit,5,$(".js-ip-pagination"),"CompanyPolicies"),$(".csLisitingArea").html(t),l=".csLisitingArea",$(l).sortable({placeholder:"ui-state-highlight"}),$(l).disableSelection(),$(".jsTooltip").tooltip({placement:"top"}),ml(!1,"policy");var l}(t)}else alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",(()=>{window.location.reload()}))}))):setTimeout((()=>{l()}),1e3)}function a(){return'\n            <div class="tabel-responsive">\n                <table class="table table-striped csCustomTableHeader">\n                    <thead>\n                        <tr>\n                            <th>Employee</th>\n                            <th>Action</th>\n                            <th>Action Type</th>\n                            <th>Action Taken</th>\n                        </tr>\n                    </thead>\n                    <tbody id="jsAllowedPolicyEmployeeTable"></tbody>\n                </table>\n            </div>\n        '}function s(){return'\n            <div id="jsManagePolicyTable">    \n            </div>\n        '}function n(){return'\n            <div id="jsAllowedPolicyEmployeeTable">    \n            </div>\n        '}function c(e){$.get(window.location.origin+"/timeoff/policy/"+e+"/history").success((function(e){$("#jsPolicyHistoryModalBody").html(e.view),ml(!1,"jsPolicyHistoryModalLoader")})).fail((function(e){let i=JSON.parse(e.responseText);if(401==e.status)return alertify.alert("ERROR!",i.errors.join("<br />"),(function(){}))}))}window.timeoff.PaginationOBJ.CompanyPolicies=e.CompanyPolicies,window.timeoff.fetchCompanyPolicies=l,""!=page&&"view"!=page||l(),$("#js-filter-from-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0,onSelect:function(e){$("#js-filter-to-date").datepicker("option","minDate",e)}}),$("#js-filter-to-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0}).datepicker("option","minDate",$("#js-filter-from-date").val()),$(".js-tab").click((function(){e.CompanyPolicies.Main.filter.archived="archived"===$(this).data("type")?1:0,l()})),$(document).on("click",".jsPolicyHistory",(function(){Modal({Id:1,Title:`Policy History for ${$(this).closest(".jsBox").data("name")}`,Body:a(),Loader:"jsPolicyHistoryLoader"},(()=>{var i;i=$(this).closest(".jsBox").data("id"),ml(!0,"jsPolicyHistoryLoader"),$("#jsPolicyHistoryTable").html(""),o=$.post(handlerURL,Object.assign(e.PolicyHistory.Main,{policyId:i}),(e=>{if(o=null,!0===e.Redirect)return void alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",(()=>{window.location.reload()}));if(!1===e.Status)return alertify.alert("WARNING!",e.Response,(()=>{})),void ml(!1,"jsPolicyHistoryLoader");let i="";0===e.Data.length?i=`\n                    <tr>\n                        <td colspan="4">\n                            <p class="alert alert-info text-center">${e.Response}</p>\n                        </td>\n                    </tr>\n                `:e.Data.map((e=>{i+=`\n                        <tr>\n                            <td>${remakeEmployeeName(e)}</td>\n                            <td>${e.action.toUpperCase()}</td>\n                            <td>${e.action_type.toUpperCase()}</td>\n                            <td>${moment(e.created_at).format(timeoffDateFormatWithTime)}</td>\n                        </tr>\n                    `})),$("#jsPolicyHistoryTable").html(i),ml(!1,"jsPolicyHistoryLoader")}))}))})),$(document).on("click",".jsManagePolicy",(function(){Modal({Id:"jsManagePolicy",Title:`Policy History for ${$(this).closest(".jsBox").data("name")}`,Body:s(),Loader:"jsManagePolicyLoader"},(()=>{var i;i=$(this).closest(".jsBox").data("id"),t=i,ml(!0,"jsManagePolicyLoader"),$("#jsPolicyHistoryTable").html(""),o=$.post(handlerURL,Object.assign(e.ManagePolicy.Main,{policyId:i}),(e=>{if(o=null,!0!==e.Redirect){if(!1===e.Status)return alertify.alert("WARNING!",e.Response,(()=>{})),void ml(!1,"jsManagePolicyLoader");$("#jsManagePolicyTable").html(e.View),$("#jsAssigPolicyToAll").select2({closeOnSelect:!0}),$("#jsAssigPolicyToAll").select2("val",i),ml(!1,"jsManagePolicyLoader")}else alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",(()=>{window.location.reload()}))}))}))})),$(document).on("click",".jsAllowedPolicyEmployees",(function(){Modal({Id:"jsAllowedPolicyEmployees",Title:`Employees entitled for ${$(this).closest(".jsBox").data("name")}`,Body:n(),Loader:"jsAllowedPolicyEmployeesLoader"},(()=>{var i;i=$(this).closest(".jsBox").data("id"),ml(!0,"jsAllowedPolicyEmployeesLoader"),$("#jsAllowedPolicyEmployeeTable").html(""),o=$.post(handlerURL,Object.assign(e.AllowedEmployees.Main,{policyId:i}),(e=>{if(o=null,!0!==e.Redirect){if(!1===e.Status)return alertify.alert("WARNING!",e.Response,(()=>{})),void ml(!1,"jsAllowedPolicyEmployeesLoader");$("#jsAllowedPolicyEmployeeTable").html(e.View),ml(!1,"jsAllowedPolicyEmployeesLoader")}else alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",(()=>{window.location.reload()}))}))}))})),$(document).on("click",".js-apply-filter-btn",(function(i){i.preventDefault(),e.CompanyPolicies.Main.filter.policy=$("#js-filter-policies").val(),e.CompanyPolicies.Main.filter.startDate=$("#js-filter-from-date").val(),e.CompanyPolicies.Main.filter.endDate=$("#js-filter-to-date").val(),e.CompanyPolicies.Main.filter.status=$("#js-filter-status").val(),e.CompanyPolicies.Main.page=1,e.CompanyPolicies.Main.limit=0,e.CompanyPolicies.Main.count=0,l()})),$(document).on("click",".js-reset-filter-btn",(function(i){i.preventDefault(),$("#js-filter-policies").select2("val","all"),$("#js-filter-from-date").val(""),$("#js-filter-to-date").val(""),$('#js-filter-status option[value="-1"]').prop("selected",!0),e.CompanyPolicies.Main.filter.policy="all",e.CompanyPolicies.Main.filter.startDate="",e.CompanyPolicies.Main.filter.endDate="",e.CompanyPolicies.Main.filter.status="-1",e.CompanyPolicies.Main.filter.archived=0,e.CompanyPolicies.Main.page=1,e.CompanyPolicies.Main.limit=0,e.CompanyPolicies.Main.count=0,l()})),$(".csLisitingArea").on("sortstop",(function(){var i=0,o={},t=$(".csLisitingArea").find(".jsBox").length;for(;i<t;i++)o[$(".csLisitingArea").find(".jsBox:eq("+i+")").data("id")]=i;!function(i){let o=Object.assign({},e.PolicySort.Main,{sort:i,type:"policies"});$.post(handlerURL,o,(e=>{ml(!1,"policy")}))}(o)})),$(document).on("click",".js-archive-btn",(function(e){e.preventDefault();var i=$(this);alertify.confirm("Do you really want to deactivate this policy?",(function(){var e={action:"archive_company_policy"};e.companyId=companyId,e.employeeId=employeeId,e.employerId=employerId,e.public=0,e.policySid=i.closest(".jsBox").data("id"),ml(!0,"policy"),$.post(handlerURL,e,(function(e){ml(!1,"policy"),!0!==e.Redirect?!1!==e.Status?alertify.alert("SUCCESS!",e.Response,(function(){loadViewPage()})):alertify.alert("WARNING!",e.Response,(function(){})):alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",(()=>{window.location.reload()}))}))})).set("labels",{ok:"YES",cancel:"NO"}).setHeader("CONFIRM!")})),$(document).on("click",".js-activate-btn",(function(e){e.preventDefault();var i=$(this);alertify.confirm("Do you really want to activate this policy?",(function(){var e={action:"activate_company_policy"};e.companyId=companyId,e.employeeId=employeeId,e.employerId=employerId,e.public=0,e.policySid=i.closest(".jsBox").data("id"),ml(!0,"policy"),$.post(handlerURL,e,(function(e){ml(!1,"policy"),!0!==e.Redirect?!1!==e.Status?alertify.alert("SUCCESS!",e.Response,(function(){loadViewPage()})):alertify.alert("WARNING!",e.Response,(function(){})):alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",(()=>{window.location.reload()}))}))})).set("labels",{ok:"YES",cancel:"NO"}).setHeader("CONFIRM!")})),$(document).on("change","#jsAssigPolicyToAll",(function(){let e=$(this).val();$(".jsAssignNewPolicy").val(e).change()})),$(document).on("click",".jsTransferPolicyBTN",(function(){var i,l=[];$(".jsAssignNewPolicy").each((function(e,i){var o=$(this).val();o!=t&&l.push({employeeId:$(this).closest(".jsEmployeeRow").data("sid"),oldPolicyId:t,newPolicyId:o})})),l.length&&(i=l,ml(!0,"jsManagePolicyLoader"),o=$.post(handlerURL,Object.assign(e.MigratePolicy.Main,{Data:i}),(e=>{if(o=null,!0!==e.Redirect)return!1===e.Status?(alertify.alert("WARNING!",e.Response,(()=>{})),void ml(!1,"jsManagePolicyLoader")):(ml(!1,"jsManagePolicyLoader"),alertify.alert("Success","The time off requests of the selected employees have been successfully transferred.",(function(){$("#jsManagePolicy .jsModalCancel").trigger("click")})));alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",(()=>{window.location.reload()}))})))})),$(document).on("click",".jsPolicyHistoryBtn",(function(e){e.preventDefault();let i=$(this).closest(".jsBox").data("id"),o=$(this).closest(".jsBox").data("name");Modal({Id:"jsPolicyHistoryModal",Title:'History for "'+o+'"',Loader:"jsPolicyHistoryModalLoader",Body:"<div id='jsPolicyHistoryModalBody'></div>"},c.bind(this,i))}))}));