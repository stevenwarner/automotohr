$((function(){let callOBJ={Requests:{Main:{action:"get_requests",companyId:companyId,employerId:employerId,employeeId:employeeId,level:level,isMine:1,type:"pending",filter:{employees:"all",policies:"all",status:"all",order:"upcoming",startDate:"",endDate:""},public:0}}},xhr=null,allComments;function resetFilter(e){e.preventDefault(),$("#js-filter-employee").select2("val","all"),$("#js-filter-policies").select2("val","all"),$("#js-filter-status").select2("val","all"),$("#js-filter-sort").select2("val","upcoming"),$("#js-filter-from-date").val(""),$("#js-filter-end-date").val(""),callOBJ.Requests.Main.filter.employees="all",callOBJ.Requests.Main.filter.policies="all",callOBJ.Requests.Main.filter.status="all",callOBJ.Requests.Main.filter.order="upcoming",callOBJ.Requests.Main.filter.startDate="",callOBJ.Requests.Main.filter.endDate="",callOBJ.Requests.Main.filter.isMine=0,fetchTimeOffs()}function applyFilter(e){e.preventDefault(),callOBJ.Requests.Main.filter.employees=$("#js-filter-employee").val(),callOBJ.Requests.Main.filter.policies=$("#js-filter-policies").val(),callOBJ.Requests.Main.filter.status=$("#js-filter-status").val(),callOBJ.Requests.Main.filter.order=$("#js-filter-sort").val(),callOBJ.Requests.Main.filter.startDate=$("#js-filter-from-date").val(),callOBJ.Requests.Main.filter.endDate=$("#js-filter-to-date").val(),fetchTimeOffs()}function fetchTimeOffs(){void 0!==window.timeoff.employees?null==xhr&&(ml(!0,"requests"),$(".js-error-row").remove(),xhr=$.post(handlerURL,callOBJ.Requests.Main,(function(resp){if(xhr=null,!0!==resp.Redirect){if(!1===resp.Status&&1==callOBJ.Balances.Main.page)return $(".js-ip-pagination").html(""),$("#js-data-area").html(`<tr class="js-error-row"><td colspan="${$(".js-table-head").find("th").length}"><p class="alert alert-info text-center">${resp.Response}</p></td></tr>`),void ml(!1,"requests");if(!1===resp.Status)return $(".js-ip-pagination").html(""),void ml(!1,"requests");0==callOBJ.Requests.Main.isMine?$("#request_status_info").show():$("#request_status_info").hide(),setTable(resp)}else alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()})}))):setTimeout(fetchTimeOffs,1e3)}function setTable(resp){let rows="";if(null==resp.Data||0==resp.Data.length)return $(".csContentWrap").html('<p class="alert alert-info text-center">No time-offs found.</p>'),void ml(!1,"requests");let sortedRequests={};allComments={},$.each(resp.Data,(function(i,v){let userRow=getUserById(v.employee_sid,window.timeoff.employees,"user_id");0!=Object.keys(userRow).length&&(null==sortedRequests[v.request_from_date]&&(sortedRequests[v.request_from_date]=[]),v.userRow=userRow,sortedRequests[v.request_from_date].push(v))})),rows="",$.each(sortedRequests,(function(i,v){rows+='<div class="csContentHead">',v.map((function(v0){rows+=getRequestBox(v0,v0.userRow)})),rows+="</div>"})),$(".csContentWrap").html(rows),$(".jsTooltip").tooltip({placement:"top",trigger:"hover"}),$(".jsCommentsPopover").popover({html:!0,placement:"right auto",trigger:"hover",template:'<div class="popover"><div class="arrow"></div><div class="popover-content"></div></div>'}).on("inserted.bs.popover",(function(e){let rows="<ul>";allComments[$(this).closest(".jsBox").data("id")][0].map((function(li){rows+=`<li><strong>${li.msg}</strong> <br /> ${li.employeeName} ${li.employeeRole} <br /> ${moment(li.time,timeoffDateFormatDWT).format(timeoffDateFormatWithTime)} <br /> ${li.employeeCanApprove}</li>`})),rows+="</ul>",$(this).next(".popover").find(".popover-content").html(rows)}))}function getApproverLisiting(history){if(0==history.length)return"";let rows="",arr=[];return history.map(his=>{if("create"==his.action)return"";if("{}"==his.note)return"";let action=JSON.parse(his.note);if(null==action.canApprove)return"";let msg=`${remakeEmployeeName(his)}`,il="";return"pending"==action.status?"":("approved"==action.status?(msg+=` has approved the time-off at ${moment(his.created_at).format(timeoffDateFormatWithTime)}`,il='<i class="fa fa-check-circle text-success"></i>'):"rejected"==action.status?(msg+=` has rejected the time-off at ${moment(his.created_at).format(timeoffDateFormatWithTime)}`,il='<i class="fa fa-times-circle text-danger"></i>'):"cancelled"!=action.status&&"cancel"!=action.status||(msg+=` has cancelled the time-off at ${moment(his.created_at).format(timeoffDateFormatWithTime)}`,il='<i class="fa fa-times-circle text-danger"></i>'),-1!==$.inArray(his.userId,arr)?"":(arr.push(his.userId),void(rows+=`\n                <div class="csApproverBox" title="Approver" data-content="${msg}">\n                    <img src="${null==his.image||""==his.image?awsURL+"test_file_01.png":awsURL+his.image}" style="width: 40px; height: 40px;" />\n                    ${il}\n                </div>\n            `)))}),rows}function getUpdateStatus(history){let msg="",status="pending",obj;return 0==history.length?status:(history.map((his,i)=>{let action=JSON.parse(his.note);"update"==his.action&&0==i&&(msg+=`${remakeEmployeeName(his)}`,"approved"==action.status?(status="approved",msg+=` has approved the time-off on ${moment(his.created_at).format(timeoffDateFormatWithTime)}`):"rejected"==action.status?(status="rejected",msg+=` has rejected the time-off on ${moment(his.created_at).format(timeoffDateFormatWithTime)}`):"cancelled"!=action.status&&"cancel"!=action.status||(status="cancelled",msg+=` has cancelled the time-off on ${moment(his.created_at).format(timeoffDateFormatWithTime)}`))}),{status:status,message:msg})}function getRequestBox(v,userRow){let progressStatus="pending"==v.status?"pending"!=v.level_status?50:0:100,comments=getComments(v.history),request_info=getUpdateStatus(v.history),bgStatusColor="",bgOldStatusColor="";if(0==callOBJ.Requests.Main.isMine){let tab_status;"pending"==v.status?($("#request_status_info").show(),"approved"==request_info.status?(bgStatusColor="background: rgba(129, 180, 49, .2)",bgOldStatusColor="background: none"):"rejected"==request_info.status&&(bgStatusColor="background: rgba(242, 222, 222, .5)",bgOldStatusColor="background: none")):$("#request_status_info").hide()}else $("#request_status_info").hide();let rows="",expired=0,allow_update=v.allow_update;return 1==callOBJ.Requests.Main.isMine&&(moment()>moment(v.request_from_date)?expired=1:"pending"==v.status&&"pending"==v.level_status||(expired=1)),rows+='<div class="col-lg-5 col-md-5 col-sm-12 col-xs-12">',rows+=`    <div class="csBox csShadow csRadius5 p0 jsBox" data-id="${v.sid}" data-status="${v.status}" data-userid="${v.employee_sid}" data-name="${userRow.first_name} ${userRow.last_name}" data-view="${expired}"\n        >`,rows+="        \x3c!-- Box Loader --\x3e",rows+=`        <div class="csIPLoader jsIPLoader dn" data-page="request${v.sid}"><i class="fa fa-circle-o-notch fa-spin"></i></div>`,rows+="        \x3c!-- Box Header --\x3e",rows+='        <div class="csBoxHeader csBoxHeaderBlue csRadius5 csRadiusBL0 csRadiusBR0">',rows+='            <span class="pull-right">',"yes"==allow_update&&(0==callOBJ.Requests.Main.isMine?rows+='                <span class="csCircleBtn csRadius50 jsTooltip jsEditTimeOff" title="Edit"><i class="fa fa-pencil"></i></span>':0==expired&&(rows+='                <span class="csCircleBtn csRadius50 jsTooltip jsEditTimeOff" title="Edit"><i class="fa fa-pencil"></i></span>')),rows+='                <span class="csCircleBtn csRadius50 jsTooltip jsHistoryTimeOff" title="Show History"><i class="fa fa-history"></i></span>',rows+=`                <a href="${baseURL}timeoff/print/requests/${v.sid}" target="_blank" style="color: #eee" class="csCircleBtn csRadius50 jsTooltip" title="Print"><i class="fa fa-print"></i></a>`,rows+=`                <a href="${baseURL}timeoff/download/requests/${v.sid}" target="_blank" style="color: #eee" class="csCircleBtn csRadius50 jsTooltip" title="Download"><i class="fa fa-download"></i></a>`,"yes"==allow_update&&0==callOBJ.Requests.Main.isMine&&(0==v.archive?rows+='                <span class="csCircleBtn csRadius50 jsTooltip jsArchiveTimeOff" title="Archive"><i class="fa fa-archive"></i></span>':rows+='                <span class="csCircleBtn csRadius50 jsTooltip jsActiveTimeOff" title="Activate"><i class="fa fa-sign-in"></i></span>'),rows+="            </span>",rows+='            <div class="clearfix"></div>',rows+="        </div>",rows+="        \x3c!-- Box Content --\x3e",rows+=`        <div class="csBoxContent" style="${bgStatusColor}">`,rows+="            \x3c!-- Section 1 --\x3e",rows+='            <div class="csBoxContentDateSection">',rows+='                <div class="col-sm-5 col-xs-5">',rows+=`                    <h3>${moment(v.request_from_date,timeoffDateFormatD).format(timeoffDateFormatB)}</h3>`,rows+=`                    <p>${moment(v.request_from_date,timeoffDateFormatD).format(timeoffDateFormatBD)}, ${moment(v.request_from_date,timeoffDateFormatD).format("Y")}</p>`,rows+="                </div>",rows+='                <div class="col-sm-2 col-xs-2 pl0 pr0">',rows+='                    <strong class="text-center">',rows+='                        <i class="fa fa-long-arrow-right"></i>',rows+="                    </strong>",rows+="                </div>",rows+='                <div class="col-sm-5 col-xs-5">',rows+=`                    <h3>${moment(v.request_to_date,timeoffDateFormatD).format(timeoffDateFormatB)}</h3>`,rows+=`                    <p>${moment(v.request_to_date,timeoffDateFormatD).format(timeoffDateFormatBD)}, ${moment(v.request_to_date,timeoffDateFormatD).format("Y")}</p>`,rows+="                </div>",rows+='                <div class="clearfix"></div>',rows+="            </div>",rows+="            \x3c!-- Section 2 --\x3e",rows+='            <div class="csBoxContentInfoSection">',rows+='                <div class="col-sm-12">',rows+=`                    <p><strong>${v.breakdown.text} of ${v.title} (<strong class="text-${1==v.categoryType?"success":"danger"}">${1==v.categoryType?"Paid":"Unpaid"}</strong>)</strong></p>`,rows+=`                    <p>Requested on ${moment(v.created_at,timeoffDateFormatDWT).format(timeoffDateFormatWithTime)}</p>`,rows+="                </div>",rows+='                <div class="clearfix"></div>',rows+="            </div>",rows+="            \x3c!-- Section 3 --\x3e",rows+='            <div class="csBoxContentEmpSection">',rows+='                <div class="col-sm-2 col-xs-2">',rows+=`                    <img src="${getImageURL(userRow.image)}" class="csRoundImg"  />`,rows+="                </div>",rows+='                <div class="col-sm-10 col-xs-10 pr0" style="padding-left: 26px;">',rows+=`                    <p><strong style="font-size: 20px;">${userRow.first_name} ${userRow.last_name}</strong> ${remakeEmployeeName(userRow,!1)} <br>  ${userRow.anniversary_text}</p>`,rows+="                </div>",rows+='                <div class="clearfix"></div>',rows+="            </div>",rows+="            \x3c!-- Section 4 --\x3e",rows+=`            <div class="csBoxContentProgressSection" style="${bgOldStatusColor}">`,rows+='                <div class="col-sm-12">',rows+='                    <div class="progress csRadius100">',rows+=`                        <div class="progress-bar progress-bar-success csRadius100" role="progressbar" aria-valuenow="${progressStatus}" aria-valuemin="0" aria-valuemax="100" style="width: ${progressStatus}% ;">`,rows+=`                            <span> ${progressStatus}% Completed</span>`,rows+="                        </div>",rows+="                    </div>",rows+="                </div>",rows+='                <div class="clearfix"></div>',rows+="            </div>",0==callOBJ.Requests.Main.isMine&&0==v.archive&&(comments.length>0&&(rows+="            \x3c!-- Section 5 --\x3e",rows+=`            <div class="csBoxContentComentSection" style="${bgOldStatusColor}">`,rows+='                <div class="col-sm-2 col-xs-2">',rows+=`                    <img src="${comments[0].employeeImage}" class="csRoundImg" />`,rows+="                </div>",rows+='                <div class="col-sm-10 col-xs-10 pr0" style="padding-left: 26px;">',rows+=`                    <p class="csBoxContentComentName">${comments[0].employeeName} ${comments[0].employeeRole}</p>`,employerId==comments[0].employeeSid&&(rows+=`                       <i class="fa fa-pencil jsEditNote" title="Edit Comment" data-empSid="${comments[0].employeeSid}" data-reqSid="${v.sid}"></i>`),rows+=`                    <p class="csBoxContentComentTag">${moment(comments[0].time,timeoffDateFormatDWT).format(timeoffDateFormatWithTime)}</p>`,0!=comments[0].msg.length&&(rows+=`                    <div>"${strip_tags(comments[0].msg).substr(0,25)}"</div>`),"approved"==comments[0].status?rows+=`                    <div class="text-success"><b>${strip_tags(comments[0].status).toUpperCase()}</b></div>`:rows+=`                    <div class="text-danger"><b>${strip_tags(comments[0].status).toUpperCase()}</b></div>`,void 0===allComments[v.sid]&&(allComments[v.sid]=[]),allComments[v.sid].push(comments),rows+='                    <span class="jsCommentsPopover" title="p">',rows+='                        <i class="fa fa-comment"></i>',rows+="                    </span>",rows+="                </div>",rows+='                <div class="clearfix"></div>',rows+="            </div>"),rows+="            \x3c!-- Section 6 --\x3e",rows+='            <div class="csBoxContentComent2Section">',rows+='                <div class="col-sm-12 col-xs-12 textarea_parent_div">',rows+='                    <textarea class="form-control jsRequestCommentTxt" rows="4" placeholder="Why are you approving/rejecting this time off?"></textarea>',rows+="                </div>",rows+='                <div class="clearfix"></div>',rows+="            </div>"),rows+="        </div>",rows+="        \x3c!-- Box Footer --\x3e",rows+='        <div class="csBoxFooter">',1==callOBJ.Requests.Main.isMine?1==expired?"approved"==v.status&&"approved"==v.level_status&&moment(v.request_from_date)>moment()?(rows+='            <div class="col-sm-6">',rows+='               <button class=" btn alert-danger btn-theme form-control jsCancelTimeOffRequest"><i class="fa fa-times-circle-o"></i> Cancel Request</button>',rows+="            </div>",rows+='            <div class="col-sm-6">',rows+='                <button class="btn btn-orange btn-theme form-control jsEditTimeOff"><i class="fa fa-eye"></i> View</button>',rows+="            </div>"):(rows+='            <div class="col-sm-12">',rows+='                <button class="btn btn-orange btn-theme form-control jsEditTimeOff"><i class="fa fa-eye"></i> View</button>',rows+="            </div>"):"pending"==v.status&&"pending"==v.level_status&&moment(v.request_from_date)>moment()&&(rows+='            <div class="col-sm-12">',rows+='               <button class=" btn alert-danger btn-theme form-control jsCancelTimeOffRequest"><i class="fa fa-times-circle-o"></i> Cancel Request</button>',rows+="            </div>"):"yes"==allow_update&&(1==v.archive?(rows+='            <div class="col-sm-12">',rows+='                <button class="btn btn-orange form-control"><i class="fa fa-eye"></i> View</button>',rows+="            </div>"):"pending"==v.status?(rows+='            <div class="col-sm-6 pl0 pr0">',rows+='                <button class="btn btn-orange form-control jsRequestBtn" data-type="approve"><i class="fa fa-clock-o"></i> Approve</button>',rows+="            </div>",rows+='            <div class="col-sm-6 pr0">',rows+='                <button class="btn alert-danger btn-theme form-control jsRequestBtn" data-type="reject"><i class="fa fa-times-circle-o"></i> Reject</button>',rows+="            </div>"):"approved"==v.status?(rows+='            <div class="col-sm-12">',rows+='                <button class="btn alert-danger btn-theme form-control jsRequestBtn" data-type="reject"><i class="fa fa-times-circle-o"></i> Reject</button>',rows+="            </div>"):"rejected"==v.status?(rows+='            <div class="col-sm-12">',rows+='                <button class="btn btn-orange form-control jsRequestBtn" data-type="approve"><i class="fa fa-clock-o"></i> Approve</button>',rows+="            </div>"):"cancelled"==v.status?(rows+='            <div class="col-sm-6 pl0 pr0">',rows+='                <button class="btn btn-orange form-control jsRequestBtn" data-type="approve"><i class="fa fa-clock-o"></i> Approve</button>',rows+="            </div>",rows+='            <div class="col-sm-6 pr0">',rows+='                <button class="btn alert-danger btn-theme form-control jsRequestBtn" data-type="reject"><i class="fa fa-times-circle-o"></i> Reject</button>',rows+="            </div>"):(rows+='            <div class="col-sm-12">',rows+='                <button class="btn btn-orange btn-theme form-control"><i class="fa fa-eye"></i> View</button>',rows+="            </div>")),rows+="        </div>",rows+="    </div>",rows+="</div>",rows}function sendUpdateStatusRequest(obj){ml(!0,`request${obj.requestId}`),$.post(handlerURL,obj,(function(resp){alertify.alert("SUCCESS!",resp.Response,(function(){$(".js-apply-filter-btn").click(),ml(!1,`request${obj.requestId}`)}))}))}function getComments(history){let comments=[];if(0==history.length)return comments;let arr=[];return history.map(his=>{if("create"==his.action)return;if("{}"==his.note)return;let action=JSON.parse(his.note),approvel_rights="";if(null==action.canApprove)return;1==action.canApprove?approvel_rights="Time-off approved 100%":0==action.canApprove&&(approvel_rights="Time-off approved 50%");let obj={status:"approved",msg:action.comment||"",time:his.created_at,employeeName:`${his.first_name} ${his.last_name}`,employeeRole:remakeEmployeeName(his,!1),employeeImage:null==his.image||""==his.image?awsURL+"test_file_01.png":awsURL+his.image,employeeCanApprove:approvel_rights,employeeSid:his.userId};"pending"!=action.status&&("approved"==action.status?obj.status="approved":"rejected"==action.status?obj.status="rejected":"cancelled"!=action.status&&"cancel"!=action.status||(obj.status="cancelled"),comments.push(obj))}),comments}window.timeoff.isMine=callOBJ.Requests.Main.isMine,$("#js-filter-status").select2(),$("#js-filter-sort").select2({minimumResultsForSearch:-1}),$("#js-filter-from-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0,onSelect:function(v){$("#js-filter-to-date").datepicker("option","minDate",v)}}),$("#js-filter-to-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0}).datepicker("option","minDate",$("#js-filter-from-date").val()),$(document).on("click",".js-apply-filter-btn",applyFilter),$(document).on("change","#js-filter-sort",applyFilter),$(document).on("click",".js-reset-filter-btn",resetFilter),$(document).on("change",".jsEditResetCheckbox",applyFilter),$(".jsReportTab").click((function(e){e.preventDefault(),callOBJ.Requests.Main.type=$(this).data("key"),$(".jsReportTab").parent().removeClass("active").removeClass("csActiveTab"),$(this).parent().addClass("active").addClass("csActiveTab"),fetchTimeOffs()})),$('.jsReportTab[data-key="pending"]').trigger("click"),$(".jsArchiveTab").hide(0),$(".jsTeamShiftTab").click((function(e){e.preventDefault(),$(".jsTeamShiftTab").removeClass("active"),$(this).addClass("active"),callOBJ.Requests.Main.isMine=$(this).data("key"),window.timeoff.isMine=callOBJ.Requests.Main.isMine,1==callOBJ.Requests.Main.isMine?($(".csPolicyBox").show(),$(".jsGraphBox").show(),$(".jsArchiveTab").hide(),$(".jsRequestSeparator").show(),$(".jsCreateRequestEMP").parent().show(),$(".jsRequestTag").removeClass("col-sm-9"),$(".jsRequestTag").addClass("col-sm-6")):($(".csPolicyBox").hide(),$(".jsGraphBox").hide(),$(".jsArchiveTab").show(),$(".jsRequestSeparator").hide(),$(".jsCreateRequestEMP").parent().hide(),$(".jsRequestTag").removeClass("col-sm-6"),$(".jsRequestTag").addClass("col-sm-9")),$('.jsReportTab[data-key="pending"]').trigger("click")})),$(document).on("click",".jsArchiveTimeOff",(function(e){e.preventDefault();let requestId=$(this).closest(".jsBox").data("id");alertify.confirm("Do you really want to archive this time off?",()=>{ml(!0,"requests"),$.post(handlerURL,Object.assign({action:"archive_request",companyId:companyId,employerId:employerId,employeeId:employeeId},{requestId:requestId,archive:1}),resp=>{alertify.alert("SUCCESS",resp.Response,()=>{$(".js-apply-filter-btn").click()})})},()=>{}).set("labels",{ok:"YES",cancel:"NO"}).setHeader("CONFIRM!")})),$(document).on("click",".jsActiveTimeOff",(function(e){e.preventDefault();let requestId=$(this).closest(".jsBox").data("id");alertify.confirm("Do you really want to activate this time off?",()=>{ml(!0,"requests"),$.post(handlerURL,Object.assign({action:"archive_request",companyId:companyId,employerId:employerId,employeeId:employeeId},{requestId:requestId,archive:0}),resp=>{alertify.alert("SUCCESS",resp.Response,()=>{$(".js-apply-filter-btn").click()})})},()=>{}).set("labels",{ok:"YES",cancel:"NO"}).setHeader("CONFIRM!")})),$(document).on("click",".jsCancelTimeOffRequest",(function(e){e.preventDefault();let requestId=$(this).closest(".jsBox").data("id");alertify.confirm("Do you really want to cancel this time off request?",()=>{ml(!0,"requests"),$.post(handlerURL,Object.assign({action:"cancel_request",companyId:companyId,employerId:employerId,employeeId:employeeId},{requestId:requestId}),resp=>{alertify.alert("SUCCESS",resp.Response,()=>{window.location.reload()})})},()=>{})})),$(document).on("click",".jsHistoryTimeOff",(function(e){e.preventDefault();let requestId=$(this).closest(".jsBox").data("id");Modal({Id:"jsTimeOffHistory",Title:"Time off - History",Body:' \n                <div class="row">\n                <div class="col-sm-3">\n                    <div id="jsData"></div>\n                </div>\n                <div class="col-sm-9">\n                    <div class="tabel-responsive">\n                        <table class="table table-striped csCustomTableHeader">\n                            <thead>\n                                <tr>\n                                    <th>Employee</th>\n                                    <th>Details</th>\n                                    <th>Action</th>\n                                    <th>Comment</th>\n                                    <th>Action Taken</th>\n                                </tr>\n                            </thead>\n                            <tbody id="jsTimeOffHistoryTable"></tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>',Loader:"jsTimeOffHistoryLoader"},()=>{ml(!0,"jsTimeOffHistoryLoader"),$("#jsPolicyHistoryTable").html(""),$.post(handlerURL,Object.assign({action:"get_request_history",companyId:companyId,employerId:employerId,employeeId:employeeId},{requestId:requestId}),resp=>{if(!0===resp.Redirect)return void alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()});if($("#jsData").html(`\n                        <div class="employee-info">\n                            <figure>\n                                <img src="${$(`.jsBox[data-id="${requestId}"]`).find(".csBoxContentEmpSection img").prop("src")}" class="img-circle emp-image" />\n                            </figure>\n                            <div class="text">\n                                <h4>${$(`.jsBox[data-id="${requestId}"]`).find(".csBoxContentEmpSection p").html()}</h4>\n                                <p><strong>Policy: </strong></p>\n                            </div>\n                        </div>\n                    `),!1===resp.Status)return alertify.alert("WARNING!",resp.Response,()=>{}),void ml(!1,"jsTimeOffHistoryLoader");let rows="";0===resp.Data.length?rows=`\n                        <tr>\n                            <td colspan="5">\n                                <p class="alert alert-info text-center">${resp.Response}</p>\n                            </td>\n                        </tr>\n                    `:resp.Data.map(v=>{let note=JSON.parse(v.note),act="",comment="-";"create"==v.action?act="Time-off created.":(void 0!==note.status?("archive"==note.status?act="Time-off marked as archive":"activate"==note.status?act="Time-off marked as active":"approved"==note.status&&1==note.canApprove?act="Time-off approved 100%":"approved"==note.status&&0==note.canApprove?act="Time-off approved 50%":"rejected"==note.status&&1==note.canApprove?act="Time-off rejected 100%":"rejected"==note.status&&0==note.canApprove?act="Time-off rejected 50%":"pending"==note.status&&0==note.canApprove?act="Time-off updated":"cancelled"==note.status&&(act="Time-off cancelled"),null!=note.comment&&""!=note.comment&&(comment=note.comment)):act="","update"==v.action&&""==act&&(act="Time-off updated.")),rows+="<tr>",rows+="<td>",rows+='        <div class="employee-info">',rows+="            <figure>",rows+=`                <img src="${getImageURL(v.image)}" class="img-circle emp-image" />`,rows+="            </figure>",rows+='            <div class="text">',rows+=`                <h4>${v.first_name} ${v.last_name} </h4>`,rows+=`                <p>${remakeEmployeeName(v,!1)}</p>`,rows+=`                <p><a href="${baseURL}employee_profile/${v.userId}" target="_blank">Id: ${getEmployeeId(v.userId,v.employee_number)}</a></p>`,rows+=`                <p>${v.anniversary_text}</p>`,rows+="            </div>",rows+="        </div></td>",rows+="                <td>",void 0!==note.details&&(rows+=`                   <div class="upcoming-time-info">            \n                            <div class="icon-image">                   \n                                <img src="${baseURL}assets/images/upcoming-time-off-icon.png" class="emp-image" alt="emp-1">             \n                            </div>             \n                            <div class="text">                  \n                                <h4>${note.details.startDate==note.details.endDate?moment(note.details.startDate).format(timeoffDateFormat):moment(note.details.startDate).format(timeoffDateFormat)+" - "+moment(note.details.endDate).format(timeoffDateFormat)}</h4>                  \n                                <span>${note.details.policyTitle}</span><br />          \n                                <span>${get_array_from_minutes(note.details.time,v.user_shift_hours,"H:M").text}</span>\n                            </div>       \n                        </div>`),rows+="                </td>",rows+=`                <td>${act}</td>`,rows+=`                <td>${comment}</td>`,rows+=`                <td>${moment(v.created_at).format(timeoffDateFormatWithTime)}</td>`,rows+="            </tr>"}),$("#jsTimeOffHistoryTable").html(rows),ml(!1,"jsTimeOffHistoryLoader")})})})),$(document).on("click",".jsViewPolicies",(function(e){e.preventDefault(),startPolicyProcess(employeeId,employeeName)})),$(document).on("click",".jsHolidays",(function(e){e.preventDefault(),Modal({Id:"jsHolidayModal",Title:"Company Holidays",Body:' \n            <div class="tabel-responsive">\n                <table class="table table-striped csCustomTableHeader">\n                    <thead>\n                        <tr>\n                            <th>Holiday</th>\n                            <th>Date</th>\n                        </tr>\n                    </thead>\n                    <tbody id="jsHolidayModalTable"></tbody>\n                </table>\n            </div>',Loader:"jsHolidayModalLoader"},()=>{ml(!0,"jsHolidayModalLoader"),$("#jsHolidayModalTable").html("");let rows="";0===window.timeoff.holidays.length?rows=`\n                    <tr>\n                        <td colspan="2">\n                            <p class="alert alert-info text-center">${resp.Response}</p>\n                        </td>\n                    </tr>\n                `:window.timeoff.holidays.map(v=>{rows+=`\n                        <tr>\n                            <td>${v.holiday_title}</td>\n                            <td>${getHolidayText(v)}</td>\n                        </tr>\n                    `}),$("#jsHolidayModalTable").html(rows),ml(!1,"jsHolidayModalLoader")})})),window.fetchTimeOffs=fetchTimeOffs,$(document).on("click",".jsRequestBtn",(function(){let tab=callOBJ.Requests.Main.type,obj={action:"request_status",companyId:companyId,employerId:employeeId,employeeId:employeeId,sendEmailNotification:1,requestId:$(this).closest(".jsBox").data("id"),status:"approve"==$(this).data("type")?"approved":"rejected",comment:$(this).closest(".jsBox").find(".jsRequestCommentTxt").val()};if("pending"==tab){let request_sid=$(this).closest(".jsBox").data("id"),request_type=$(this).data("type");ml(!0,`request${request_sid}`);let myurl=handlerURL+"/requests_status/"+companyId+"/"+request_sid+"/"+request_type;$.ajax({type:"GET",url:myurl,async:!1,success:function(resp){ml(!1,`request${request_sid}`),!0===resp.Status?alertify.confirm("Please Confirm",resp.message,(function(){sendUpdateStatusRequest(obj)}),(function(){})):sendUpdateStatusRequest(obj)},error:function(resp){}})}else sendUpdateStatusRequest(obj)}));var RTOT="my";function get_user_access_level(){ml(!0,"jsReportModalLoader");var my_url=baseURL+"timeoff/get_employee_status/"+employeeId;$.ajax({url:my_url,cache:!1,contentType:!1,processData:!1,type:"get",success:function(resp){ml(!1,"jsReportModalLoader"),"no"==resp.allow_access?($("#filter_employees_section").hide(),$("#filter_departments_section").hide(),$("#filter_teams_section").hide(),$("#filter_jobtitle_section").hide(),$("#filter_employeetype_section").hide(),$("#user_allow").val("no"),$("#tab_filter").hide()):($("#filter_employees").html(resp.employee),$("#filter_departments").html(resp.department),$("#filter_teams").html(resp.team),$("#user_allow").val("yes"),$("#tab_filter").show()),get_timeoff_report()},error:function(){}})}function get_timeoff_report(){ml(!0,"jsReportModalLoader");var URL=baseURL+"timeoff/get_report/"+employeeId,formData=$("#form_filter").serialize();$.ajax({url:URL,cache:!1,contentType:!1,processData:!1,type:"GET",data:formData,success:function(resp){ml(!1,"jsReportModalLoader"),$("#timeoff_container").html(resp.modal),$("#request_token").val(resp.session_token),"my"==RTOT&&(console.log(RTOT),$("tr").filter((function(){return this.className.match(/timeoff_/)})).show()),"no"==resp.main_action_button&&$(".jsReportLink").hide()},error:function(){}})}$(".jsReport").click((function(e){e.preventDefault(),Modal({Id:"jsReportModal",Title:"Time-off Report",Loader:"jsReportModalLoader",Body:`<div class="row">\n            <div class="col-sm-12 col-xs-12">\n                <div class="form-group">\n                    <div class="row">\n                        <div class="col-sm-3 col-xs-12">\n                            <div class="panel-heading col-sm-12 col-xs-12" id="tab_filter" style="background-color: #3554DC !important; color: #fff; padding-bottom: 0; padding-left: 5px;">\n                            <span>\n                            <a href="javascript:;" style="display: inline-block; padding: 11px" class="" id="my_tf_btn" placement="top" data-key="0" data-original-title="Show time offs for my team members">My Time-off</a>\n                            </span>\n                            <span>\n                                <a href="javascript:;" style="display: inline-block; padding: 11px" class="" id="all_tf_btn" placement="top" data-key="0" data-original-title="Show time offs for my team members">All Time-off</a>\n                            </span>\n                            <div class="clearfix"></div>\n                            </div>\n                            \x3c!--  --\x3e\n                            <form action="" method="GET" id="form_filter">\n                                <div class="form-group" id="filter_employees_section">\n                                    <label>Employee(s)</label>\n                                    <select multiple="true" name="employees" id="filter_employees">\n                                        \n                                    </select>\n                                </div>\n                                \x3c!--  --\x3e\n                                <div class="form-group" id="filter_departments_section">\n                                    <label>Department(s)</label>\n                                    <select multiple="true" name="departments" id="filter_departments">\n                                        \n                                    </select>\n                                </div>\n                                \x3c!--  --\x3e\n                                <div class="form-group" id="filter_teams_section">\n                                    <label>Team(s)</label>\n                                    <select multiple="true" name="teams" id="filter_teams">\n                                        \n                                    </select>\n                                </div>\n                                \x3c!--  --\x3e\n                                <div class="form-group" id="filter_jobtitle_section">\n                                    <label>Job Title(s)</label>\n                                    <select id="jsJobTitles" multiple="true">\n                                    \n                                    </select>\n                                </div>\n                                \x3c!--  --\x3e\n                                <div class="form-group" id="filter_employeetype_section">\n                                    <label>Employment Type(s)</label>\n                                    <select id="jsEmploymentTypes" multiple="true">\n                                        <option value="fulltime">Full-time</option>\n                                        <option value="parttime">Part-time</option>\n                                    </select>\n                                </div>\n                                \x3c!--  --\x3e\n                                <div class="form-group">\n                                    <label>Start Date</label>\n                                    <input type="text" id="jsReportStartDate" name="startDate" class="form-control" readonly />\n                                </div>\n                                \x3c!--  --\x3e\n                                <div class="form-group">\n                                    <label>End Date</label>\n                                    <input type="text" id="jsReportEndDate" name="endDate" class="form-control" readonly />\n                                </div>\n                                <input type="hidden" name="user_allow" id="user_allow">\n                                <input type="hidden" name="request_type" id="request_type">\n                                <input type="hidden" name="request_token" id="request_token">\n                                <div class="form-group">\n                                    <button class="btn btn-success form-control jsGetReport" data-href="${baseURL+"timeoff/get_report/"+employeeId}">Apply Filter</button>\n                                </div>\n                            </form>    \n                            \x3c!--  --\x3e\n                            <div class="form-group">\n                                <a href="<?php echo base_url('timeoff/report'); ?>" class="btn btn-black form-control">Clear Filter</a>\n                            </div>\n                        </div>\n                        <div class="col-sm-9 col-xs-12">\n                            <span class="pull-right">\n                                <button class="btn btn-success jsReportLink" data-href="${baseURL+"timeoff/report/print/all"}"><i class="fa fa-print" aria-hidden="true"></i>&nbsp;Print</button>\n                                <button class="btn btn-success jsReportLink" data-href="${baseURL+"timeoff/report/download/all"}"><i class="fa fa-download" aria-hidden="true"></i>&nbsp;Download</button>\n                            </span>\n                            <div class="clearfix"></div>\n                            <div class="table-responsive">\n                                <table class="table table-striped table-condensed">\n                                    <caption></caption>\n                                    <thead>\n                                        <tr style="background: #444444; color:#fff;">\n                                            <th scope="col">Employee Name</th>\n                                            <th scope="col">Department</th>\n                                            <th scope="col">Team</th>\n                                            <th scope="col"># of Requests</th>\n                                            <th scope="col">Actions</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody id="timeoff_container"></tbody>\n                                </table>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>`},(function(){var date=new Date,y=date.getFullYear(),m=date.getMonth(),firstDay=new Date(y,m,1),lastDay=new Date(y,m+1,0),type=$(".jsReport").attr("data-action"),enable={backgroundColor:"#fd7a2a",color:"#fff"},disable={backgroundColor:"#fff",color:"#000"};get_user_access_level(),$("#filter_employees").select2({closeOnSelect:!1}),$("#filter_departments").select2({closeOnSelect:!1}),$("#filter_teams").select2({closeOnSelect:!1}),$("#jsJobTitles").select2({closeOnSelect:!1}),$("#jsEmploymentTypes").select2({closeOnSelect:!1}),$("#my_tf_btn").css(enable),$("#all_tf_btn").css(disable),$("#request_type").val("my"),$("#filter_employees_section").hide(),$("#filter_departments_section").hide(),$("#filter_teams_section").hide(),$("#filter_jobtitle_section").hide(),$("#filter_employeetype_section").hide(),$("#jsReportStartDate").val($.datepicker.formatDate("mm/dd/yy",firstDay)),$("#jsReportEndDate").val($.datepicker.formatDate("mm/dd/yy",lastDay)),ml(!1,"jsReportModalLoader"),$("#jsReportStartDate").datepicker({format:"m/d/y",changeMonth:!0,changeYear:!0,onSelect:function(d){$("#jsReportEndDate").datepicker("option","minDate",d)}}),$("#all_tf_btn").on("click",(function(){$("#request_type").val("all"),$("#my_tf_btn").css(disable),$("#all_tf_btn").css(enable),RTOT="all",$("#filter_employees_section").show(),$("#filter_departments_section").show(),$("#filter_teams_section").show(),$("#filter_jobtitle_section").show(),$("#filter_employeetype_section").show(),get_timeoff_report()})),$("#my_tf_btn").on("click",(function(){RTOT="my",$("#request_type").val("my"),$("#my_tf_btn").css(enable),$("#all_tf_btn").css(disable),$("#filter_employees_section").hide(),$("#filter_departments_section").hide(),$("#filter_teams_section").hide(),$("#filter_jobtitle_section").hide(),$("#filter_employeetype_section").hide(),get_timeoff_report()})),$("#jsReportEndDate").datepicker({format:"m/d/y",changeMonth:!0,changeYear:!0}),$(document).on("click",".timeoff_count",(function(){$("."+$(this).data("id")).toggle()})),$(".jsGetReport").click((function(c){c.preventDefault();let startDate=$("#jsReportStartDate").val()||"all",endDate=$("#jsReportEndDate").val()||"all";ml(!0,"jsReportModalLoader");var URL=$(this).data("href"),formData=$("#form_filter").serialize();$.ajax({url:URL,cache:!1,contentType:!1,processData:!1,type:"GET",data:formData,success:function(resp){$("#request_token").val(resp.session_token),$("#timeoff_container").html(resp.modal),ml(!1,"jsReportModalLoader")},error:function(){}})})),$(".jsReportLink").click((function(c){c.preventDefault();let startDate=$("#jsReportStartDate").val()||"all",endDate=$("#jsReportEndDate").val()||"all",token=$("#request_token").val();window.open($(this).data("href")+"?start="+startDate+"&end="+endDate+"&token="+token)}))}))})),$(document).on("click",".jsEditNote",(function(){let request_sid=$(this).closest(".jsBox").data("id"),employeeSid=$(this).attr("data-empSid"),obj={action:"get_employee_note",companyId:companyId,employerId:employerId,employeeId:employeeSid,requestId:request_sid};$.post(handlerURL,obj,(function(resp){$("#jsRequestSid").val(request_sid),$("#jsEmployeeSid").val(employeeSid),$("#jsNoteSection").val(resp.Comment),null!==window.location.pathname.match(/lms/gi)&&$("#document_modal_title").css("color","#fff"),$("#jsAddNoteModal").modal("show")}))})),$(document).on("click","#jsSaveEmployeeNote",(function(){if($("#jsAddNoteModalLoader").show(),0==$("#jsNoteSection").val().trim().length)alertify.alert("Notice","Comment is required!");else{$("#jsSaveEmployeeNote").prop("disabled",!0);let obj={action:"update_employee_note",companyId:companyId,employerId:employerId,employeeId:$("#jsEmployeeSid").val(),requestId:$("#jsRequestSid").val(),comment:$("#jsNoteSection").val()};$.post(handlerURL,obj,(function(resp){$("#jsAddNoteModalLoader").hide(),$("#jsSaveEmployeeNote").prop("disabled",!1),alertify.alert("SUCCESS!",resp.Response,(function(){$("#jsAddNoteModal").modal("hide"),fetchTimeOffs()}))}))}}))}));