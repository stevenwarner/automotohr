$((function(){let e={Balances:{Main:{action:"get_balances",companyId:companyId,employerId:employerId,employeeId:employeeId,level:level,filter:{employees:getParams("id"),policies:getParams("pid"),type:$(".jsEditResetCheckbox:checked").val(),all:0},public:0,inset:0,offset:10}}},a=null,t={};function s(a){a.preventDefault(),e.Balances.Main.inset=0,e.Balances.Main.offset=10,e.Balances.Main.filter.employees=$("#js-filter-employee").val(),e.Balances.Main.filter.employeeStatus=$(".jsFilterEmployeeStatus").val(),e.Balances.Main.filter.policies=null==$("#js-filter-policies").val()?"all":$("#js-filter-policies").val(),e.Balances.Main.filter.type=$(".jsEditResetCheckbox:checked").val(),window.location="?id="+e.Balances.Main.filter.employees+"&employee_status="+e.Balances.Main.filter.employeeStatus}function n(){void 0!==window.timeoff.employees?null==a&&($("#js-filter-employee > option").length&&$("#js-filter-employee").select2("val",getParams("id")),$("#js-filter-policies > option").length&&$("#js-filter-policies").select2("val",getParams("pid")),ml(!0,"balance"),$(".js-error-row").remove(),e.Balances.Main.filter.all=getSearchParam("employee_status")||0,a=$.post(handlerURL,e.Balances.Main,(function(t){if(a=null,!0!==t.Redirect)if(null!=t.Data.Balances&&0!=t.Data.Balances.length){if(!1===t.Status&&1==e.Balances.Main.page)return $(".js-ip-pagination").html(""),$("#js-data-area").html(`<tr class="js-error-row"><td colspan="${$(".js-table-head").find("th").length}"><p class="alert alert-info text-center">${t.Response}</p></td></tr>`),void ml(!1,"balance");if(!1===t.Status)return $(".js-ip-pagination").html(""),void ml(!1,"balance");0==e.Balances.Main.inset&&i(),l(t)}else ml(!1,"balance");else alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",(()=>{window.location.reload()}))}))):setTimeout((()=>{n()}),1e3)}function l(e,a){let s="";0!=e.Data.Balances.length&&($.each(e.Data.Balances,(function(a,n){if(void 0!==n.total){let a=getUserById(n.total.UserId,e.Data.Employees,"userId");if(0==Object.keys(a).length)return;s+=function(e,a,t){return`\n        \x3c!--  --\x3e\n        <div class="col-sm-3">\n            <div class="csBox jsBox csShadow csRadius5"  data-id="${e.total.UserId}" data-name="${a.first_name} ${a.last_name}" data-anniversary="${a.anniversary_text}">\n                \x3c!-- Box Header --\x3e\n                <div class="csBoxHeader csRadius5 csRadiusBL0 csRadiusBR0">\n                    <span class="pull-right">\n                        <span target="_blank" class="csCircleBtn csRadius50 jsViewPolicies jsTooltip" title="View Policies" placement="top"><i class="fa fa-eye"></i></span>\n                        <span target="_blank" class="csCircleBtn csRadius50 jsViewBalance jsTooltip" title="Manage Balance" placement="top"><i class="fa fa-balance-scale"></i></span>\n                        <span target="_blank" class="csCircleBtn csRadius50 jsViewApprovers jsTooltip" title="View Approvers" placement="top"><i class="fa fa-users"></i></span>\n                    </span>\n                    <div class="clearfix"></div>\n                </div>\n                \x3c!-- Box Content --\x3e\n                <div class="csBoxContent">\n                    \x3c!-- Section 1 --\x3e\n                    <div class="csBoxContentEmpployeeSection">\n                        <a href="${baseURL}employee_profile/${a.userId}" target="_blank">\n                        <div class="col-sm-3">\n                            <img src="${getImageURL(a.image)}" class="csRoundImg" />\n                        </div>\n                        <div class="col-sm-9 pr0">\n                            <p><strong>${a.first_name} ${a.last_name}</strong>${"1"===a.terminated_status?' (<span class="text-danger">Terminated</span>)':""}\n        ${"0"===a.terminated_status&&"0"===a.active?' (<span class="text-danger">Deactivated</span>)':""}\n                            <br /> ${remakeEmployeeName(a,!1)}</p>\n                            ${a.anniversary_text}\n                            </div>\n                        </a>\n                        <div class="clearfix"></div>\n                    </div>\n                    \x3c!-- Section 2 --\x3e\n                    <div class="csBoxBalanceSection">\n                        <div class="col-sm-12">\n                            <p><strong>${""==e.total.AllowedTime.text?"0 hours":e.total.AllowedTime.text}</strong></p>\n                            <p>Allowed Time</p>\n                            \x3c!--  --\x3e\n                            <div class="csFixedToRight jsCustomPopover" data-type="allowed" title="p" placement="right">\n                                <i class="fa fa-plus-circle"></i>\n                            </div>\n                        </div>\n                        <div class="clearfix"></div>\n                    </div>\n                    \x3c!-- Section 3 --\x3e\n                    <div class="csBoxBalanceSection">\n                        <div class="col-sm-12">\n                            <p><strong>${""==e.total.ConsumedTime.text?"0 hours":e.total.ConsumedTime.text}</strong></p>\n                            <p>Consumed Paid Time</p>\n                        </div>\n                        <div class="clearfix"></div>\n                    </div>\n                    \x3c!-- Section 4 --\x3e\n                    <div class="csBoxBalanceSection">\n                        <div class="col-sm-12">\n                            <p><strong>${""==e.total.UnpaidConsumedTime.text?"0 hours":e.total.UnpaidConsumedTime.text}</strong></p>\n                            <p>Consume Unpaid Time</p>\n                        </div>\n                        <div class="clearfix"></div>\n                    </div>\n                    \x3c!-- Section 5 --\x3e\n                    <div class="csBoxBalanceSection">\n                        <div class="col-sm-12">\n                            <p><strong>${""==e.total.RemainingTime.text?"0 hours":e.total.RemainingTime.text}</strong></p>\n                            <p>Remaining Time</p>\n                            \x3c!--  --\x3e\n                            <div class="csFixedToRight jsCustomPopover" data-type="pending" title="p">\n                                <i class="fa fa-plus-circle"></i>\n                            </div>\n                        </div>\n                        <div class="clearfix"></div>\n                    </div>\n                </div>\n                \x3c!-- Box Footer --\x3e\n                <div class="csBoxFooter">\n                    <div class="col-sm-12 pl0 pr0">\n                        <button class="btn btn-orange btn-lg form-control jsCreateRequest"><i class="fa fa-plus-circle"></i> Create time-off</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n        `}(n,a),t[n.total.UserId]={allowed:[],pending:[]},$.each(n,((e,a)=>{if("total"==e)return"";t[n.total.UserId].allowed.push({policy:e+' <strong class="text-'+(1==a.policy_type?"success":"danger")+'">('+(1==a.policy_type?"Paid":"Unpaid")+"</strong>)",time:a.AllowedTime.text}),t[n.total.UserId].pending.push({policy:e+' <strong class="text-'+(1==a.policy_type?"success":"danger")+'">('+(1==a.policy_type?"Paid":"Unpaid")+"</strong>)",time:a.RemainingTime.text})}))}})),void 0===a?$(".csBalanceBoxInner").html(s):$(".csBalanceBoxInner").append(s),$(".jsCustomPopover").popover({html:!0,trigger:"hover click",placement:"auto right",template:'<div class="popover"><div class="arrow"></div><div class="popover-content"></div></div>'}).on("inserted.bs.popover",(function(e){let a="<ul>";t[$(this).closest(".jsBox").data("id")][$(this).data("type")].map((function(e){a+=`<li>${e.time} of <strong>${e.policy}</strong></li>`})),a+="</ul>",$(this).next(".popover").find(".popover-content").html(a)})),$(".jsTooltip").tooltip(),ml(!1,"balance"))}function i(){e.Balances.Main.inset+=10,$.post(handlerURL,e.Balances.Main,(function(e){0!=e.Data.Balances.length&&i(),l(e,"append")}))}window.timeoff.fetchBalances=n,n(),$("#js-filter-from-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0,onSelect:function(e){$("#js-filter-to-date").datepicker("option","minDate",e)}}),$("#js-filter-to-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0}).datepicker("option","minDate",$("#js-filter-from-date").val()),$(document).on("click",".js-apply-filter-btn",s),$(document).on("click",".js-reset-filter-btn",(function(a){a.preventDefault(),$("#js-filter-employee").select2("val","all"),e.Balances.Main.inset=0,e.Balances.Main.offset=10,e.Balances.Main.filter.employees="all",e.Balances.Main.filter.policies="all",e.Balances.Main.filter.employeeStatus=0,e.Balances.Main.filter.type=$(".jsEditResetCheckbox:checked").val(),window.location="?id=all&pid=all"})),$(document).on("change",".jsEditResetCheckbox",s),$(document).on("click",".jsViewPolicies",(function(e){e.preventDefault(),startPolicyProcess($(this).closest(".jsBox").data("id"),$(this).closest(".jsBox").data("name"),$(this).closest(".jsBox").data("anniversary"))})),$(document).on("click",".jsViewBalance",(function(e){e.preventDefault(),startBalanceProcess($(this).closest(".jsBox").data("id"),$(this).closest(".jsBox").data("name"),$(this).closest(".jsBox").data("anniversary"))})),$(document).on("click",".jsViewApprovers",(function(e){e.preventDefault(),Modal({Id:"employeeApproverModal",Title:`Approvers for ${$(this).closest(".jsBox").data("name")}`,Body:"",Loader:"employeeApproverModalLoader"},(async()=>{const e=await function(e){return new Promise((a=>{$.post(handlerURL,{action:"get_employee_approvers",companyId:companyId,employerId:employerId,employeeId:e,public:0},(e=>{a(e)}))}))}($(this).closest(".jsBox").data("id"));if(!0===e.Redirect)return void alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",(()=>{window.location.reload()}));if(!1===e.Status||0==e.Data.length)return $("#employeeApproverModal .csModalBody").html('<p class="alert alert-success text-center">No approvers are assigned to this employee.</p>'),void ml(!1,"employeeApproverModalLoader");let a='\n            <div class="tabel-responsive">\n                <table class="table table-striped csCustomTableHeader">\n                    <thead>\n                        <tr>\n                            <th>Employee</th>\n                            <th>Can Approve</th>\n                        </tr>\n                    </thead>\n                    <tbody id="employeeApproverModalTable"></tbody>\n                </table>\n            </div>';$("#employeeApproverModal .csModalBody").html(a),a="",e.Data.map((e=>{a+="<tr>",a+=`   <td>${remakeEmployeeName(e)}</td>`,a+=`   <td style="font-weight: 900"; class="${1==e.approver_percentage?"text-success":"text-danger"}">${1==e.approver_percentage?"Yes":"No"}</td>`,a+="</tr>"})),$("#employeeApproverModalTable").html(a),ml(!1,"employeeApproverModalLoader")}))})),$(".jsFilterEmployeeStatus").select2({minimumResultsForSearch:-1})}));