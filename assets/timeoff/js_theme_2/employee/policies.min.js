$((function(){async function fetchPoliciesLMS(){const policies=await fetchEmployeePolicies();if(0==policies.Data.length)return void console.log("No policies found.");window.timeoff.employeePolicies=policies.Data;let rows="",i=0;policies.Data.map((policy,j)=>{i%3==0&&(rows+='<div class="row">'),rows+=getPolicyBox(policy,j>2),2==i?(i=0,rows+="</div>"):i++}),rows+='<div class="clearfix"></div>',$(".csPolicyBox").append(rows);let sRows="\x3c!-- Separator --\x3e";sRows+=' <div class="csSeparator">',policies.Data.length>3&&(sRows+='     <div class="csFix">',sRows+='         <button class="btn btn-default jsViewMorePolicies"><i class="fa fa-chevron-down"></i> <span>View More</span></button>',sRows+="      </div>"),sRows+=" </div>",$(".csPolicyBox").append(sRows),$("#jsEMSCraousal div").html(rows),loadTitles()}function fetchEmployeePolicies(){return new Promise((res,rej)=>{$.post(handlerURL,{action:"get_employee_policies_with_timeoffs",companyId:companyId,employerId:employerId,employeeId:employeeId},(function(resp){res(resp)}))})}function employeeRequests(status,policyId){return new Promise((res,rej)=>{$.post(handlerURL,{action:"get_employee_requests_by_status",companyId:companyId,employerId:employerId,employeeId:employeeId,status:status,policyId:policyId},(function(resp){res(resp)}))})}function getPolicyBox(policy,hideIt){return`\n                <div class="col-sm-4 col-xs-12 ${hideIt?"csPolicyBoxDiv dn":""}">\n                    <div class="csCard csRadius5 csShadow"  data-id="${policy.PolicyId}">\n                        <div class="csCardTitle">\n                            <p class="csCardHead"><strong>${policy.Title}</strong></p>\n                            <p>(${policy.Category}) </p>\n                            ${policy.Plans.length>0?'<div class="csFix"><a href="javascript:void(0)" class="btn btn-orange btn-xs jsShowTime"><i class="fa fa-clock-o"></i> View Plans</a></div>':""}\n                            \n                        </div>\n                        <div class="csCardBody">\n                            <ul>\n                                <li>\n                                    <p>\n                                        ${0==policy.IsUnlimited?policy.RemainingTime.text:"Unlimited"} remaining\n                                    </p>\n                                </li>\n                                <li>\n                                    <p>\n                                        ${policy.ConsumedTime.text} scheduled\n                                    </p>\n                                </li>\n                                <li>\n                                    <p>\n                                        ${policy.Approved} time-off${0==policy.Approved||policy.Approved>1?"s":""} scheduled \n                                        <span class="pull-right">\n                                            <button class="btn btn-success btn-xs jsScheduledTimeoOfBTN" title = "Show scheduled time-offs" placement = "top">\n                                                <i class="fa fa-eye"></i>\n                                            </button>\n                                        </span>\n                                    </p>\n                                    <div class="clearfix"></div>\n                                </li>\n                                <li>\n                                    <p>\n                                        ${policy.Pending} time-off${0==policy.Pending||policy.Pending>1?"s":""} requested \n                                        <span class="pull-right">\n                                            <button class="btn btn-success btn-xs jsRemainingTimeOffBTN" title = "Show requested time-offs" placement = "top">\n                                                <i class="fa fa-eye"></i>\n                                            </button>\n                                        </span>\n                                    </p>\n                                </li>\n                                <li>\n                                    <p>\n                                        Employment Status:  ${ucwords(policy.EmployementStatus)}\n                                    </p>\n                                </li>\n                                ${isEmpty(policy.Reason)?"":`<li><p>Reason:  ${ucwords(policy.Reason)}</p></li>`}\n                            </ul>\n                            <hr />\n                            <div class="csCardFooter text-center">\n                            ${""!=policy.Reason||0==policy.IsUnlimited&&0==policy.RemainingTime.M.minutes?'<a href="javascript:void(0)" class="btn btn-orange form-control disabled"><i class="fa fa-plus"></i> Create a request</a>':`<a href="javascript:void(0)" class="btn btn-orange form-control jsCreateRequest" data-id = "${employeeId}" data-policyId = "${policy.PolicyId}"><i class="fa fa-plus"></i> Create a request</a>`}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `}fetchPoliciesLMS(),$(document).on("click",".jsScheduledTimeoOfBTN",(function(e){e.preventDefault(),Modal({Id:"jsViewTimeOffModal",Loader:"jsViewTimeOffModalLoader",Title:`Time-offs scheduled for the year ${moment().format("YYYY")}`,Body:' \n                <div class="tabel-responsive">\n                    <div id="jsData"></div>\n                    <table class="table table-striped csCustomTableHeader">\n                        <thead>\n                            <tr>\n                                <th>Policy</th>\n                                <th>Status</th>\n                                <th>Progress</th>\n                                <th>Reason</th>\n                                <th>Requested On</th>\n                            </tr>\n                        </thead>\n                        <tbody id="jsViewTimeOffModalTable"></tbody>\n                    </table>\n                </div>\n            '},async()=>{const requests=await employeeRequests("approved",$(this).closest(".csCard").data("id"));if(0==requests.Data.length)return ml(!1,"jsViewTimeOffModalLoader"),void $("#jsViewTimeOffModalTable").html('<tr><td colspan="5"><p class="alert alert-info text-center">No time-offs found.</p></td></tr>');let rows="";requests.Data.map(v=>{rows+=`\n                    <tr>\n                        <td> \n                            <div class="upcoming-time-info">            \n                                <div class="icon-image">                   \n                                    <img src="${baseURL}assets/images/upcoming-time-off-icon.png" class="emp-image" alt="emp-1">             \n                                </div>             \n                                <div class="text">                  \n                                    <h4>${v.request_from_date==v.request_to_date?moment(v.request_from_date).format(timeoffDateFormat):moment(v.request_from_date).format(timeoffDateFormat)+" - "+moment(v.request_to_date).format(timeoffDateFormat)}</h4>                  \n                                    <span>${v.title}</span><br />          \n                                    <span>${v.breakdown.text}</span>          \n                                </div>       \n                            </div>\n                        </td>`,rows+=`\n                        <td>\n                          <p class="">${ucwords(v.status)}</p>\n                        </td>\n                    `,rows+=`\n                    <td>\n                        <div class="progress" style="margin-top: 10px;">\n                            <div class="progress-bar progress-bar-success" role="progressbar" style="width: ${"pending"==v.status?"pending"!=v.level_status?50:0:100}%;">\n                                <span class="sr-only"> ${"pending"==v.status?"pending"!=v.level_status?50:0:100} % Complete</span>\n                            </div>\n                            <p>${"pending"==v.status?"pending"!=v.level_status?50:0:100}%</p>\n                        </div>\n                        ${getApproverLisiting(v.history)}\n                    </td>`,rows+=`\n                        <td>\n                          <p class="">${ucwords(v.reason)}</p>\n                        </td>\n                    `,rows+=`\n                        <td>\n                          <p class="">${moment(v.created_at).format(timeoffDateFormatWithTime)}</p>\n                        </td>\n                    `,rows+="</tr>"}),ml(!1,"jsViewTimeOffModalLoader"),$("#jsViewTimeOffModalTable").html(rows),$(".csApproverBox").popover({html:!0,trigger:"hover",placement:"left"})})})),$(document).on("click",".jsRemainingTimeOffBTN",(function(e){e.preventDefault(),Modal({Id:"jsViewTimeOffModal",Loader:"jsViewTimeOffModalLoader",Title:`Time-offs requested for the year ${moment().format("YYYY")}`,Body:' \n                <div class="tabel-responsive">\n                    <div id="jsData"></div>\n                    <table class="table table-striped csCustomTableHeader">\n                        <thead>\n                            <tr>\n                                <th>Policy</th>\n                                <th>Status</th>\n                                <th>Progress</th>\n                                <th>Reason</th>\n                                <th>Requested On</th>\n                            </tr>\n                        </thead>\n                        <tbody id="jsViewTimeOffModalTable"></tbody>\n                    </table>\n                </div>\n            '},async()=>{const requests=await employeeRequests("pending",$(this).closest(".csCard").data("id"));if(0==requests.Data.length)return ml(!1,"jsViewTimeOffModalLoader"),void $("#jsViewTimeOffModalTable").html('<tr><td colspan="5"><p class="alert alert-info text-center">No time-off requests found.</p></td></tr>');let rows="";requests.Data.map(v=>{rows+=`\n                    <tr>\n                        <td> \n                            <div class="upcoming-time-info">            \n                                <div class="icon-image">                   \n                                    <img src="${baseURL}assets/images/upcoming-time-off-icon.png" class="emp-image" alt="emp-1" />             \n                                </div>             \n                                <div class="text">                  \n                                    <h4>${v.request_from_date==v.request_to_date?moment(v.request_from_date).format(timeoffDateFormat):moment(v.request_from_date).format(timeoffDateFormat)+" - "+moment(v.request_to_date).format(timeoffDateFormat)}</h4>                  \n                                    <span>${v.title}</span><br />          \n                                    <span>${v.breakdown.text}</span>          \n                                </div>       \n                            </div>\n                        </td>`,rows+=`\n                        <td>\n                          <p class="">${ucwords(v.status)}</p>\n                        </td>\n                    `,rows+=`\n                    <td>\n                        <div class="progress" style="margin-top: 10px;">\n                            <div class="progress-bar progress-bar-success" role="progressbar" style="width: ${"pending"==v.status?"pending"!=v.level_status?50:0:100}%;">\n                                <span class="sr-only"> ${"pending"==v.status?"pending"!=v.level_status?50:0:100} % Complete</span>\n                            </div>\n                            <p>${"pending"==v.status?"pending"!=v.level_status?50:0:100}%</p>\n                        </div>\n                        ${getApproverLisiting(v.history)}\n                    </td>`,rows+=`\n                        <td>\n                          <p class="">${ucwords(v.reason)}</p>\n                        </td>\n                    `,rows+=`\n                        <td>\n                          <p class="">${moment(v.created_at).format(timeoffDateFormatWithTime)}</p>\n                        </td>\n                    `,rows+="</tr>"}),ml(!1,"jsViewTimeOffModalLoader"),$("#jsViewTimeOffModalTable").html(rows),$(".csApproverBox").popover({html:!0,trigger:"hover",placement:"left"})})})),$(document).on("click",".jsShowTime",(function(e){e.preventDefault();let policy=getPolicy($(this).closest(".csCard").data("id"),window.timeoff.employeePolicies);Modal({Id:"jsViewTimeModal",Loader:"jsViewTimeModalLoader",Title:`Time for ${policy.Title}`,Body:' \n                <div class="tabel-responsive">\n                    <table class="table table-striped csCustomTableHeader">\n                        <tbody id="jsViewTimeModalTable"></tbody>\n                    </table>\n                </div>\n            '},async()=>{if(0===policy.Plans.length)return $("#jsViewTimeModalTable").html('<tr><td><p class="alert alert-info">No time is available to use</p></td></tr>'),void ml(!1,"jsViewTimeModalLoader");let rows="";policy.Plans.map(pl=>{rows+=`<tr><td>${pl.time} will be available on ${moment(pl.date,"YYYY-MM-DD").format(timeoffDateFormat)}</td></tr>`}),$("#jsViewTimeModalTable").html(rows),ml(!1,"jsViewTimeModalLoader")})})),$(document).on("click",".jsViewMorePolicies",(function(e){e.preventDefault(),$(".csPolicyBoxDiv").toggleClass("dn"),$(this).find("i").toggleClass("fa-chevron-up"),$(this).find("i").toggleClass("fa-chevron-down"),$(this).find("span").text("View More"==$(this).find("span").text()?"Show Less":"View More")}))}));