$((function(){let e={Requests:{Main:{action:"get_requests",companyId:companyId,employerId:employerId,employeeId:employeeId,level:level,isMine:1,type:"pending",filter:{employees:"all",policies:"all",status:"all",order:"upcoming",startDate:"",endDate:""},public:0}}},t=null;function s(t){t.preventDefault(),e.Requests.Main.filter.employees=$("#js-filter-employee").val(),e.Requests.Main.filter.policies=$("#js-filter-policies").val(),e.Requests.Main.filter.status=$("#js-filter-status").val(),e.Requests.Main.filter.order=$("#js-filter-sort").val(),e.Requests.Main.filter.startDate=$("#js-filter-from-date").val(),e.Requests.Main.filter.endDate=$("#js-filter-to-date").val(),a()}function a(){void 0!==window.timeoff.employees?null==t&&(ml(!0,"requests"),$(".js-error-row").remove(),t=$.post(handlerURL,e.Requests.Main,(function(s){if(t=null,!0!==s.Redirect)return!1===s.Status&&1==e.Balances.Main.page?($(".js-ip-pagination").html(""),$("#js-data-area").html(`<tr class="js-error-row"><td colspan="${$(".js-table-head").find("th").length}"><p class="alert alert-info text-center">${s.Response}</p></td></tr>`),void ml(!1,"requests")):!1===s.Status?($(".js-ip-pagination").html(""),void ml(!1,"requests")):void function(e){let t="";if(o={},0==e.Data.length)return $(".jsBoxWrap").html('<p class="alert alert-info text-center">No time-offs found.</p>'),void ml(!1,"requests");let s={};$.each(e.Data,(function(e,t){let a=getUserById(t.employee_sid,window.timeoff.employees,"user_id");0!=Object.keys(a).length&&(null==s[t.request_from_date]&&(s[t.request_from_date]=[]),t.userRow=a,s[t.request_from_date].push(t))})),$.each(s,(function(e,s){t+='<div class="csContentHead">',s.map((function(e){t+=function(e,t){let s="pending"==e.status?"pending"!=e.level_status?50:0:100,a=function(e){let t=[];if(0==e.length)return t;return e.map((e=>{if("create"==e.action)return;if("{}"==e.note)return;let s=JSON.parse(e.note);if(null==s.canApprove)return;let a={status:"approved",msg:s.comment||"",time:e.created_at,employeeName:`${e.first_name} ${e.last_name}`,employeeRole:remakeEmployeeName(e,!1),employeeImage:null==e.image||""==e.image?awsURL+"test_file_01.png":awsURL+e.image};"pending"!=s.status&&("approved"==s.status?a.status="approved":"rejected"==s.status&&(a.status="rejected"),t.push(a))})),t}(e.history),i="";i+='<div class="col-sm-12">',i+=`    <div class="csBox csShadow csRadius5 p0 jsBox" data-id="${e.sid}"  data-status="${e.status}" data-userid="${e.employee_sid}" data-name="${t.first_name} ${t.last_name}" >`,i+="        \x3c!-- Box Loader --\x3e",i+=`        <div class="csIPLoader jsIPLoader dn" data-page="request${e.sid}"><i class="fa fa-circle-o-notch fa-spin"></i></div>`,i+="        \x3c!-- Box Header --\x3e",i+='        <div class="csBoxHeader csRadius5 csRadiusBL0 csRadiusBR0">',i+='            <span class="pull-right">',i+='                <span class="csCircleBtn csRadius50 jsTooltip jsEditTimeOff" title="Edit"><i class="fa fa-pencil"></i></span>',i+='                <span class="csCircleBtn csRadius50 jsTooltip jsHistoryTimeOff" title="Show History"><i class="fa fa-history"></i></span>',i+=`                <a href="${baseURL}timeoff/print/requests/${e.sid}" target="_blank" style="color: #eee" class="csCircleBtn csRadius50 jsTooltip" title="Print"><i class="fa fa-print"></i></a>`,i+=`                <a href="${baseURL}timeoff/download/requests/${e.sid}" target="_blank" style="color: #eee" class="csCircleBtn csRadius50 jsTooltip" title="Download"><i class="fa fa-download"></i></a>`,0==e.archive?i+='                <span class="csCircleBtn csRadius50 jsTooltip jsArchiveTimeOff" title="Archive"><i class="fa fa-archive"></i></span>':i+='                <span class="csCircleBtn csRadius50 jsTooltip jsActiveTimeOff" title="Activate"><i class="fa fa-sign-in"></i></span>';i+="            </span>",i+='            <div class="clearfix"></div>',i+="        </div>",i+="        \x3c!-- Box Content --\x3e",i+='        <div class="csBoxContent">',i+="            \x3c!-- Section 1 --\x3e",i+='            <div class="csBoxContentDateSection">',i+='                <div class="col-sm-5 col-xs-5">',i+=`                    <h3>${moment(e.request_from_date,timeoffDateFormatD).format(timeoffDateFormatB)}</h3>`,i+=`                    <p>${moment(e.request_from_date,timeoffDateFormatD).format(timeoffDateFormatBD)}</p>`,i+="                </div>",i+='                <div class="col-sm-2 col-xs-2 pl0 pr0">',i+='                    <strong class="text-center">',i+='                        <i class="fa fa-long-arrow-right"></i>',i+="                    </strong>",i+="                </div>",i+='                <div class="col-sm-5 col-xs-5">',i+=`                    <h3>${moment(e.request_to_date,timeoffDateFormatD).format(timeoffDateFormatB)}</h3>`,i+=`                    <p>${moment(e.request_to_date,timeoffDateFormatD).format(timeoffDateFormatBD)}</p>`,i+="                </div>",i+='                <div class="clearfix"></div>',i+="            </div>",i+="            \x3c!-- Section 2 --\x3e",i+='            <div class="csBoxContentInfoSection">',i+='                <div class="col-sm-12">',i+=`                    <p><strong>${e.breakdown.text} of ${e.title}</strong></p>`,i+=`                    <p>Requested on ${moment(e.created_at,timeoffDateFormatDWT).format(timeoffDateFormatWithTime)}</p>`,i+="                </div>",i+='                <div class="clearfix"></div>',i+="            </div>",i+="            \x3c!-- Section 3 --\x3e",i+='            <div class="csBoxContentEmpSection">',i+='                <div class="col-sm-2 col-xs-2">',i+=`                    <img src="${getImageURL(t.image)}" class="csRoundImg"  />`,i+="                </div>",i+='                <div class="col-sm-10 col-xs-10 pr0">',i+=`                    <p><strong>${t.first_name} ${t.last_name}</strong> ${remakeEmployeeName(t,!1)}</p>`,i+="                </div>",i+='                <div class="clearfix"></div>',i+="            </div>",i+="            \x3c!-- Section 4 --\x3e",i+='            <div class="csBoxContentProgressSection">',i+='                <div class="col-sm-12">',i+='                    <div class="progress csRadius100">',i+=`                        <div class="progress-bar progress-bar-success csRadius100" role="progressbar" aria-valuenow="${s}" aria-valuemin="0" aria-valuemax="100" style="width: ${s}% ;">`,i+=`                            <span> ${s}% Completed</span>`,i+="                        </div>",i+="                    </div>",i+="                </div>",i+='                <div class="clearfix"></div>',i+="            </div>",a.length>0&&(i+="            \x3c!-- Section 5 --\x3e",i+='            <div class="csBoxContentComentSection">',i+='                <div class="col-sm-2 col-xs-2">',i+=`                    <img src="${a[0].employeeImage}" class="csRoundImg" />`,i+="                </div>",i+='                <div class="col-sm-10 col-xs-10 pr0">',i+=`                    <div><strong>${strip_tags(a[0].msg).substr(0,25)}</strong></div>`,i+=`                    <p class="csBoxContentComentName">${a[0].employeeName} ${a[0].employeeRole}</p>`,i+=`                    <p class="csBoxContentComentTag">${moment(a[0].time,timeoffDateFormatDWT).format(timeoffDateFormatWithTime)}</p>`,void 0===o[e.sid]&&(o[e.sid]=[]),o[e.sid].push(a),i+='                    <span class="jsCommentsPopover" title="p">',i+='                        <i class="fa fa-comment"></i>',i+="                    </span>",i+="                </div>",i+='                <div class="clearfix"></div>',i+="            </div>");i+="            \x3c!-- Section 6 --\x3e",i+='            <div class="csBoxContentComent2Section">',i+='                <div class="col-sm-2 col-xs-2">',i+='                    <i class="fa fa-comment-o"></i>',i+="                </div>",i+='                <div class="col-sm-10 col-xs-10">',i+='                    <textarea class="form-control jsRequestCommentTxt" rows="1"></textarea>',i+="                </div>",i+='                <div class="clearfix"></div>',i+="            </div>",i+="        </div>",i+="        \x3c!-- Box Footer --\x3e",i+='        <div class="csBoxFooter">',1==e.archive?(i+='            <div class="col-sm-12">',i+='                <button class="btn btn-orange form-control jsEditTimeOff"><i class="fa fa-eye"></i>View</button>',i+="            </div>"):"pending"==e.status?(i+='            <div class="col-sm-6 pl0 pr0">',i+='                <button class="btn btn-orange form-control jsRequestBtn" data-type="approve"><i class="fa fa-clock-o"></i>Approve</button>',i+="            </div>",i+='            <div class="col-sm-6 pr0">',i+='                <button class="btn alert-danger btn-theme form-control jsRequestBtn" data-type="reject"><i class="fa fa-times-circle-o"></i>Reject</button>',i+="            </div>"):"approved"==e.status?(i+='            <div class="col-sm-12">',i+='                <button class="btn alert-danger btn-theme form-control jsRequestBtn" data-type="reject"><i class="fa fa-times-circle-o"></i>Reject</button>',i+="            </div>"):"rejected"==e.status?(i+='            <div class="col-sm-12">',i+='                <button class="btn btn-orange form-control jsRequestBtn" data-type="approve"><i class="fa fa-clock-o"></i>Approve</button>',i+="            </div>"):"cancelled"==e.status?(i+='            <div class="col-sm-6 pl0 pr0">',i+='                <button class="btn btn-orange form-control jsRequestBtn" data-type="approve"><i class="fa fa-clock-o"></i>Approve</button>',i+="            </div>",i+='            <div class="col-sm-6 pr0">',i+='                <button class="btn alert-danger btn-theme form-control jsRequestBtn" data-type="reject"><i class="fa fa-times-circle-o"></i>Reject</button>',i+="            </div>"):(i+='            <div class="col-sm-12">',i+='                <button class="btn alert-orange btn-theme form-control jsEditTimeOff"><i class="fa fa-eye"></i>View</button>',i+="            </div>");return i+="        </div>",i+="    </div>",i+="</div>",i}(e,e.userRow)})),t+="</div>"})),$(".jsBoxWrap").html(t),$(".jsTooltip").tooltip({placement:"top"}),$(".jsCommentsPopover").popover({html:!0,trigger:"hover",template:'<div class="popover"><div class="arrow"></div><div class="popover-content"></div></div>'}).on("inserted.bs.popover",(function(e){let t="<ul>";o[$(this).closest(".jsBox").data("id")][0].map((function(e){t+=`<li><strong>${e.msg}</strong> <br /> ${e.employeeName} ${e.employeeRole} <br /> ${moment(e.time,timeoffDateFormatDWT).format(timeoffDateFormatWithTime)}</li>`})),t+="</ul>",$(this).next(".popover").find(".popover-content").html(t)})),ml(!1,"requests")}(s);alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",(()=>{window.location.reload()}))}))):setTimeout(a,1e3)}$("#js-filter-status").select2(),$("#js-filter-sort").select2({minimumResultsForSearch:-1}),$("#js-filter-from-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0,onSelect:function(e){$("#js-filter-to-date").datepicker("option","minDate",e)}}),$("#js-filter-to-date").datepicker({dateFormat:"mm-dd-yy",changeYear:!0,changeMonth:!0}).datepicker("option","minDate",$("#js-filter-from-date").val()),$(document).on("click",".js-apply-filter-btn",s),$(document).on("click",".js-reset-filter-btn",(function(t){t.preventDefault(),$("#js-filter-employee").select2("val","all"),$("#js-filter-policies").select2("val","all"),$("#js-filter-status").select2("val","all"),$("#js-filter-sort").select2("val","upcoming"),$("#js-filter-from-date").val(""),$("#js-filter-end-date").val(""),e.Requests.Main.filter.employees="all",e.Requests.Main.filter.policies="all",e.Requests.Main.filter.status="all",e.Requests.Main.filter.order="upcoming",e.Requests.Main.filter.startDate="",e.Requests.Main.filter.endDate="",e.Requests.Main.filter.isMine=0,a()})),$(document).on("change",".jsEditResetCheckbox",s),$(document).on("change","#js-filter-sort",s),$(".jsReportTab").click((function(t){t.preventDefault(),e.Requests.Main.type=$(this).data("key"),$(".jsReportTab").parent().removeClass("active").removeClass("csActiveTab"),$(this).parent().addClass("active").addClass("csActiveTab"),a()})),$('.jsReportTab[data-key="pending"]').trigger("click");let o={};$(document).on("click",".jsArchiveTimeOff",(function(e){e.preventDefault();let t=$(this).closest(".jsBox").data("id");alertify.confirm("Do you really want to archive this time off?",(()=>{ml(!0,"requests"),$.post(handlerURL,Object.assign({action:"archive_request",companyId:companyId,employerId:employerId,employeeId:employeeId},{requestId:t,archive:1}),(e=>{alertify.alert("SUCCESS",e.Response,(()=>{$(".js-apply-filter-btn").click()}))}))}),(()=>{}))})),$(document).on("click",".jsActiveTimeOff",(function(e){e.preventDefault();let t=$(this).closest(".jsBox").data("id");alertify.confirm("Do you really want to activate this time off?",(()=>{ml(!0,"requests"),$.post(handlerURL,Object.assign({action:"archive_request",companyId:companyId,employerId:employerId,employeeId:employeeId},{requestId:t,archive:0}),(e=>{alertify.alert("SUCCESS",e.Response,(()=>{$(".js-apply-filter-btn").click()}))}))}),(()=>{}))})),$(document).on("click",".jsHistoryTimeOff",(function(e){e.preventDefault();let t=$(this).closest(".jsBox").data("id");Modal({Id:"jsTimeOffHistory",Title:"Time-off, History",Body:' \n            <div class="row">\n                    <div class="col-sm-3">\n                        <div id="jsData"></div>\n                    </div>\n                    <div class="col-sm-9">\n                        <div class="tabel-responsive">\n                            <table class="table table-striped csCustomTableHeader">\n                                <thead>\n                                    <tr>\n                                        <th>Employee</th>\n                                        <th>Details</th>\n                                        <th>Action</th>\n                                        <th>Comment</th>\n                                        <th>Action Taken</th>\n                                    </tr>\n                                </thead>\n                                <tbody id="jsTimeOffHistoryTable"></tbody>\n                            </table>\n                        </div>\n                    </div>\n                </div>',Loader:"jsTimeOffHistoryLoader"},(()=>{ml(!0,"jsTimeOffHistoryLoader"),$("#jsPolicyHistoryTable").html(""),$.post(handlerURL,Object.assign({action:"get_request_history",companyId:companyId,employerId:employerId,employeeId:employeeId},{requestId:t}),(e=>{if(!0===e.Redirect)return void alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",(()=>{window.location.reload()}));if($("#jsData").html(`\n                 <div class="employee-info">\n                     <figure>\n                         <img src="${$(`.jsBox[data-id="${t}"]`).find(".csBoxContentEmpSection img").prop("src")}" class="img-circle emp-image" />\n                     </figure>\n                     <div class="text">\n                         <h4>${$(`.jsBox[data-id="${t}"]`).find(".csBoxContentEmpSection p").html()}</h4>\n                         <p><strong>Policy: </strong></p>\n                     </div>\n                 </div>\n             `),!1===e.Status)return alertify.alert("WARNING!",e.Response,(()=>{})),void ml(!1,"jsTimeOffHistoryLoader");let s="";0===e.Data.length?s=`\n                        <tr>\n                            <td colspan="5">\n                                <p class="alert alert-info text-center">${e.Response}</p>\n                            </td>\n                        </tr>\n                    `:e.Data.map((e=>{let t=JSON.parse(e.note),a="",o="-";"create"==e.action?a="Time-off created.":(void 0!==t.status?("archive"==t.status?a="Time-off marked as archive":"activate"==t.status?a="Time-off marked as active":"approved"==t.status&&1==t.canApprove?a="Time-off approved 100%":"approved"==t.status&&0==t.canApprove?a="Time-off approved 50%":"rejected"==t.status&&1==t.canApprove?a="Time-off rejected 100%":"rejected"==t.status&&0==t.canApprove?a="Time-off rejected 50%":"pending"==t.status&&0==t.canApprove?a="Time-off updated":"cancelled"==t.status&&(a="Time-off cancelled"),null!=t.comment&&""!=t.comment&&(o=t.comment)):a="","update"==e.action&&""==a&&(a="Time-off updated.")),s+="<tr>",s+="<td>",s+='        <div class="employee-info">',s+="            <figure>",s+=`                <img src="${getImageURL(e.image)}" class="img-circle emp-image" />`,s+="            </figure>",s+='            <div class="text">',s+=`                <h4>${e.first_name} ${e.last_name} </h4>`,s+=`                <p>${remakeEmployeeName(e,!1)}</p>`,s+=`                <p><a href="${baseURL}employee_profile/${e.userId}" target="_blank">Id: ${getEmployeeId(e.userId,e.employee_number)}</a></p>`,s+="            </div>",s+="        </div></td>",s+="                <td>",void 0!==t.details&&(s+=`                   <div class="upcoming-time-info">            \n                    <div class="icon-image">                   \n                        <img src="${baseURL}assets/images/upcoming-time-off-icon.png" class="emp-image" alt="emp-1">             \n                    </div>             \n                    <div class="text">                  \n                        <h4>${t.details.startDate==t.details.endDate?moment(t.details.startDate).format(timeoffDateFormat):moment(t.details.startDate).format(timeoffDateFormat)+" - "+moment(t.details.endDate).format(timeoffDateFormat)}</h4>                  \n                        <span>${t.details.policyTitle}</span><br />          \n                        <span>${get_array_from_minutes(t.details.time,e.user_shift_hours,"H:M").text}</span>\n                    </div>       \n                </div>`),s+="                </td>",s+=`                <td>${a}</td>`,s+=`                <td>${o}</td>`,s+=`                <td>${moment(e.created_at).format(timeoffDateFormatWithTime)}</td>`,s+="            </tr>"})),$("#jsTimeOffHistoryTable").html(s),ml(!1,"jsTimeOffHistoryLoader")}))}))})),$(document).on("click",".jsViewPolicies",(function(e){e.preventDefault(),startPolicyProcess(employeeId,employeeName)})),$(document).on("click",".jsHolidays",(function(e){e.preventDefault(),Modal({Id:"jsHolidayModal",Title:"Company Holidays",Body:' \n            <div class="tabel-responsive">\n                <table class="table table-striped csCustomTableHeader">\n                    <thead>\n                        <tr>\n                            <th>Holiday</th>\n                            <th>Date</th>\n                        </tr>\n                    </thead>\n                    <tbody id="jsHolidayModalTable"></tbody>\n                </table>\n            </div>',Loader:"jsHolidayModalLoader"},(()=>{ml(!0,"jsHolidayModalLoader"),$("#jsHolidayModalTable").html("");let e="";0===window.timeoff.holidays.length?e=`\n                    <tr>\n                        <td colspan="2">\n                            <p class="alert alert-info text-center">${resp.Response}</p>\n                        </td>\n                    </tr>\n                `:window.timeoff.holidays.map((t=>{e+=`\n                        <tr>\n                            <td>${t.holiday_title}</td>\n                            <td>${getHolidayText(t)}</td>\n                        </tr>\n                    `})),$("#jsHolidayModalTable").html(e),ml(!1,"jsHolidayModalLoader")}))})),$(document).on("click",".jsRequestBtn",(function(){let e={action:"request_status",companyId:companyId,employerId:employerId,employeeId:employeeId,sendEmailNotification:1,requestId:$(this).closest(".jsBox").data("id"),status:"approve"==$(this).data("type")?"approved":"rejected",comment:$(this).closest(".jsBox").find(".jsRequestCommentTxt").val()};ml(!0,`request${e.requestId}`),$.post(handlerURL,e,(function(t){alertify.alert("SUCCESS!",t.Response,(function(){$(".js-apply-filter-btn").click(),ml(!1,`request${e.requestId}`)}))}))}))}));