$((function(){var e="jsEmployeeOnboardModal",o=e+"Loader",a=$("#jsPayrollEmployeesListingBox"),t=$("#jsPayrollEmployeesListingCount"),r=0,l=0,n=[],s=0,i="",d=0,c=0;function m(){$.get(baseURI+"payroll/get/"+companyId+"/payroll_employees").done((function(e){null,function(e){t.text("Total: "+Object.keys(e).length);var o="";if(!Object.keys(e).length)return o+="<tr>",o+='    <td colspan="4"><p class="alert alert-info text-center">No employees found.</p></td>',o+="</tr>",a.html(o);for(var r in e){var l=e[r];if("object"==typeof l){if(o+='<tr class="jsPayrollOnEmployeeRow" data-id="'+l.user_id+'">',o+='    <td class="vam"><strong>'+l.full_name_with_role+"</strong><p><strong>Reference: </strong>"+l.payroll_employee_id+"</p></td>",o+='    <td class="text-center vam text-'+("completed"==l.payroll_onboard_status.status?"success":"warning")+'"><strong>'+l.payroll_onboard_status.status.toUpperCase()+"</strong>","pending"==l.payroll_onboard_status.status){for(var r in o+='<div class="jsToggleOnboardItemsTable hidden"><br><br>        <table class="table table-striped table-condensed ">',o+="            <tbody>",l.payroll_onboard_status.details){var n=l.payroll_onboard_status.details[r];o+="                <tr>",o+='                    <th class="vam">'+r.replace(/_/g," ").toUpperCase()+"</th>",o+='                    <td class="text-right vam text-'+(1==n?"success":"danger")+'">'+(1==n?"Completed":"Pending")+"</td>",o+="                </tr>"}o+="            </tbody>",o+="        </table></div>"}o+="    </td>",o+='    <td class="text-right vam">',"pending"==l.payroll_onboard_status.status&&(o+='        <button class="btn btn-orange jsToggleOnboardItems"><i class="fa fa-eye" aria-hidden="true"></i>&nbsp;Pending Items</button>',o+='        <button class="btn btn-success jsFinishEmployeeOnboard"><i class="fa fa-check-circle" aria-hidden="true"></i>&nbsp;Finish Onboard</button>'),o+='        <button class="btn btn-warning jsPayrollEmployeeEdit"><i class="fa fa-edit" aria-hidden="true"></i>&nbsp;Edit</button>',"completed"!=l.payroll_onboard_status.status.toLowerCase()&&(o+='        <button class="btn btn-danger jsPayrollEmployeeDelete"><i class="fa fa-times-circle" aria-hidden="true"></i>&nbsp;Delete</button>'),o+="    </td>",o+="</tr>"}}a.html(o)}(e)})).fail(T)}function y(){$.get(baseURI+"payroll/get/"+companyId+"/employees").done((function(a){!function(a){var t="";if(t+='<div class="container">',!Object.keys(a).length)return t+='<div class="row">',t+='   <div class="col-xs-12">',t+='       <p class="alert alert-info text-center"><strong>Looks like there are no employees that need to be on payroll.</strong>',t+="       </p>",t+="   </div>",t+="</div>",t+="</div>",$("#"+e+"Body").html(t),ml(!1,o);for(var r in t+='<div class="row">',t+='   <div class="col-xs-12">',t+='       <h3 class="alert pl0">Please select the employees that you want to be part of payroll.</h3>',t+="   </div>",t+="</div>",a){var l=a[r];"object"==typeof l&&(t+='<div class="row" id="jsPayrollEmployeeRow'+l.user_id+'">',t+='   <div class="col-xs-12 col-md-12">',t+='       <label class="control control--checkbox">',t+='           <input type="checkbox" '+(l.missing_fields.length?"disabled":"")+' name="'+(l.missing_fields.length?"disabled":"jsEmployeesList[]")+'" class="jsEmployeesList" value="'+l.user_id+'" />',t+=l.full_name_with_role,l.missing_fields.length&&(t+=' --- <span class="text-danger">Missing Fields ['+l.missing_fields.join(", ")+"]</span>"),t+='           <div class="control__indicator"></div>',t+="       </label>",t+='       <div id="jsEmployeeError'+l.user_id+'" class="text-danger"></div>',t+="   </div>",t+="</div>",t+="<br />")}t+='<div class="row">',t+='   <div class="col-xs-12 text-right">',t+='       <button class="btn btn-success" id="jsMoveEmployeesToPayroll"><i class="fa fa-plus-circle" aria-hidden="true"></i>&nbsp;Onboard Selected Employees To Payroll</button>',t+="   </div>",t+="</div>",t+="</div>",$("#"+e+"Body").html(t),ml(!1,o)}(a)})).error(T)}function p(){if(l>r)return ml(!1,o),alertify.alert("Success","The process has been completed.",(function(){}));ml(!0,o),$.post(baseURI+"payroll/onboard_employee/"+companyId,{employee_id:n[l-1],need_response:!0}).done((function(e){e.errors?$("#jsEmployeeError"+n[l-1]).html("Errors: "+e.errors.join("<br />")):($("#jsPayrollEmployeeRow"+n[l-1]).remove(),n.splice(l-1,1)),l++,p()})).error(T)}function u(){c=0,$.get(baseURI+"payroll/onboard_status/"+companyId+"/"+s).done((function(e){1==e.response.details.personal_profile&&(c=1)})).error(T),f()}function f(){ml(!0,o),$.ajax({method:"GET",url:w("get_payroll_page/get_company_employee_profile/"+companyId),data:{employee_id:s}}).done((function(e){null,D(e.html,(function(){$(".jsPayrollSaveCompanyEmployee").click(b),$(".jsDOBPicker").datepicker({format:"m/d/Y",changeMonth:!0,changeYear:!0,yearRange:"-80:+0"}),$(".jsDatePicker").datepicker({format:"m/d/Y",changeMonth:!0,changeYear:!0,yearRange:"-100:+50"}),ml(!1,"jsEmployeeOnboardModelLoader")}))})).error(T)}function b(e){e.preventDefault();var o={};return o.firstName=$(".jsFirstName").val().trim(),o.middleInitial=$(".jsMiddleName").val().trim(),o.lastName=$(".jsLastName").val().trim(),o.startDate=$(".jsStartDate").val()||"",o.ssn=$(".jsEmployeeSSN").val().replace(/[^\d]/g,""),o.dob=$(".jsEDOB").val()||"",o.workLocation=$(".jsEWD option:selected").val()||0,o.email=$(".jsEmail").val().trim(),o.firstName?o.lastName?o.email?o.email.verifyEmail()?o.ssn?9!=o.ssn.length?alertify.alert("Warning!","SSN number must be of 9 digits long.",R):o.dob?(o.employeeId=s,o.companyId=companyId,ml(!0,"jsEmployeeOnboardModelLoader"),void $.ajax({method:"POST",url:baseURI+"gusto/employee/profile",data:o}).done((function(e){return null,ml(!1,"jsEmployeeOnboardModelLoader"),e.errors?alertify.alert("Error!","object"==typeof e.errors?e.errors.join("<br/>"):e.errors,R):alertify.alert("Success!",e.success,(function(){return I(),!0}))})).error(T)):alertify.alert("Warning!","Date of birth is mandatory.",R):alertify.alert("Warning!","SSN is mandatory.",R):alertify.alert("Warning!","Email address is not valid.",R):alertify.alert("Warning!","Email address is mandatory.",R):alertify.alert("Warning!","Last name is mandatory.",R):alertify.alert("Warning!","First name is mandatory.",R)}function j(e){e.preventDefault();var o={};return o.title=$(".jsJobTitle").val().trim(),o.rate=$(".jsAmount").val().trim().replace(/[^0-9.]/g,""),o.flsa_status=$(".jsEmployeeType option:selected").val(),o.payment_unit=$(".jsSalaryType option:selected").val(),o.employeeId=s,o.companyId=companyId,o.title?o.flsa_status&&0!=o.flsa_status?o.rate?o.payment_unit&&0!=o.payment_unit?(ml(!0,"jsEmployeeOnboardModelLoader"),void $.ajax({method:"POST",url:baseURI+"gusto/employee/compensation",data:o}).done((function(e){return null,ml(!1,"jsEmployeeOnboardModelLoader"),e.errors?alertify.alert("Error!","object"==typeof e.errors?e.errors.join("<br/>"):e.errors,R):alertify.alert("Success!",e.success,k)})).error(T)):alertify.alert("Warning!","Salary type is mandatory.",R):alertify.alert("Warning!","Salary amount is mandatory.",R):alertify.alert("Warning!","Employee type is mandatory.",R):alertify.alert("Warning!","Job title is mandatory.",R)}function g(e){e.preventDefault();var o={};return o.street1=$(".jsStreet1").val().trim(),o.street2=$(".jsStreet2").val().trim(),o.country="USA",o.city=$(".jsCity").val().trim(),o.state=$(".jsState option:selected").val(),o.zip=$(".jsZip").val().trim(),o.phoneNumber=$(".jsPhoneNumber").val().replace(/[^\d]/g,""),o.employeeId=s,o.companyId=companyId,o.street1?o.city?o.state?o.zip?5!=o.zip.length?alertify.alert("Warning!","Zip must be 5 characters long.",R):o.phoneNumber&&10!=o.phoneNumber.length?alertify.alert("Warning!","Phone number must be of 10 digits long.",R):(ml(!0,"jsEmployeeOnboardModelLoader"),void $.ajax({method:"POST",url:baseURI+"gusto/employee/home_address",data:o}).done((function(e){return null,ml(!1,"jsEmployeeOnboardModelLoader"),e.errors?alertify.alert("Error!","object"==typeof e.errors?e.errors.join("<br/>"):e.errors,R):alertify.alert("Success!",e.success,P)})).error(T)):alertify.alert("Warning!","Zip is mandatory.",R):alertify.alert("Warning!","State is mandatory.",R):alertify.alert("Warning!","City is mandatory.",R):alertify.alert("Warning!","Street 1 is mandatory.",R)}function h(e){e.preventDefault();var o={};if(o.federalFilingStatus=$(".jsFederalFilingStatus option:selected").val(),o.multipleJobs=$(".jsMultipleJobs option:selected").val(),o.dependentTotal=$(".jsDependentTotal").val(),o.otherIncome=$(".jsOtherIncome").val(),o.deductions=$(".jsDeductions").val(),o.extraWithholding=$(".jsExtraWithholding").val(),o.employeeId=s,o.companyId=companyId,!o.federalFilingStatus||0==o.federalFilingStatus)return alertify.alert("Warning!","Federal Filing Status is mandatory.",R);o.deductions=o.deductions?parseFloat(o.deductions).toFixed(2):0,o.otherIncome=o.otherIncome?parseFloat(o.otherIncome).toFixed(2):0,o.extraWithholding=o.extraWithholding?parseFloat(o.extraWithholding).toFixed(2):0,o.dependentTotal=o.dependentTotal?parseFloat(o.dependentTotal).toFixed(2):0,ml(!0,"jsEmployeeOnboardModelLoader"),$.ajax({method:"POST",url:baseURI+"gusto/employee/federal_tax",data:o}).done((function(e){return null,ml(!1,"jsEmployeeOnboardModelLoader"),e.errors?alertify.alert("Error!","object"==typeof e.errors?e.errors.join("<br/>"):e.errors,R):alertify.alert("Success!",e.success,S)})).error(HandleError)}function v(e){e.preventDefault();var o={};for(key in o.employeeId=s,o.state_name=i,$(".jsStateField").each((function(){var e=$(this).data("field_key");o[e]="withholding_allowance"==e?parseInt($(".js"+e).val()):$(".js"+e).val()})),o){if(!o[key])return alertify.alert("Error!",key.replace(/_/gi," ")+" is mandatory",R);if("withholding_allowance"===key&&o[key]>99)return alertify.alert("Error!","Withholding Allowance must be less than or equal to 99",R)}ml(!0,"jsEmployeeOnboardModelLoader"),$.ajax({method:"POST",url:baseURI+"payroll/onboard_employee/state_tax/"+companyId,data:o}).done((function(e){return null,ml(!1,"jsEmployeeOnboardModelLoader"),e.status?alertify.alert("Success!",e.response,M):alertify.alert("Error!","object"==typeof e.errors?e.errors.join("<br/>"):e.errors,R)})).error(T)}function E(e){e.preventDefault();var o={};return o.routingNumber=$(".jsRoutingNumber").val().replace(/[^\d]/g,""),o.accountNumber=$(".jsAccountNumber").val().replace(/[^\d]/g,""),o.accountType=$(".jsAccountType option:selected").val(),o.bankName=$(".jsBankName").val().trim(),o.employeeId=s,o.companyId=companyId,o.bankId=d,o.bankName?o.routingNumber?9!==o.routingNumber.length?alertify.alert("Warning!","Routing number must be of 9 digits.",R):o.accountNumber?9!==o.accountNumber.length?alertify.alert("Warning!","Account number must be of 9 digits.",R):o.accountType&&"0"!=o.accountType?(ml(!0,"jsEmployeeOnboardModelLoader"),void $.ajax({method:"POST",url:baseURI+"gusto/employee/bank_account_add",data:o}).done((function(e){return null,ml(!1,"jsEmployeeOnboardModelLoader"),e.errors?alertify.alert("Error!","object"==typeof e.errors?e.errors.join("<br/>"):e.errors,R):alertify.alert("Success!",e.success,M)})).error(T)):alertify.alert("Warning!","Please, select the account type.",R):alertify.alert("Warning!","Account number is mandatory.",R):alertify.alert("Warning!","Routing number is mandatory.",R):alertify.alert("Warning!","Bank name is mandatory.",R)}function _(e){e.preventDefault();var o={};if(o.paymentMethod=$(".jsPaymentMethod option:selected").val(),o.employeeId=s,o.companyId=companyId,!o.paymentMethod||0==o.paymentMethod)return alertify.alert("Warning!","Please select a payment method.",R);ml(!0,"jsEmployeeOnboardModelLoader"),$.ajax({method:"POST",url:baseURI+"gusto/employee/payment_method",data:o}).done((function(e){return null,ml(!1,"jsEmployeeOnboardModelLoader"),e.errors?alertify.alert("Error!","object"==typeof e.errors?e.errors.join("<br/>"):e.errors,R):alertify.alert("Success!",e.success,(()=>{$(".jsModalCancel").click(),window.location.reload()}))})).error(HandleError)}function O(e){e.preventDefault();var o=[],a=$(this).data("uid");o.push("Are you sure you want to delete this bank Account?"),alertify.confirm("Confirm!",o.join("<br/>"),(function(){ml(!0,"jsEmployeeOnboardModelLoader"),$.ajax({method:"DELETE",url:baseURI+"payroll/onboard_employee/bank_account/"+companyId+"/"+s+"/"+a}).done((function(e){return null,ml(!1,"jsEmployeeOnboardModelLoader"),e.status?alertify.alert("Success!",e.response,M):alertify.alert("Error!","object"==typeof e.errors?e.errors.join("<br/>"):e.errors,R)})).error(T)}),(function(){}))}function I(){ml(!0,"jsEmployeeOnboardModelLoader"),$.ajax({method:"GET",url:w("get_payroll_page/get_company_employee_compensation/"+companyId),data:{employee_id:s}}).done((function(e){null,employeeJobID=e.JOB_ID,employeeHireDate=e.JOB_HIRE_DATE,D(e.html,(function(){$(".jsPayrollEmployeeOnboard").click(f),$(".jsPayrollSaveEmployeeJobInfo").click(j),ml(!1,"jsEmployeeOnboardModelLoader")}))})).error(T)}function k(){ml(!0,"jsEmployeeOnboardModelLoader"),$.ajax({method:"GET",url:w("get_payroll_page/get_company_employee_address/"+companyId),data:{employee_id:s}}).done((function(e){null,D(e.html,(function(){$(".jsPayrollEmployeeOnboard").click(I),$(".jsPayrollSaveEmployeeAddressInfo").click(g),$(".jsDatePicker").datepicker({format:"m/d/Y",changeMonth:!0,changeYear:!0,yearRange:"-100:+50"}),ml(!1,"jsEmployeeOnboardModelLoader")}))})).error(T)}function P(){ml(!0,"jsEmployeeOnboardModelLoader"),$.ajax({method:"GET",url:w("get_payroll_page/get_company_employee_federal_tax/"+companyId),data:{employee_id:s}}).done((function(e){null,D(e.html,(function(){$(".jsPayrollEmployeeOnboard").click(k),$(".jsPayrollSaveEmployeeFederalTax").click(h),ml(!1,"jsEmployeeOnboardModelLoader")}))})).error(T)}function S(){ml(!0,"jsEmployeeOnboardModelLoader"),$.ajax({method:"GET",url:w("get_payroll_page/get_company_employee_state_tax/"+companyId),data:{employee_id:s}}).done((function(e){null,D(e.html,(function(){"data_completed"==e.status?(ml(!0,"jsEmployeeOnboardModelLoader"),$.get(baseURI+"payroll/onboard_employee/state_tax/"+companyId+"/"+s).done((function(e){null,$("#JSStateName").text(e.response.state_name),i=e.response.state_name;var o="";e.response.state_json.questions.map((function(e){var a=0;e.answers.length&&(a=e.answers[0].value),o+='<div class="row">',o+='    <div class="col-md-12 col-xs-12">',o+='        <label class="csF16 csB7">',o+=e.label,o+="        </label>",o+='        <p class="csF16">',o+=e.description,o+="        </p>","Select"==e.input_question_format.type?(o+='<select class="form-control jsStateField js'+e.key+'" data-field_key="'+e.key+'">',e.input_question_format.options.map((function(e){o+='<option value="'+e.value+'" '+(a==e.value?"selected":"")+">"+e.label+"</option>"})),o+="</select>"):o+='<input type="'+e.input_question_format.type+'" min="0" class="form-control jsStateField js'+e.key+'" data-field_key="'+e.key+'" value="'+a+'">',o+="    </div>",o+="</div>",o+="</br>"})),$("#JSQusetionSection").html(o),ml(!1,"jsEmployeeOnboardModelLoader")})).error(T),$(".jsPayrollEmployeeOnboard").click(P),$(".jsPayrollSaveEmployeeStateTax").click(v)):ml(!1,"jsEmployeeOnboardModelLoader")}))})).error(T)}function M(){ml(!0,"jsEmployeeOnboardModelLoader"),$.ajax({method:"GET",url:w("get_payroll_page/get_company_employee_payment_method/"+companyId),data:{employee_id:s}}).done((function(e){null,D(e.html,(function(){$(".jsPayrollEmployeeOnboard").click(S),$(".jsPayrollEmployeePaymentMethod").click(_),$(".jsAddEmployeeBankAccount").click(x),$(".jsDeleteEmployeeBankAccount").click(O),ml(!1,"jsEmployeeOnboardModelLoader")}))})).error(T)}function x(){ml(!0,"jsEmployeeOnboardModelLoader"),d=$(this).data("account_id"),$.ajax({method:"GET",url:w("get_payroll_page/get_company_employee_bank_detail/"+companyId),data:{employee_id:s,row_id:d}}).done((function(e){null,D(e.html,(function(){$(".jsBackToPaymentMethod").click(M),$(".jsSaveEmployeeBankInfo").click(E),ml(!1,"jsEmployeeOnboardModelLoader")}))})).error(T)}function T(e){null,alertify.alert("Error!","The system failed to process your request. ("+e.status+")")}$("#jsPayrollEmployeeAddBtn").click((function(a){a.preventDefault(),r=0,l=0,n=[],null,Model({Id:e,Title:'<span class="'+e+'Title">Add Employees To Payroll</span>',Body:'<div id="'+e+'Body"></div>',Loader:o,Container:"container",CancelClass:"btn-cancel csW"},y)})),$(document).on("click","#jsMoveEmployeesToPayroll",(function(e){if(e.preventDefault(),n=[],!$('input[name="jsEmployeesList[]"]:checked').length)return alertify.alert("Error!","Please select at least one employee.",(function(){}));$('input[name="jsEmployeesList[]"]:checked').map((function(){n.push($(this).val())})),r=n.length,l=1,p()})),$(document).on("click",".jsPayrollEmployeeDelete",(function(e){e.preventDefault();var o=$(this).closest(".jsPayrollOnEmployeeRow").data("id");return alertify.confirm("Do you really want to delete this employee from payroll? <br /> This action is not revertible.",(function(){!function(e){$.ajax({method:"DELETE",url:baseURI+"payroll/onboard_employee/"+companyId+"/"+e}).done((function(e){return e.errors?alertify.alert("Error!",e.errors.join("<br />"),(function(){})):alertify.alert("Success!","You have successfully deleted the employee from payroll.",(function(){m()}))})).fail(T)}(o)})).setHeader("Confirm!")})),$(document).on("click",".jsPayrollEmployeeEdit",(function(e){e.preventDefault(),s=$(this).closest(".jsPayrollOnEmployeeRow").data("id"),function(){var e="jsEmployeeOnboardModel";Model({Id:e,Title:'<span class="'+e+'Title">Onboard Process</span>',Body:'<div id="'+e+'Body"></div>',Loader:e+"Loader",Container:"container",CancelClass:"btn-cancel csW"},u)}()})),$(document).on("change",".jsPaymentMethod",(function(){var e=$(this).val();"Check"==e&&($(".jsBaseOnC").show(),$(".jsBaseOnDD").hide()),"Direct Deposit"==e&&($(".jsBaseOnC").hide(),$(".jsBaseOnDD").show())})),$(document).on("click",".jsNavBarAction",(function(e){if(e.preventDefault(),0==c)return!1;({employee_profile:f,employee_compensation:I,employee_address:k,employee_federal_tax:P,employee_state_tax:S,employee_payment:M})[$(this).data("id")]()})),$(document).on("click",".jsToggleOnboardItems",(function(e){e.preventDefault(),$(".jsToggleOnboardItemsTable").addClass("hidden"),$(this).closest(".jsPayrollOnEmployeeRow").find(".jsToggleOnboardItemsTable").removeClass("hidden")})),$(document).on("click",".jsFinishEmployeeOnboard",(function(e){e.preventDefault();let o=$(this).closest(".jsPayrollOnEmployeeRow").data("id");var a;a=o,$('.jsPayrollOnEmployeeRow[data-id="'+a+'"] .jsFinishEmployeeOnboard i').addClass("fa-spin fa-spinner"),$('.jsPayrollOnEmployeeRow[data-id="'+a+'"] .jsFinishEmployeeOnboard').addClass("disabled"),L=$.get(window.location.origin+"/gusto/employee/"+a+"/onboard/finish").success((function(e){return L=null,$('.jsPayrollOnEmployeeRow[data-id="'+a+'"] .jsFinishEmployeeOnboard i').removeClass("fa-spin fa-spinner"),$('.jsPayrollOnEmployeeRow[data-id="'+a+'"] .jsFinishEmployeeOnboard').removeClass("disabled"),e.view?Model({Title:"Employee Onboard Steps",Id:"jsStepModal",Loader:"jsStepModalLoader",Body:e.view},(function(){ml(!1,"jsStepModalLoader")})):e.errors?alertify.alert("Error",e.errors.join("<br />")):void window.location.reload()})).fail((function(){L=null,$('.jsPayrollOnEmployeeRow[data-id="'+a+'"] .jsFinishEmployeeOnboard i').removeClass("fa-spin fa-spinner"),$('.jsPayrollOnEmployeeRow[data-id="'+a+'"] .jsFinishEmployeeOnboard').removeClass("disabled")}))}));let L=null;function w(e){return window.location.origin+"/"+(e||"")}function D(e,a){$("#jsEmployeeOnboardModelBody").html(e),a?a():ml(!1,o)}function R(){}m()}));