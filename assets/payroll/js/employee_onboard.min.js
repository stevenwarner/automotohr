$((function(){var e="jsEmployeeOnboardModal",t=e+"Loader",a=$("#jsPayrollEmployeesListingBox"),o=$("#jsPayrollEmployeesListingCount"),r=null,l=0,n=0,s=[],i=0,d="",c=0,m=0;function y(){r=$.get(baseURI+"payroll/get/"+companyId+"/payroll_employees").done((function(e){r=null,function(e){o.text("Total: "+Object.keys(e).length);var t="";if(!Object.keys(e).length)return t+="<tr>",t+='    <td colspan="4"><p class="alert alert-info text-center">No employees found.</p></td>',t+="</tr>",a.html(t);for(var r in e){var l=e[r];if("object"==typeof l){if(t+='<tr class="jsPayrollOnEmployeeRow" data-id="'+l.user_id+'">',t+='    <td class="vam"><strong>'+l.full_name_with_role+"</strong><p><strong>Reference: </strong>"+l.payroll_employee_id+"</p></td>",t+='    <td class="text-center vam text-'+("completed"==l.payroll_onboard_status.status?"success":"warning")+'"><strong>'+l.payroll_onboard_status.status.toUpperCase()+"</strong>","pending"==l.payroll_onboard_status.status){for(var r in t+='<div class="jsToggleOnboardItemsTable hidden"><br><br>        <table class="table table-striped table-condensed ">',t+="            <tbody>",l.payroll_onboard_status.details){var n=l.payroll_onboard_status.details[r];t+="                <tr>",t+='                    <th class="vam">'+r.replace(/_/g," ").toUpperCase()+"</th>",t+='                    <td class="text-right vam text-'+(1==n?"success":"danger")+'">'+(1==n?"Completed":"Pending")+"</td>",t+="                </tr>"}t+="            </tbody>",t+="        </table></div>"}t+="    </td>",t+='    <td class="text-right vam">',"pending"==l.payroll_onboard_status.status&&(t+='        <button class="btn btn-orange jsToggleOnboardItems"><i class="fa fa-eye" aria-hidden="true"></i>&nbsp;Pending Items</button>',t+='        <button class="btn btn-success jsFinishEmployeeOnboard"><i class="fa fa-check-circle" aria-hidden="true"></i>&nbsp;Finish Onboard</button>'),t+='        <button class="btn btn-warning jsPayrollEmployeeEdit"><i class="fa fa-edit" aria-hidden="true"></i>&nbsp;Edit</button>',"completed"!=l.payroll_onboard_status.status.toLowerCase()&&(t+='        <button class="btn btn-danger jsPayrollEmployeeDelete"><i class="fa fa-times-circle" aria-hidden="true"></i>&nbsp;Delete</button>'),t+="    </td>",t+="</tr>"}}a.html(t)}(e)})).fail(R)}function p(){null===r&&(ml(!0,t),r=$.ajax({method:"GET",url:C("get_payroll_employees/"+companyId+"/employee_onboarding")}).done((function(e){r=null,N(e,(function(){$(".jsMoveEmployeesToPayroll").click(u),ml(!1,t)}))})).error(R))}function u(e){if(e.preventDefault(),s=[],!$('input[name="jsEmployeesList[]"]:checked').length)return alertify.alert("Error!","Please select at least one employee.",(function(){}));$('input[name="jsEmployeesList[]"]:checked').map((function(){s.push($(this).val())})),f()}function f(){l=s.length,n=1,b()}function b(){if(n>l&&void 0===s[n-1])return ml(!1,t),alertify.alert("Success","The process has been completed.",(function(){}));ml(!0,t),r=$.post(baseURI+"payroll/onboard_employee/"+companyId,{employee_id:s[n-1],need_response:!0}).done((function(e){e.errors?$("#jsEmployeeError"+s[n-1]).html("Errors: "+e.errors.join("<br />")):$("#jsPayrollEmployeeRow"+s[n-1]).remove(),n++,b()})).error(R)}function h(){m=0,r=$.get(baseURI+"payroll/onboard_status/"+companyId+"/"+i).done((function(e){1==e.response.details.personal_profile&&(m=1)})).error(R),g()}function g(){ml(!0,t),r=$.ajax({method:"GET",url:C("get_payroll_page/get_company_employee_profile/"+companyId),data:{employee_id:i}}).done((function(e){r=null,N(e.html,(function(){$(".jsPayrollSaveCompanyEmployee").click(j),$(".jsDOBPicker").datepicker({format:"m/d/Y",changeMonth:!0,changeYear:!0,yearRange:"-80:+0"}),$(".jsDatePicker").datepicker({format:"m/d/Y",changeMonth:!0,changeYear:!0,yearRange:"-100:+50"}),ml(!1,t)}))})).error(R)}function j(e){e.preventDefault();var a={};return a.firstName=$(".jsFirstName").val().trim(),a.middleInitial=$(".jsMiddleName").val().trim(),a.lastName=$(".jsLastName").val().trim(),a.startDate=$(".jsStartDate").val()||"",a.ssn=$(".jsEmployeeSSN").val().replace(/[^\d]/g,""),a.dob=$(".jsEDOB").val()||"",a.workLocation=$(".jsEWD option:selected").val()||0,a.email=$(".jsEmail").val().trim(),a.firstName?a.lastName?a.email?a.email.verifyEmail()?a.ssn?9!=a.ssn.length?alertify.alert("Warning!","SSN number must be of 9 digits long.",B):a.dob?(a.employeeId=i,a.companyId=companyId,ml(!0,t),void(r=$.ajax({method:"POST",url:baseURI+"gusto/employee/profile",data:a}).done((function(e){return r=null,ml(!1,t),e.errors?alertify.alert("Error!","object"==typeof e.errors?e.errors.join("<br/>"):e.errors,B):alertify.alert("Success!",e.success,(function(){return T(),!0}))})).error(R))):alertify.alert("Warning!","Date of birth is mandatory.",B):alertify.alert("Warning!","SSN is mandatory.",B):alertify.alert("Warning!","Email address is not valid.",B):alertify.alert("Warning!","Email address is mandatory.",B):alertify.alert("Warning!","Last name is mandatory.",B):alertify.alert("Warning!","First name is mandatory.",B)}function _(e){e.preventDefault();var a={};return a.title=$(".jsJobTitle").val().trim(),a.rate=$(".jsAmount").val().trim().replace(/[^0-9.]/g,""),a.flsa_status=$(".jsEmployeeType option:selected").val(),a.payment_unit=$(".jsSalaryType option:selected").val(),a.employeeId=i,a.companyId=companyId,a.title?a.flsa_status&&0!=a.flsa_status?a.rate?a.payment_unit&&0!=a.payment_unit?(ml(!0,t),void(r=$.ajax({method:"POST",url:baseURI+"gusto/employee/compensation",data:a}).done((function(e){return r=null,ml(!1,t),e.errors?alertify.alert("Error!","object"==typeof e.errors?e.errors.join("<br/>"):e.errors,B):alertify.alert("Success!",e.success,O)})).error(R))):alertify.alert("Warning!","Salary type is mandatory.",B):alertify.alert("Warning!","Salary amount is mandatory.",B):alertify.alert("Warning!","Employee type is mandatory.",B):alertify.alert("Warning!","Job title is mandatory.",B)}function v(e){e.preventDefault();var a={};return a.street1=$(".jsStreet1").val().trim(),a.street2=$(".jsStreet2").val().trim(),a.country="USA",a.city=$(".jsCity").val().trim(),a.state=$(".jsState option:selected").val(),a.zip=$(".jsZip").val().trim(),a.phoneNumber=$(".jsPhoneNumber").val().replace(/[^\d]/g,""),a.employeeId=i,a.companyId=companyId,a.street1?a.city?a.state?a.zip?5!=a.zip.length?alertify.alert("Warning!","Zip must be 5 characters long.",B):a.phoneNumber&&10!=a.phoneNumber.length?alertify.alert("Warning!","Phone number must be of 10 digits long.",B):(ml(!0,t),void(r=$.ajax({method:"POST",url:baseURI+"gusto/employee/home_address",data:a}).done((function(e){return r=null,ml(!1,t),e.errors?alertify.alert("Error!","object"==typeof e.errors?e.errors.join("<br/>"):e.errors,B):alertify.alert("Success!",e.success,x)})).error(R))):alertify.alert("Warning!","Zip is mandatory.",B):alertify.alert("Warning!","State is mandatory.",B):alertify.alert("Warning!","City is mandatory.",B):alertify.alert("Warning!","Street 1 is mandatory.",B)}function E(e){e.preventDefault();var a={};if(a.federalFilingStatus=$(".jsFederalFilingStatus option:selected").val(),a.multipleJobs=$(".jsMultipleJobs option:selected").val(),a.dependentTotal=$(".jsDependentTotal").val(),a.otherIncome=$(".jsOtherIncome").val(),a.deductions=$(".jsDeductions").val(),a.extraWithholding=$(".jsExtraWithholding").val(),a.employeeId=i,a.companyId=companyId,!a.federalFilingStatus||0==a.federalFilingStatus)return alertify.alert("Warning!","Federal Filing Status is mandatory.",B);a.deductions=a.deductions?parseFloat(a.deductions).toFixed(2):0,a.otherIncome=a.otherIncome?parseFloat(a.otherIncome).toFixed(2):0,a.extraWithholding=a.extraWithholding?parseFloat(a.extraWithholding).toFixed(2):0,a.dependentTotal=a.dependentTotal?parseFloat(a.dependentTotal).toFixed(2):0,ml(!0,t),r=$.ajax({method:"POST",url:baseURI+"gusto/employee/federal_tax",data:a}).done((function(e){return r=null,ml(!1,t),e.errors?alertify.alert("Error!","object"==typeof e.errors?e.errors.join("<br/>"):e.errors,B):alertify.alert("Success!",e.success,D)})).error(HandleError)}function I(e){e.preventDefault();var a={};for(key in a.employeeId=i,a.state_name=d,$(".jsStateField").each((function(){var e=$(this).data("field_key");a[e]="withholding_allowance"==e?parseInt($(".js"+e).val()):$(".js"+e).val()})),a){if(!a[key])return alertify.alert("Error!",key.replace(/_/gi," ")+" is mandatory",B);if("withholding_allowance"===key&&a[key]>99)return alertify.alert("Error!","Withholding Allowance must be less than or equal to 99",B)}ml(!0,t),r=$.ajax({method:"POST",url:baseURI+"payroll/onboard_employee/state_tax/"+companyId,data:a}).done((function(e){return r=null,ml(!1,t),e.status?alertify.alert("Success!",e.response,w):alertify.alert("Error!","object"==typeof e.errors?e.errors.join("<br/>"):e.errors,B)})).error(R)}function k(e){e.preventDefault();var a={};return a.routingNumber=$(".jsRoutingNumber").val().replace(/[^\d]/g,""),a.accountNumber=$(".jsAccountNumber").val().replace(/[^\d]/g,""),a.accountType=$(".jsAccountType option:selected").val(),a.bankName=$(".jsBankName").val().trim(),a.employeeId=i,a.companyId=companyId,a.bankId=c,a.bankName?a.routingNumber?9!==a.routingNumber.length?alertify.alert("Warning!","Routing number must be of 9 digits.",B):a.accountNumber?9!==a.accountNumber.length?alertify.alert("Warning!","Account number must be of 9 digits.",B):a.accountType&&"0"!=a.accountType?(ml(!0,t),void(r=$.ajax({method:"POST",url:baseURI+"gusto/employee/bank_account_add",data:a}).done((function(e){return r=null,ml(!1,t),e.errors?alertify.alert("Error!","object"==typeof e.errors?e.errors.join("<br/>"):e.errors,B):alertify.alert("Success!",e.success,w)})).error(R))):alertify.alert("Warning!","Please, select the account type.",B):alertify.alert("Warning!","Account number is mandatory.",B):alertify.alert("Warning!","Routing number is mandatory.",B):alertify.alert("Warning!","Bank name is mandatory.",B)}function S(e){e.preventDefault();var a={};if(a.paymentMethod=$(".jsPaymentMethod option:selected").val(),a.employeeId=i,a.companyId=companyId,!a.paymentMethod||0==a.paymentMethod)return alertify.alert("Warning!","Please select a payment method.",B);ml(!0,t),r=$.ajax({method:"POST",url:baseURI+"gusto/employee/payment_method",data:a}).done((function(e){return r=null,ml(!1,t),e.errors?alertify.alert("Error!","object"==typeof e.errors?e.errors.join("<br/>"):e.errors,B):alertify.alert("Success!",e.success,(()=>{$(".jsModalCancel").click(),window.location.reload()}))})).error(HandleError)}function P(e){e.preventDefault();var a=[],o=$(this).data("uid");a.push("Are you sure you want to delete this bank Account?"),alertify.confirm("Confirm!",a.join("<br/>"),(function(){ml(!0,t),r=$.ajax({method:"DELETE",url:baseURI+"payroll/onboard_employee/bank_account/"+companyId+"/"+i+"/"+o}).done((function(e){return r=null,ml(!1,t),e.status?alertify.alert("Success!",e.response,w):alertify.alert("Error!","object"==typeof e.errors?e.errors.join("<br/>"):e.errors,B)})).error(R)}),(function(){}))}function T(){ml(!0,t),r=$.ajax({method:"GET",url:C("get_payroll_page/get_company_employee_compensation/"+companyId),data:{employee_id:i}}).done((function(e){r=null,employeeJobID=e.JOB_ID,employeeHireDate=e.JOB_HIRE_DATE,N(e.html,(function(){$(".jsPayrollEmployeeOnboard").click(g),$(".jsPayrollSaveEmployeeJobInfo").click(_),ml(!1,t)}))})).error(R)}function O(){ml(!0,t),r=$.ajax({method:"GET",url:C("get_payroll_page/get_company_employee_address/"+companyId),data:{employee_id:i}}).done((function(e){r=null,N(e.html,(function(){$(".jsPayrollEmployeeOnboard").click(T),$(".jsPayrollSaveEmployeeAddressInfo").click(v),$(".jsDatePicker").datepicker({format:"m/d/Y",changeMonth:!0,changeYear:!0,yearRange:"-100:+50"}),ml(!1,t)}))})).error(R)}function x(){ml(!0,t),r=$.ajax({method:"GET",url:C("get_payroll_page/get_company_employee_federal_tax/"+companyId),data:{employee_id:i}}).done((function(e){r=null,N(e.html,(function(){$(".jsPayrollEmployeeOnboard").click(O),$(".jsPayrollSaveEmployeeFederalTax").click(E),ml(!1,t)}))})).error(R)}function D(){ml(!0,t),r=$.ajax({method:"GET",url:C("get_payroll_page/get_company_employee_state_tax/"+companyId),data:{employee_id:i}}).done((function(e){r=null,N(e.html,(function(){"data_completed"==e.status?(ml(!0,t),r=$.get(baseURI+"payroll/onboard_employee/state_tax/"+companyId+"/"+i).done((function(e){r=null,$("#JSStateName").text(e.response.state_name),d=e.response.state_name;var a="";e.response.state_json.questions.map((function(e){var t=0;e.answers.length&&(t=e.answers[0].value),a+='<div class="row">',a+='    <div class="col-md-12 col-xs-12">',a+='        <label class="csF16 csB7">',a+=e.label,a+="        </label>",a+='        <p class="csF16">',a+=e.description,a+="        </p>","Select"==e.input_question_format.type?(a+='<select class="form-control jsStateField js'+e.key+'" data-field_key="'+e.key+'">',e.input_question_format.options.map((function(e){a+='<option value="'+e.value+'" '+(t==e.value?"selected":"")+">"+e.label+"</option>"})),a+="</select>"):a+='<input type="'+e.input_question_format.type+'" min="0" class="form-control jsStateField js'+e.key+'" data-field_key="'+e.key+'" value="'+t+'">',a+="    </div>",a+="</div>",a+="</br>"})),$("#JSQusetionSection").html(a),ml(!1,t)})).error(R),$(".jsPayrollEmployeeOnboard").click(x),$(".jsPayrollSaveEmployeeStateTax").click(I)):ml(!1,t)}))})).error(R)}function w(){ml(!0,t),r=$.ajax({method:"GET",url:C("get_payroll_page/get_company_employee_payment_method/"+companyId),data:{employee_id:i}}).done((function(e){r=null,N(e.html,(function(){$(".jsPayrollEmployeeOnboard").click(D),$(".jsPayrollEmployeePaymentMethod").click(S),$(".jsAddEmployeeBankAccount").click(W),$(".jsDeleteEmployeeBankAccount").click(P),ml(!1,t)}))})).error(R)}function W(){ml(!0,t),c=$(this).data("account_id"),r=$.ajax({method:"GET",url:C("get_payroll_page/get_company_employee_bank_detail/"+companyId),data:{employee_id:i,row_id:c}}).done((function(e){r=null,N(e.html,(function(){$(".jsBackToPaymentMethod").click(w),$(".jsSaveEmployeeBankInfo").click(k),ml(!1,t)}))})).error(R)}function R(e){r=null,alertify.alert("Error!","The system failed to process your request. ("+e.status+")")}$("#jsPayrollEmployeeAddBtn").click((function(a){a.preventDefault(),l=0,n=0,s=[],r=null,Model({Id:e,Title:'<span class="'+e+'Title">Add Employees To Payroll</span>',Body:'<div id="'+e+'Body"></div>',Loader:t,Container:"container",CancelClass:"btn-cancel csW"},p)})),$(document).on("click","#jsMoveEmployeesToPayroll",(function(e){if(e.preventDefault(),s=[],!$('input[name="jsEmployeesList[]"]:checked').length)return alertify.alert("Error!","Please select at least one employee.",(function(){}));$('input[name="jsEmployeesList[]"]:checked').map((function(){s.push($(this).val())})),f()})),$(document).on("click",".jsPayrollEmployeeDelete",(function(e){e.preventDefault();var t=$(this).closest(".jsPayrollOnEmployeeRow").data("id");return alertify.confirm("Do you really want to delete this employee from payroll? <br /> This action is not revertible.",(function(){!function(e){r=$.ajax({method:"DELETE",url:baseURI+"payroll/onboard_employee/"+companyId+"/"+e}).done((function(e){return e.errors?alertify.alert("Error!",e.errors.join("<br />"),(function(){})):alertify.alert("Success!","You have successfully deleted the employee from payroll.",(function(){y()}))})).fail(R)}(t)})).setHeader("Confirm!")})),$(document).on("click",".jsPayrollEmployeeEdit",(function(a){a.preventDefault(),i=$(this).closest(".jsPayrollOnEmployeeRow").data("id"),Model({Id:e,Title:'<span class="'+e+'Title">Onboard Process</span>',Body:'<div id="'+e+'Body"></div>',Loader:t,Container:"container",CancelClass:"btn-cancel csW"},h)})),$(document).on("change",".jsPaymentMethod",(function(){var e=$(this).val();"Check"==e&&($(".jsBaseOnC").show(),$(".jsBaseOnDD").hide()),"Direct Deposit"==e&&($(".jsBaseOnC").hide(),$(".jsBaseOnDD").show())})),$(document).on("click",".jsNavBarAction",(function(e){if(e.preventDefault(),0==m)return!1;({employee_profile:g,employee_compensation:T,employee_address:O,employee_federal_tax:x,employee_state_tax:D,employee_payment:w})[$(this).data("id")]()})),$(document).on("click",".jsToggleOnboardItems",(function(e){e.preventDefault(),$(".jsToggleOnboardItemsTable").addClass("hidden"),$(this).closest(".jsPayrollOnEmployeeRow").find(".jsToggleOnboardItemsTable").removeClass("hidden")})),$(document).on("click",".jsFinishEmployeeOnboard",(function(e){e.preventDefault();let t=$(this).closest(".jsPayrollOnEmployeeRow").data("id");var a;a=t,$('.jsPayrollOnEmployeeRow[data-id="'+a+'"] .jsFinishEmployeeOnboard i').addClass("fa-spin fa-spinner"),$('.jsPayrollOnEmployeeRow[data-id="'+a+'"] .jsFinishEmployeeOnboard').addClass("disabled"),F=$.get(window.location.origin+"/gusto/employee/"+a+"/onboard/finish").success((function(e){return F=null,$('.jsPayrollOnEmployeeRow[data-id="'+a+'"] .jsFinishEmployeeOnboard i').removeClass("fa-spin fa-spinner"),$('.jsPayrollOnEmployeeRow[data-id="'+a+'"] .jsFinishEmployeeOnboard').removeClass("disabled"),e.view?Model({Title:"Employee Onboard Steps",Id:"jsStepModal",Loader:"jsStepModalLoader",Body:e.view},(function(){ml(!1,"jsStepModalLoader")})):e.errors?alertify.alert("Error",e.errors.join("<br />")):void window.location.reload()})).fail((function(){F=null,$('.jsPayrollOnEmployeeRow[data-id="'+a+'"] .jsFinishEmployeeOnboard i').removeClass("fa-spin fa-spinner"),$('.jsPayrollOnEmployeeRow[data-id="'+a+'"] .jsFinishEmployeeOnboard').removeClass("disabled")}))}));let F=null;function C(e){return window.location.origin+"/"+(e||"")}function N(a,o){$("#"+e+"Body").html(a),o?o():ml(!1,t)}function B(){}y()}));