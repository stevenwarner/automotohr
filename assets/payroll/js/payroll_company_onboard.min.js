$((function(){var e,l,a,n="jsPayrollCompanyOnboardModal",o=n+"Loader",t=null,r=[function(){$("#jsIPLoaderTextArea").text(i[0]);var n=_("PayrollEmployees"+e);null!==n&&n.length>0&&(l=0,a=n.length);!function(){if(null!==t)return;ml(!0,o),t=$.ajax({method:"post",url:j("payroll/onboard_company/"+e),data:{companyId:e}}).done((function(e){return t=null,ml(!1,o),e.errors?alertify.alert("Error!",function(e){if(void 0!==typeof e)return"object"==typeof e[0]?e[0].full_message:e.join("<br/>");return e}(e.errors)):a>0?p():void h()})).error(v)}()},g],i=["Please wait while we set up the payroll.","Please wait while we are adding company address.","Please wait while we are adding company federal tax.","Please wait while we are adding company Bank detail.","Please wait while we add the selected employees to payroll..","Please wait we are adding employee one by one."];function s(){null===t&&(ml(!0,o),t=$.ajax({method:"GET",url:j("get_payroll_page/welcome")}).done((function(e){t=null,P(e,(function(){$(".jsPayrollLoadSelectEmployees").click(c),ml(!1,o)}))})).error(v))}function c(l){l.preventDefault(),null===t&&(ml(!0,o),t=$.ajax({method:"GET",url:j("get_payroll_page/employees/"+e)}).done((function(l){t=null,P(l,(function(){$(".jsPayrollBackToWelcome").click(s),$(".jsPayrollLoadOnboaard").click(d);var l=_("PayrollEmployees"+e);if(null!==l&&l.length>0)for(var a in l)$('.jsPayrollEmployees[value="'+l[a]+'"]').prop("checked",!0);ml(!1,o)}))})).error(v))}function d(l){if(l){l.preventDefault();var a=[];$(".jsPayrollEmployees:checked").length&&$(".jsPayrollEmployees:checked").map((function(){a.push($(this).val())})),n="PayrollEmployees"+e,r=a,localStorage.setItem(n,JSON.stringify(r)),_(n)}var n,r;null===t&&(ml(!0,o),t=$.ajax({method:"GET",url:j("get_payroll_page/onboard/"+e)}).done((function(e){t=null,P(e,(function(){$(".jsPayrollMoveCompanyToPayroll").length&&$(".jsPayrollMoveCompanyToPayroll").click(f),$(".jsPayrollSetAdmin").length&&$(".jsPayrollSetAdmin").click(u),$(".jsPayrollViewAdmin").length&&$(".jsPayrollViewAdmin").click(y),ml(!1,o)}))})).error(v))}function u(l){l.preventDefault(),null===t&&(ml(!0,o),t=$.ajax({method:"GET",url:j("get_payroll_page/admin/"+e)}).done((function(e){t=null,P(e,(function(){$(".jsPayrollSaveAdmin").click(m),ml(!1,o)}))})).error(v))}function m(l){l.preventDefault();var a,n={};return n.first_name=$(".jsAdminFirstName").val().replace(/[^a-zA-Z]/g,""),n.last_name=$(".jsAdminLastName").val().replace(/[^a-zA-Z]/g,""),n.email_address=$(".jsAdminEmailAddress").val().trim(),n.phone_number=$(".jsAdminPhoneNumber").val().replace(/[^\d]/g,""),0===n.first_name.length?alertify.alert("Warning!","First name is mandatory.",w):0===n.last_name.length?alertify.alert("Warning!","Last name is mandatory.",w):0===n.email_address.length?alertify.alert("Warning!","Email is mandatory.",w):(a=n.email_address,/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(a).toLowerCase())?n.phone_number&&10!==n.phone_number.length?alertify.alert("Warning!","Phone number must be 10 digits long.",w):(ml(!0,o),void $.ajax({method:"POST",url:j("save_payroll_admin/"+e),data:n}).done((function(){return alertify.alert("Success","You have successfully added the payroll admin.",(function(){d()}))})).error(v)):alertify.alert("Warning!","Email is not valid.",w))}function y(l){l.preventDefault(),null===t&&(ml(!0,o),t=$.ajax({method:"GET",url:j("get_payroll_page/admin_view/"+e)}).done((function(e){t=null,P(e,(function(){$(".jsPayrollBackToOnboard").click(d),ml(!1,o)}))})).error(v))}function f(e){e.preventDefault(),null===t&&(ml(!0,o),$("#jsIPLoaderTextArea").text(i[0]),r[0]())}function p(){var a=_("PayrollEmployees"+e);$("#jsIPLoaderTextArea").text("Please wait we are adding employee "+(l+1)+" out of "+a.length),t=$.ajax({method:"POST",url:j("payroll/onboard_employee/"+e),data:{employee_id:a[l]}}).done((function(){t=null,l<a.length-1?(l++,p()):h()}))}function g(){$("#"+n).hide(),alertify.alert("Success!","Payroll is activated against this store.",(function(){location.reload()}))}function h(){ml(!0,o),t=$.ajax({method:"GET",url:j("get_payroll_page/get_prosess_complete_page/"+e)}).done((function(e){t=null,P(e.html,(function(){ml(!1,o)}))})).error(v)}function j(e){return window.location.origin+"/"+(e||"")}function P(e,l){$("#"+n+"Body").html(e),l?l():ml(!1,o)}function v(e){t=null,alertify.alert("Error!","The system failed to process your request. ("+e.status+")")}function _(e){return JSON.parse(localStorage.getItem(e))}function w(){return!0}$(".jsPayrollCompanyOnboard, .jsAddCompanyToGusto").click((function(l){if(l.preventDefault(),e=$(this).data("cid")||0,$(this).data("company_sid")&&(e=$(this).data("company_sid")),0==e)return alertify.alert("Warning!","System failed to verify company reference.");t=null,Model({Id:n,Title:'<span class="'+n+'Title"></span>',Body:'<div id="'+n+'Body"></div>',Loader:o,Container:"container",CancelClass:"btn-cancel csW"},s)})),$(document).on("click",".jsPayrollCancel",(function(e){return e.preventDefault(),alertify.confirm("Any unsaved changes to this content will be lost. Are you sure you want to close this page?",(function(){t=null,$("#"+n).find(".jsModalCancel").click()})).setHeader("Confirm!")})),$(".jsSyncWithGusto").click((function(l){var a=$(this).data("company_sid");e=a,SyncCompanyOnboarding()})),$(document).on("click",".jsPayrollConfirmContinue",g)}));