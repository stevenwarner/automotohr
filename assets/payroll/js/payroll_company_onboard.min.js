$((function PayrollCompanyOnboard(){var companyId,modalId="jsPayrollCompanyOnboardModal",modalLoader=modalId+"Loader",xhr=null,payrollEvents=[AddCompanyEmployees,FinishCompanyOnboarding],payrollEventsMessages=["Please wait while we set up the payroll.","Please wait while we are adding company address.","Please wait while we are adding company federal tax.","Please wait while we are adding company Bank detail.","Please wait while we add the selected employees to payroll..","Please wait we are adding employee one by one."],CURRENT_EMPLOYEE,SELECTED_EMPLOYEE;function StartOnboardProcess(){xhr=null,Model({Id:modalId,Title:'<span class="'+modalId+'Title"></span>',Body:'<div id="'+modalId+'Body"></div>',Loader:modalLoader,Container:"container-fluid",CancelClass:"btn-cancel csW"},WelcomeJourney)}function WelcomeJourney(){null===xhr&&(ml(!0,modalLoader),xhr=$.ajax({method:"GET",url:GetURL("get_payroll_page/welcome")}).done((function(resp){xhr=null,LoadContent(resp,(function(){$(".jsPayrollLoadSelectEmployees").click(EmployeeSelectPage),ml(!1,modalLoader)}))})).error(HandleError))}function EmployeeSelectPage(event){event.preventDefault(),null===xhr&&(ml(!0,modalLoader),xhr=$.ajax({method:"GET",url:GetURL("get_payroll_page/employees/"+companyId)}).done((function(resp){xhr=null,LoadContent(resp,(function(){$(".jsPayrollBackToWelcome").click(WelcomeJourney),$(".jsPayrollLoadOnboaard").click(OnboardPage);var preSelected=GetItem("PayrollEmployees"+companyId);if(null!==preSelected&&preSelected.length>0)for(var index in preSelected)$('.jsPayrollEmployees[value="'+preSelected[index]+'"]').prop("checked",!0);ml(!1,modalLoader)}))})).error(HandleError))}function OnboardPage(event){if(event){event.preventDefault();var ids=[];$(".jsPayrollEmployees:checked").length&&$(".jsPayrollEmployees:checked").map((function(){ids.push($(this).val())})),SaveItem("PayrollEmployees"+companyId,ids)}null===xhr&&(ml(!0,modalLoader),xhr=$.ajax({method:"GET",url:GetURL("get_payroll_page/onboard/"+companyId)}).done((function(resp){xhr=null,LoadContent(resp,(function(){$(".jsPayrollMoveCompanyToPayroll").length&&$(".jsPayrollMoveCompanyToPayroll").click(InitialOnboard),$(".jsPayrollSetAdmin").length&&$(".jsPayrollSetAdmin").click(PayrollAdminPage),$(".jsPayrollViewAdmin").length&&$(".jsPayrollViewAdmin").click(PayrollAdminViewPage),ml(!1,modalLoader)}))})).error(HandleError))}function PayrollAdminPage(event){event.preventDefault(),null===xhr&&(ml(!0,modalLoader),xhr=$.ajax({method:"GET",url:GetURL("get_payroll_page/admin/"+companyId)}).done((function(resp){xhr=null,LoadContent(resp,(function(){$(".jsPayrollSaveAdmin").click(SavePayrollAdmin),ml(!1,modalLoader)}))})).error(HandleError))}function SavePayrollAdmin(event){event.preventDefault();var o={};return o.first_name=$(".jsAdminFirstName").val().replace(/[^a-zA-Z]/g,""),o.last_name=$(".jsAdminLastName").val().replace(/[^a-zA-Z]/g,""),o.email_address=$(".jsAdminEmailAddress").val().trim(),o.phone_number=$(".jsAdminPhoneNumber").val().replace(/[^\d]/g,""),0===o.first_name.length?alertify.alert("Warning!","First name is mandatory.",AlertifyHandler):0===o.last_name.length?alertify.alert("Warning!","Last name is mandatory.",AlertifyHandler):0===o.email_address.length?alertify.alert("Warning!","Email is mandatory.",AlertifyHandler):validateEmail(o.email_address)?o.phone_number&&10!==o.phone_number.length?alertify.alert("Warning!","Phone number must be 10 digits long.",AlertifyHandler):(ml(!0,modalLoader),void $.ajax({method:"POST",url:GetURL("save_payroll_admin/"+companyId),data:o}).done((function(){return alertify.alert("Success","You have successfully added the payroll admin.",(function(){OnboardPage()}))})).error(HandleError)):alertify.alert("Warning!","Email is not valid.",AlertifyHandler)}function PayrollAdminViewPage(event){event.preventDefault(),null===xhr&&(ml(!0,modalLoader),xhr=$.ajax({method:"GET",url:GetURL("get_payroll_page/admin_view/"+companyId)}).done((function(resp){xhr=null,LoadContent(resp,(function(){$(".jsPayrollBackToOnboard").click(OnboardPage),ml(!1,modalLoader)}))})).error(HandleError))}function InitialOnboard(event){event.preventDefault(),null===xhr&&(ml(!0,modalLoader),$("#jsIPLoaderTextArea").text(payrollEventsMessages[0]),payrollEvents[0]())}function AddNewCompany(){null===xhr&&(ml(!0,modalLoader),xhr=$.ajax({method:"post",url:GetURL("payroll/onboard_company/"+companyId),data:{companyId:companyId}}).done((function(resp){return xhr=null,ml(!1,modalLoader),resp.errors?alertify.alert("Error!",ShowError(resp.errors)):SELECTED_EMPLOYEE>0?moveEmployeeToGusto():void ShowCompleteProcessPage()})).error(HandleError))}function AddCompanyEmployees(){$("#jsIPLoaderTextArea").text(payrollEventsMessages[0]);var preSelected=GetItem("PayrollEmployees"+companyId);null!==preSelected&&preSelected.length>0&&(CURRENT_EMPLOYEE=0,SELECTED_EMPLOYEE=preSelected.length),AddNewCompany()}function moveEmployeeToGusto(){var preSelected=GetItem("PayrollEmployees"+companyId);$("#jsIPLoaderTextArea").text("Please wait we are adding employee "+(CURRENT_EMPLOYEE+1)+" out of "+preSelected.length),xhr=$.ajax({method:"POST",url:GetURL("payroll/onboard_employee/"+companyId),data:{employee_id:preSelected[CURRENT_EMPLOYEE]}}).done((function(){xhr=null,CURRENT_EMPLOYEE<preSelected.length-1?(CURRENT_EMPLOYEE++,moveEmployeeToGusto()):ShowCompleteProcessPage()}))}function FinishCompanyOnboarding(){$("#"+modalId).hide(),alertify.alert("Success!","Payroll is activated against this store.",(function(){location.reload()}))}function ShowCompleteProcessPage(){ml(!0,modalLoader),xhr=$.ajax({method:"GET",url:GetURL("get_payroll_page/get_prosess_complete_page/"+companyId)}).done((function(resp){xhr=null,LoadContent(resp.html,(function(){ml(!1,modalLoader)}))})).error(HandleError)}function GetURL(url){return window.location.origin+"/"+(url||"")}function LoadContent(content,cb){$("#"+modalId+"Body").html(content),cb?cb():ml(!1,modalLoader)}function HandleError(error){xhr=null,alertify.alert("Error!","The system failed to process your request. ("+error.status+")")}function validateEmail(email){const re=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(String(email).toLowerCase())}function SaveItem(slug,data){return localStorage.setItem(slug,JSON.stringify(data)),GetItem(slug)}function GetItem(slug){return JSON.parse(localStorage.getItem(slug))}function AlertifyHandler(){return!0}function ShowError(errors){return void 0!==typeof errors?"object"==typeof errors[0]?errors[0].full_message:errors.join("<br/>"):errors}$(".jsPayrollCompanyOnboard, .jsAddCompanyToGusto").click((function(event){if(event.preventDefault(),companyId=$(this).data("cid")||0,$(this).data("company_sid")&&(companyId=$(this).data("company_sid")),0==companyId)return alertify.alert("Warning!","System failed to verify company reference.");StartOnboardProcess()})),$(document).on("click",".jsPayrollCancel",(function(event){return event.preventDefault(),alertify.confirm("Any unsaved changes to this content will be lost. Are you sure you want to close this page?",(function(){xhr=null,$("#"+modalId).find(".jsModalCancel").click()})).setHeader("Confirm!")})),$(".jsSyncWithGusto").click((function(event){var company_sid=$(this).data("company_sid");companyId=company_sid,SyncCompanyOnboarding()})),$(document).on("click",".jsPayrollConfirmContinue",FinishCompanyOnboarding)}));