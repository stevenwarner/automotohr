$(function(){function e(e){var t;$("#attachment_loader").show();var a="",i="";"normal"==e?(a=$("#subject").val(),i=CKEDITOR.instances.email_message.getData()):"popup"==e&&(a=$("#send_email_subject").val(),i=CKEDITOR.instances.send_email_message.getData());var o=new FormData;if(o.append("report_id",reportId),o.append("incident_id",incidentId),o.append("subject",a),o.append("message",i),"normal"==e)"system"==$("#jsUserType").val()?(t=$("#receiverId").val(),o.append("receivers",t),o.append("send_type","system")):(manual_email=$("#manual_address").val(),o.append("manual_email",manual_email),o.append("send_type","manual"));else if("popup"==e){var n=$("#send_email_type").val();"system"==n?(t=$("#send_email_user").val(),o.append("receivers",t),o.append("send_type","system")):(t=$("#send_email_user").val(),o.append("manual_email",manual_email),o.append("send_type","manual"))}m.length&&o.append("attach_files",m),$.ajax({url:baseURL+"compliance_safety_reporting_public/send_compliance_report_email",cache:!1,contentType:!1,processData:!1,type:"post",data:o,success:function(e){$("#attachment_loader").hide(),alertify.alert("SUCCESS!","You have succesfully send an email.",()=>{window.location.reload()})},error:function(){}})}function t(e){var t=baseURL+"compliance_safety_reporting_public/update_email_read_flag",a=($("#update_document_sid").val(),new FormData);a.append("email_sid",e),a.append("receiver_sid",employeeId),$.ajax({url:t,cache:!1,contentType:!1,processData:!1,type:"post",data:a,success:function(t){var a=jQuery.parseJSON(t),i=a.status_one,o=a.status_two,n=a.sender_sid;0==i&&$("#current_user_notification").hide(),0==o&&$("#email_notification_"+n).hide(),$("#email_read_"+e).hide()},error:function(){}})}function a(e){var t=$(e).attr("item-category"),a=$(e).attr("item-title"),i=$(e).attr("item-url"),o=$(e).attr("item-type");if($("#show_library_item").hide(),$("#view_library_item").show(),$("#library_item_title").html(a),$(".back_to_library").attr("file-type",o),"document"==t)if($("#library-document-section").show(),"document"==o){var n=$("<iframe />").attr("id","library-document-iframe").attr("class","uploaded-file-preview").attr("src",i);$("#library-document-placeholder").append(n)}else{var p=$("<img />").attr("id","library-image").attr("class","img-responsive").attr("src",i);$("#library-document-placeholder").append(p)}else if("link"==o){$("#library-youtube-section").show();var _=$("<iframe />").attr("id","library-youtube-iframe").attr("src",i);$("#library-youtube-placeholder").append(_)}else if("video"==o){$("#library-video-section").show();_=$("<video />").attr("id","library-upload-video").attr("src",i).attr("controls",!0);$("#library-video-placeholder").append(_)}else if("audio"==o){$("#library-audio-section").show();var l=$("<audio />").attr("id","library-upload-audio").attr("src",i).attr("controls",!0);$("#library-audio-placeholder").append(l)}}function i(e){var t=$("#"+e).val();if(!(t.length>0))return $("#name_"+e).html("No video selected"),alertify.alert("No video selected"),$("#name_"+e).html('<p class="red">Please select video</p>'),!1;$("#name_"+e).html(t.substring(0,45));var a=t.split(".").pop();a=a.toLowerCase();if("attach_video"==e){if("mp4"!=a&&"m4a"!=a&&"m4v"!=a&&"f4v"!=a&&"f4a"!=a&&"m4b"!=a&&"m4r"!=a&&"f4b"!=a&&"mov"!=a)return $("#"+e).val(null),alertify.alert("Please select a valid video format."),$("#name_"+e).html('<p class="red">Only (.mp4, .m4a, .m4v, .f4v, .f4a, .m4b, .m4r, .f4b, .mov) allowed!</p>'),!1;var i=Number(($("#"+e)[0].files[0].size/1024/1024).toFixed(2)),o=Number(uploadVideoSize);if(o<i)return $("#"+e).val(null),alertify.alert(errorUploadVideoSize),$("#name_"+e).html(""),!1;var n=t,p=n.substring(n.lastIndexOf("\\")+1,n.length);return $("#name_"+e).html(p),!0}}function o(e){var t=$("#"+e).val();if(!(t.length>0))return $("#name_"+e).html("No audio selected"),alertify.alert("No audio selected"),$("#name_"+e).html('<p class="red">Please select audio</p>'),!1;$("#name_"+e).html(t.substring(0,45));var a=t.split(".").pop();a=a.toLowerCase();if("attach_audio"==e){if("mp3"!=a&&"m4a"!=a&&"mp4"!=a&&"ogg"!=a&&"flac"!=a&&"wav"!=a)return $("#"+e).val(null),alertify.alert("Please select a valid Audio format."),$("#name_"+e).html('<p class="red">Only (.mp3, .m4a, .mp4, .ogg, .flac, .wav) allowed!</p>'),!1;var i=Number(($("#"+e)[0].files[0].size/1024/1024).toFixed(2)),o=Number(uploadVideoSize);if(o<i)return $("#"+e).val(null),alertify.alert(errorUploadVideoSize),$("#name_"+e).html(""),!1;var n=t,p=n.substring(n.lastIndexOf("\\")+1,n.length);return $("#name_"+e).html(p),!0}}function n(e){var t=$("#"+e).val();if(!(t.length>0))return $("#name_"+e).html("No document selected"),alertify.alert("No document selected"),$("#name_"+e).html('<p class="red">Please select document</p>'),!1;$("#name_"+e).html(t.substring(0,45));var a=t.split(".").pop();a=a.toLowerCase();if("attach_document"==e){if("pdf"!=a&&"doc"!=a&&"docx"!=a&&"jpg"!=a&&"jpe"!=a&&"jpeg"!=a&&"png"!=a&&"gif"!=a)return $("#"+e).val(null),alertify.alert("Please select a valid document format."),$("#name_"+e).html('<p class="red">Only (.pdf, .doc, .docx, .jpg, .jpe, .jpeg, .png, .gif) allowed!</p>'),!1;var i=t,o=i.substring(i.lastIndexOf("\\")+1,i.length);return $("#name_"+e).html(o),!0}}function p(e){var t=$(e).attr("item-category"),a=$(e).attr("item-title"),i=$(e).attr("item-url"),o=$(e).attr("item-type");if($("#view_media_document_modal").modal("show"),$("#view_item_title").html(a),$("#close_media_document_modal_up").attr("file-type",o),$("#close_media_document_modal_down").attr("file-type",o),"Document"==t)if($("#document-container").show(),"document"==o){var n=$("<iframe />").attr("id","document-iframe").attr("class","uploaded-file-preview").attr("src",i);$("#document-iframe-holder").html(n)}else{var p=$("<img />").attr("id","image-tag").attr("class","img-responsive").attr("src",i);$("#document-iframe-holder").html(p)}else if("youtube"==o){$("#youtube-container").show();var _=$("<iframe />").attr("id","youtube-iframe").attr("src","https://www.youtube.com/embed/"+i);$("#youtube-iframe-holder").append(_)}else if("vimeo"==o){$("#vimeo-container").show();_=$("<iframe />").attr("id","vimeo-iframe").attr("src","https://player.vimeo.com/video/"+i);$("#vimeo-iframe-holder").append(_)}else if("upload_video"==o){$("#video-container").show();_=$("<video />").attr("id","video-player").attr("src",i).attr("controls",!0);$("#video-player-holder").append(_)}else if("upload_audio"==o){$("#audio-container").show();var l=$("<audio />").attr("id","audio-player").attr("src",i).attr("controls",!0);$("#audio-player-holder").append(l)}}function _(e,t,a,i,o,n){if(console.log(i),"system"==t){$("#send_email_address").val(o),$("#send_email_user").attr("name","receivers[]");var p=[i];$("#send_email_user").val(p)}else $("#send_email_address").val(o),$("#send_email_user").attr("name","manual_email"),$("#send_email_user").val(o);"reply"==e?e='<i class="fa fa-reply"></i> Reply Email':"resend"==e&&(e='<i class="fa fa-retweet"></i> Resend Email'),$("#send_email_pop_up_title").html(e),$("#send_email_type").val(t),$("#send_email_subject").val(n),$("#send_email_modal").modal("show")}function l(){$("#pop_up_attachment_item_title").val(""),$("#pop_up_attach_social_video").val(""),$("#default_manual_pop_up").prop("checked",!0),$("#pop_up_attach_video").val(null),$("#name_pop_up_attach_video").html(""),$("#pop_up_attach_audio").val(null),$("#name_pop_up_attach_audio").html(""),$("#pop_up_attach_document").val(null),$("#name_pop_up_attach_document").html(""),$("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!1),$("#pop_up_attachment_yt_vm_video_input_container").show(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide()}function d(e){var t=$("#"+e).val();if(!(t.length>0))return $("#name_"+e).html("No video selected"),alertify.alert("No video selected"),$("#name_"+e).html('<p class="red">Please select video</p>'),!1;$("#name_"+e).html(t.substring(0,45));var a=t.split(".").pop();a=a.toLowerCase();if("pop_up_attach_video"==e){if("mp4"!=a&&"m4a"!=a&&"m4v"!=a&&"f4v"!=a&&"f4a"!=a&&"m4b"!=a&&"m4r"!=a&&"f4b"!=a&&"mov"!=a)return $("#"+e).val(null),alertify.alert("Please select a valid video format."),$("#name_"+e).html('<p class="red">Only (.mp4, .m4a, .m4v, .f4v, .f4a, .m4b, .m4r, .f4b, .mov) allowed!</p>'),!1;var i=Number(($("#"+e)[0].files[0].size/1024/1024).toFixed(2)),o=Number(uploadVideoSize);if(o<i)return $("#"+e).val(null),alertify.alert(errorUploadVideoSize),$("#name_"+e).html(""),!1;var n=t,p=n.substring(n.lastIndexOf("\\")+1,n.length);return $("#name_"+e).html(p),!0}}function r(e){var t=$("#"+e).val();if(!(t.length>0))return $("#name_"+e).html("No audio selected"),alertify.alert("No audio selected"),$("#name_"+e).html('<p class="red">Please select audio</p>'),!1;$("#name_"+e).html(t.substring(0,45));var a=t.split(".").pop();a=a.toLowerCase();if("pop_up_attach_audio"==e){if("mp3"!=a&&"m4a"!=a&&"mp4"!=a&&"ogg"!=a&&"flac"!=a&&"wav"!=a)return $("#"+e).val(null),alertify.alert("Please select a valid Audio format."),$("#name_"+e).html('<p class="red">Only (.mp3, .m4a, .mp4, .ogg, .flac, .wav) allowed!</p>'),!1;var i=Number(($("#"+e)[0].files[0].size/1024/1024).toFixed(2)),o=Number(uploadVideoSize);if(o<i)return $("#"+e).val(null),alertify.alert(errorUploadVideoSize),$("#name_"+e).html(""),!1;var n=t,p=n.substring(n.lastIndexOf("\\")+1,n.length);return $("#name_"+e).html(p),!0}}function c(e){var t=$("#"+e).val();if(!(t.length>0))return $("#name_"+e).html("No document selected"),alertify.alert("No document selected"),$("#name_"+e).html('<p class="red">Please select document</p>'),!1;$("#name_"+e).html(t.substring(0,45));var a=t.split(".").pop();a=a.toLowerCase();if("pop_up_attach_document"==e){if("pdf"!=a&&"doc"!=a&&"docx"!=a&&"jpg"!=a&&"jpe"!=a&&"jpeg"!=a&&"png"!=a&&"gif"!=a)return $("#"+e).val(null),alertify.alert("Please select a valid document format."),$("#name_"+e).html('<p class="red">Only (.pdf, .doc, .docx, .jpg, .jpe, .jpeg, .png, .gif) allowed!</p>'),!1;var i=t,o=i.substring(i.lastIndexOf("\\")+1,i.length);return $("#name_"+e).html(o),!0}}var m=[];$(document).ready(function(){new Array;$("#up_video_container input").prop("disabled",!0),$("#up_video_container").hide(),$("#up_audio_container input").prop("disabled",!0),$("#up_audio_container").hide(),$("#view_0").trigger("click"),$(".js-main-coll").on("shown.bs.collapse",function(e){e.stopPropagation(),$(this).parent().find(".js-main-gly").removeClass("glyphicon-plus").addClass("glyphicon-minus")}).on("hidden.bs.collapse",function(){$(this).parent().find(".js-main-gly").removeClass("glyphicon-minus").addClass("glyphicon-plus")}),$(".js-child-coll").on("shown.bs.collapse",function(e){e.stopPropagation(),$(this).parent().find(".js-child-gly").removeClass("glyphicon-plus").addClass("glyphicon-minus")}).on("hidden.bs.collapse",function(){$(this).parent().find(".js-child-gly").removeClass("glyphicon-minus").addClass("glyphicon-plus")}),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide()}),$(".email_type").on("click",function(){var e=$(this).val();"system"==e?($("#system_email").show(),$("#manual_email").hide()):"manual"==e&&($("#manual_email").show(),$("#system_email").hide())}),$("#send_normal_email").on("click",function(){var t,a=0,i="",o=$("#attachment_listing_data > .manual_upload_items"),n=0;if(o.length)n=$("#attachment_listing_data > .manual_upload_items").length;t="system"==$("#jsUserType").val()?$("#receiverId").val():$("#manual_address").val();var p=$("#subject").val(),_=CKEDITOR.instances.email_message.getData();if(null==t&&""==p&&""==_?(i="All fields are required.",a=1):null==t&&""==p?(i="Email address and Subject are required.",a=1):null==t&&""==_?(i="Email address and Message are required.",a=1):""==p&&""==_?(i="Subject and Message body are required.",a=1):null==t?(i="Email address is required.",a=1):""==_?(i="Message body is required.",a=1):""==p&&(i="Subject is required.",a=1),n>0&&0==a)$("#attachment_loader").show(),$("#attachment_listing_data > .manual_upload_items").each(function(t){var a=$(this).attr("item-status");if("pending"==a){var i=$(this).attr("row-id"),o=$(this).attr("item-title"),p=$(this).attr("item-source"),_=baseURL+"compliance_safety_reporting_public/save_email_manual_attachment",l=new FormData;if(l.append("attachment_title",o),"youtube"==p||"vimeo"==p){var d=$(this).attr("item-data");l.append("social_url",d)}else{var r=o.replace(/ /g,""),c=$("#"+r).prop("files")[0];if(l.append("file",c),"upload_document"==p){var u=$("#"+r).val(),s=u.split(".").pop();l.append("file_name",u.replace("C:\\fakepath\\","")),l.append("file_ext",s)}}l.append("file_type",p),l.append("report_sid",reportId),l.append("incident_sid",incidentId),$.ajax({url:_,cache:!1,contentType:!1,processData:!1,type:"post",data:l,success:function(t){var a=jQuery.parseJSON(t),o=a.item_sid,p=a.item_title,_=a.item_type,l=a.item_source;$("#"+i).html('<input type="hidden" name="attachment['+o+'][item_type]" value="'+_+'"><input type="hidden" name="attachment['+o+'][record_sid]" value="'+o+'"><td class="text-center">'+p+'</td><td class="text-center">'+_+'</td><td class="text-center">'+l+'</td><td><a href="javascript:;" item-sid="'+o+'" attachment-type="library" item-type="'+_+'" class="btn btn-block btn-info js-remove-attachment">Remove</a></td>'),$("#"+i).attr("item-status","done"),n-=1,m.push(o),0==n&&setTimeout(function(){e("normal")},1e3)},error:function(){}})}});else{if(1==a)return alertify.alert(i),!1;e("normal")}}),$(document).on("click",".jsMarkAsRead",function(e){e.preventDefault();var a=$(this).data("id");t(a)}),$(".show_media_library").on("click",function(){$("#library_item_title").html("Attachment Library"),$("#attachment_library_modal").modal("show")}),$(document).on("click",".jsViewLibraryItem",function(e){e.preventDefault(),a($(this))}),$(".back_to_library").on("click",function(){var e=$(this).attr("file-type");"youtube"==e?($("#library-youtube-iframe").remove(),$("#library-youtube-section").hide()):"vimeo"==e?($("#library-vimeo-iframe").remove(),$("#library-vimeo-section").hide()):"upload_video"==e?($("#library-upload-video").remove(),$("#library-video-section").hide()):"upload_audio"==e?($("#library-upload-audio").remove(),$("#library-audio-section").hide()):"document"==e?($("#library-document-iframe").remove(),$("#library-document-section").hide()):"image"==e&&($("#library-image").remove(),$("#library-document-section").hide()),$("#view_library_item").hide(),$("#library_item_title").html("Attachment Library"),$("#show_library_item").show()}),$(".select_lib_item").on("click",function(){var e=$(this).attr("item-sid");if(1==$(this).prop("checked")){var t=$(this).attr("item-category"),a=$(this).attr("item-type"),i=$(this).attr("item-title");$("#email_attachment_list").show(),$("#attachment_listing_data").prepend('<tr id="lib_item_'+e+'"><input type="hidden" name="attachment['+e+'][item_type]" value="'+t+'"><input type="hidden" name="attachment['+e+'][record_sid]" value="'+e+'"><td class="text-center">'+i+'</td><td class="text-center">'+t+'</td><td class="text-center">'+a+'</td><td><a href="javascript:;" item-sid="'+e+'" attachment-type="library" item-type="'+t+'" class="btn btn-block btn-info js-remove-attachment">Remove</a></td></tr>'),m.push(e.split("_")[1])}else{$("#lib_item_"+e).remove();var o=m.indexOf(e);o>-1&&m.splice(o,1)}}),$(document).on("click",".js-remove-attachment",function(){var e=$(this).attr("item-sid"),t=$(this).attr("attachment-type"),a=$(this).attr("item-type");"library"==t?($("#lib_item_"+e).remove(),"Document"==a?$("#doc_key_"+e).prop("checked",!1):$("#med_key_"+e).prop("checked",!1)):$("#man_item_"+e).remove()}),$(".show_manual_attachment").on("click",function(){$("#attachment_item_title").val(""),$("#attach_social_video").val(""),$("#default_manual_select").prop("checked",!0),$("#attach_video").val(null),$("#name_attach_video").html(""),$("#attach_audio").val(null),$("#name_attach_audio").html(""),$("#attach_document").val(null),$("#name_attach_document").html(""),$("#attachment_yt_vm_video_container input").prop("disabled",!1),$("#attachment_yt_vm_video_container").show(),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide(),$("#manual_attachment_modal").modal("show")}),$(".attach_item_source").on("click",function(){var e=$(this).val();"youtube"==e?($("#attachment_yt_vm_video_container input").prop("disabled",!1),$("#attachment_yt_vm_video_container").show(),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide()):"vimeo"==e?($("#attachment_yt_vm_video_container input").prop("disabled",!1),$("#attachment_yt_vm_video_container").show(),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide()):"upload_video"==e?($("#attachment_yt_vm_video_container input").prop("disabled",!0),$("#attachment_yt_vm_video_container").hide(),$("#attachment_video_container input").prop("disabled",!1),$("#attachment_video_container").show(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide()):"upload_audio"==e?($("#attachment_yt_vm_video_container input").prop("disabled",!0),$("#attachment_yt_vm_video_container").hide(),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!1),$("#attachment_audio_container").show(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide()):"upload_document"==e&&($("#attachment_yt_vm_video_container input").prop("disabled",!0),$("#attachment_yt_vm_video_container").hide(),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!1),$("#attachment_document_container").show())}),$(document).on("onchange",".jsCheckAttachVideo",function(e){e.preventDefault(),i("attach_video")}),$(document).on("onchange",".jsCheckAttachAudio",function(e){e.preventDefault(),o("attach_audio")}),$(document).on("onchange",".jsCheckAttachDocument",function(e){e.preventDefault(),n("attach_document")});var u=1;$("#save_attach_item").on("click",function(){var e,t,a,i,o=0,n=$('input[name="attach_item_source"]:checked').val();if("youtube"==n)if(""!=$("#attach_social_video").val()){var p=/(?:https?:\/\/)?(?:youtu\.be\/|(?:www\.)?youtube\.com\/watch(?:\.php)?\?.*v=)([a-zA-Z0-9\-_]+)/;$("#attach_social_video").val().match(p)||(e="Not a Valid Youtube URL",o=1)}else e="Please provide a Valid Youtube URL",o=1;if("vimeo"==n)if(""!=$("#attach_social_video").val()){var _=baseURL+"compliance_safety_reporting_public/validate_vimeo";$.ajax({type:"POST",url:_,data:{url:$("#attach_social_video").val()},async:!1,success:function(t){0==t&&(e="Not a Valid Vimeo URLs",o=1)},error:function(e){}})}else e="Please provide a Valid Vimeo URL",o=1;if("upload_video"==n){var l=$("#attach_video").val();if(l.length>0){$("#name_attach_video").html(l.substring(0,45));var d=l.split(".").pop();d=d.toLowerCase();if("mp4"!=d&&"m4a"!=d&&"m4v"!=d&&"f4v"!=d&&"f4a"!=d&&"m4b"!=d&&"m4r"!=d&&"f4b"!=d&&"mov"!=d)$("#attach_video").val(null),$("#name_attach_video").html('<p class="red">Only (.mp4, .m4a, .m4v, .f4v, .f4a, .m4b, .m4r, .f4b, .mov) allowed!</p>'),e="Please select a valid video format.",o=1;else{var r=Number(($("#attach_video")[0].files[0].size/1024/1024).toFixed(2)),c=Number(uploadVideoSize);c<r&&($("#attach_video").val(null),$("#name_attach_video").html(""),e=errorUploadVideoSize,o=1)}}else $("#name_attach_video").html('<p class="red">Please select video</p>'),e="Please select video to upload",o=1}if("upload_audio"==n){l=$("#attach_audio").val();if(l.length>0){$("#name_attach_audio").html(l.substring(0,45));d=l.split(".").pop(),d=d.toLowerCase();if("mp3"!=d&&"m4a"!=d&&"mp4"!=d&&"ogg"!=d&&"flac"!=d&&"wav"!=d)$("#attach_audio").val(null),$("#name_attach_audio").html('<p class="red">Only (.mp3, .m4a, .mp4, .ogg, .flac, .wav) allowed!</p>'),e="Please select a valid audio format.",o=1;else{r=Number(($("#attach_audio")[0].files[0].size/1024/1024).toFixed(2));var m=Number(uploadVideoSize);m<r&&($("#attach_audio").val(null),$("#name_attach_audio").html(""),e=errorUploadVideoSize,o=1)}}else $("#name_attach_audio").html('<p class="red">Please select audio</p>'),e="Please select audio to upload",o=1}if("upload_document"==n){l=$("#attach_document").val();if(l.length>0){$("#name_attach_document").html(l.substring(0,45));d=l.split(".").pop(),d=d.toLowerCase();i=d.toUpperCase(),"pdf"!=d&&"doc"!=d&&"docx"!=d&&"jpg"!=d&&"jpe"!=d&&"jpeg"!=d&&"png"!=d&&"gif"!=d&&($("#attach_document").val(null),$("#name_attach_document").html('<p class="red">Only (.pdf, .doc, .docx, .jpg, .jpe, .jpeg, .png, .gif) allowed!</p>'),e="Please select a valid document format.",o=1)}else $("#name_attach_document").html('<p class="red">Please select document</p>'),e="Please select document to upload",o=1}var s=$("#attachment_item_title").val();if(""!=s&&0!=s.length||(e="Please provide a Video Title.",o=1),1==o)return alertify.alert(e),!1;new FormData;var h="";if("youtube"==n){t="Media",a="Youtube";var v=$("#attach_social_video").val();h=v}else if("vimeo"==n){t="Media",a="Vimeo";var f=$("#attach_social_video").val();h=f}else if("upload_video"==n){t="Media",a="Upload Video";var b=$("#attach_video").prop("files")[0];h=b;var y=s.replace(/ /g,"");$("#attach_video").clone().prop("id",y).insertAfter("div#email_attachment_files:last"),$("#"+y).hide()}else if("upload_audio"==n){t="Media",a="Upload Audio";var g=$("#attach_audio").prop("files")[0];h=g;y=s.replace(/ /g,"");$("#attach_audio").clone().prop("id",y).insertAfter("div#email_attachment_files:last"),$("#"+y).hide()}else if("upload_document"==n){t="Document",a=i;var w=$("#attach_document").prop("files")[0];h=w;y=s.replace(/ /g,"");$("#attach_document").clone().prop("id",y).insertAfter("div#email_attachment_files:last"),$("#"+y).hide()}$("#manual_attachment_modal").modal("hide"),$("#email_attachment_list").show(),$("#attachment_listing_data").prepend('<tr id="man_item_'+u+'" class="manual_upload_items" item-status="pending" row-id="man_item_'+u+'" item-title="'+s+'" item-source="'+n+'" item-data="'+h+'"><td class="text-center">'+s+'</td><td class="text-center">'+t+'</td><td class="text-center">'+a+'</td><td><a href="javascript:;" item-sid="'+u+'" attachment-type="manual" item-type="'+a+'" class="btn btn-block btn-info js-remove-attachment">Remove</a></td></tr>'),++u}),$(document).on("click",".jsViewAttachItem",function(e){e.preventDefault(),p($(this))}),$(".close-current-item").on("click",function(){var e=$(this).attr("file-type");"youtube"==e?($("#youtube-iframe").remove(),$("#youtube-container").hide()):"vimeo"==e?($("#vimeo-iframe").remove(),$("#vimeo-container").hide()):"upload_video"==e?($("#video-player").remove(),$("#video-container").hide()):"upload_audio"==e?($("#audio-player").remove(),$("#audio-container").hide()):"document"==e?($("#document-iframe").remove(),$("#document-container").hide()):"image"==e&&($("#image-tag").remove(),$("#document-container").hide())}),$(document).on("click",".jsSendEmail",function(e){e.preventDefault();var t=$(this).data("title"),a=$(this).data("type"),i=$(this).data("sender_id"),o=$(this).data("receiver_id"),n=$(this).data("email"),p=$(this).data("subject");_(t,a,i,o,n,p)}),$(".attachment_pop_up").on("click",function(){var e=$(this).attr("attachment-type");"library"==e?($("#pop_up_email_compose_container").hide(),$("#pop_up_attachment_library_container").show()):($("#pop_up_email_compose_container").hide(),l(),$("#pop_up_manual_attachment_container").show())}),$(".email_pop_up_back_to_library").on("click",function(){var e=$(".email_pop_up_back_to_library").attr("item-type");"youtube"==e?($("#email-pop-up-youtube-iframe").remove(),$("#email-pop-up-youtube-container").hide()):"vimeo"==e?($("#email-pop-up-vimeo-iframe").remove(),$("#email-pop-up-vimeo-container").hide()):"upload_video"==e?($("#email-pop-up-video-player").remove(),$("#email-pop-up-video-container").hide()):"upload_audio"==e?($("#email-pop-up-audio-player").remove(),$("#email-pop-up-audio-container").hide()):"document"==e?($("#email-pop-up-document-iframe").remove(),$("#email-pop-up-document-container").hide()):"image"==e&&($("#email-pop-up-image-tag").remove(),$("#email-pop-up-document-container").hide()),$("#view_pop_up_library_item").hide(),$("#show_pop_up_library_item").show()}),$(".email_pop_up_back_to_compose_email").on("click",function(){var e=$(this).attr("btn-from");"library"==e?($("#pop_up_attachment_library_container").hide(),$("#pop_up_email_compose_container").show()):"manual"==e?($("#pop_up_manual_attachment_container").hide(),$("#pop_up_email_compose_container").show()):($("#pop_up_attachment_library_container").hide(),$("#pop_up_manual_attachment_container").hide(),$("#pop_up_email_compose_container").show())}),$(".email_pop_up_select_lib_item").on("click",function(){var e=$(this).attr("item-sid");if(1==$(this).prop("checked")){var t=$(this).attr("item-category"),a=$(this).attr("item-type"),i=$(this).attr("item-title");$("#pop_up_email_attachment_list").show(),$("#pop_up_attachment_listing_data").prepend('<tr id="pop_up_lib_item_'+e+'"><input type="hidden" name="attachment['+e+'][item_type]" value="'+t+'"><input type="hidden" name="attachment['+e+'][record_sid]" value="'+e+'"><td class="text-center">'+i+'</td><td class="text-center">'+t+'</td><td class="text-center">'+a+'</td><td><a href="javascript:;" item-sid="'+e+'" attachment-type="library" item-type="'+t+'" class="btn btn-block btn-info js-pop-up-remove-attachment">Remove</a></td></tr>'),m.push(e.split("_")[1])}else{$("#pop_up_lib_item_"+e).remove();var o=m.indexOf(e);o>-1&&m.splice(o,1)}}),$(document).on("click",".js-pop-up-remove-attachment",function(){var e=$(this).attr("item-sid"),t=$(this).attr("attachment-type"),a=$(this).attr("item-type");"library"==t?($("#pop_up_lib_item_"+e).remove(),"Document"==a?$("#pop_up_doc_key_"+e).prop("checked",!1):$("#pop_up_med_key_"+e).prop("checked",!1)):$("#pop_up_man_item_"+e).remove()}),$(".pop_up_attach_item_source").on("click",function(){var e=$(this).val();"youtube"==e?($("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!1),$("#pop_up_attachment_yt_vm_video_input_container").show(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide()):"vimeo"==e?($("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!1),$("#pop_up_attachment_yt_vm_video_input_container").show(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide()):"upload_video"==e?($("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_yt_vm_video_input_container").hide(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!1),$("#pop_up_attachment_upload_video_input_container").show(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide()):"upload_audio"==e?($("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_yt_vm_video_input_container").hide(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!1),$("#pop_up_attachment_upload_audio_input_container").show(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide()):"upload_document"==e&&($("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_yt_vm_video_input_container").hide(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!1),$("#pop_up_attachment_upload_document_input_container").show())}),$(document).on("onchange",".jsPopUpCheckAttachVideo",function(e){e.preventDefault(),d("pop_up_attach_video")}),$(document).on("onchange",".jsPopUpCheckAttachAudio",function(e){e.preventDefault(),r("pop_up_attach_audio")}),$(document).on("onchange",".jsPopUpCheckAttachDocument",function(e){e.preventDefault(),c("pop_up_attach_document")});var s=1;$("#pop_up_save_attach_item").on("click",function(){var e,t,a,i,o=0,n=$('input[name="pop_up_attach_item_source"]:checked').val();if("youtube"==n)if(""!=$("#pop_up_attach_social_video").val()){var p=/(?:https?:\/\/)?(?:youtu\.be\/|(?:www\.)?youtube\.com\/watch(?:\.php)?\?.*v=)([a-zA-Z0-9\-_]+)/;$("#pop_up_attach_social_video").val().match(p)||(e="Not a Valid Youtube URL",o=1)}else e="Please provide a Valid Youtube URL",o=1;if("vimeo"==n)if(""!=$("#pop_up_attach_social_video").val()){var _=baseURL+"compliance_safety_reporting_public/validate_vimeo";$.ajax({type:"POST",url:_,data:{url:$("#pop_up_attach_social_video").val()},async:!1,success:function(t){0==t&&(e="Not a Valid Vimeo URLs",o=1)},error:function(e){}})
}else e="Please provide a Valid Vimeo URL",o=1;if("upload_video"==n){var l=$("#pop_up_attach_video").val();if(l.length>0){$("#name_pop_up_attach_video").html(l.substring(0,45));var d=l.split(".").pop();d=d.toLowerCase();if("mp4"!=d&&"m4a"!=d&&"m4v"!=d&&"f4v"!=d&&"f4a"!=d&&"m4b"!=d&&"m4r"!=d&&"f4b"!=d&&"mov"!=d)$("#pop_up_attach_video").val(null),$("#name_pop_up_attach_video").html('<p class="red">Only (.mp4, .m4a, .m4v, .f4v, .f4a, .m4b, .m4r, .f4b, .mov) allowed!</p>'),e="Please select a valid video format.",o=1;else{var r=Number(($("#pop_up_attach_video")[0].files[0].size/1024/1024).toFixed(2)),c=Number(uploadVideoSize);c<r&&($("#pop_up_attach_video").val(null),$("#name_pop_up_attach_video").html(""),e=errorUploadVideoSize,o=1)}}else $("#name_pop_up_attach_video").html('<p class="red">Please select video</p>'),e="Please select video to upload",o=1}if("upload_audio"==n){l=$("#pop_up_attach_audio").val();if(l.length>0){$("#name_pop_up_attach_audio").html(l.substring(0,45));d=l.split(".").pop(),d=d.toLowerCase();if("mp3"!=d&&"m4a"!=d&&"mp4"!=d&&"ogg"!=d&&"flac"!=d&&"wav"!=d)$("#pop_up_attach_audio").val(null),$("#name_pop_up_attach_audio").html('<p class="red">Only (.mp3, .m4a, .mp4, .ogg, .flac, .wav) allowed!</p>'),e="Please select a valid audio format.",o=1;else{r=Number(($("#pop_up_attach_audio")[0].files[0].size/1024/1024).toFixed(2));var m=Number(uploadVideoSize);m<r&&($("#pop_up_attach_audio").val(null),$("#name_pop_up_attach_audio").html(""),e=errorUploadVideoSize,o=1)}}else $("#name_pop_up_attach_audio").html('<p class="red">Please select audio</p>'),e="Please select audio to upload",o=1}if("upload_document"==n){l=$("#pop_up_attach_document").val();if(l.length>0){$("#name_pop_up_attach_document").html(l.substring(0,45));d=l.split(".").pop(),d=d.toLowerCase();i=d.toUpperCase(),"pdf"!=d&&"doc"!=d&&"docx"!=d&&"jpg"!=d&&"jpe"!=d&&"jpeg"!=d&&"png"!=d&&"gif"!=d&&($("#pop_up_attach_document").val(null),$("#name_pop_up_attach_document").html('<p class="red">Only (.pdf, .doc, .docx, .jpg, .jpe, .jpeg, .png, .gif) allowed!</p>'),e="Please select a valid document format.",o=1)}else $("#name_pop_up_attach_document").html('<p class="red">Please select document</p>'),e="Please select document to upload",o=1}var u=$("#pop_up_attachment_item_title").val();if(""!=u&&0!=u.length||(e="Please provide a Video Title.",o=1),1==o)return alertify.alert(e),!1;new FormData;var h="";if("youtube"==n){t="Media",a="Youtube";var v=$("#pop_up_attach_social_video").val();h=v}else if("vimeo"==n){t="Media",a="Vimeo";var f=$("#pop_up_attach_social_video").val();h=f}else if("upload_video"==n){t="Media",a="Upload Video";var b=$("#pop_up_attach_video").prop("files")[0];h=b;var y=u.replace(/ /g,"");$("#pop_up_attach_video").clone().prop("id",y).insertAfter("div#pop_up_email_attachment_files:last"),$("#"+y).hide()}else if("upload_audio"==n){t="Media",a="Upload Audio";var g=$("#attach_audio").prop("files")[0];h=g;y=u.replace(/ /g,"");$("#pop_up_attach_audio").clone().prop("id",y).insertAfter("div#pop_up_email_attachment_files:last"),$("#"+y).hide()}else if("upload_document"==n){t="Document",a=i;var w=$("#attach_document").prop("files")[0];h=w;y=u.replace(/ /g,"");$("#pop_up_attach_document").clone().prop("id",y).insertAfter("div#pop_up_email_attachment_files:last"),$("#"+y).hide()}$("#pop_up_manual_attachment_container").hide(),$("#pop_up_email_compose_container").show(),$("#pop_up_email_attachment_list").show(),$("#pop_up_attachment_listing_data").prepend('<tr id="pop_up_man_item_'+s+'" class="pop_up_manual_upload_items" item-status="pending" row-id="man_item_'+s+'" item-title="'+u+'" item-source="'+n+'" item-data="'+h+'"><td class="text-center">'+u+'</td><td class="text-center">'+t+'</td><td class="text-center">'+a+'</td><td><a href="javascript:;" item-sid="'+s+'" attachment-type="manual" item-type="'+a+'" class="btn btn-block btn-info js-pop-up-remove-attachment">Remove</a></td></tr>'),++s}),$("#send_pop_up_email").on("click",function(){var t=0,a="",i=$("#pop_up_attachment_listing_data > .pop_up_manual_upload_items"),o=0;if(i.length)o=$("#pop_up_attachment_listing_data > .pop_up_manual_upload_items").length;var n=$("#send_email_subject").val(),p=CKEDITOR.instances.send_email_message.getData();if(""==n&&""==p?(a="All fields are required.",t=1):""==p?(a="Message body is required.",t=1):""==n&&(a="Subject is required.",t=1),o>0&&0==t)$("#send_email_modal").modal("hide"),$("#attachment_loader").show(),$("#pop_up_attachment_listing_data > .pop_up_manual_upload_items").each(function(t){var a=$(this).attr("item-status");if("pending"==a){var i=$(this).attr("row-id"),n=$(this).attr("item-title"),p=$(this).attr("item-source"),_=baseURL+"compliance_safety_reporting_public/save_email_manual_attachment",l=new FormData;if(l.append("attachment_title",n),"youtube"==p||"vimeo"==p){var d=$(this).attr("item-data");l.append("social_url",d)}else{var r=n.replace(/ /g,""),c=$("#"+r).prop("files")[0];if(l.append("file",c),"upload_document"==p){var u=$("#"+r).val(),s=u.split(".").pop();l.append("file_name",u.replace("C:\\fakepath\\","")),l.append("file_ext",s)}}l.append("file_type",p),l.append("user_type","manager"),l.append("report_sid",reportId),l.append("incident_sid",incidentId),$.ajax({url:_,cache:!1,contentType:!1,processData:!1,type:"post",data:l,success:function(t){var a=jQuery.parseJSON(t),n=a.item_sid,p=a.item_title,_=a.item_type,l=a.item_source;$("#pop_up_"+i).html('<input type="hidden" name="attachment['+n+'][item_type]" value="'+_+'"><input type="hidden" name="attachment['+n+'][record_sid]" value="'+n+'"><td class="text-center">'+p+'</td><td class="text-center">'+_+'</td><td class="text-center">'+l+'</td><td><a href="javascript:;" item-sid="'+n+'" attachment-type="library" item-type="'+_+'" class="btn btn-block btn-info js-remove-attachment">Remove</a></td>'),$("#pop_up_"+i).attr("item-status","done"),o-=1,m.push(n),0==o&&setTimeout(function(){e("popup")},1e3)},error:function(){}})}});else{if(1==t)return alertify.alert(a),!1;e("popup")}})});