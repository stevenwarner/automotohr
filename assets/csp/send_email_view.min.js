$((function(){var e=[];function t(t){var a;$("#attachment_loader").show();var i="",o="";"normal"==t?(i=$("#subject").val(),o=CKEDITOR.instances.email_message.getData()):"popup"==t&&(i=$("#send_email_subject").val(),o=CKEDITOR.instances.send_email_message.getData());var p=new FormData;if(p.append("report_id",reportId),p.append("incident_id",incidentId),p.append("subject",i),p.append("message",o),"normal"==t)"system"==$("#jsUserType").val()?(a=$("#receiverId").val(),p.append("receivers",a),p.append("send_type","system")):(manual_email=$("#manual_address").val(),p.append("manual_email",manual_email),p.append("send_type","manual"));else if("popup"==t){"system"==$("#send_email_type").val()?(a=$("#send_email_user").val(),p.append("receivers",a),p.append("send_type","system")):(a=$("#send_email_user").val(),p.append("manual_email",manual_email),p.append("send_type","manual"))}e.length&&p.append("attach_files",e),$.ajax({url:baseURL+"compliance_safety_reporting_public/send_compliance_report_email",cache:!1,contentType:!1,processData:!1,type:"post",data:p,success:function(e){$("#attachment_loader").hide(),alertify.alert("SUCCESS!","You have succesfully send an email.",(()=>{window.location.reload()}))},error:function(){}})}$(document).ready((function(){new Array;$("#up_video_container input").prop("disabled",!0),$("#up_video_container").hide(),$("#up_audio_container input").prop("disabled",!0),$("#up_audio_container").hide(),$("#view_0").trigger("click"),$(".js-main-coll").on("shown.bs.collapse",(function(e){e.stopPropagation(),$(this).parent().find(".js-main-gly").removeClass("glyphicon-plus").addClass("glyphicon-minus")})).on("hidden.bs.collapse",(function(){$(this).parent().find(".js-main-gly").removeClass("glyphicon-minus").addClass("glyphicon-plus")})),$(".js-child-coll").on("shown.bs.collapse",(function(e){e.stopPropagation(),$(this).parent().find(".js-child-gly").removeClass("glyphicon-plus").addClass("glyphicon-minus")})).on("hidden.bs.collapse",(function(){$(this).parent().find(".js-child-gly").removeClass("glyphicon-minus").addClass("glyphicon-plus")})),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide()})),$(".email_type").on("click",(function(){var e=$(this).val();"system"==e?($("#system_email").show(),$("#manual_email").hide()):"manual"==e&&($("#manual_email").show(),$("#system_email").hide())})),$("#send_normal_email").on("click",(function(){var a,i=0,o="",p=$("#attachment_listing_data > .manual_upload_items"),n=0;if(p.length)n=$("#attachment_listing_data > .manual_upload_items").length;a="system"==$("#jsUserType").val()?$("#receiverId").val():$("#manual_address").val();var _=$("#subject").val(),d=CKEDITOR.instances.email_message.getData();if(null==a&&""==_&&""==d?(o="All fields are required.",i=1):null==a&&""==_?(o="Email address and Subject are required.",i=1):null==a&&""==d?(o="Email address and Message are required.",i=1):""==_&&""==d?(o="Subject and Message body are required.",i=1):null==a?(o="Email address is required.",i=1):""==d?(o="Message body is required.",i=1):""==_&&(o="Subject is required.",i=1),n>0&&0==i)$("#attachment_loader").show(),$("#attachment_listing_data > .manual_upload_items").each((function(a){if("pending"==$(this).attr("item-status")){var i=$(this).attr("row-id"),o=$(this).attr("item-title"),p=$(this).attr("item-source"),_=baseURL+"compliance_safety_reporting_public/save_email_manual_attachment",d=new FormData;if(d.append("attachment_title",o),"youtube"==p||"vimeo"==p){var l=$(this).attr("item-data");d.append("social_url",l)}else{var c=o.replace(/ /g,""),u=$("#"+c).prop("files")[0];if(d.append("file",u),"upload_document"==p){var m=$("#"+c).val(),r=m.split(".").pop();d.append("file_name",m.replace("C:\\fakepath\\","")),d.append("file_ext",r)}}d.append("file_type",p),d.append("report_sid",reportId),d.append("incident_sid",incidentId),$.ajax({url:_,cache:!1,contentType:!1,processData:!1,type:"post",data:d,success:function(a){var o=jQuery.parseJSON(a),p=o.item_sid,_=o.item_title,d=o.item_type,l=o.item_source;$("#"+i).html('<input type="hidden" name="attachment['+p+'][item_type]" value="'+d+'"><input type="hidden" name="attachment['+p+'][record_sid]" value="'+p+'"><td class="text-center">'+_+'</td><td class="text-center">'+d+'</td><td class="text-center">'+l+'</td><td><a href="javascript:;" item-sid="'+p+'" attachment-type="library" item-type="'+d+'" class="btn btn-block btn-info js-remove-attachment">Remove</a></td>'),$("#"+i).attr("item-status","done"),n-=1,e.push(p),0==n&&setTimeout((function(){t("normal")}),1e3)},error:function(){}})}}));else{if(1==i)return alertify.alert(o),!1;t("normal")}})),$(document).on("click",".jsMarkAsRead",(function(e){e.preventDefault();var t,a,i,o=$(this).data("id");t=o,a=baseURL+"compliance_safety_reporting_public/update_email_read_flag",$("#update_document_sid").val(),(i=new FormData).append("email_sid",t),i.append("receiver_sid",employeeId),$.ajax({url:a,cache:!1,contentType:!1,processData:!1,type:"post",data:i,success:function(e){var a=jQuery.parseJSON(e),i=a.status_one,o=a.status_two,p=a.sender_sid;0==i&&$("#current_user_notification").hide(),0==o&&$("#email_notification_"+p).hide(),$("#email_read_"+t).hide()},error:function(){}})})),$(".show_media_library").on("click",(function(){$("#library_item_title").html("Attachment Library"),$("#attachment_library_modal").modal("show")})),$(".back_to_library").on("click",(function(){var e=$(this).attr("file-type");"youtube"==e?($("#library-youtube-iframe").remove(),$("#library-youtube-section").hide()):"vimeo"==e?($("#library-vimeo-iframe").remove(),$("#library-vimeo-section").hide()):"upload_video"==e?($("#library-upload-video").remove(),$("#library-video-section").hide()):"upload_audio"==e?($("#library-upload-audio").remove(),$("#library-audio-section").hide()):"document"==e?($("#library-document-iframe").remove(),$("#library-document-section").hide()):"image"==e&&($("#library-image").remove(),$("#library-document-section").hide()),$("#view_library_item").hide(),$("#library_item_title").html("Attachment Library"),$("#show_library_item").show()})),$(".select_lib_item").on("click",(function(){var t=$(this).attr("item-sid");if(1==$(this).prop("checked")){var a=$(this).attr("item-category"),i=$(this).attr("item-type"),o=$(this).attr("item-title");$("#email_attachment_list").show(),$("#attachment_listing_data").prepend('<tr id="lib_item_'+t+'"><input type="hidden" name="attachment['+t+'][item_type]" value="'+a+'"><input type="hidden" name="attachment['+t+'][record_sid]" value="'+t+'"><td class="text-center">'+o+'</td><td class="text-center">'+a+'</td><td class="text-center">'+i+'</td><td><a href="javascript:;" item-sid="'+t+'" attachment-type="library" item-type="'+a+'" class="btn btn-block btn-info js-remove-attachment">Remove</a></td></tr>'),e.push(t.split("_")[1])}else{$("#lib_item_"+t).remove();var p=e.indexOf(t);p>-1&&e.splice(p,1)}})),$(document).on("click",".js-remove-attachment",(function(){var e=$(this).attr("item-sid"),t=$(this).attr("attachment-type"),a=$(this).attr("item-type");"library"==t?($("#lib_item_"+e).remove(),"Document"==a?$("#doc_key_"+e).prop("checked",!1):$("#med_key_"+e).prop("checked",!1)):$("#man_item_"+e).remove()})),$(".show_manual_attachment").on("click",(function(){$("#attachment_item_title").val(""),$("#attach_social_video").val(""),$("#default_manual_select").prop("checked",!0),$("#attach_video").val(null),$("#name_attach_video").html(""),$("#attach_audio").val(null),$("#name_attach_audio").html(""),$("#attach_document").val(null),$("#name_attach_document").html(""),$("#attachment_yt_vm_video_container input").prop("disabled",!1),$("#attachment_yt_vm_video_container").show(),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide(),$("#manual_attachment_modal").modal("show")})),$(".attach_item_source").on("click",(function(){var e=$(this).val();"youtube"==e||"vimeo"==e?($("#attachment_yt_vm_video_container input").prop("disabled",!1),$("#attachment_yt_vm_video_container").show(),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide()):"upload_video"==e?($("#attachment_yt_vm_video_container input").prop("disabled",!0),$("#attachment_yt_vm_video_container").hide(),$("#attachment_video_container input").prop("disabled",!1),$("#attachment_video_container").show(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide()):"upload_audio"==e?($("#attachment_yt_vm_video_container input").prop("disabled",!0),$("#attachment_yt_vm_video_container").hide(),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!1),$("#attachment_audio_container").show(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide()):"upload_document"==e&&($("#attachment_yt_vm_video_container input").prop("disabled",!0),$("#attachment_yt_vm_video_container").hide(),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!1),$("#attachment_document_container").show())}));var a=1;$("#save_attach_item").on("click",(function(){var e,t,i,o,p,n,_=0,d=$('input[name="attach_item_source"]:checked').val();if("youtube"==d)if(""!=$("#attach_social_video").val()){$("#attach_social_video").val().match(/(?:https?:\/\/)?(?:youtu\.be\/|(?:www\.)?youtube\.com\/watch(?:\.php)?\?.*v=)([a-zA-Z0-9\-_]+)/)||(e="Not a Valid Youtube URL",_=1)}else e="Please provide a Valid Youtube URL",_=1;if("vimeo"==d)if(""!=$("#attach_social_video").val()){var l=baseURL+"compliance_safety_reporting_public/validate_vimeo";$.ajax({type:"POST",url:l,data:{url:$("#attach_social_video").val()},async:!1,success:function(t){0==t&&(e="Not a Valid Vimeo URLs",_=1)},error:function(e){}})}else e="Please provide a Valid Vimeo URL",_=1;if("upload_video"==d)if((p=$("#attach_video").val()).length>0)if($("#name_attach_video").html(p.substring(0,45)),"mp4"!=(n=(n=p.split(".").pop()).toLowerCase())&&"m4a"!=n&&"m4v"!=n&&"f4v"!=n&&"f4a"!=n&&"m4b"!=n&&"m4r"!=n&&"f4b"!=n&&"mov"!=n)$("#attach_video").val(null),$("#name_attach_video").html('<p class="red">Only (.mp4, .m4a, .m4v, .f4v, .f4a, .m4b, .m4r, .f4b, .mov) allowed!</p>'),e="Please select a valid video format.",_=1;else{var c=Number(($("#attach_video")[0].files[0].size/1024/1024).toFixed(2));Number(uploadVideoSize)<c&&($("#attach_video").val(null),$("#name_attach_video").html(""),e=errorUploadVideoSize,_=1)}else $("#name_attach_video").html('<p class="red">Please select video</p>'),e="Please select video to upload",_=1;if("upload_audio"==d)if((p=$("#attach_audio").val()).length>0)if($("#name_attach_audio").html(p.substring(0,45)),"mp3"!=(n=(n=p.split(".").pop()).toLowerCase())&&"m4a"!=n&&"mp4"!=n&&"ogg"!=n&&"flac"!=n&&"wav"!=n)$("#attach_audio").val(null),$("#name_attach_audio").html('<p class="red">Only (.mp3, .m4a, .mp4, .ogg, .flac, .wav) allowed!</p>'),e="Please select a valid audio format.",_=1;else{c=Number(($("#attach_audio")[0].files[0].size/1024/1024).toFixed(2));Number(uploadVideoSize)<c&&($("#attach_audio").val(null),$("#name_attach_audio").html(""),e=errorUploadVideoSize,_=1)}else $("#name_attach_audio").html('<p class="red">Please select audio</p>'),e="Please select audio to upload",_=1;"upload_document"==d&&((p=$("#attach_document").val()).length>0?($("#name_attach_document").html(p.substring(0,45)),o=(n=(n=p.split(".").pop()).toLowerCase()).toUpperCase(),"pdf"!=n&&"doc"!=n&&"docx"!=n&&"jpg"!=n&&"jpe"!=n&&"jpeg"!=n&&"png"!=n&&"gif"!=n&&($("#attach_document").val(null),$("#name_attach_document").html('<p class="red">Only (.pdf, .doc, .docx, .jpg, .jpe, .jpeg, .png, .gif) allowed!</p>'),e="Please select a valid document format.",_=1)):($("#name_attach_document").html('<p class="red">Please select document</p>'),e="Please select document to upload",_=1));var u=$("#attachment_item_title").val();if(""!=u&&0!=u.length||(e="Please provide a Video Title.",_=1),1==_)return alertify.alert(e),!1;new FormData;var m="";if("youtube"==d)t="Media",i="Youtube",m=$("#attach_social_video").val();else if("vimeo"==d){t="Media",i="Vimeo",m=$("#attach_social_video").val()}else if("upload_video"==d){t="Media",i="Upload Video",m=$("#attach_video").prop("files")[0];var r=u.replace(/ /g,"");$("#attach_video").clone().prop("id",r).insertAfter("div#email_attachment_files:last"),$("#"+r).hide()}else if("upload_audio"==d){t="Media",i="Upload Audio",m=$("#attach_audio").prop("files")[0];r=u.replace(/ /g,"");$("#attach_audio").clone().prop("id",r).insertAfter("div#email_attachment_files:last"),$("#"+r).hide()}else if("upload_document"==d){t="Document",i=o,m=$("#attach_document").prop("files")[0];r=u.replace(/ /g,"");$("#attach_document").clone().prop("id",r).insertAfter("div#email_attachment_files:last"),$("#"+r).hide()}$("#manual_attachment_modal").modal("hide"),$("#email_attachment_list").show(),$("#attachment_listing_data").prepend('<tr id="man_item_'+a+'" class="manual_upload_items" item-status="pending" row-id="man_item_'+a+'" item-title="'+u+'" item-source="'+d+'" item-data="'+m+'"><td class="text-center">'+u+'</td><td class="text-center">'+t+'</td><td class="text-center">'+i+'</td><td><a href="javascript:;" item-sid="'+a+'" attachment-type="manual" item-type="'+i+'" class="btn btn-block btn-info js-remove-attachment">Remove</a></td></tr>'),++a})),$(".close-current-item").on("click",(function(){var e=$(this).attr("file-type");"youtube"==e?($("#youtube-iframe").remove(),$("#youtube-container").hide()):"vimeo"==e?($("#vimeo-iframe").remove(),$("#vimeo-container").hide()):"upload_video"==e?($("#video-player").remove(),$("#video-container").hide()):"upload_audio"==e?($("#audio-player").remove(),$("#audio-container").hide()):"document"==e?($("#document-iframe").remove(),$("#document-container").hide()):"image"==e&&($("#image-tag").remove(),$("#document-container").hide())})),$(document).on("click",".jsSendEmail",(function(e){e.preventDefault();var t=$(this).data("title"),a=$(this).data("type");$(this).data("sender_id");!function(e,t,a,i,o,p){if("system"==t){$("#send_email_address").val(o),$("#send_email_user").attr("name","receivers[]");var n=[i];$("#send_email_user").val(n)}else $("#send_email_address").val(o),$("#send_email_user").attr("name","manual_email"),$("#send_email_user").val(o);"reply"==e?e='<i class="fa fa-reply"></i> Reply Email':"resend"==e&&(e='<i class="fa fa-retweet"></i> Resend Email');$("#send_email_pop_up_title").html(e),$("#send_email_type").val(t),$("#send_email_subject").val(p),$("#send_email_modal").modal("show")}(t,a,0,$(this).data("receiver_id"),$(this).data("email"),$(this).data("subject"))})),$(".attachment_pop_up").on("click",(function(){"library"==$(this).attr("attachment-type")?($("#pop_up_email_compose_container").hide(),$("#pop_up_attachment_library_container").show()):($("#pop_up_email_compose_container").hide(),$("#pop_up_attachment_item_title").val(""),$("#pop_up_attach_social_video").val(""),$("#default_manual_pop_up").prop("checked",!0),$("#pop_up_attach_video").val(null),$("#name_pop_up_attach_video").html(""),$("#pop_up_attach_audio").val(null),$("#name_pop_up_attach_audio").html(""),$("#pop_up_attach_document").val(null),$("#name_pop_up_attach_document").html(""),$("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!1),$("#pop_up_attachment_yt_vm_video_input_container").show(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide(),$("#pop_up_manual_attachment_container").show())})),$(".email_pop_up_back_to_library").on("click",(function(){var e=$(".email_pop_up_back_to_library").attr("item-type");"youtube"==e?($("#email-pop-up-youtube-iframe").remove(),$("#email-pop-up-youtube-container").hide()):"vimeo"==e?($("#email-pop-up-vimeo-iframe").remove(),$("#email-pop-up-vimeo-container").hide()):"upload_video"==e?($("#email-pop-up-video-player").remove(),$("#email-pop-up-video-container").hide()):"upload_audio"==e?($("#email-pop-up-audio-player").remove(),$("#email-pop-up-audio-container").hide()):"document"==e?($("#email-pop-up-document-iframe").remove(),$("#email-pop-up-document-container").hide()):"image"==e&&($("#email-pop-up-image-tag").remove(),$("#email-pop-up-document-container").hide()),$("#view_pop_up_library_item").hide(),$("#show_pop_up_library_item").show()})),$(".email_pop_up_back_to_compose_email").on("click",(function(){var e=$(this).attr("btn-from");"library"==e?($("#pop_up_attachment_library_container").hide(),$("#pop_up_email_compose_container").show()):"manual"==e?($("#pop_up_manual_attachment_container").hide(),$("#pop_up_email_compose_container").show()):($("#pop_up_attachment_library_container").hide(),$("#pop_up_manual_attachment_container").hide(),$("#pop_up_email_compose_container").show())})),$(".email_pop_up_select_lib_item").on("click",(function(){var t=$(this).attr("item-sid");if(1==$(this).prop("checked")){var a=$(this).attr("item-category"),i=$(this).attr("item-type"),o=$(this).attr("item-title");$("#pop_up_email_attachment_list").show(),$("#pop_up_attachment_listing_data").prepend('<tr id="pop_up_lib_item_'+t+'"><input type="hidden" name="attachment['+t+'][item_type]" value="'+a+'"><input type="hidden" name="attachment['+t+'][record_sid]" value="'+t+'"><td class="text-center">'+o+'</td><td class="text-center">'+a+'</td><td class="text-center">'+i+'</td><td><a href="javascript:;" item-sid="'+t+'" attachment-type="library" item-type="'+a+'" class="btn btn-block btn-info js-pop-up-remove-attachment">Remove</a></td></tr>'),e.push(t.split("_")[1])}else{$("#pop_up_lib_item_"+t).remove();var p=e.indexOf(t);p>-1&&e.splice(p,1)}})),$(document).on("click",".js-pop-up-remove-attachment",(function(){var e=$(this).attr("item-sid"),t=$(this).attr("attachment-type"),a=$(this).attr("item-type");"library"==t?($("#pop_up_lib_item_"+e).remove(),"Document"==a?$("#pop_up_doc_key_"+e).prop("checked",!1):$("#pop_up_med_key_"+e).prop("checked",!1)):$("#pop_up_man_item_"+e).remove()})),$(".pop_up_attach_item_source").on("click",(function(){var e=$(this).val();"youtube"==e||"vimeo"==e?($("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!1),$("#pop_up_attachment_yt_vm_video_input_container").show(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide()):"upload_video"==e?($("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_yt_vm_video_input_container").hide(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!1),$("#pop_up_attachment_upload_video_input_container").show(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide()):"upload_audio"==e?($("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_yt_vm_video_input_container").hide(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!1),$("#pop_up_attachment_upload_audio_input_container").show(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide()):"upload_document"==e&&($("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_yt_vm_video_input_container").hide(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!1),$("#pop_up_attachment_upload_document_input_container").show())}));var i=1;$("#pop_up_save_attach_item").on("click",(function(){var e,t,a,o,p,n,_=0,d=$('input[name="pop_up_attach_item_source"]:checked').val();if("youtube"==d)if(""!=$("#pop_up_attach_social_video").val()){$("#pop_up_attach_social_video").val().match(/(?:https?:\/\/)?(?:youtu\.be\/|(?:www\.)?youtube\.com\/watch(?:\.php)?\?.*v=)([a-zA-Z0-9\-_]+)/)||(e="Not a Valid Youtube URL",_=1)}else e="Please provide a Valid Youtube URL",_=1;if("vimeo"==d)if(""!=$("#pop_up_attach_social_video").val()){var l=baseURL+"compliance_safety_reporting_public/validate_vimeo";$.ajax({type:"POST",url:l,data:{url:$("#pop_up_attach_social_video").val()},async:!1,success:function(t){0==t&&(e="Not a Valid Vimeo URLs",_=1)},error:function(e){}})}else e="Please provide a Valid Vimeo URL",_=1;if("upload_video"==d)if((p=$("#pop_up_attach_video").val()).length>0)if($("#name_pop_up_attach_video").html(p.substring(0,45)),"mp4"!=(n=(n=p.split(".").pop()).toLowerCase())&&"m4a"!=n&&"m4v"!=n&&"f4v"!=n&&"f4a"!=n&&"m4b"!=n&&"m4r"!=n&&"f4b"!=n&&"mov"!=n)$("#pop_up_attach_video").val(null),$("#name_pop_up_attach_video").html('<p class="red">Only (.mp4, .m4a, .m4v, .f4v, .f4a, .m4b, .m4r, .f4b, .mov) allowed!</p>'),e="Please select a valid video format.",_=1;else{var c=Number(($("#pop_up_attach_video")[0].files[0].size/1024/1024).toFixed(2));Number(uploadVideoSize)<c&&($("#pop_up_attach_video").val(null),$("#name_pop_up_attach_video").html(""),e=errorUploadVideoSize,_=1)}else $("#name_pop_up_attach_video").html('<p class="red">Please select video</p>'),e="Please select video to upload",_=1;if("upload_audio"==d)if((p=$("#pop_up_attach_audio").val()).length>0)if($("#name_pop_up_attach_audio").html(p.substring(0,45)),"mp3"!=(n=(n=p.split(".").pop()).toLowerCase())&&"m4a"!=n&&"mp4"!=n&&"ogg"!=n&&"flac"!=n&&"wav"!=n)$("#pop_up_attach_audio").val(null),$("#name_pop_up_attach_audio").html('<p class="red">Only (.mp3, .m4a, .mp4, .ogg, .flac, .wav) allowed!</p>'),e="Please select a valid audio format.",_=1;else{c=Number(($("#pop_up_attach_audio")[0].files[0].size/1024/1024).toFixed(2));Number(uploadVideoSize)<c&&($("#pop_up_attach_audio").val(null),$("#name_pop_up_attach_audio").html(""),e=errorUploadVideoSize,_=1)}else $("#name_pop_up_attach_audio").html('<p class="red">Please select audio</p>'),e="Please select audio to upload",_=1;"upload_document"==d&&((p=$("#pop_up_attach_document").val()).length>0?($("#name_pop_up_attach_document").html(p.substring(0,45)),o=(n=(n=p.split(".").pop()).toLowerCase()).toUpperCase(),"pdf"!=n&&"doc"!=n&&"docx"!=n&&"jpg"!=n&&"jpe"!=n&&"jpeg"!=n&&"png"!=n&&"gif"!=n&&($("#pop_up_attach_document").val(null),$("#name_pop_up_attach_document").html('<p class="red">Only (.pdf, .doc, .docx, .jpg, .jpe, .jpeg, .png, .gif) allowed!</p>'),e="Please select a valid document format.",_=1)):($("#name_pop_up_attach_document").html('<p class="red">Please select document</p>'),e="Please select document to upload",_=1));var u=$("#pop_up_attachment_item_title").val();if(""!=u&&0!=u.length||(e="Please provide a Video Title.",_=1),1==_)return alertify.alert(e),!1;new FormData;var m="";if("youtube"==d)t="Media",a="Youtube",m=$("#pop_up_attach_social_video").val();else if("vimeo"==d){t="Media",a="Vimeo",m=$("#pop_up_attach_social_video").val()}else if("upload_video"==d){t="Media",a="Upload Video",m=$("#pop_up_attach_video").prop("files")[0];var r=u.replace(/ /g,"");$("#pop_up_attach_video").clone().prop("id",r).insertAfter("div#pop_up_email_attachment_files:last"),$("#"+r).hide()}else if("upload_audio"==d){t="Media",a="Upload Audio",m=$("#attach_audio").prop("files")[0];r=u.replace(/ /g,"");$("#pop_up_attach_audio").clone().prop("id",r).insertAfter("div#pop_up_email_attachment_files:last"),$("#"+r).hide()}else if("upload_document"==d){t="Document",a=o,m=$("#attach_document").prop("files")[0];r=u.replace(/ /g,"");$("#pop_up_attach_document").clone().prop("id",r).insertAfter("div#pop_up_email_attachment_files:last"),$("#"+r).hide()}$("#pop_up_manual_attachment_container").hide(),$("#pop_up_email_compose_container").show(),$("#pop_up_email_attachment_list").show(),$("#pop_up_attachment_listing_data").prepend('<tr id="pop_up_man_item_'+i+'" class="pop_up_manual_upload_items" item-status="pending" row-id="man_item_'+i+'" item-title="'+u+'" item-source="'+d+'" item-data="'+m+'"><td class="text-center">'+u+'</td><td class="text-center">'+t+'</td><td class="text-center">'+a+'</td><td><a href="javascript:;" item-sid="'+i+'" attachment-type="manual" item-type="'+a+'" class="btn btn-block btn-info js-pop-up-remove-attachment">Remove</a></td></tr>'),++i})),$("#send_pop_up_email").on("click",(function(){var a=0,i="",o=$("#pop_up_attachment_listing_data > .pop_up_manual_upload_items"),p=0;if(o.length)p=$("#pop_up_attachment_listing_data > .pop_up_manual_upload_items").length;var n=$("#send_email_subject").val(),_=CKEDITOR.instances.send_email_message.getData();if(""==n&&""==_?(i="All fields are required.",a=1):""==_?(i="Message body is required.",a=1):""==n&&(i="Subject is required.",a=1),p>0&&0==a)$("#send_email_modal").modal("hide"),$("#attachment_loader").show(),$("#pop_up_attachment_listing_data > .pop_up_manual_upload_items").each((function(a){if("pending"==$(this).attr("item-status")){var i=$(this).attr("row-id"),o=$(this).attr("item-title"),n=$(this).attr("item-source"),_=baseURL+"compliance_safety_reporting_public/save_email_manual_attachment",d=new FormData;if(d.append("attachment_title",o),"youtube"==n||"vimeo"==n){var l=$(this).attr("item-data");d.append("social_url",l)}else{var c=o.replace(/ /g,""),u=$("#"+c).prop("files")[0];if(d.append("file",u),"upload_document"==n){var m=$("#"+c).val(),r=m.split(".").pop();d.append("file_name",m.replace("C:\\fakepath\\","")),d.append("file_ext",r)}}d.append("file_type",n),d.append("user_type","manager"),d.append("report_sid",reportId),d.append("incident_sid",incidentId),$.ajax({url:_,cache:!1,contentType:!1,processData:!1,type:"post",data:d,success:function(a){var o=jQuery.parseJSON(a),n=o.item_sid,_=o.item_title,d=o.item_type,l=o.item_source;$("#pop_up_"+i).html('<input type="hidden" name="attachment['+n+'][item_type]" value="'+d+'"><input type="hidden" name="attachment['+n+'][record_sid]" value="'+n+'"><td class="text-center">'+_+'</td><td class="text-center">'+d+'</td><td class="text-center">'+l+'</td><td><a href="javascript:;" item-sid="'+n+'" attachment-type="library" item-type="'+d+'" class="btn btn-block btn-info js-remove-attachment">Remove</a></td>'),$("#pop_up_"+i).attr("item-status","done"),p-=1,e.push(n),0==p&&setTimeout((function(){t("popup")}),1e3)},error:function(){}})}}));else{if(1==a)return alertify.alert(i),!1;t("popup")}}))}));