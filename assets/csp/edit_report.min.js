$(function(){function e(){let e=`\n        <div class="row" data-external="${x}">\n            <div class="col-md-5">\n                <div class="form-group">\n                    <label for="external_employee_name">Name</label>\n                    <input type="text" name="external_employees_names[${x}]['name']" class="form-control" required>\n                </div>\n            </div>\n            <div class="col-md-5">\n                <div class="form-group">\n                    <label for="external_employee_email">Email</label>\n                    <input type="email" name="external_employees_emails[${x}]['email']" class="form-control" required>\n                </div>\n            </div>\n            <div class="col-md-1">\n                <div class="form-group">\n                    <label>&nbsp;</label>\n                    <button type="button" class="btn btn-red btn-block jsRemoveExternalEmployee">\n                        <i class="fa fa-trash"></i>\n                    </button>\n                </div>\n            </div>\n        </div>\n        `;return x++,$(".jsAddExternalBody").append(e),$(`input[name="external_employees[${x-1}]['name']"]`).rules("add",{required:!0,messages:{required:"Please enter the name"}}),$(`input[name="external_employees[${x-1}]['email']"]`).rules("add",{required:!0,email:!0,messages:{required:"Please enter the email",email:"Please enter a valid email address"}}),e}function t(e){_confirm("Are you sure you want to remove this external employee? It will be removed from this report permanently as well.",function(){o(e)})}function a(e){null===k&&(ml(!0,"jsPageLoader"),k=$.ajax({url:baseUrl("compliance_safety_reporting/edit/"+getSegment(2)),method:"POST",data:$(e).serializeArray()}).always(function(){k=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){mn,_success(e.message,function(){window.location.refresh()})}))}function s(e){null===k&&(ml(!0,"jsPageLoader"),k=$.ajax({url:baseUrl("compliance_safety_reporting/notes/"+getSegment(2)+"/0"),method:"POST",data:e}).always(function(){k=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){_success(e.message,function(){window.location.refresh()})}))}function n(e){null===k&&(ml(!0,"jsPageLoader"),k=$.ajax({url:baseUrl("compliance_safety_reporting/report/"+getSegment(2)+"/incident"),method:"POST",data:{incidentId:e}}).always(function(){k=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){_success(e.message,function(){window.location.refresh()})}))}function i(e){null===k&&(ml(!0,"jsPageLoader"),k=$.ajax({url:baseUrl("compliance_safety_reporting/incident/"+e),method:"delete"}).always(function(){k=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){_success(e.message,function(){window.location.refresh()})}))}function l(e){$.ajax({url:baseUrl("compliance_safety_reporting/file/view/"+e),method:"GET"}).always(function(){k=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){$("#jsFileViewModalBody").html(e.view),$("#jsFileViewModalTitle").html(e.data.title),ml(!1,"jsFileViewModalLoader")})}function o(e){null===k&&(ml(!0,"jsPageLoader"),k=$.ajax({url:baseUrl("compliance_safety_reporting/"+getSegment(2)+"/"+e.data("id")),method:"DELETE"}).always(function(){k=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(t){_success(t.message,function(){$(`input[name="external_employees[${e.data("external")}]['name']"]`).rules("remove"),$(`input[name="external_employees[${e.data("external")}]['email']"]`).rules("remove"),e.remove(),x--,0==x&&$(".jsAddExternalBody").html(' <div class="alert alert-info text-center">No External employees found</div>')})}))}async function d(e,t,a){if(null===k){ml(!0,"jsPageLoader");const s=new FormData;s.append("title",t),s.append("type",a),"youtube"===e.type||"vimeo"===e.type?s.append("link",e.link):s.append("file",e),k=$.ajax({url:baseUrl("compliance_safety_reporting/file/"+getSegment(2)+"/0/"+a),method:"POST",async:!0,cache:!1,contentType:!1,processData:!1,data:s}).always(function(){k=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){_success(e.message,function(){$("#document_title").val(""),$("#report_documents").msFileUploader("clear"),"link"===a||"audio"===a||"video"===a?0!=$(".jsAudioArea").find(".jsFirst").length?$(".jsAudioArea").find(".jsFirst").append(e.view):$(".jsAudioArea").html(`<div class="row jsFirst">${e.view}</div>`):0!=$(".jsDocumentsArea").find(".jsFirst").length?$(".jsDocumentsArea").find(".jsFirst").append(e.view):$(".jsDocumentsArea").html(`<div class="row jsFirst">${e.view}</div>`)})})}}function r(e){if(!e)return"Unknown";const t=e.name.toLowerCase(),a=e.type;let s="file";return a.startsWith("audio/")?s="audio":a.startsWith("video/")?s="video":a.startsWith("image/")?s="image":a.startsWith("application/")&&("application/pdf"===a||a.startsWith("application/msword")||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===a)&&(s="document"),"file"===s&&(t.match(/\.(pdf|doc|docx|txt|xls|xlsx|ppt|pptx)$/)?s="document":t.match(/\.(mp3|wav|ogg|flac|aac|m4a)$/)?s="audio":t.match(/\.(mp4|mkv|avi|mov|wmv|flv|webm)$/)&&(s="video")),s}function c(){null===k&&(ml(!0,"jsPageLoader"),k=$.ajax({url:baseUrl("compliance_safety_reporting/"+getSegment(2)+"/emails/send"),method:"POST"}).always(function(){k=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){_success(e.message)}))}async function u(e){$("#jsAddIssueModal").modal("hide"),ml(!0,"jsPageLoader");const t=$(".jsAddIssueBtn");t.prop("disabled",!0).text("Adding...");try{const a=await $.ajax({url:baseUrl("compliance_safety_reporting/issue/add"),method:"POST",data:e}),{reportId:s,incidentId:n,issueId:i}=a;$("#jsAttachedFileListing > .jsUploadIssueFile").length>0&&await m(s,n,i),$("#jsAttachedNoteListing > .jsUploadIssueNote").length>0&&await p(s,n,i),_success(a.message,function(){ml(!1,"jsPageLoader"),window.location.href=a.reloadURL,window.location.reload()})}catch(e){handleErrorResponse(e)}finally{k=null,t.prop("disabled",!1).text("Add Issue")}}async function m(e,t,a){for(const s of M){const n=new FormData;n.append("reportId",e),n.append("incidentId",t),n.append("itemId",a),n.append("title",s.title),n.append("type",s.type),"link"===s.type?n.append("link",s.link):n.append("file",s.file);try{await $.ajax({url:baseUrl("compliance_safety_reporting/add_file_to_incident_item"),method:"POST",data:n,processData:!1,contentType:!1})}catch(e){handleErrorResponse(e)}}console.log("✅ All files processed.")}async function p(e,t,a){for(const s of T)try{await $.ajax({url:baseUrl(`compliance_safety_reporting/notes/${e}/${t}/${a}`),method:"POST",data:s})}catch(e){handleErrorResponse(e)}console.log("✅ All notes processed.")}function f(e){null!==k&&k.abort(),k=$.ajax({url:baseUrl("compliance_safety_reporting/issues/"+e),method:"GET"}).always(function(){k=null}).fail(handleErrorResponse).done(function(e){$("#jsAddIssueBox").html(e.view),$("#jsAddIssueModal .jsAddIssueBtn").removeClass("hidden")})}function v(e){const t=$(".jsEditModalIssue");t.prop("disabled",!0).text("Updating..."),null===k&&(k=$.ajax({url:baseUrl("compliance_safety_reporting/issue/edit"),method:"POST",data:e}).always(function(){k=null,t.prop("disabled",!1).text("Save changes")}).fail(handleErrorResponse).done(function(e){_success(e.message,function(){window.location.reload()})}))}function h(){if($("#jsAddIssueModal").length<=0){const e='\n\t\t\t<div class="modal fade" id="jsAddIssueModal" role="dialog" style="overflow-y:auto;" aria-labelledby="exampleModalLabel" aria-hidden="true">\n\t\t\t\t<div class="modal-dialog modal-lg" role="document">\n\t\t\t\t\t<div class="modal-content">\n\t\t\t\t\t\t<div class="modal-header">\n\t\t\t\t\t\t\t<h5 class="modal-title" id="exampleModalLabel">Report a new Issue</h5>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-body">\n\t\t\t\t\t\t\t<div class="alert alert-info text-center">Generating view please wait.</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-footer">\n\t\t\t\t\t\t\t<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n\t\t\t\t\t\t\t<button type="button" class="btn btn-primary jsAddIssueBtn hidden">Add Issue</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t';$("body").append(e)}$("#jsAddIssueModal").modal({backdrop:"static",keyboard:!1}),$("#jsAddIssueModal").modal("show")}function y(){if($("#jsEditIssueModal").length<=0){const e='\n\t\t\t<div class=modal fade" id="jsEditIssueModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">\n\t\t\t\t<div class="modal-dialog modal-lg" role="document">\n\t\t\t\t\t<div class="modal-content">\n\t\t\t\t\t\t<div class="modal-header">\n\t\t\t\t\t\t\t<h5 class="modal-title" id="exampleModalLabel">Modify an Issue</h5>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-body">\n\t\t\t\t\t\t\t<div class="alert alert-info text-center">Generating view please wait.</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-footer">\n\t\t\t\t\t\t\t<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n\t\t\t\t\t\t\t<button type="button" class="btn btn-primary jsEditModalIssue hidden">Save changes</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t';$("body").append(e)}$("#jsEditIssueModal").modal({backdrop:"static",keyboard:!1}),$("#jsEditIssueModal").modal("show")}function j(e){const t=$(".jsReportBasicUpdateBtn");t.prop("disabled",!0).text("Updating..."),null===k&&(k=$.ajax({url:baseUrl("compliance_safety_reporting/report/update/"+e.report_id),method:"POST",data:e}).always(function(){k=null,t.prop("disabled",!1).text("Save Changes")}).fail(handleErrorResponse).done(function(e){_success(e.message,function(){})}))}function I(){null===k&&(ml(!0,"jsPageLoader"),k=$.ajax({url:baseUrl("compliance_safety_reporting/delete_issue_from_report/"+issueId),method:"Delete"}).always(function(){k=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){_success(e.message,function(){window.location.reload()})}))}function g(e){if($("#jsIssueModalCommon").length<=0){const e='\n\t\t\t<div class=modal fade" id="jsIssueModalCommon" tabindex="-1" role="dialog" aria-hidden="true">\n\t\t\t\t<div class="modal-dialog modal-lg" role="document">\n\t\t\t\t\t<div class="modal-content">\n\t\t\t\t\t\t<div class="modal-header">\n\t\t\t\t\t\t\t<h5 class="modal-title"></h5>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-body">\n\t\t\t\t\t\t\t<div class="alert alert-info text-center">Generating a view please wait.</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-footer">\n\t\t\t\t\t\t\t<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t';$("body").append(e)}$("#jsIssueModalCommon").find(".modal-title").html(e.title),0==e.count?$("#jsIssueModalCommon").find(".modal-body").html('<div class="alert alert-info text-center">No file has been attached to this issue.</div>'):($("#jsIssueModalCommon").find(".modal-body").html('<div class="alert alert-info text-center">Generating a view please wait.</div>'),null===k&&(ml(!0,"jsPageLoader"),k=$.ajax({url:baseUrl("compliance_safety_reporting/get_attached_files/"+e.reportId+"/"+e.incidentId+"/"+e.issueId),method:"GET"}).always(function(){k=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){$("#jsIssueModalCommon").find(".modal-body").html(e.view),_success(e.message)}))),$("#jsIssueModalCommon").modal({backdrop:"static",keyboard:!1}),$("#jsIssueModalCommon").modal("show")}function l(e){$.ajax({url:baseUrl("compliance_safety_reporting/file/view/"+e),method:"GET"}).always(function(){k=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){$("#jsFileViewModalBody").html(e.view),$("#jsFileViewModalTitle").html(e.data.title),ml(!1,"jsFileViewModalLoader")})}function _(e,t){null===k&&(ml(!0,"jsPageLoader"),k=$.ajax({url:baseUrl("compliance_safety_reporting/delete_file/"+e),method:"DELETE"}).always(function(){k=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){_success("Removed "+t+" successfully",function(){window.location.reload()})}))}function b(e){const t=$(".jsIssueSaveFileBtn");t.prop("disabled",!0);const a=new FormData;a.append("reportId",F),a.append("incidentId",P),a.append("itemId",E),a.append("title",e.title),a.append("type",e.fileType),"youtube"===e.file.type||"vimeo"===e.file.type?a.append("link",e.file.link):a.append("file",e.file),k=$.ajax({url:baseUrl("compliance_safety_reporting/add_file_to_incident_item"),method:"POST",data:a,processData:!1,contentType:!1}).always(function(){k=null,t.prop("disabled",!1)}).fail(handleErrorResponse).done(function(e){_success("File attached successfully."),$("#jsIssueModalCommon").modal("hide")})}function w(e){if($("#jsIssueModalCommon").length<=0){const e='\n\t\t\t<div class=modal fade" id="jsIssueModalCommon" tabindex="-1" role="dialog" aria-hidden="true">\n\t\t\t\t<div class="modal-dialog modal-lg" role="document">\n\t\t\t\t\t<div class="modal-content">\n\t\t\t\t\t\t<div class="modal-header">\n\t\t\t\t\t\t\t<h5 class="modal-title"></h5>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-body">\n\t\t\t\t\t\t\t<div class="alert alert-info text-center">Generating a view please wait.</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-footer">\n\t\t\t\t\t\t\t<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n\t\t\t\t\t\t\t<button type="button" class="btn btn-orange hidden"></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t';$("body").append(e)}$("#jsIssueModalCommon").find(".modal-title").html(e.title),$("#jsIssueModalCommon").find(".btn-orange").html(e.save.text),$("#jsIssueModalCommon").find(".btn-orange").addClass(e.save.cl),$("#jsIssueModalCommon").find(".btn-orange").addClass("hidden"),$("#jsIssueModalCommon").modal({backdrop:"static",keyboard:!1}),$("#jsIssueModalCommon").modal("show")}function r(e){if(!e)return"Unknown";const t=e.name.toLowerCase(),a=e.type;let s="file";return a.startsWith("audio/")?s="audio":a.startsWith("video/")?s="video":a.startsWith("image/")?s="image":a.startsWith("application/")&&("application/pdf"===a||a.startsWith("application/msword")||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===a)&&(s="document"),"file"===s&&(t.match(/\.(pdf|doc|docx|txt|xls|xlsx|ppt|pptx)$/)?s="document":t.match(/\.(mp3|wav|ogg|flac|aac|m4a)$/)?s="audio":t.match(/\.(mp4|mkv|avi|mov|wmv|flv|webm)$/)&&(s="video")),s}let x=$(".jsAddExternalBody .jsEER").length,k=null,F=0,P=0,E=0,A={},C=1,L=1,M=[],T=[];const R={document:{allowedTypes:["jpg","jpeg","png","gif","webp","rtf","pdf","doc","docx","pptx","ppt","xls","xlsx","csv","mov","mp4","webm","wav","mp3"],fileLimit:"200mb",allowLinks:!0,allowCapture:!0}};$("#report_documents").msFileUploader(R.document),0!=x&&$(".jsAddExternalBody .jsEER").each(function(e){$(`input[name="external_employees[${e}]['name']"]`).rules("add",{required:!0,messages:{required:"Please enter the name"}}),$(`input[name="external_employees[${e}]['email']"]`).rules("add",{required:!0,email:!0,messages:{required:"Please enter the email",email:"Please enter a valid email address"}})}),$("#report_status").select2({minimumResultsForSearch:-1}),$("#report_note_type").select2({minimumResultsForSearch:-1}),$("#jsReportIncidentType").select2({}),CKEDITOR.replace("report_note"),$("#report_date").datetimepicker({format:"m/d/Y",datepicker:!0,timepicker:!1,changeYear:!0,changeMonth:!0}),$(".start_date").datetimepicker({format:"m/d/Y",datepicker:!0,timepicker:!1,changeYear:!0,changeMonth:!0}),$("#report_completion_date").datetimepicker({format:"m/d/Y",datepicker:!0,timepicker:!1,changeYear:!0,changeMonth:!0}),$("#jsAddReportForm").validate({rules:{report_title:{required:!0},report_date:{required:!0}},messages:{report_title:{required:"Please enter report title"},report_date:{required:"Please select report date"}},submitHandler:function(e){a(e)}}),$(".jsAddExternalEmployee").click(function(t){t.preventDefault(),$(".jsAddExternalBody .alert").remove(),e()}),$(document).on("click",".jsRemoveExternalEmployee",function(){const e=$(this).closest(".row");if(e.data("id"))return t(e);alertify.confirm("Are you sure you want to remove this external employee?",function(){$(`input[name="external_employees[${e.data("external")}]['name']"]`).rules("remove"),$(`input[name="external_employees[${e.data("external")}]['email']"]`).rules("remove"),e.remove(),x--,0==x&&$(".jsAddExternalBody").html(' <div class="alert alert-info text-center">No External employees found</div>')})}),$(document).on("click",".jsDeleteReportIncident",function(){const e=$(this).closest("tr").data("id");alertify.confirm("Are you sure you want to remove this incident type?",function(){i(e)})}),$(".jsAddNote").click(function(e){e.preventDefault();const t={type:$("#report_note_type").val(),content:CKEDITOR.instances.report_note.getData()};""!==t.content.trim()?s(t):_error("Please enter a note.")}),$(".jsAddIncident").click(function(e){e.preventDefault();const t={type:$("#jsReportIncidentType").val()};"0"!=t.type?n(t.type):_error("Please select an incident type.")}),$(".jsAddDocument").click(function(e){e.preventDefault();const t={title:$("#document_title").val(),file:$("#report_documents").msFileUploader("get")};if(""===t.title.trim())return void _error("Please enter a file title.");if(!t.file)return void _error("Please select a file.");if(0===Object.keys(t.file).length)return void _error("Please select a file.");if(t.file.hasError&&"vimeo"===t.file.type)return void _error("Vimeo link is invalid.");if(t.file.hasError&&"youtube"===t.file.type)return void _error("YouTube link is invalid.");if(t.file.hasError)return void _error(t.file.errorCode);let a="vimeo"===t.file.type||"youtube"===t.file.type?"link":r(t.file).toLowerCase();d(t.file,t.title,a)}),$(document).on("click",".jsViewFile",function(e){e.preventDefault();const t=$(this).closest(".jsFileBox").data("id");Modal({Id:"jsFileViewModal",Loader:"jsFileViewModalLoader",Title:'<span id="jsFileViewModalTitle"></span>',Body:'<div id="jsFileViewModalBody"></body>'},function(){l(t)})}),$(".jsSendReminderEmails").click(function(e){e.preventDefault(),_confirm("Are you sure you want to send emails to the selected employees and external recipients?",c)}),$(".jsAddAddIssueBtn").click(function(e){e.preventDefault(),h(),k=$.ajax({url:baseUrl("compliance_safety_reporting/issues/all"),method:"GET"}).always(function(){k=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){$("#jsAddIssueModal .modal-body").html(e.view),$.fn.modal.Constructor.prototype.enforceFocus=function(){},$("#jsNewItemSelect").select2(),$("#jsAddIssueNoteType").select2(),CKEDITOR.replace("jsManualIssueDescription",{toolbar:[["Bold","Italic","-","NumberedList","BulletedList","-","Link","Unlink"],["FontSize","TextColor","BGColor"]]}),CKEDITOR.replace("jsAddIssueNote"),$("#jsAddIssueFileUploadFile").msFileUploader(R.document),f($("#jsNewItemSelect").val())})}),$(document).on("change","#jsNewItemSelect",function(){f($(this).val())}),$(document).on("click",".jsAddIssueBtn",function(){const e={reportId:getSegment(2),incidentId:$("#jsNewItemIncidentId").val(),issueId:$("#jsNewItemId").val(),severityLevelId:$("#jsNewItemSeverityLevel").val(),dynamicInputs:[],dynamicCheckbox:[],type:$(".jsIssueType:checked").val(),title:"",description:""};if(e.reportId)if(e.incidentId)if(e.issueId){if("default"==e.type){if(e.dynamicInputs=$("#jsAddIssuePanelRef").find('[name="dynamicInput[]"]').length>0?$("#jsAddIssuePanelRef").find('[name="dynamicInput[]"]').map(function(){return $(this).val()}).get():[],e.dynamicCheckbox=$("#jsAddIssuePanelRef").find('[name="dynamicCheckbox[]"]')>0?$("#jsAddIssuePanelRef").find('[name="dynamicCheckbox[]"]').map(function(){return $(this).val()}).get():[],!e.severityLevelId)return void _error("Please select a severity level.")}else if("manual"==e.type){if(e.title=$("#jsManualIssueTitle").val(),e.description=CKEDITOR.instances.jsManualIssueDescription.getData(),!e.title)return void _error("Please add a manual issue title.");if(!e.description)return void _error("Please add a manual issue description.")}u(e)}else _error("Please provide a issue id.");else _error("Please provide a incident id.");else _error("Please provide a report id.")}),$(".jsEditIssue").click(function(e){e.preventDefault();const t=$(this).data("id");y(),k=$.ajax({url:baseUrl("compliance_safety_reporting/issues/edit/"+t),method:"GET"}).always(function(){k=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){$("#jsEditIssueModal .modal-body").html(e.view),$(".jsEditModalIssue").removeClass("hidden")})}),$(document).on("click",".jsEditModalIssue",function(){const e={issueId:$("#jsNewItemId").val(),severityLevelId:$("#jsNewItemSeverityLevel").val(),dynamicInputs:[],dynamicCheckbox:[]};e.dynamicInputs=$("#jsAddIssuePanelRef").find('[name="dynamicInput[]"]').length>0?$("#jsAddIssuePanelRef").find('[name="dynamicInput[]"]').map(function(){return $(this).val()}).get():[],e.dynamicCheckbox=$("#jsAddIssuePanelRef").find('[name="dynamicCheckbox[]"]')>0?$("#jsAddIssuePanelRef").find('[name="dynamicCheckbox[]"]').map(function(){return $(this).val()}).get():[],e.issueId?e.severityLevelId?v(e):_error("Please select a severity level."):_error("Please provide a issue id.")}),$(document).on("click",".show-status-box",function(){$(this).closest(".row").next().show()}),$(document).on("click",".applicant",function(){const e=$(this).data("id");$(this).parent().parent().parent().find(".jsSelectedPill").html(`\n\t\t\t<div id="jsNewItemSelectedSeverity" data-id="${e}" class="csLabelPill jsSelectedLabelPill text-center" \n\t\t\tstyle="\n\t\t\tbackground-color: ${$(this).css("background-color")}; color: ${$(this).css("color")} ;">${$(this).text()}</div>\n\t\t`),$("#jsNewItemSeverityLevel").val(e)}),$(document).on("click",".cross",function(){$(this).parent().parent().css("display","none")}),$(document).on("change",".jsIssueType",function(){const e=$(this).val();"manual"==e?($("#jsDefaultIssue").addClass("hidden"),$("#jsManualIssue").removeClass("hidden")):"default"==e&&($("#jsManualIssue").addClass("hidden"),$("#jsDefaultIssue").removeClass("hidden"))}),$(document).on("click",".jsIssueSection",function(){const e=$(this).data("section");$(".jsIssueSection").removeClass("active"),$(this).addClass("active"),"detail"==e?($("#jsDetailSection").removeClass("hidden"),$("#jsFileSection").addClass("hidden"),$("#jsNoteSection").addClass("hidden")):"file"==e?($("#jsDetailSection").addClass("hidden"),$("#jsFileSection").removeClass("hidden"),$("#jsNoteSection").addClass("hidden")):"note"==e&&($("#jsDetailSection").addClass("hidden"),$("#jsFileSection").addClass("hidden"),$("#jsNoteSection").removeClass("hidden"))}),$(".jsReportBasicUpdateBtn").click(function(e){e.preventDefault();const t={title:$(".report_title").val().trim(),report_date:$(".report_date").val(),report_completion_date:$(".report_completion_date").val(),report_status:$(".report_status option:selected").val(),report_id:getSegment(2)};t.title?t.report_date?"completed"!=t.status||t.date?j(t):_error("Please add a report completion date."):_error("Please add a report date."):_error("Please add a report title.")}),$(".jsDeleteIssue").click(function(e){e.preventDefault(),issueId=$(this).data("issue_id"),_confirm("Are you sure you want to delete this issue?",I)}),$(".jsViewIssuesFiles").click(function(e){e.preventDefault(),g({title:"View File(s)",reportId:$(this).data("report_id"),incidentId:$(this).data("incident_id"),issueId:$(this).data("issue_id"),count:$(this).data("files_count")})}),$(document).on("click",".jsViewFile",function(e){e.preventDefault();const t=$(this).closest(".jsFileBox").data("id");Modal({Id:"jsFileViewModal",Loader:"jsFileViewModalLoader",Title:'<span id="jsFileViewModalTitle"></span>',Body:'<div id="jsFileViewModalBody"></body>'},function(){$("#jsIssueModalCommon").modal("hide"),l(t)})}),$(document).on("click",".jsDeleteFile",function(e){e.preventDefault();const t=$(this).data("file_id"),a=$(this).data("file_type");_confirm("Are you sure you want to remove this "+a+"? It will be removed from this issue permanently as well.",function(){_(t,a)})}),$(".jsIssueUploadFileBtn").click(function(e){e.preventDefault(),F=$(this).data("report_id"),P=$(this).data("incident_id"),E=$(this).data("issue_id"),w({title:"Attach file",save:{text:"Upload file",cl:"jsIssueSaveFileBtn"}});const t='\n                    <div class="row">\n                        <div class="col-lg-12">\n                            <div class="form-group">\n                                <label for="jsIssueFileUploadTitle">Title <strong class="text-danger">*</strong></label>\n                                <input type="text" class="form-control" id="jsIssueFileUploadTitle" name="jsIssueFileUploadTitle" />\n                            </div>\n                        </div>\n                    </div>\n                    <div class="row">\n                        <div class="col-lg-12">\n                            <div class="form-group">\n                                <input type="file" class="hidden" id="jsIssueFileUploadFile" name="jsIssueFileUploadFile" />\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            ';$("#jsIssueModalCommon").find(".modal-body").html(t),A=$("#jsIssueFileUploadFile").msFileUploader(R.document),$("#jsIssueModalCommon").find(".jsIssueSaveFileBtn").removeClass("hidden")}),$(document).on("click",".jsIssueSaveFileBtn",function(e){if(e.preventDefault(),null!==k)return;const t={title:$("#jsIssueFileUploadTitle").val().trim(),file:$("#jsIssueFileUploadFile").msFileUploader("get")};t.title?0!==Object.keys(t.file).length?t.hasError&&"vimeo"===t.type?_error("Vimeo link is invalid."):t.hasError&&"youtube"===t.type?_error("YouTube link is invalid."):t.file.hasError?_error("Please select a valid file."):(t.fileType="vimeo"===t.file.type||"youtube"===t.file.type?"link":r(t.file).toLowerCase(),b(t)):_error("Please select a valid file."):_error("Please add a title of the file.")}),$(document).on("click","#jsAddIssueFileBtn",function(e){e.preventDefault();const t={title:$("#jsAddIssueFileUploadTitle").val().trim(),file:$("#jsAddIssueFileUploadFile").msFileUploader("get")};if(!t.title)return void _error("Please add a title of the file.");if(0===Object.keys(t.file).length)return void _error("Please select a valid file.");if(t.hasError&&"vimeo"===t.type)return void _error("Vimeo link is invalid.");if(t.hasError&&"youtube"===t.type)return void _error("YouTube link is invalid.");if(t.file.hasError)return void _error("Please select a valid file.");t.fileType="vimeo"===t.file.type||"youtube"===t.file.type?"link":r(t.file).toLowerCase(),$("#jsAttachedFileListingSection").removeClass("hidden"),$("#jsAttachedFileListing").prepend('<tr id="jsIssueFile_'+C+'" class="jsUploadIssueFile" row-id="jsIssueFile_'+C+'" file-title="'+t.title+'"  file-data="'+t+'"><td class="text-center">'+t.title+'</td><td class="text-center">'+t.fileType+'</td><td><a href="javascript:;" item-sid="'+C+'" attachment-type="manual" class="btn btn-block btn-info jsRemoveAttachedIssueFile">Remove</a></td></tr>');let a={id:C,title:t.title,type:t.fileType};"youtube"===t.file.type||"vimeo"===t.file.type?a.link=t.file.link:a.file=t.file,M.push(a),++C,$("#jsAddIssueFileUploadTitle").val(""),$("#jsAddIssueFileUploadFile").msFileUploader("clear"),$('input[type="radio"][value="upload"]:checked')}),$(document).on("click",".jsRemoveAttachedIssueFile",function(){var e=$(this).attr("item-sid");$("#jsIssueFile_"+e).remove(),M=M.filter(function(t){return t.id!==e})}),$(document).on("click","#jsAddIssueNoteBtn",function(e){e.preventDefault();const t={type:$("#jsAddIssueNoteType").val(),content:CKEDITOR.instances.jsAddIssueNote.getData()};if(""===t.content.trim())return void _error("Please enter a note.");let a={id:L,type:t.type,content:t.content};T.push(a),$("#jsAttachedNoteListingSection").removeClass("hidden"),$("#jsAttachedNoteListing").prepend('<tr id="jsIssueNote_'+L+'" class="jsUploadIssueNote" row-id="jsIssueNote_'+L+'"  note-type="'+t.type+'"  note-content="'+t+'"><td class="text-center">'+t.type+'</td><td class="text-center">'+t.content+'</td><td><a href="javascript:;" note-sid="'+L+'" attachment-type="manual" class="btn btn-block btn-info jsRemoveAttachedIssueNote">Remove</a></td></tr>'),++L,$("#jsAddIssueNoteType").val(""),CKEDITOR.instances.jsAddIssueNote.setData("")}),$(document).on("click",".jsRemoveAttachedIssueNote",function(){var e=$(this).attr("note-sid");$("#jsIssueNote_"+e).remove(),T=T.filter(function(t){return t.id!==e})}),ml(!1,"jsPageLoader")});