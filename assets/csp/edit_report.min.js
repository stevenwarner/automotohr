$((function(){let e=$(".jsAddExternalBody .jsEER").length,t=null,a=0,n=0,s=0,l={};const o={allowedTypes:["jpg","jpeg","png","gif","webp","rtf","pdf","doc","docx","pptx","ppt","xls","xlsx","csv","mov","mp4","webm","wav","mp3"],fileLimit:"200mb",allowLinks:!0,allowCapture:!0};function i(e){$.ajax({url:baseUrl("compliance_safety_reporting/file/view/"+e),method:"GET"}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){$("#jsFileViewModalBody").html(e.view),$("#jsFileViewModalTitle").html(e.data.title),ml(!1,"jsFileViewModalLoader")}))}function d(e){if(!e)return"Unknown";const t=e.name.toLowerCase(),a=e.type;let n="file";return a.startsWith("audio/")?n="audio":a.startsWith("video/")?n="video":a.startsWith("image/")?n="image":a.startsWith("application/")&&("application/pdf"===a||a.startsWith("application/msword")||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===a)&&(n="document"),"file"===n&&(t.match(/\.(pdf|doc|docx|txt|xls|xlsx|ppt|pptx)$/)?n="document":t.match(/\.(mp3|wav|ogg|flac|aac|m4a)$/)?n="audio":t.match(/\.(mp4|mkv|avi|mov|wmv|flv|webm)$/)&&(n="video")),n}function r(){null===t&&(ml(!0,"jsPageLoader"),t=$.ajax({url:baseUrl("compliance_safety_reporting/"+getSegment(2)+"/emails/send"),method:"POST"}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){_success(e.message)})))}function c(e){null!==t&&t.abort(),t=$.ajax({url:baseUrl("compliance_safety_reporting/issues/"+e),method:"GET"}).always((function(){t=null})).fail(handleErrorResponse).done((function(e){$("#jsAddIssueBox").html(e.view),$("#jsAddIssueModal .jsAddIssue").removeClass("hidden")}))}function m(){null===t&&(ml(!0,"jsPageLoader"),t=$.ajax({url:baseUrl("compliance_safety_reporting/delete_issue_from_report/"+issueId),method:"Delete"}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){_success(e.message,(function(){window.location.reload()}))})))}function i(e){$.ajax({url:baseUrl("compliance_safety_reporting/file/view/"+e),method:"GET"}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){$("#jsFileViewModalBody").html(e.view),$("#jsFileViewModalTitle").html(e.data.title),ml(!1,"jsFileViewModalLoader")}))}function d(e){if(!e)return"Unknown";const t=e.name.toLowerCase(),a=e.type;let n="file";return a.startsWith("audio/")?n="audio":a.startsWith("video/")?n="video":a.startsWith("image/")?n="image":a.startsWith("application/")&&("application/pdf"===a||a.startsWith("application/msword")||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===a)&&(n="document"),"file"===n&&(t.match(/\.(pdf|doc|docx|txt|xls|xlsx|ppt|pptx)$/)?n="document":t.match(/\.(mp3|wav|ogg|flac|aac|m4a)$/)?n="audio":t.match(/\.(mp4|mkv|avi|mov|wmv|flv|webm)$/)&&(n="video")),n}$("#report_documents").msFileUploader(o),0!=e&&$(".jsAddExternalBody .jsEER").each((function(e){$(`input[name="external_employees[${e}]['name']"]`).rules("add",{required:!0,messages:{required:"Please enter the name"}}),$(`input[name="external_employees[${e}]['email']"]`).rules("add",{required:!0,email:!0,messages:{required:"Please enter the email",email:"Please enter a valid email address"}})})),$("#report_status").select2({minimumResultsForSearch:-1}),$("#report_note_type").select2({minimumResultsForSearch:-1}),$("#jsReportIncidentType").select2({}),CKEDITOR.replace("report_note"),$("#report_date").datetimepicker({format:"m/d/Y",datepicker:!0,timepicker:!1,changeYear:!0,changeMonth:!0}),$(".start_date").datetimepicker({format:"m/d/Y",datepicker:!0,timepicker:!1,changeYear:!0,changeMonth:!0}),$("#report_completion_date").datetimepicker({format:"m/d/Y",datepicker:!0,timepicker:!1,changeYear:!0,changeMonth:!0}),$("#jsAddReportForm").validate({rules:{report_title:{required:!0},report_date:{required:!0}},messages:{report_title:{required:"Please enter report title"},report_date:{required:"Please select report date"}},submitHandler:function(e){!function(e){null===t&&(ml(!0,"jsPageLoader"),t=$.ajax({url:baseUrl("compliance_safety_reporting/edit/"+getSegment(2)),method:"POST",data:$(e).serializeArray()}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){_success(e.message,(function(){window.location.refresh()}))})))}(e)}}),$(".jsAddExternalEmployee").click((function(t){t.preventDefault(),$(".jsAddExternalBody .alert").remove(),function(){let t=`\n        <div class="row" data-external="${e}">\n            <div class="col-md-5">\n                <div class="form-group">\n                    <label for="external_employee_name">Name</label>\n                    <input type="text" name="external_employees_names[${e}]['name']" class="form-control" required>\n                </div>\n            </div>\n            <div class="col-md-5">\n                <div class="form-group">\n                    <label for="external_employee_email">Email</label>\n                    <input type="email" name="external_employees_emails[${e}]['email']" class="form-control" required>\n                </div>\n            </div>\n            <div class="col-md-1">\n                <div class="form-group">\n                    <label>&nbsp;</label>\n                    <button type="button" class="btn btn-red btn-block jsRemoveExternalEmployee">\n                        <i class="fa fa-trash"></i>\n                    </button>\n                </div>\n            </div>\n        </div>\n        `;e++,$(".jsAddExternalBody").append(t),$(`input[name="external_employees[${e-1}]['name']"]`).rules("add",{required:!0,messages:{required:"Please enter the name"}}),$(`input[name="external_employees[${e-1}]['email']"]`).rules("add",{required:!0,email:!0,messages:{required:"Please enter the email",email:"Please enter a valid email address"}})}()})),$(document).on("click",".jsRemoveExternalEmployee",(function(){const a=$(this).closest(".row");if(a.data("id"))return function(a){_confirm("Are you sure you want to remove this external employee? It will be removed from this report permanently as well.",(function(){!function(a){null===t&&(ml(!0,"jsPageLoader"),t=$.ajax({url:baseUrl("compliance_safety_reporting/"+getSegment(2)+"/"+a.data("id")),method:"DELETE"}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(t){_success(t.message,(function(){$(`input[name="external_employees[${a.data("external")}]['name']"]`).rules("remove"),$(`input[name="external_employees[${a.data("external")}]['email']"]`).rules("remove"),a.remove(),e--,0==e&&$(".jsAddExternalBody").html(' <div class="alert alert-info text-center">No External employees found</div>')}))})))}(a)}))}(a);alertify.confirm("Are you sure you want to remove this external employee?",(function(){$(`input[name="external_employees[${a.data("external")}]['name']"]`).rules("remove"),$(`input[name="external_employees[${a.data("external")}]['email']"]`).rules("remove"),a.remove(),e--,0==e&&$(".jsAddExternalBody").html(' <div class="alert alert-info text-center">No External employees found</div>')}))})),$(document).on("click",".jsDeleteReportIncident",(function(){const e=$(this).closest("tr").data("id");alertify.confirm("Are you sure you want to remove this incident type?",(function(){var a;a=e,null===t&&(ml(!0,"jsPageLoader"),t=$.ajax({url:baseUrl("compliance_safety_reporting/incident/"+a),method:"delete"}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){_success(e.message,(function(){window.location.refresh()}))})))}))})),$(".jsAddNote").click((function(e){e.preventDefault();const a={type:$("#report_note_type").val(),content:CKEDITOR.instances.report_note.getData()};""!==a.content.trim()?function(e){null===t&&(ml(!0,"jsPageLoader"),t=$.ajax({url:baseUrl("compliance_safety_reporting/notes/"+getSegment(2)+"/0"),method:"POST",data:e}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){_success(e.message,(function(){window.location.refresh()}))})))}(a):_error("Please enter a note.")})),$(".jsAddIncident").click((function(e){e.preventDefault();const a={type:$("#jsReportIncidentType").val()};var n;"0"!=a.type?(n=a.type,null===t&&(ml(!0,"jsPageLoader"),t=$.ajax({url:baseUrl("compliance_safety_reporting/report/"+getSegment(2)+"/incident"),method:"POST",data:{incidentId:n}}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){_success(e.message,(function(){window.location.refresh()}))})))):_error("Please select an incident type.")})),$(".jsAddDocument").click((function(e){e.preventDefault();const a={title:$("#document_title").val(),file:$("#report_documents").msFileUploader("get")};if(""===a.title.trim())return void _error("Please enter a file title.");if(!a.file)return void _error("Please select a file.");if(0===Object.keys(a.file).length)return void _error("Please select a file.");if(a.file.hasError&&"vimeo"===a.file.type)return void _error("Vimeo link is invalid.");if(a.file.hasError&&"youtube"===a.file.type)return void _error("YouTube link is invalid.");if(a.file.hasError)return void _error(a.file.errorCode);let n="vimeo"===a.file.type||"youtube"===a.file.type?"link":d(a.file).toLowerCase();!async function(e,a,n){if(null===t){ml(!0,"jsPageLoader");const s=new FormData;s.append("title",a),s.append("type",n),"youtube"===e.type||"vimeo"===e.type?s.append("link",e.link):s.append("file",e),t=$.ajax({url:baseUrl("compliance_safety_reporting/file/"+getSegment(2)+"/0/"+n),method:"POST",async:!0,cache:!1,contentType:!1,processData:!1,data:s}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){_success(e.message,(function(){$("#document_title").val(""),$("#report_documents").msFileUploader("clear"),"link"===n||"audio"===n||"video"===n?0!=$(".jsAudioArea").find(".jsFirst").length?$(".jsAudioArea").find(".jsFirst").append(e.view):$(".jsAudioArea").html(`<div class="row jsFirst">${e.view}</div>`):0!=$(".jsDocumentsArea").find(".jsFirst").length?$(".jsDocumentsArea").find(".jsFirst").append(e.view):$(".jsDocumentsArea").html(`<div class="row jsFirst">${e.view}</div>`)}))}))}}(a.file,a.title,n)})),$(document).on("click",".jsViewFile",(function(e){e.preventDefault();const t=$(this).closest(".jsFileBox").data("id");Modal({Id:"jsFileViewModal",Loader:"jsFileViewModalLoader",Title:'<span id="jsFileViewModalTitle"></span>',Body:'<div id="jsFileViewModalBody"></body>'},(function(){i(t)}))})),$(".jsSendReminderEmails").click((function(e){e.preventDefault(),_confirm("Are you sure you want to send emails to the selected employees and external recipients?",r)})),$(".jsAddAddIssueBtn").click((function(e){e.preventDefault(),function(){if($("#jsAddIssueModal").length<=0){const e='\n\t\t\t<div class=modal fade" id="jsAddIssueModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">\n\t\t\t\t<div class="modal-dialog modal-lg" role="document">\n\t\t\t\t\t<div class="modal-content">\n\t\t\t\t\t\t<div class="modal-header">\n\t\t\t\t\t\t\t<h5 class="modal-title" id="exampleModalLabel">Report a new Issue</h5>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-body">\n\t\t\t\t\t\t\t<div class="alert alert-info text-center">Generating view please wait.</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-footer">\n\t\t\t\t\t\t\t<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n\t\t\t\t\t\t\t<button type="button" class="btn btn-primary jsAddIssue hidden">Add Issue</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t';$("body").append(e)}$("#jsAddIssueModal").modal({backdrop:"static",keyboard:!1}),$("#jsAddIssueModal").modal("show")}(),t=$.ajax({url:baseUrl("compliance_safety_reporting/issues/all"),method:"GET"}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){$("#jsAddIssueModal .modal-body").html(e.view),c($("#jsNewItemSelect").val())}))})),$(document).on("change","#jsNewItemSelect",(function(){c($(this).val())})),$(document).on("click",".jsAddIssue",(function(){const e={reportId:getSegment(2),incidentId:$("#jsNewItemIncidentId").val(),issueId:$("#jsNewItemId").val(),severityLevelId:$("#jsNewItemSeverityLevel").val(),dynamicInputs:[],dynamicCheckbox:[]};e.dynamicInputs=$("#jsAddIssuePanelRef").find('[name="dynamicInput[]"]').length>0?$("#jsAddIssuePanelRef").find('[name="dynamicInput[]"]').map((function(){return $(this).val()})).get():[],e.dynamicCheckbox=$("#jsAddIssuePanelRef").find('[name="dynamicCheckbox[]"]')>0?$("#jsAddIssuePanelRef").find('[name="dynamicCheckbox[]"]').map((function(){return $(this).val()})).get():[],e.reportId?e.incidentId?e.issueId?e.severityLevelId?function(e){const a=$(".jsAddIssue");a.prop("disabled",!0).text("Adding..."),null===t&&(t=$.ajax({url:baseUrl("compliance_safety_reporting/issue/add"),method:"POST",data:e}).always((function(){t=null,a.prop("disabled",!1).text("Add Issue")})).fail(handleErrorResponse).done((function(e){_success(e.message,(function(){window.location.refresh()}))})))}(e):_error("Please select a severity level."):_error("Please provide a issue id."):_error("Please provide a incident id."):_error("Please provide a report id.")})),$(".jsEditIssue").click((function(e){e.preventDefault();const a=$(this).closest("tr").data("id");!function(){if($("#jsEditIssueModal").length<=0){const e='\n\t\t\t<div class=modal fade" id="jsEditIssueModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">\n\t\t\t\t<div class="modal-dialog modal-lg" role="document">\n\t\t\t\t\t<div class="modal-content">\n\t\t\t\t\t\t<div class="modal-header">\n\t\t\t\t\t\t\t<h5 class="modal-title" id="exampleModalLabel">Modify an Issue</h5>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-body">\n\t\t\t\t\t\t\t<div class="alert alert-info text-center">Generating view please wait.</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-footer">\n\t\t\t\t\t\t\t<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n\t\t\t\t\t\t\t<button type="button" class="btn btn-primary jsEditModalIssue hidden">Save changes</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t';$("body").append(e)}$("#jsEditIssueModal").modal({backdrop:"static",keyboard:!1}),$("#jsEditIssueModal").modal("show")}(),t=$.ajax({url:baseUrl("compliance_safety_reporting/issues/edit/"+a),method:"GET"}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){$("#jsEditIssueModal .modal-body").html(e.view),$(".jsEditModalIssue").removeClass("hidden")}))})),$(document).on("click",".jsEditModalIssue",(function(){const e={issueId:$("#jsNewItemId").val(),severityLevelId:$("#jsNewItemSeverityLevel").val(),dynamicInputs:[],dynamicCheckbox:[]};e.dynamicInputs=$("#jsAddIssuePanelRef").find('[name="dynamicInput[]"]').length>0?$("#jsAddIssuePanelRef").find('[name="dynamicInput[]"]').map((function(){return $(this).val()})).get():[],e.dynamicCheckbox=$("#jsAddIssuePanelRef").find('[name="dynamicCheckbox[]"]')>0?$("#jsAddIssuePanelRef").find('[name="dynamicCheckbox[]"]').map((function(){return $(this).val()})).get():[],e.issueId?e.severityLevelId?function(e){const a=$(".jsEditModalIssue");a.prop("disabled",!0).text("Updating..."),null===t&&(t=$.ajax({url:baseUrl("compliance_safety_reporting/issue/edit"),method:"POST",data:e}).always((function(){t=null,a.prop("disabled",!1).text("Save changes")})).fail(handleErrorResponse).done((function(e){_success(e.message,(function(){window.location.refresh()}))})))}(e):_error("Please select a severity level."):_error("Please provide a issue id.")})),$(document).on("click",".show-status-box",(function(){$(this).closest(".row").next().show()})),$(document).on("click",".applicant",(function(){const e=$(this).data("id");$(this).parent().parent().parent().find(".jsSelectedPill").html(`\n\t\t\t<div id="jsNewItemSelectedSeverity" data-id="${e}" class="csLabelPill jsSelectedLabelPill text-center" \n\t\t\tstyle="\n\t\t\tbackground-color: ${$(this).css("background-color")}; color: ${$(this).css("color")} ;">${$(this).text()}</div>\n\t\t`),$("#jsNewItemSeverityLevel").val(e)})),$(document).on("click",".cross",(function(){$(this).parent().parent().css("display","none")})),$(".jsReportBasicUpdateBtn").click((function(e){e.preventDefault();const a={title:$(".report_title").val().trim(),report_date:$(".report_date").val(),report_completion_date:$(".report_completion_date").val(),report_status:$(".report_status option:selected").val(),report_id:getSegment(2)};a.title?a.report_date?"completed"!=a.status||a.date?function(e){const a=$(".jsReportBasicUpdateBtn");a.prop("disabled",!0).text("Updating..."),null===t&&(t=$.ajax({url:baseUrl("compliance_safety_reporting/report/update/"+e.report_id),method:"POST",data:e}).always((function(){t=null,a.prop("disabled",!1).text("Save Changes")})).fail(handleErrorResponse).done((function(e){_success(e.message,(function(){}))})))}(a):_error("Please add a report completion date."):_error("Please add a report date."):_error("Please add a report title.")})),$(".jsDeleteIssue").click((function(e){e.preventDefault(),issueId=$(this).data("issue_id"),_confirm("Are you sure you want to delete this issue?",m)})),$(".jsViewIssuesFiles").click((function(e){e.preventDefault(),function(e){if($("#jsIssueModalCommon").length<=0){const e='\n\t\t\t<div class=modal fade" id="jsIssueModalCommon" tabindex="-1" role="dialog" aria-hidden="true">\n\t\t\t\t<div class="modal-dialog modal-lg" role="document">\n\t\t\t\t\t<div class="modal-content">\n\t\t\t\t\t\t<div class="modal-header">\n\t\t\t\t\t\t\t<h5 class="modal-title"></h5>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-body">\n\t\t\t\t\t\t\t<div class="alert alert-info text-center">Generating a view please wait.</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-footer">\n\t\t\t\t\t\t\t<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t';$("body").append(e)}$("#jsIssueModalCommon").find(".modal-title").html(e.title),0==e.count?$("#jsIssueModalCommon").find(".modal-body").html('<div class="alert alert-info text-center">No file has been attached to this issue.</div>'):($("#jsIssueModalCommon").find(".modal-body").html('<div class="alert alert-info text-center">Generating a view please wait.</div>'),null===t&&(ml(!0,"jsPageLoader"),t=$.ajax({url:baseUrl("compliance_safety_reporting/get_attached_files/"+e.reportId+"/"+e.incidentId+"/"+e.issueId),method:"GET"}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){$("#jsIssueModalCommon").find(".modal-body").html(e.view),_success(e.message)}))));$("#jsIssueModalCommon").modal({backdrop:"static",keyboard:!1}),$("#jsIssueModalCommon").modal("show")}({title:"View File(s)",reportId:$(this).data("report_id"),incidentId:$(this).data("incident_id"),issueId:$(this).data("issue_id"),count:$(this).data("files_count")})})),$(document).on("click",".jsViewFile",(function(e){e.preventDefault();const t=$(this).closest(".jsFileBox").data("id");Modal({Id:"jsFileViewModal",Loader:"jsFileViewModalLoader",Title:'<span id="jsFileViewModalTitle"></span>',Body:'<div id="jsFileViewModalBody"></body>'},(function(){$("#jsIssueModalCommon").modal("hide"),i(t)}))})),$(document).on("click",".jsDeleteFile",(function(e){e.preventDefault();const a=$(this).data("file_id"),n=$(this).data("file_type");_confirm("Are you sure you want to remove this "+n+"? It will be removed from this issue permanently as well.",(function(){!function(e,a){null===t&&(ml(!0,"jsPageLoader"),t=$.ajax({url:baseUrl("compliance_safety_reporting/delete_file/"+e),method:"DELETE"}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){_success("Removed "+a+" successfully",(function(){window.location.reload()}))})))}(a,n)}))})),$(".jsIssueUploadFileBtn").click((function(e){e.preventDefault(),a=$(this).data("report_id"),n=$(this).data("incident_id"),s=$(this).data("issue_id"),function(e){if($("#jsIssueModalCommon").length<=0){const e='\n\t\t\t<div class=modal fade" id="jsIssueModalCommon" tabindex="-1" role="dialog" aria-hidden="true">\n\t\t\t\t<div class="modal-dialog modal-lg" role="document">\n\t\t\t\t\t<div class="modal-content">\n\t\t\t\t\t\t<div class="modal-header">\n\t\t\t\t\t\t\t<h5 class="modal-title"></h5>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-body">\n\t\t\t\t\t\t\t<div class="alert alert-info text-center">Generating a view please wait.</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-footer">\n\t\t\t\t\t\t\t<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n\t\t\t\t\t\t\t<button type="button" class="btn btn-orange hidden"></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t';$("body").append(e)}$("#jsIssueModalCommon").find(".modal-title").html(e.title),$("#jsIssueModalCommon").find(".btn-orange").html(e.save.text),$("#jsIssueModalCommon").find(".btn-orange").addClass(e.save.cl),$("#jsIssueModalCommon").find(".btn-orange").addClass("hidden"),$("#jsIssueModalCommon").modal({backdrop:"static",keyboard:!1}),$("#jsIssueModalCommon").modal("show")}({title:"Attach file",save:{text:"Upload file",cl:"jsIssueSaveFileBtn"}});$("#jsIssueModalCommon").find(".modal-body").html('\n                    <div class="row">\n                        <div class="col-lg-12">\n                            <div class="form-group">\n                                <label for="jsIssueFileUploadTitle">Title <strong class="text-danger">*</strong></label>\n                                <input type="text" class="form-control" id="jsIssueFileUploadTitle" name="jsIssueFileUploadTitle" />\n                            </div>\n                        </div>\n                    </div>\n                    <div class="row">\n                        <div class="col-lg-12">\n                            <div class="form-group">\n                                <input type="file" class="hidden" id="jsIssueFileUploadFile" name="jsIssueFileUploadFile" />\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            '),l=$("#jsIssueFileUploadFile").msFileUploader(o),$("#jsIssueModalCommon").find(".jsIssueSaveFileBtn").removeClass("hidden")})),$(document).on("click",".jsIssueSaveFileBtn",(function(e){if(e.preventDefault(),null!==t)return;const l={title:$("#jsIssueFileUploadTitle").val().trim(),file:$("#jsIssueFileUploadFile").msFileUploader("get")};l.title?0!==Object.keys(l.file).length?l.hasError&&"vimeo"===l.type?_error("Vimeo link is invalid."):l.hasError&&"youtube"===l.type?_error("YouTube link is invalid."):l.file.hasError?_error("Please select a valid file."):(l.fileType="vimeo"===l.file.type||"youtube"===l.file.type?"link":d(l.file).toLowerCase(),function(e){const l=$(".jsIssueSaveFileBtn");l.prop("disabled",!0);const o=new FormData;o.append("reportId",a),o.append("incidentId",n),o.append("itemId",s),o.append("title",e.title),o.append("type",e.fileType),"youtube"===e.file.type||"vimeo"===e.file.type?o.append("link",e.file.link):o.append("file",e.file);t=$.ajax({url:baseUrl("compliance_safety_reporting/add_file_to_incident_item"),method:"POST",data:o,processData:!1,contentType:!1}).always((function(){t=null,l.prop("disabled",!1)})).fail(handleErrorResponse).done((function(e){_success("File attached successfully."),$("#jsIssueModalCommon").modal("hide")}))}(l)):_error("Please select a valid file."):_error("Please add a title of the file.")})),ml(!1,"jsPageLoader")}));