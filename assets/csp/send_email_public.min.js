$((function(){var e={".chosen-select":{}};for(var t in e)$(t).chosen(e[t]);var a=[];function i(e){var t;$("#attachment_loader").show();var i="",p="";"normal"==e?(i=$("#subject").val(),p=CKEDITOR.instances.email_message.getData()):"popup"==e&&(i=$("#send_email_subject").val(),p=CKEDITOR.instances.send_email_message.getData());var o=new FormData;if(o.append("report_id",reportId),o.append("incident_id",incidentId),o.append("subject",i),o.append("message",p),"normal"==e)"system"==$('input[name="send_type"]:checked').val()?(t=$("#receivers").val(),o.append("receivers",t),o.append("send_type","system")):(manual_email=$("#manual_address").val(),o.append("manual_email",manual_email),o.append("send_type","manual"));else if("popup"==e){"system"==$("#send_email_type").val()?(manual_email=$("#send_email_user").val(),o.append("receivers",t),o.append("send_type","system")):(t=$("#send_email_user").val(),o.append("manual_email",manual_email),o.append("send_type","manual"))}a.length&&o.append("attach_files",a),$.ajax({url:baseURL+"compliance_safety_reporting_public/send_compliance_report_email",cache:!1,contentType:!1,processData:!1,type:"post",data:o,success:function(e){$("#attachment_loader").hide(),alertify.alert("SUCCESS!","You have succesfully send an email.",(()=>{window.location.reload()}))},error:function(){}})}$(document).ready((function(){new Array;"internal"==employeeType?employeesList.length?($('input[name="send_type"][value="system"]').prop("checked",!0),$('input[name="send_type"][value="manual"]').prop("checked",!1),$("#manual_email").hide()):($('input[name="send_type"][value="system"]').prop("checked",!1),$('input[name="send_type"][value="manual"]').prop("checked",!0),$("#system_email").hide()):($("#jsEmailFilter").hide(),$('input[name="send_type"][value="system"]').prop("checked",!0),$('input[name="send_type"][value="manual"]').prop("checked",!1),$("#manual_email").hide()),$("#up_video_container input").prop("disabled",!0),$("#up_video_container").hide(),$("#up_audio_container input").prop("disabled",!0),$("#up_audio_container").hide(),$("#view_0").trigger("click"),$(".js-main-coll").on("shown.bs.collapse",(function(e){e.stopPropagation(),$(this).parent().find(".js-main-gly").removeClass("glyphicon-plus").addClass("glyphicon-minus")})).on("hidden.bs.collapse",(function(){$(this).parent().find(".js-main-gly").removeClass("glyphicon-minus").addClass("glyphicon-plus")})),$(".js-child-coll").on("shown.bs.collapse",(function(e){e.stopPropagation(),$(this).parent().find(".js-child-gly").removeClass("glyphicon-plus").addClass("glyphicon-minus")})).on("hidden.bs.collapse",(function(){$(this).parent().find(".js-child-gly").removeClass("glyphicon-minus").addClass("glyphicon-plus")})),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide()})),$(".email_type").on("click",(function(){var e=$(this).val();"system"==e?($("#system_email").show(),$("#manual_email").hide()):"manual"==e&&($("#manual_email").show(),$("#system_email").hide())})),$("#send_normal_email").on("click",(function(){var e,t=0,p="",o=$("#attachment_listing_data > .manual_upload_items"),n=0;if(o.length)n=$("#attachment_listing_data > .manual_upload_items").length;e="system"==$('input[name="send_type"]:checked').val()?$("#receivers").val():$("#manual_address").val();var _=$("#subject").val(),d=CKEDITOR.instances.email_message.getData();if(null==e&&""==_&&""==d?(p="All fields are required.",t=1):null==e&&""==_?(p="Email address and Subject are required.",t=1):null==e&&""==d?(p="Email address and Message are required.",t=1):""==_&&""==d?(p="Subject and Message body are required.",t=1):null==e?(p="Email address is required.",t=1):""==d?(p="Message body is required.",t=1):""==_&&(p="Subject is required.",t=1),n>0&&0==t)$("#attachment_loader").show(),$("#attachment_listing_data > .manual_upload_items").each((function(e){if("pending"==$(this).attr("item-status")){var t=$(this).attr("row-id"),p=$(this).attr("item-title"),o=$(this).attr("item-source"),_=baseURL+"compliance_safety_reporting_public/save_email_manual_attachment",d=new FormData;if(d.append("attachment_title",p),"youtube"==o||"vimeo"==o){var l=$(this).attr("item-data");d.append("social_url",l)}else{var c=p.replace(/ /g,""),u=$("#"+c).prop("files")[0];if(d.append("file",u),"upload_document"==o){var m=$("#"+c).val(),r=m.split(".").pop();d.append("file_name",m.replace("C:\\fakepath\\","")),d.append("file_ext",r)}}d.append("file_type",o),d.append("report_sid",reportId),d.append("incident_sid",incidentId),d.append("item_sid",itemId),$.ajax({url:_,cache:!1,contentType:!1,processData:!1,type:"post",data:d,success:function(e){var p=jQuery.parseJSON(e),o=p.item_sid,_=p.item_title,d=p.item_type,l=p.item_source;$("#"+t).html('<input type="hidden" name="attachment['+o+'][item_type]" value="'+d+'"><input type="hidden" name="attachment['+o+'][record_sid]" value="'+o+'"><td class="text-center">'+_+'</td><td class="text-center">'+d+'</td><td class="text-center">'+l+'</td><td><a href="javascript:;" item-sid="'+o+'" attachment-type="library" item-type="'+d+'" class="btn btn-block btn-info js-remove-attachment">Remove</a></td>'),$("#"+t).attr("item-status","done"),n-=1,a.push(o),0==n&&setTimeout((function(){i("normal")}),1e3)},error:function(){}})}}));else{if(1==t)return alertify.alert(p),!1;i("normal")}})),$(".show_media_library").on("click",(function(){$("#library_item_title").html("Attachment Library"),$("#attachment_library_modal").modal("show")})),$(".back_to_library").on("click",(function(){var e=$(this).attr("file-type");"youtube"==e?($("#library-youtube-iframe").remove(),$("#library-youtube-section").hide()):"vimeo"==e?($("#library-vimeo-iframe").remove(),$("#library-vimeo-section").hide()):"upload_video"==e?($("#library-upload-video").remove(),$("#library-video-section").hide()):"upload_audio"==e?($("#library-upload-audio").remove(),$("#library-audio-section").hide()):"document"==e?($("#library-document-iframe").remove(),$("#library-document-section").hide()):"image"==e&&($("#library-image").remove(),$("#library-document-section").hide()),$("#view_library_item").hide(),$("#library_item_title").html("Attachment Library"),$("#show_library_item").show()})),$(".select_lib_item").on("click",(function(){var e=$(this).attr("item-sid");if(1==$(this).prop("checked")){var t=$(this).attr("item-category"),i=$(this).attr("item-type"),p=$(this).attr("item-title");$("#email_attachment_list").show(),$("#attachment_listing_data").prepend('<tr id="lib_item_'+e+'"><input type="hidden" name="attachment['+e+'][item_type]" value="'+t+'"><input type="hidden" name="attachment['+e+'][record_sid]" value="'+e+'"><td class="text-center">'+p+'</td><td class="text-center">'+t+'</td><td class="text-center">'+i+'</td><td><a href="javascript:;" item-sid="'+e+'" attachment-type="library" item-type="'+t+'" class="btn btn-block btn-info js-remove-attachment">Remove</a></td></tr>'),a.push(e.split("_")[1])}else{$("#lib_item_"+e).remove();var o=a.indexOf(e);o>-1&&a.splice(o,1)}})),$(document).on("click",".js-remove-attachment",(function(){var e=$(this).attr("item-sid"),t=$(this).attr("attachment-type"),a=$(this).attr("item-type");"library"==t?($("#lib_item_"+e).remove(),"Document"==a?$("#doc_key_"+e).prop("checked",!1):$("#med_key_"+e).prop("checked",!1)):$("#man_item_"+e).remove()})),$(".show_manual_attachment").on("click",(function(){$("#attachment_item_title").val(""),$("#attach_social_video").val(""),$("#default_manual_select").prop("checked",!0),$("#attach_video").val(null),$("#name_attach_video").html(""),$("#attach_audio").val(null),$("#name_attach_audio").html(""),$("#attach_document").val(null),$("#name_attach_document").html(""),$("#attachment_yt_vm_video_container input").prop("disabled",!1),$("#attachment_yt_vm_video_container").show(),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide(),$("#manual_attachment_modal").modal("show")})),$(".attach_item_source").on("click",(function(){var e=$(this).val();"youtube"==e||"vimeo"==e?($("#attachment_yt_vm_video_container input").prop("disabled",!1),$("#attachment_yt_vm_video_container").show(),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide()):"upload_video"==e?($("#attachment_yt_vm_video_container input").prop("disabled",!0),$("#attachment_yt_vm_video_container").hide(),$("#attachment_video_container input").prop("disabled",!1),$("#attachment_video_container").show(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide()):"upload_audio"==e?($("#attachment_yt_vm_video_container input").prop("disabled",!0),$("#attachment_yt_vm_video_container").hide(),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!1),$("#attachment_audio_container").show(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide()):"upload_document"==e&&($("#attachment_yt_vm_video_container input").prop("disabled",!0),$("#attachment_yt_vm_video_container").hide(),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!1),$("#attachment_document_container").show())}));var p=1;$("#save_attach_item").on("click",(function(){var e,t,a,i,o,n,_=0,d=$('input[name="attach_item_source"]:checked').val();if("youtube"==d)if(""!=$("#attach_social_video").val()){$("#attach_social_video").val().match(/(?:https?:\/\/)?(?:youtu\.be\/|(?:www\.)?youtube\.com\/watch(?:\.php)?\?.*v=)([a-zA-Z0-9\-_]+)/)||(e="Not a Valid Youtube URL",_=1)}else e="Please provide a Valid Youtube URL",_=1;if("vimeo"==d)if(""!=$("#attach_social_video").val()){var l=baseURL+"compliance_safety_reporting_public/validate_vimeo";$.ajax({type:"POST",url:l,data:{url:$("#attach_social_video").val()},async:!1,success:function(t){0==t&&(e="Not a Valid Vimeo URLs",_=1)},error:function(e){}})}else e="Please provide a Valid Vimeo URL",_=1;if("upload_video"==d)if((o=$("#attach_video").val()).length>0)if($("#name_attach_video").html(o.substring(0,45)),"mp4"!=(n=(n=o.split(".").pop()).toLowerCase())&&"m4a"!=n&&"m4v"!=n&&"f4v"!=n&&"f4a"!=n&&"m4b"!=n&&"m4r"!=n&&"f4b"!=n&&"mov"!=n)$("#attach_video").val(null),$("#name_attach_video").html('<p class="red">Only (.mp4, .m4a, .m4v, .f4v, .f4a, .m4b, .m4r, .f4b, .mov) allowed!</p>'),e="Please select a valid video format.",_=1;else{var c=Number(($("#attach_video")[0].files[0].size/1024/1024).toFixed(2));Number(uploadVideoSize)<c&&($("#attach_video").val(null),$("#name_attach_video").html(""),e=errorUploadVideoSize,_=1)}else $("#name_attach_video").html('<p class="red">Please select video</p>'),e="Please select video to upload",_=1;if("upload_audio"==d)if((o=$("#attach_audio").val()).length>0)if($("#name_attach_audio").html(o.substring(0,45)),"mp3"!=(n=(n=o.split(".").pop()).toLowerCase())&&"m4a"!=n&&"mp4"!=n&&"ogg"!=n&&"flac"!=n&&"wav"!=n)$("#attach_audio").val(null),$("#name_attach_audio").html('<p class="red">Only (.mp3, .m4a, .mp4, .ogg, .flac, .wav) allowed!</p>'),e="Please select a valid audio format.",_=1;else{c=Number(($("#attach_audio")[0].files[0].size/1024/1024).toFixed(2));Number(uploadVideoSize)<c&&($("#attach_audio").val(null),$("#name_attach_audio").html(""),e=errorUploadVideoSize,_=1)}else $("#name_attach_audio").html('<p class="red">Please select audio</p>'),e="Please select audio to upload",_=1;"upload_document"==d&&((o=$("#attach_document").val()).length>0?($("#name_attach_document").html(o.substring(0,45)),i=(n=(n=o.split(".").pop()).toLowerCase()).toUpperCase(),"pdf"!=n&&"doc"!=n&&"docx"!=n&&"jpg"!=n&&"jpe"!=n&&"jpeg"!=n&&"png"!=n&&"gif"!=n&&($("#attach_document").val(null),$("#name_attach_document").html('<p class="red">Only (.pdf, .doc, .docx, .jpg, .jpe, .jpeg, .png, .gif) allowed!</p>'),e="Please select a valid document format.",_=1)):($("#name_attach_document").html('<p class="red">Please select document</p>'),e="Please select document to upload",_=1));var u=$("#attachment_item_title").val();if(""!=u&&0!=u.length||(e="Please provide a Video Title.",_=1),1==_)return alertify.alert(e),!1;new FormData;var m="";if("youtube"==d)t="Media",a="Youtube",m=$("#attach_social_video").val();else if("vimeo"==d){t="Media",a="Vimeo",m=$("#attach_social_video").val()}else if("upload_video"==d){t="Media",a="Upload Video",m=$("#attach_video").prop("files")[0];var r=u.replace(/ /g,"");$("#attach_video").clone().prop("id",r).insertAfter("div#email_attachment_files:last"),$("#"+r).hide()}else if("upload_audio"==d){t="Media",a="Upload Audio",m=$("#attach_audio").prop("files")[0];r=u.replace(/ /g,"");$("#attach_audio").clone().prop("id",r).insertAfter("div#email_attachment_files:last"),$("#"+r).hide()}else if("upload_document"==d){t="Document",a=i,m=$("#attach_document").prop("files")[0];r=u.replace(/ /g,"");$("#attach_document").clone().prop("id",r).insertAfter("div#email_attachment_files:last"),$("#"+r).hide()}$("#manual_attachment_modal").modal("hide"),$("#email_attachment_list").show(),$("#attachment_listing_data").prepend('<tr id="man_item_'+p+'" class="manual_upload_items" item-status="pending" row-id="man_item_'+p+'" item-title="'+u+'" item-source="'+d+'" item-data="'+m+'"><td class="text-center">'+u+'</td><td class="text-center">'+t+'</td><td class="text-center">'+a+'</td><td><a href="javascript:;" item-sid="'+p+'" attachment-type="manual" item-type="'+a+'" class="btn btn-block btn-info js-remove-attachment">Remove</a></td></tr>'),++p})),$(".close-current-item").on("click",(function(){var e=$(this).attr("file-type");"youtube"==e?($("#youtube-iframe").remove(),$("#youtube-container").hide()):"vimeo"==e?($("#vimeo-iframe").remove(),$("#vimeo-container").hide()):"upload_video"==e?($("#video-player").remove(),$("#video-container").hide()):"upload_audio"==e?($("#audio-player").remove(),$("#audio-container").hide()):"document"==e?($("#document-iframe").remove(),$("#document-container").hide()):"image"==e&&($("#image-tag").remove(),$("#document-container").hide())})),$(".attachment_pop_up").on("click",(function(){"library"==$(this).attr("attachment-type")?($("#pop_up_email_compose_container").hide(),$("#pop_up_attachment_library_container").show()):($("#pop_up_email_compose_container").hide(),$("#pop_up_attachment_item_title").val(""),$("#pop_up_attach_social_video").val(""),$("#default_manual_pop_up").prop("checked",!0),$("#pop_up_attach_video").val(null),$("#name_pop_up_attach_video").html(""),$("#pop_up_attach_audio").val(null),$("#name_pop_up_attach_audio").html(""),$("#pop_up_attach_document").val(null),$("#name_pop_up_attach_document").html(""),$("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!1),$("#pop_up_attachment_yt_vm_video_input_container").show(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide(),$("#pop_up_manual_attachment_container").show())})),$(".email_pop_up_back_to_library").on("click",(function(){var e=$(".email_pop_up_back_to_library").attr("item-type");"youtube"==e?($("#email-pop-up-youtube-iframe").remove(),$("#email-pop-up-youtube-container").hide()):"vimeo"==e?($("#email-pop-up-vimeo-iframe").remove(),$("#email-pop-up-vimeo-container").hide()):"upload_video"==e?($("#email-pop-up-video-player").remove(),$("#email-pop-up-video-container").hide()):"upload_audio"==e?($("#email-pop-up-audio-player").remove(),$("#email-pop-up-audio-container").hide()):"document"==e?($("#email-pop-up-document-iframe").remove(),$("#email-pop-up-document-container").hide()):"image"==e&&($("#email-pop-up-image-tag").remove(),$("#email-pop-up-document-container").hide()),$("#view_pop_up_library_item").hide(),$("#show_pop_up_library_item").show()})),$(".email_pop_up_back_to_compose_email").on("click",(function(){var e=$(this).attr("btn-from");"library"==e?($("#pop_up_attachment_library_container").hide(),$("#pop_up_email_compose_container").show()):"manual"==e?($("#pop_up_manual_attachment_container").hide(),$("#pop_up_email_compose_container").show()):($("#pop_up_attachment_library_container").hide(),$("#pop_up_manual_attachment_container").hide(),$("#pop_up_email_compose_container").show())})),$(".email_pop_up_select_lib_item").on("click",(function(){var e=$(this).attr("item-sid");if(1==$(this).prop("checked")){var t=$(this).attr("item-category"),i=$(this).attr("item-type"),p=$(this).attr("item-title");$("#pop_up_email_attachment_list").show(),$("#pop_up_attachment_listing_data").prepend('<tr id="pop_up_lib_item_'+e+'"><input type="hidden" name="attachment['+e+'][item_type]" value="'+t+'"><input type="hidden" name="attachment['+e+'][record_sid]" value="'+e+'"><td class="text-center">'+p+'</td><td class="text-center">'+t+'</td><td class="text-center">'+i+'</td><td><a href="javascript:;" item-sid="'+e+'" attachment-type="library" item-type="'+t+'" class="btn btn-block btn-info js-pop-up-remove-attachment">Remove</a></td></tr>'),a.push(e.split("_")[1])}else{$("#pop_up_lib_item_"+e).remove();var o=a.indexOf(e);o>-1&&a.splice(o,1)}})),$(document).on("click",".js-pop-up-remove-attachment",(function(){var e=$(this).attr("item-sid"),t=$(this).attr("attachment-type"),a=$(this).attr("item-type");"library"==t?($("#pop_up_lib_item_"+e).remove(),"Document"==a?$("#pop_up_doc_key_"+e).prop("checked",!1):$("#pop_up_med_key_"+e).prop("checked",!1)):$("#pop_up_man_item_"+e).remove()})),$(".pop_up_attach_item_source").on("click",(function(){var e=$(this).val();"youtube"==e||"vimeo"==e?($("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!1),$("#pop_up_attachment_yt_vm_video_input_container").show(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide()):"upload_video"==e?($("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_yt_vm_video_input_container").hide(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!1),$("#pop_up_attachment_upload_video_input_container").show(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide()):"upload_audio"==e?($("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_yt_vm_video_input_container").hide(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!1),$("#pop_up_attachment_upload_audio_input_container").show(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide()):"upload_document"==e&&($("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_yt_vm_video_input_container").hide(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!1),$("#pop_up_attachment_upload_document_input_container").show())}));var o=1;$("#pop_up_save_attach_item").on("click",(function(){var e,t,a,i,p,n,_=0,d=$('input[name="pop_up_attach_item_source"]:checked').val();if("youtube"==d)if(""!=$("#pop_up_attach_social_video").val()){$("#pop_up_attach_social_video").val().match(/(?:https?:\/\/)?(?:youtu\.be\/|(?:www\.)?youtube\.com\/watch(?:\.php)?\?.*v=)([a-zA-Z0-9\-_]+)/)||(e="Not a Valid Youtube URL",_=1)}else e="Please provide a Valid Youtube URL",_=1;if("vimeo"==d)if(""!=$("#pop_up_attach_social_video").val()){var l=baseURL+"compliance_safety_reporting_public/validate_vimeo";$.ajax({type:"POST",url:l,data:{url:$("#pop_up_attach_social_video").val()},async:!1,success:function(t){0==t&&(e="Not a Valid Vimeo URLs",_=1)},error:function(e){}})}else e="Please provide a Valid Vimeo URL",_=1;if("upload_video"==d)if((p=$("#pop_up_attach_video").val()).length>0)if($("#name_pop_up_attach_video").html(p.substring(0,45)),"mp4"!=(n=(n=p.split(".").pop()).toLowerCase())&&"m4a"!=n&&"m4v"!=n&&"f4v"!=n&&"f4a"!=n&&"m4b"!=n&&"m4r"!=n&&"f4b"!=n&&"mov"!=n)$("#pop_up_attach_video").val(null),$("#name_pop_up_attach_video").html('<p class="red">Only (.mp4, .m4a, .m4v, .f4v, .f4a, .m4b, .m4r, .f4b, .mov) allowed!</p>'),e="Please select a valid video format.",_=1;else{var c=Number(($("#pop_up_attach_video")[0].files[0].size/1024/1024).toFixed(2));Number(uploadVideoSize)<c&&($("#pop_up_attach_video").val(null),$("#name_pop_up_attach_video").html(""),e=errorUploadVideoSize,_=1)}else $("#name_pop_up_attach_video").html('<p class="red">Please select video</p>'),e="Please select video to upload",_=1;if("upload_audio"==d)if((p=$("#pop_up_attach_audio").val()).length>0)if($("#name_pop_up_attach_audio").html(p.substring(0,45)),"mp3"!=(n=(n=p.split(".").pop()).toLowerCase())&&"m4a"!=n&&"mp4"!=n&&"ogg"!=n&&"flac"!=n&&"wav"!=n)$("#pop_up_attach_audio").val(null),$("#name_pop_up_attach_audio").html('<p class="red">Only (.mp3, .m4a, .mp4, .ogg, .flac, .wav) allowed!</p>'),e="Please select a valid audio format.",_=1;else{c=Number(($("#pop_up_attach_audio")[0].files[0].size/1024/1024).toFixed(2));Number(uploadVideoSize)<c&&($("#pop_up_attach_audio").val(null),$("#name_pop_up_attach_audio").html(""),e=errorUploadVideoSize,_=1)}else $("#name_pop_up_attach_audio").html('<p class="red">Please select audio</p>'),e="Please select audio to upload",_=1;"upload_document"==d&&((p=$("#pop_up_attach_document").val()).length>0?($("#name_pop_up_attach_document").html(p.substring(0,45)),i=(n=(n=p.split(".").pop()).toLowerCase()).toUpperCase(),"pdf"!=n&&"doc"!=n&&"docx"!=n&&"jpg"!=n&&"jpe"!=n&&"jpeg"!=n&&"png"!=n&&"gif"!=n&&($("#pop_up_attach_document").val(null),$("#name_pop_up_attach_document").html('<p class="red">Only (.pdf, .doc, .docx, .jpg, .jpe, .jpeg, .png, .gif) allowed!</p>'),e="Please select a valid document format.",_=1)):($("#name_pop_up_attach_document").html('<p class="red">Please select document</p>'),e="Please select document to upload",_=1));var u=$("#pop_up_attachment_item_title").val();if(""!=u&&0!=u.length||(e="Please provide a Video Title.",_=1),1==_)return alertify.alert(e),!1;new FormData;var m="";if("youtube"==d)t="Media",a="Youtube",m=$("#pop_up_attach_social_video").val();else if("vimeo"==d){t="Media",a="Vimeo",m=$("#pop_up_attach_social_video").val()}else if("upload_video"==d){t="Media",a="Upload Video",m=$("#pop_up_attach_video").prop("files")[0];var r=u.replace(/ /g,"");$("#pop_up_attach_video").clone().prop("id",r).insertAfter("div#pop_up_email_attachment_files:last"),$("#"+r).hide()}else if("upload_audio"==d){t="Media",a="Upload Audio",m=$("#attach_audio").prop("files")[0];r=u.replace(/ /g,"");$("#pop_up_attach_audio").clone().prop("id",r).insertAfter("div#pop_up_email_attachment_files:last"),$("#"+r).hide()}else if("upload_document"==d){t="Document",a=i,m=$("#attach_document").prop("files")[0];r=u.replace(/ /g,"");$("#pop_up_attach_document").clone().prop("id",r).insertAfter("div#pop_up_email_attachment_files:last"),$("#"+r).hide()}$("#pop_up_manual_attachment_container").hide(),$("#pop_up_email_compose_container").show(),$("#pop_up_email_attachment_list").show(),$("#pop_up_attachment_listing_data").prepend('<tr id="pop_up_man_item_'+o+'" class="pop_up_manual_upload_items" item-status="pending" row-id="man_item_'+o+'" item-title="'+u+'" item-source="'+d+'" item-data="'+m+'"><td class="text-center">'+u+'</td><td class="text-center">'+t+'</td><td class="text-center">'+a+'</td><td><a href="javascript:;" item-sid="'+o+'" attachment-type="manual" item-type="'+a+'" class="btn btn-block btn-info js-pop-up-remove-attachment">Remove</a></td></tr>'),++o})),$("#send_pop_up_email").on("click",(function(){var e=0,t="",p=$("#pop_up_attachment_listing_data > .pop_up_manual_upload_items"),o=0;if(p.length)o=$("#pop_up_attachment_listing_data > .pop_up_manual_upload_items").length;var n=$("#send_email_subject").val(),_=CKEDITOR.instances.send_email_message.getData();if(""==n&&""==_?(t="All fields are required.",e=1):""==_?(t="Message body is required.",e=1):""==n&&(t="Subject is required.",e=1),o>0&&0==e)$("#send_email_modal").modal("hide"),$("#attachment_loader").show(),$("#pop_up_attachment_listing_data > .pop_up_manual_upload_items").each((function(e){if("pending"==$(this).attr("item-status")){var t=$(this).attr("row-id"),p=$(this).attr("item-title"),n=$(this).attr("item-source"),_=baseURL+"compliance_safety_reporting_public/save_email_manual_attachment",d=new FormData;if(d.append("attachment_title",p),"youtube"==n||"vimeo"==n){var l=$(this).attr("item-data");d.append("social_url",l)}else{var c=p.replace(/ /g,""),u=$("#"+c).prop("files")[0];if(d.append("file",u),"upload_document"==n){var m=$("#"+c).val(),r=m.split(".").pop();d.append("file_name",m.replace("C:\\fakepath\\","")),d.append("file_ext",r)}}d.append("file_type",n),d.append("user_type","manager"),d.append("report_sid",reportId),d.append("incident_sid",incidentId),d.append("item_sid",itemId),$.ajax({url:_,cache:!1,contentType:!1,processData:!1,type:"post",data:d,success:function(e){var p=jQuery.parseJSON(e),n=p.item_sid,_=p.item_title,d=p.item_type,l=p.item_source;$("#pop_up_"+t).html('<input type="hidden" name="attachment['+n+'][item_type]" value="'+d+'"><input type="hidden" name="attachment['+n+'][record_sid]" value="'+n+'"><td class="text-center">'+_+'</td><td class="text-center">'+d+'</td><td class="text-center">'+l+'</td><td><a href="javascript:;" item-sid="'+n+'" attachment-type="library" item-type="'+d+'" class="btn btn-block btn-info js-remove-attachment">Remove</a></td>'),$("#pop_up_"+t).attr("item-status","done"),o-=1,a.push(n),0==o&&setTimeout((function(){i("popup")}),1e3)},error:function(){}})}}));else{if(1==e)return alertify.alert(t),!1;i("popup")}}))}));