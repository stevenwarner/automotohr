$((function(){let e=$(".jsAddExternalBody .jsEER").length,t=null;const n={allowedTypes:["jpg","jpeg","png","gif","webp","rtf","pdf","doc","docx","pptx","ppt","xls","xlsx","csv","mov","mp4","webm","wav","mp3"],fileLimit:"200mb",allowLinks:!0,allowCapture:!0};function a(e){if(!e)return"Unknown";const t=e.name.toLowerCase(),n=e.type;let a="file";return n.startsWith("audio/")?a="audio":n.startsWith("video/")?a="video":n.startsWith("image/")?a="image":n.startsWith("application/")&&("application/pdf"===n||n.startsWith("application/msword")||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===n)&&(a="document"),"file"===a&&(t.match(/\.(pdf|doc|docx|txt|xls|xlsx|ppt|pptx)$/)?a="document":t.match(/\.(mp3|wav|ogg|flac|aac|m4a)$/)?a="audio":t.match(/\.(mp4|mkv|avi|mov|wmv|flv|webm)$/)&&(a="video")),a}function i(){null===t&&(ml(!0,"jsPageLoader"),t=$.ajax({url:baseUrl("compliance_safety_reporting/"+getSegment(2)+"/emails/send/incidents"),method:"POST"}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){_success(e.message)})))}$("#report_documents").msFileUploader(n),0!=e&&$(".jsAddExternalBody .jsEER").each((function(e){$(`input[name="external_employees[${e}]['name']"]`).rules("add",{required:!0,messages:{required:"Please enter the name"}}),$(`input[name="external_employees[${e}]['email']"]`).rules("add",{required:!0,email:!0,messages:{required:"Please enter the email",email:"Please enter a valid email address"}})})),$("#report_status").select2({minimumResultsForSearch:-1}),$("#report_note_type").select2({minimumResultsForSearch:-1}),$("#jsReportIncidentType").select2({minimumResultsForSearch:-1}),CKEDITOR.replace("report_note"),$("#report_date").datetimepicker({format:"m/d/Y",datepicker:!0,timepicker:!1,changeYear:!0,changeMonth:!0}),$(".start_date").datetimepicker({format:"m/d/Y",datepicker:!0,timepicker:!1,changeYear:!0,changeMonth:!0}),$("#report_completion_date").datetimepicker({format:"m/d/Y",datepicker:!0,timepicker:!1,changeYear:!0,changeMonth:!0}),$("#jsAddReportForm").validate({rules:{},messages:{},submitHandler:function(e){!function(e){null===t&&(ml(!0,"jsPageLoader"),t=$.ajax({url:baseUrl("compliance_safety_reporting/report/"+getSegment(2)+"/incident/edit/"+getSegment(5)),method:"POST",data:$(e).serializeArray()}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){_success(e.message,(function(){window.location.refresh()}))})))}(e)}}),$(".jsAddExternalEmployee").click((function(t){t.preventDefault(),$(".jsAddExternalBody .alert").remove(),function(){let t=`\n        <div class="row" data-external="${e}">\n            <div class="col-md-5">\n                <div class="form-group">\n                    <label for="external_employee_name">Name</label>\n                    <input type="text" name="external_employees_names[${e}]['name']" class="form-control" required>\n                </div>\n            </div>\n            <div class="col-md-5">\n                <div class="form-group">\n                    <label for="external_employee_email">Email</label>\n                    <input type="email" name="external_employees_emails[${e}]['email']" class="form-control" required>\n                </div>\n            </div>\n            <div class="col-md-1">\n                <div class="form-group">\n                    <label>&nbsp;</label>\n                    <button type="button" class="btn btn-red btn-block jsRemoveExternalEmployee">\n                        <i class="fa fa-trash"></i>\n                    </button>\n                </div>\n            </div>\n        </div>\n        `;e++,$(".jsAddExternalBody").append(t),$(`input[name="external_employees[${e-1}]['name']"]`).rules("add",{required:!0,messages:{required:"Please enter the name"}}),$(`input[name="external_employees[${e-1}]['email']"]`).rules("add",{required:!0,email:!0,messages:{required:"Please enter the email",email:"Please enter a valid email address"}})}()})),$(document).on("click",".jsRemoveExternalEmployee",(function(){const n=$(this).closest(".row");if(n.data("id"))return function(n){_confirm("Are you sure you want to remove this external employee? It will be removed from this report permanently as well.",(function(){!function(n){null===t&&(ml(!0,"jsPageLoader"),t=$.ajax({url:baseUrl("compliance_safety_reporting/"+getSegment(2)+"/"+getSegment(5)+"/"+n.data("id")),method:"DELETE"}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(t){_success(t.message,(function(){$(`input[name="external_employees[${n.data("external")}]['name']"]`).rules("remove"),$(`input[name="external_employees[${n.data("external")}]['email']"]`).rules("remove"),n.remove(),e--,0==e&&$(".jsAddExternalBody").html(' <div class="alert alert-info text-center">No External employees found</div>')}))})))}(n)}))}(n);alertify.confirm("Are you sure you want to remove this external employee?",(function(){$(`input[name="external_employees[${n.data("external")}]['name']"]`).rules("remove"),$(`input[name="external_employees[${n.data("external")}]['email']"]`).rules("remove"),n.remove(),e--,0==e&&$(".jsAddExternalBody").html(' <div class="alert alert-info text-center">No External employees found</div>')}))})),$(".jsAddNote").click((function(e){e.preventDefault();const n={type:$("#report_note_type").val(),content:CKEDITOR.instances.report_note.getData()};""!==n.content.trim()?function(e){null===t&&(ml(!0,"jsPageLoader"),t=$.ajax({url:baseUrl("compliance_safety_reporting/notes/"+getSegment(2)+"/"+getSegment(5)),method:"POST",data:e}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){_success(e.message,(function(){window.location.refresh()}))})))}(n):_error("Please enter a note.")})),$(".jsAddDocument").click((function(e){e.preventDefault();const n={title:$("#document_title").val(),file:$("#report_documents").msFileUploader("get")};if(""===n.title.trim())return void _error("Please enter a file title.");if(!n.file)return void _error("Please select a file.");if(0===Object.keys(n.file).length)return void _error("Please select a file.");if(n.file.hasError&&"vimeo"===n.file.type)return void _error("Vimeo link is invalid.");if(n.file.hasError&&"youtube"===n.file.type)return void _error("YouTube link is invalid.");if(n.file.hasError)return void _error(n.file.errorCode);let i="vimeo"===n.file.type||"youtube"===n.file.type?"link":a(n.file).toLowerCase();!async function(e,n,a){if(null===t){ml(!0,"jsPageLoader");const i=new FormData;i.append("title",n),i.append("type",a),"youtube"===e.type||"vimeo"===e.type?i.append("link",e.link):i.append("file",e),t=$.ajax({url:baseUrl("compliance_safety_reporting/file/"+getSegment(2)+"/"+getSegment(5)+"/"+a),method:"POST",async:!0,cache:!1,contentType:!1,processData:!1,data:i}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){_success(e.message,(function(){$("#document_title").val(""),$("#report_documents").msFileUploader("clear"),"link"===a||"audio"===a||"video"===a?0!=$(".jsAudioArea").find(".jsFirst").length?$(".jsAudioArea").find(".jsFirst").append(e.view):$(".jsAudioArea").html(`<div class="row jsFirst">${e.view}</div>`):0!=$(".jsDocumentsArea").find(".jsFirst").length?$(".jsDocumentsArea").find(".jsFirst").append(e.view):$(".jsDocumentsArea").html(`<div class="row jsFirst">${e.view}</div>`)}))}))}}(n.file,n.title,i)})),$(document).on("click",".jsViewFile",(function(e){e.preventDefault();const n=$(this).closest(".jsFileBox").data("id");Modal({Id:"jsFileViewModal",Loader:"jsFileViewModalLoader",Title:'<span id="jsFileViewModalTitle"></span>',Body:'<div id="jsFileViewModalBody"></body>'},(function(){!function(e){$.ajax({url:baseUrl("compliance_safety_reporting/file/view/"+e),method:"GET"}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){$("#jsFileViewModalBody").html(e.view),$("#jsFileViewModalTitle").html(e.data.title),ml(!1,"jsFileViewModalLoader")}))}(n)}))})),$(document).on("click",".jsCSPItemAttachmentBtn",(function(e){e.preventDefault();const a=$(this).data("item_id"),i=$(this).data("report_id"),l=$(this).data("incident_id");Modal({Id:"FileAttachModal",Loader:"jsFileAttachModalLoader",Title:"<span>Upload Item Attachment</span>",Body:'<div id="jsFileAttachModalBody"></div>'},(function(){!function(e,a,i){$.ajax({url:baseUrl("compliance_safety_reporting/get_item_attachment_view"),method:"GET"}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(t){$("#jsFileAttachModalBody").html(t.view),$("#jsItemId").val(e),$("#jsReportId").val(a),$("#jsIncidentId").val(i),$("#jsItemDocuments").msFileUploader(n),ml(!1,"jsFileAttachModalLoader")}))}(a,i,l)}))})),$(document).on("click",".jsAddItemDocument",(function(e){e.preventDefault();const n={title:$("#jsItemDocumentTitle").val(),file:$("#jsItemDocuments").msFileUploader("get")};if(""===n.title.trim())return void _error("Please enter a file title.");if(!n.file)return void _error("Please select a file.");if(0===Object.keys(n.file).length)return void _error("Please select a file.");if(n.file.hasError&&"vimeo"===n.file.type)return void _error("Vimeo link is invalid.");if(n.file.hasError&&"youtube"===n.file.type)return void _error("YouTube link is invalid.");if(n.file.hasError)return void _error(n.file.errorCode);let i="vimeo"===n.file.type||"youtube"===n.file.type?"link":a(n.file).toLowerCase();!async function(e,n,a){if(null===t){ml(!0,"jsPageLoader");var i=$("#jsItemId").val(),l=$("#jsReportId").val(),o=$("#jsIncidentId").val();const r=new FormData;r.append("title",n),r.append("type",a),r.append("itemId",i),r.append("reportId",l),r.append("incidentId",o),"youtube"===e.type||"vimeo"===e.type?r.append("link",e.link):r.append("file",e),t=$.ajax({url:baseUrl("compliance_safety_reporting/add_file_to_incident_item"),method:"POST",async:!0,cache:!1,contentType:!1,processData:!1,data:r}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){alertify.alert("You have successfully upload the file",(function(){window.location.refresh()}))}))}}(n.file,n.title,i)})),$(".jsUpdateItems").click((function(e){e.preventDefault();let n=[];$(".jsIncidentType:checked").length>0&&$(".jsIncidentType:checked").map((function(){let e=$(this).closest(".jsIncidentItemRow").find('[name="dynamicInput[]"]').map((function(){return $(this).val()})).get(),a=$(this).closest(".jsIncidentItemRow").find('[name="dynamicCheckbox[]"]').map((function(){return $(this).prop("checked")?"on":"off"})).get();const i={id:$(this).val(),status:$(this).prop("checked")?"active":"inactive",level:$(this).closest(".jsIncidentItemRow").find(".jsIncidentSeverityLevel").val(),dynamicInput:e,dynamicCheckbox:a};n.push($(this).val()),function(e){t=$.ajax({url:baseUrl("compliance_safety_reporting/report/"+getSegment(2)+"/incident/"+getSegment(5)+"/items"),method:"POST",data:e}).always((function(){t=null})).fail(handleErrorResponse).done((function(e){}))}(i)})),function(e){ml(!0,"jsPageLoader"),t=$.ajax({url:baseUrl("compliance_safety_reporting/report/"+getSegment(2)+"/incident/"+getSegment(5)+"/items/all"),method:"POST",data:{ids:e}}).always((function(){t=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){alertify.alert("You have successfully updated the checklist.",(function(){window.location.refresh()}))}))}(n)})),$(".jsCSPItemListingBtn").click((function(e){e.preventDefault();let n=[];$(".jsCSPItemListingRow").length>0&&($(".jsCSPItemListingRow").map((function(){let e=$(this).find('[name="dynamicInput[]"]').map((function(){return $(this).val()})).get(),a=$(this).find('[name="dynamicCheckbox[]"]').map((function(){return $(this).prop("checked")?"on":"off"})).get();const i={id:$(this).data("id"),dynamicInput:e,dynamicCheckbox:a};n.push($(this).val()),function(e){t=$.ajax({url:baseUrl("compliance_safety_reporting/report/"+getSegment(2)+"/incident/"+getSegment(5)+"/items/employees"),method:"POST",data:e}).always((function(){t=null})).fail(handleErrorResponse).done((function(e){}))}(i)})),alertify.alert("You have successfully updated the checklist",(function(){window.location.refresh()})),ml(!1,"jsPageLoader"))})),$(".jsDescriptionBody").length&&(descriptionFieldsObj&&descriptionFieldsObj.dynamicInput&&descriptionFieldsObj.dynamicInput.map((function(e,t){$('[name="dynamicInput[]"]').eq(t).val(e)})),descriptionFieldsObj&&descriptionFieldsObj.dynamicCheckbox&&descriptionFieldsObj.dynamicCheckbox.map((function(e,t){$('[name="dynamicCheckbox[]"]').eq(t).prop("checked","on"===e)}))),$(".show-status-box").click((function(){$(this).closest(".row").next().show()})),$(".applicant").hover((function(){$(this).find(".jsSeverityLevelText").animate({"padding-top":0,"padding-right":0,"padding-bottom":0,"padding-left":15},"fast")}),(function(){$(this).find(".jsSeverityLevelText").animate({"padding-top":0,"padding-right":0,"padding-bottom":0,"padding-left":5},"fast")})),$(".applicant").click((function(){const e=$(this).data("id");$(this).parent().parent().parent().find(".jsSelectedPill").html(`\n\t\t\t<div data-id="${e}" class="csLabelPill jsSelectedLabelPill text-center" \n\t\t\tstyle="\n\t\t\tbackground-color: ${$(this).css("background-color")}; color: ${$(this).css("color")} ;">${$(this).text()}</div>\n\t\t`),$(this).parent().parent().parent().parent().find(".jsIncidentSeverityLevel").val(e)})),$(".cross").click((function(){$(this).parent().parent().css("display","none")})),$(".jsSendReminderEmails").click((function(e){e.preventDefault(),_confirm("Are you sure you want to send emails to the selected employees and external recipients?",i)})),ml(!1,"jsPageLoader")}));