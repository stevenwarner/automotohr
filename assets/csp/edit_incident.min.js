$(function(){function e(){let e=`\n        <div class="row" data-external="${f}">\n            <div class="col-md-5">\n                <div class="form-group">\n                    <label for="external_employee_name">Name</label>\n                    <input type="text" name="external_employees_names[${f}]['name']" class="form-control" required>\n                </div>\n            </div>\n            <div class="col-md-5">\n                <div class="form-group">\n                    <label for="external_employee_email">Email</label>\n                    <input type="email" name="external_employees_emails[${f}]['email']" class="form-control" required>\n                </div>\n            </div>\n            <div class="col-md-1">\n                <div class="form-group">\n                    <label>&nbsp;</label>\n                    <button type="button" class="btn btn-red btn-block jsRemoveExternalEmployee">\n                        <i class="fa fa-trash"></i>\n                    </button>\n                </div>\n            </div>\n        </div>\n        `;return f++,$(".jsAddExternalBody").append(e),$(`input[name="external_employees[${f-1}]['name']"]`).rules("add",{required:!0,messages:{required:"Please enter the name"}}),$(`input[name="external_employees[${f-1}]['email']"]`).rules("add",{required:!0,email:!0,messages:{required:"Please enter the email",email:"Please enter a valid email address"}}),e}function t(e){_confirm("Are you sure you want to remove this external employee? It will be removed from this report permanently as well.",function(){c(e)})}function n(e){null===h&&(ml(!0,"jsPageLoader"),h=$.ajax({url:baseUrl("compliance_safety_reporting/report/"+getSegment(2)+"/incident/edit/"+getSegment(5)),method:"POST",data:$(e).serializeArray()}).always(function(){h=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){_success(e.message,function(){window.location.refresh()})}))}function a(e){h=$.ajax({url:baseUrl("compliance_safety_reporting/report/"+getSegment(2)+"/incident/"+getSegment(5)+"/items"),method:"POST",data:e}).always(function(){h=null}).fail(handleErrorResponse).done(function(e){})}function i(e){h=$.ajax({url:baseUrl("compliance_safety_reporting/report/"+getSegment(2)+"/incident/"+getSegment(5)+"/items/employees"),method:"POST",data:e}).always(function(){h=null}).fail(handleErrorResponse).done(function(e){})}function l(e){ml(!0,"jsPageLoader"),h=$.ajax({url:baseUrl("compliance_safety_reporting/report/"+getSegment(2)+"/incident/"+getSegment(5)+"/items/all"),method:"POST",data:{ids:e}}).always(function(){h=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){alertify.alert("You have successfully updated the checklist 11",function(){console.log("here I am"),window.location.refresh()})})}function o(e){null===h&&(ml(!0,"jsPageLoader"),h=$.ajax({url:baseUrl("compliance_safety_reporting/notes/"+getSegment(2)+"/"+getSegment(5)),method:"POST",data:e}).always(function(){h=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){_success(e.message,function(){window.location.refresh()})}))}function r(e){$.ajax({url:baseUrl("compliance_safety_reporting/file/view/"+e),method:"GET"}).always(function(){h=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){$("#jsFileViewModalBody").html(e.view),$("#jsFileViewModalTitle").html(e.data.title),ml(!1,"jsFileViewModalLoader")})}function s(e,t,n){$.ajax({url:baseUrl("compliance_safety_reporting/get_item_attachment_view"),method:"GET"}).always(function(){h=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(a){$("#jsFileAttachModalBody").html(a.view),$("#jsItemId").val(e),$("#jsReportId").val(t),$("#jsIncidentId").val(n),$("#jsItemDocuments").msFileUploader(y.document),ml(!1,"jsFileAttachModalLoader")})}async function d(e,t,n){if(null===h){ml(!0,"jsPageLoader");var a=$("#jsItemId").val(),i=$("#jsReportId").val(),l=$("#jsIncidentId").val();const o=new FormData;o.append("title",t),o.append("type",n),o.append("itemId",a),o.append("reportId",i),o.append("incidentId",l),"youtube"===e.type||"vimeo"===e.type?o.append("link",e.link):o.append("file",e),h=$.ajax({url:baseUrl("compliance_safety_reporting/add_file_to_incident_item"),method:"POST",async:!0,cache:!1,contentType:!1,processData:!1,data:o}).always(function(){h=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){alertify.alert("You have successfully upload the file",function(){window.location.refresh()})})}}function c(e){null===h&&(ml(!0,"jsPageLoader"),h=$.ajax({url:baseUrl("compliance_safety_reporting/"+getSegment(2)+"/"+getSegment(5)+"/"+e.data("id")),method:"DELETE"}).always(function(){h=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(t){_success(t.message,function(){$(`input[name="external_employees[${e.data("external")}]['name']"]`).rules("remove"),$(`input[name="external_employees[${e.data("external")}]['email']"]`).rules("remove"),e.remove(),f--,0==f&&$(".jsAddExternalBody").html(' <div class="alert alert-info text-center">No External employees found</div>')})}))}async function m(e,t,n){if(null===h){ml(!0,"jsPageLoader");const a=new FormData;a.append("title",t),a.append("type",n),"youtube"===e.type||"vimeo"===e.type?a.append("link",e.link):a.append("file",e),h=$.ajax({url:baseUrl("compliance_safety_reporting/file/"+getSegment(2)+"/"+getSegment(5)+"/"+n),method:"POST",async:!0,cache:!1,contentType:!1,processData:!1,data:a}).always(function(){h=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){_success(e.message,function(){$("#document_title").val(""),$("#report_documents").msFileUploader("clear"),"link"===n||"audio"===n||"video"===n?0!=$(".jsAudioArea").find(".jsFirst").length?$(".jsAudioArea").find(".jsFirst").append(e.view):$(".jsAudioArea").html(`<div class="row jsFirst">${e.view}</div>`):0!=$(".jsDocumentsArea").find(".jsFirst").length?$(".jsDocumentsArea").find(".jsFirst").append(e.view):$(".jsDocumentsArea").html(`<div class="row jsFirst">${e.view}</div>`)})})}}function p(e){if(!e)return"Unknown";const t=e.name.toLowerCase(),n=e.type;let a="file";return n.startsWith("audio/")?a="audio":n.startsWith("video/")?a="video":n.startsWith("image/")?a="image":n.startsWith("application/")&&("application/pdf"===n||n.startsWith("application/msword")||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===n)&&(a="document"),"file"===a&&(t.match(/\.(pdf|doc|docx|txt|xls|xlsx|ppt|pptx)$/)?a="document":t.match(/\.(mp3|wav|ogg|flac|aac|m4a)$/)?a="audio":t.match(/\.(mp4|mkv|avi|mov|wmv|flv|webm)$/)&&(a="video")),a}function u(){null===h&&(ml(!0,"jsPageLoader"),h=$.ajax({url:baseUrl("compliance_safety_reporting/"+getSegment(2)+"/emails/send/incidents"),method:"POST"}).always(function(){h=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){_success(e.message)}))}let f=$(".jsAddExternalBody .jsEER").length,h=null;const y={document:{allowedTypes:["jpg","jpeg","png","gif","webp","rtf","pdf","doc","docx","pptx","ppt","xls","xlsx","csv","mov","mp4","webm","wav","mp3"],fileLimit:"200mb",allowLinks:!0}};$("#report_documents").msFileUploader(y.document),0!=f&&$(".jsAddExternalBody .jsEER").each(function(e){$(`input[name="external_employees[${e}]['name']"]`).rules("add",{required:!0,messages:{required:"Please enter the name"}}),$(`input[name="external_employees[${e}]['email']"]`).rules("add",{required:!0,email:!0,messages:{required:"Please enter the email",email:"Please enter a valid email address"}})}),$("#report_status").select2({minimumResultsForSearch:-1}),$("#report_note_type").select2({minimumResultsForSearch:-1}),$("#jsReportIncidentType").select2({minimumResultsForSearch:-1}),CKEDITOR.replace("report_note"),$("#report_date").datetimepicker({format:"m/d/Y",datepicker:!0,timepicker:!1,changeYear:!0,changeMonth:!0}),$(".start_date").datetimepicker({format:"m/d/Y",datepicker:!0,timepicker:!1,changeYear:!0,changeMonth:!0}),$("#report_completion_date").datetimepicker({format:"m/d/Y",datepicker:!0,timepicker:!1,changeYear:!0,changeMonth:!0}),$("#jsAddReportForm").validate({rules:{},messages:{},submitHandler:function(e){n(e)}}),$(".jsAddExternalEmployee").click(function(t){t.preventDefault(),$(".jsAddExternalBody .alert").remove(),e()}),$(document).on("click",".jsRemoveExternalEmployee",function(){const e=$(this).closest(".row");if(e.data("id"))return t(e);alertify.confirm("Are you sure you want to remove this external employee?",function(){$(`input[name="external_employees[${e.data("external")}]['name']"]`).rules("remove"),$(`input[name="external_employees[${e.data("external")}]['email']"]`).rules("remove"),e.remove(),f--,0==f&&$(".jsAddExternalBody").html(' <div class="alert alert-info text-center">No External employees found</div>')})}),$(".jsAddNote").click(function(e){e.preventDefault();const t={type:$("#report_note_type").val(),content:CKEDITOR.instances.report_note.getData()};""!==t.content.trim()?o(t):_error("Please enter a note.")}),$(".jsAddDocument").click(function(e){e.preventDefault();const t={title:$("#document_title").val(),file:$("#report_documents").msFileUploader("get")};if(""===t.title.trim())return void _error("Please enter a file title.");if(!t.file)return void _error("Please select a file.");if(0===Object.keys(t.file).length)return void _error("Please select a file.");if(t.file.hasError&&"vimeo"===t.file.type)return void _error("Vimeo link is invalid.");if(t.file.hasError&&"youtube"===t.file.type)return void _error("YouTube link is invalid.");if(t.file.hasError)return void _error(t.file.errorCode);let n="vimeo"===t.file.type||"youtube"===t.file.type?"link":p(t.file).toLowerCase();m(t.file,t.title,n)}),$(document).on("click",".jsViewFile",function(e){e.preventDefault();const t=$(this).closest(".jsFileBox").data("id");Modal({Id:"jsFileViewModal",Loader:"jsFileViewModalLoader",Title:'<span id="jsFileViewModalTitle"></span>',Body:'<div id="jsFileViewModalBody"></body>'},function(){r(t)})}),$(document).on("click",".jsCSPItemAttachmentBtn",function(e){e.preventDefault();const t=$(this).data("item_id"),n=$(this).data("report_id"),a=$(this).data("incident_id");Modal({Id:"FileAttachModal",Loader:"jsFileAttachModalLoader",Title:"<span>Upload Item Attachment</span>",Body:'<div id="jsFileAttachModalBody"></body>'},function(){s(t,n,a)})}),$(document).on("click",".jsAddItemDocument",function(e){e.preventDefault();const t={title:$("#jsItemDocumentTitle").val(),file:$("#jsItemDocuments").msFileUploader("get")};if(""===t.title.trim())return void _error("Please enter a file title.");if(!t.file)return void _error("Please select a file.");if(0===Object.keys(t.file).length)return void _error("Please select a file.");if(t.file.hasError&&"vimeo"===t.file.type)return void _error("Vimeo link is invalid.");if(t.file.hasError&&"youtube"===t.file.type)return void _error("YouTube link is invalid.");if(t.file.hasError)return void _error(t.file.errorCode);let n="vimeo"===t.file.type||"youtube"===t.file.type?"link":p(t.file).toLowerCase();d(t.file,t.title,n)}),$(".jsUpdateItems").click(function(e){e.preventDefault();let t=[];$(".jsIncidentType:checked").length>0&&$(".jsIncidentType:checked").map(function(){let e=$(this).closest(".jsIncidentItemRow").find('[name="dynamicInput[]"]').map(function(){return $(this).val()}).get(),n=$(this).closest(".jsIncidentItemRow").find('[name="dynamicCheckbox[]"]').map(function(){return $(this).prop("checked")?"on":"off"}).get();const i={id:$(this).val(),status:$(this).prop("checked")?"active":"inactive",level:$(this).closest(".jsIncidentItemRow").find(".jsIncidentSeverityLevel").val(),dynamicInput:e,dynamicCheckbox:n};t.push($(this).val()),a(i)}),l(t)}),$(".jsCSPItemListingBtn").click(function(e){e.preventDefault();let t=[];$(".jsCSPItemListingRow").length>0&&($(".jsCSPItemListingRow").map(function(){let e=$(this).find('[name="dynamicInput[]"]').map(function(){return $(this).val()}).get(),n=$(this).find('[name="dynamicCheckbox[]"]').map(function(){return $(this).prop("checked")?"on":"off"}).get();const a={id:$(this).data("id"),dynamicInput:e,dynamicCheckbox:n};t.push($(this).val()),i(a)}),alertify.alert("You have successfully updated the checklist",function(){window.location.refresh()}),ml(!1,"jsPageLoader"))}),$(".jsDescriptionBody").length&&(descriptionFieldsObj&&descriptionFieldsObj.dynamicInput&&descriptionFieldsObj.dynamicInput.map(function(e,t){$('[name="dynamicInput[]"]').eq(t).val(e)}),descriptionFieldsObj&&descriptionFieldsObj.dynamicCheckbox&&descriptionFieldsObj.dynamicCheckbox.map(function(e,t){$('[name="dynamicCheckbox[]"]').eq(t).prop("checked","on"===e)})),$(".show-status-box").click(function(){$(this).closest(".row").next().show()}),$(".applicant").hover(function(){$(this).find(".jsSeverityLevelText").animate({"padding-top":0,"padding-right":0,"padding-bottom":0,"padding-left":15},"fast")},function(){$(this).find(".jsSeverityLevelText").animate({"padding-top":0,"padding-right":0,"padding-bottom":0,"padding-left":5},"fast")}),$(".applicant").click(function(){const e=$(this).data("id");$(this).parent().parent().parent().find(".jsSelectedPill").html(`\n\t\t\t<div data-id="${e}" class="csLabelPill jsSelectedLabelPill text-center" \n\t\t\tstyle="\n\t\t\tbackground-color: ${$(this).css("background-color")}; color: ${$(this).css("color")} ;">${$(this).text()}</div>\n\t\t`),$(this).parent().parent().parent().parent().find(".jsIncidentSeverityLevel").val(e)}),$(".cross").click(function(){$(this).parent().parent().css("display","none")}),$(".jsSendReminderEmails").click(function(e){e.preventDefault(),_confirm("Are you sure you want to send emails to the selected employees and external recipients?",u)}),ml(!1,"jsPageLoader")});