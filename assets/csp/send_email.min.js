$(function(){function t(t){var e;$("#attachment_loader").show();var a="",i="";"normal"==t?(a=$("#subject").val(),i=CKEDITOR.instances.email_message.getData()):"popup"==t&&(a=$("#send_email_subject").val(),i=CKEDITOR.instances.send_email_message.getData());var o=new FormData;if(o.append("report_id",reportId),o.append("incident_id",incidentId),o.append("item_id",itemId),o.append("subject",a),o.append("message",i),"normal"==t)"system"==$('input[name="send_type"]:checked').val()?(e=$("#receivers").val(),o.append("receivers",e),o.append("send_type","system")):(manual_email=$("#manual_address").val(),o.append("manual_email",manual_email),o.append("send_type","manual"));else if("popup"==t){var n=$("#send_email_type").val();"system"==n?(manual_email=$("#send_email_user").val(),o.append("receivers",e),o.append("send_type","system")):(e=$("#send_email_user").val(),o.append("manual_email",manual_email),o.append("send_type","manual"))}p.length&&o.append("attach_files",p),$.ajax({url:baseURL+"compliance_safety_reporting/send_compliance_report_email",cache:!1,contentType:!1,processData:!1,type:"post",data:o,success:function(t){$("#attachment_loader").hide(),alertify.alert("SUCCESS!","You have succesfully send an email.",()=>{window.location.reload()})},error:function(){}})}function e(){$("#pop_up_attachment_item_title").val(""),$("#pop_up_attach_social_video").val(""),$("#default_manual_pop_up").prop("checked",!0),$("#pop_up_attach_video").val(null),$("#name_pop_up_attach_video").html(""),$("#pop_up_attach_audio").val(null),$("#name_pop_up_attach_audio").html(""),$("#pop_up_attach_document").val(null),$("#name_pop_up_attach_document").html(""),$("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!1),$("#pop_up_attachment_yt_vm_video_input_container").show(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide()}var a={".chosen-select":{}};for(var i in a)$(i).chosen(a[i]);var p=[];$(document).ready(function(){new Array;employeesList.length?($('input[name="send_type"][value="system"]').prop("checked",!0),$('input[name="send_type"][value="manual"]').prop("checked",!1),$("#manual_email").hide()):($('input[name="send_type"][value="system"]').prop("checked",!1),$('input[name="send_type"][value="manual"]').prop("checked",!0),$("#system_email").hide()),$("#up_video_container input").prop("disabled",!0),$("#up_video_container").hide(),$("#up_audio_container input").prop("disabled",!0),$("#up_audio_container").hide(),$("#view_0").trigger("click"),$(".js-main-coll").on("shown.bs.collapse",function(t){t.stopPropagation(),$(this).parent().find(".js-main-gly").removeClass("glyphicon-plus").addClass("glyphicon-minus")}).on("hidden.bs.collapse",function(){$(this).parent().find(".js-main-gly").removeClass("glyphicon-minus").addClass("glyphicon-plus")}),$(".js-child-coll").on("shown.bs.collapse",function(t){t.stopPropagation(),$(this).parent().find(".js-child-gly").removeClass("glyphicon-plus").addClass("glyphicon-minus")}).on("hidden.bs.collapse",function(){$(this).parent().find(".js-child-gly").removeClass("glyphicon-minus").addClass("glyphicon-plus")}),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide()}),$(".email_type").on("click",function(){var t=$(this).val();"system"==t?($("#system_email").show(),$("#manual_email").hide()):"manual"==t&&($("#manual_email").show(),$("#system_email").hide())}),$("#send_normal_email").on("click",function(){var e,a=0,i="",o=$("#attachment_listing_data > .manual_upload_items"),n=0;if(o.length)n=$("#attachment_listing_data > .manual_upload_items").length;e="system"==$('input[name="send_type"]:checked').val()?$("#receivers").val():$("#manual_address").val();var _=$("#subject").val(),d=CKEDITOR.instances.email_message.getData();if(null==e&&""==_&&""==d?(i="All fields are required.",a=1):null==e&&""==_?(i="Email address and Subject are required.",a=1):null==e&&""==d?(i="Email address and Message are required.",a=1):""==_&&""==d?(i="Subject and Message body are required.",a=1):null==e?(i="Email address is required.",a=1):""==d?(i="Message body is required.",a=1):""==_&&(i="Subject is required.",a=1),n>0&&0==a)$("#attachment_loader").show(),$("#attachment_listing_data > .manual_upload_items").each(function(e){var a=$(this).attr("item-status");if("pending"==a){var i=$(this).attr("row-id"),o=$(this).attr("item-title"),_=$(this).attr("item-source"),d=baseURL+"compliance_safety_reporting/save_email_manual_attachment",c=new FormData;if(c.append("attachment_title",o),"youtube"==_||"vimeo"==_){var l=$(this).attr("item-data");c.append("social_url",l)}else{var u=o.replace(/ /g,""),m=$("#"+u).prop("files")[0];if(c.append("file",m),"upload_document"==_){var r=$("#"+u).val(),s=r.split(".").pop();c.append("file_name",r.replace("C:\\fakepath\\","")),c.append("file_ext",s)}}c.append("file_type",_),c.append("user_type","manager"),c.append("report_sid",reportId),c.append("incident_sid",incidentId),c.append("item_sid",itemId),c.append("company_sid",companyId),c.append("uploaded_by",employeeId),$.ajax({url:d,cache:!1,contentType:!1,processData:!1,type:"post",data:c,success:function(e){var a=jQuery.parseJSON(e),o=a.item_sid,_=a.item_title,d=a.item_type,c=a.item_source;$("#"+i).html('<input type="hidden" name="attachment['+o+'][item_type]" value="'+d+'"><input type="hidden" name="attachment['+o+'][record_sid]" value="'+o+'"><td class="text-center">'+_+'</td><td class="text-center">'+d+'</td><td class="text-center">'+c+'</td><td><a href="javascript:;" item-sid="'+o+'" attachment-type="library" item-type="'+d+'" class="btn btn-block btn-info js-remove-attachment">Remove</a></td>'),$("#"+i).attr("item-status","done"),n-=1,p.push(o),0==n&&setTimeout(function(){t("normal")},1e3)},error:function(){}})}});else{if(1==a)return alertify.alert(i),!1;t("normal")}}),$(".show_media_library").on("click",function(){$("#library_item_title").html("Attachment Library"),$("#attachment_library_modal").modal("show")}),$(".back_to_library").on("click",function(){var t=$(this).attr("file-type");"youtube"==t?($("#library-youtube-iframe").remove(),$("#library-youtube-section").hide()):"vimeo"==t?($("#library-vimeo-iframe").remove(),$("#library-vimeo-section").hide()):"upload_video"==t?($("#library-upload-video").remove(),$("#library-video-section").hide()):"upload_audio"==t?($("#library-upload-audio").remove(),$("#library-audio-section").hide()):"document"==t?($("#library-document-iframe").remove(),$("#library-document-section").hide()):"image"==t&&($("#library-image").remove(),$("#library-document-section").hide()),$("#view_library_item").hide(),$("#library_item_title").html("Attachment Library"),$("#show_library_item").show()}),$(".select_lib_item").on("click",function(){var t=$(this).attr("item-sid");if(1==$(this).prop("checked")){var e=$(this).attr("item-category"),a=$(this).attr("item-type"),i=$(this).attr("item-title");$("#email_attachment_list").show(),$("#attachment_listing_data").prepend('<tr id="lib_item_'+t+'"><input type="hidden" name="attachment['+t+'][item_type]" value="'+e+'"><input type="hidden" name="attachment['+t+'][record_sid]" value="'+t+'"><td class="text-center">'+i+'</td><td class="text-center">'+e+'</td><td class="text-center">'+a+'</td><td><a href="javascript:;" item-sid="'+t+'" attachment-type="library" item-type="'+e+'" class="btn btn-block btn-info js-remove-attachment">Remove</a></td></tr>'),p.push(t.split("_")[1])}else{$("#lib_item_"+t).remove();var o=p.indexOf(t);o>-1&&p.splice(o,1)}}),$(document).on("click",".js-remove-attachment",function(){var t=$(this).attr("item-sid"),e=$(this).attr("attachment-type"),a=$(this).attr("item-type");"library"==e?($("#lib_item_"+t).remove(),"Document"==a?$("#doc_key_"+t).prop("checked",!1):$("#med_key_"+t).prop("checked",!1)):$("#man_item_"+t).remove()}),$(".show_manual_attachment").on("click",function(){$("#attachment_item_title").val(""),$("#attach_social_video").val(""),$("#default_manual_select").prop("checked",!0),$("#attach_video").val(null),$("#name_attach_video").html(""),$("#attach_audio").val(null),$("#name_attach_audio").html(""),$("#attach_document").val(null),$("#name_attach_document").html(""),$("#attachment_yt_vm_video_container input").prop("disabled",!1),$("#attachment_yt_vm_video_container").show(),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide(),$("#manual_attachment_modal").modal("show")}),$(".attach_item_source").on("click",function(){var t=$(this).val();"youtube"==t?($("#attachment_yt_vm_video_container input").prop("disabled",!1),$("#attachment_yt_vm_video_container").show(),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide()):"vimeo"==t?($("#attachment_yt_vm_video_container input").prop("disabled",!1),$("#attachment_yt_vm_video_container").show(),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide()):"upload_video"==t?($("#attachment_yt_vm_video_container input").prop("disabled",!0),$("#attachment_yt_vm_video_container").hide(),$("#attachment_video_container input").prop("disabled",!1),$("#attachment_video_container").show(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide()):"upload_audio"==t?($("#attachment_yt_vm_video_container input").prop("disabled",!0),$("#attachment_yt_vm_video_container").hide(),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!1),$("#attachment_audio_container").show(),$("#attachment_document_container input").prop("disabled",!0),$("#attachment_document_container").hide()):"upload_document"==t&&($("#attachment_yt_vm_video_container input").prop("disabled",!0),$("#attachment_yt_vm_video_container").hide(),$("#attachment_video_container input").prop("disabled",!0),$("#attachment_video_container").hide(),$("#attachment_audio_container input").prop("disabled",!0),$("#attachment_audio_container").hide(),$("#attachment_document_container input").prop("disabled",!1),$("#attachment_document_container").show())});var o=1;$("#save_attach_item").on("click",function(){var t,e,a,i,p=0,n=$('input[name="attach_item_source"]:checked').val();if("youtube"==n)if(""!=$("#attach_social_video").val()){var _=/(?:https?:\/\/)?(?:youtu\.be\/|(?:www\.)?youtube\.com\/watch(?:\.php)?\?.*v=)([a-zA-Z0-9\-_]+)/;$("#attach_social_video").val().match(_)||(t="Not a Valid Youtube URL",p=1)}else t="Please provide a Valid Youtube URL",p=1;if("vimeo"==n)if(""!=$("#attach_social_video").val()){var d=baseURL+"compliance_safety_reporting/validate_vimeo";$.ajax({type:"POST",url:d,data:{url:$("#attach_social_video").val()},async:!1,success:function(e){0==e&&(t="Not a Valid Vimeo URLs",p=1)},error:function(t){}})}else t="Please provide a Valid Vimeo URL",p=1;if("upload_video"==n){var c=$("#attach_video").val();if(c.length>0){$("#name_attach_video").html(c.substring(0,45));var l=c.split(".").pop();l=l.toLowerCase();if("mp4"!=l&&"m4a"!=l&&"m4v"!=l&&"f4v"!=l&&"f4a"!=l&&"m4b"!=l&&"m4r"!=l&&"f4b"!=l&&"mov"!=l)$("#attach_video").val(null),$("#name_attach_video").html('<p class="red">Only (.mp4, .m4a, .m4v, .f4v, .f4a, .m4b, .m4r, .f4b, .mov) allowed!</p>'),t="Please select a valid video format.",p=1;else{var u=Number(($("#attach_video")[0].files[0].size/1024/1024).toFixed(2)),m=Number(uploadVideoSize);m<u&&($("#attach_video").val(null),$("#name_attach_video").html(""),t=errorUploadVideoSize,p=1)}}else $("#name_attach_video").html('<p class="red">Please select video</p>'),t="Please select video to upload",p=1}if("upload_audio"==n){c=$("#attach_audio").val();if(c.length>0){$("#name_attach_audio").html(c.substring(0,45));l=c.split(".").pop(),l=l.toLowerCase();if("mp3"!=l&&"m4a"!=l&&"mp4"!=l&&"ogg"!=l&&"flac"!=l&&"wav"!=l)$("#attach_audio").val(null),$("#name_attach_audio").html('<p class="red">Only (.mp3, .m4a, .mp4, .ogg, .flac, .wav) allowed!</p>'),t="Please select a valid audio format.",p=1;else{u=Number(($("#attach_audio")[0].files[0].size/1024/1024).toFixed(2));var r=Number(uploadVideoSize);r<u&&($("#attach_audio").val(null),$("#name_attach_audio").html(""),t=errorUploadVideoSize,p=1)}}else $("#name_attach_audio").html('<p class="red">Please select audio</p>'),t="Please select audio to upload",p=1}if("upload_document"==n){c=$("#attach_document").val();if(c.length>0){$("#name_attach_document").html(c.substring(0,45));l=c.split(".").pop(),l=l.toLowerCase();i=l.toUpperCase(),"pdf"!=l&&"doc"!=l&&"docx"!=l&&"jpg"!=l&&"jpe"!=l&&"jpeg"!=l&&"png"!=l&&"gif"!=l&&($("#attach_document").val(null),$("#name_attach_document").html('<p class="red">Only (.pdf, .doc, .docx, .jpg, .jpe, .jpeg, .png, .gif) allowed!</p>'),t="Please select a valid document format.",p=1)}else $("#name_attach_document").html('<p class="red">Please select document</p>'),t="Please select document to upload",p=1}var s=$("#attachment_item_title").val();if(""!=s&&0!=s.length||(t="Please provide a Video Title.",p=1),1==p)return alertify.alert(t),!1;new FormData;var h="";if("youtube"==n){e="Media",a="Youtube";var v=$("#attach_social_video").val();h=v}else if("vimeo"==n){e="Media",a="Vimeo";var y=$("#attach_social_video").val();h=y}else if("upload_video"==n){e="Media",a="Upload Video";var f=$("#attach_video").prop("files")[0];h=f;var b=s.replace(/ /g,"");$("#attach_video").clone().prop("id",b).insertAfter("div#email_attachment_files:last"),$("#"+b).hide()}else if("upload_audio"==n){e="Media",a="Upload Audio";var g=$("#attach_audio").prop("files")[0];h=g;b=s.replace(/ /g,"");$("#attach_audio").clone().prop("id",b).insertAfter("div#email_attachment_files:last"),$("#"+b).hide()}else if("upload_document"==n){e="Document",a=i;var w=$("#attach_document").prop("files")[0];h=w;b=s.replace(/ /g,"");$("#attach_document").clone().prop("id",b).insertAfter("div#email_attachment_files:last"),$("#"+b).hide()}$("#manual_attachment_modal").modal("hide"),$("#email_attachment_list").show(),$("#attachment_listing_data").prepend('<tr id="man_item_'+o+'" class="manual_upload_items" item-status="pending" row-id="man_item_'+o+'" item-title="'+s+'" item-source="'+n+'" item-data="'+h+'"><td class="text-center">'+s+'</td><td class="text-center">'+e+'</td><td class="text-center">'+a+'</td><td><a href="javascript:;" item-sid="'+o+'" attachment-type="manual" item-type="'+a+'" class="btn btn-block btn-info js-remove-attachment">Remove</a></td></tr>'),++o}),$(".close-current-item").on("click",function(){var t=$(this).attr("file-type");"youtube"==t?($("#youtube-iframe").remove(),$("#youtube-container").hide()):"vimeo"==t?($("#vimeo-iframe").remove(),$("#vimeo-container").hide()):"upload_video"==t?($("#video-player").remove(),$("#video-container").hide()):"upload_audio"==t?($("#audio-player").remove(),$("#audio-container").hide()):"document"==t?($("#document-iframe").remove(),$("#document-container").hide()):"image"==t&&($("#image-tag").remove(),$("#document-container").hide())}),$(".attachment_pop_up").on("click",function(){var t=$(this).attr("attachment-type");"library"==t?($("#pop_up_email_compose_container").hide(),$("#pop_up_attachment_library_container").show()):($("#pop_up_email_compose_container").hide(),e(),$("#pop_up_manual_attachment_container").show())}),$(".email_pop_up_back_to_library").on("click",function(){var t=$(".email_pop_up_back_to_library").attr("item-type");"youtube"==t?($("#email-pop-up-youtube-iframe").remove(),$("#email-pop-up-youtube-container").hide()):"vimeo"==t?($("#email-pop-up-vimeo-iframe").remove(),$("#email-pop-up-vimeo-container").hide()):"upload_video"==t?($("#email-pop-up-video-player").remove(),$("#email-pop-up-video-container").hide()):"upload_audio"==t?($("#email-pop-up-audio-player").remove(),$("#email-pop-up-audio-container").hide()):"document"==t?($("#email-pop-up-document-iframe").remove(),$("#email-pop-up-document-container").hide()):"image"==t&&($("#email-pop-up-image-tag").remove(),$("#email-pop-up-document-container").hide()),$("#view_pop_up_library_item").hide(),$("#show_pop_up_library_item").show()}),$(".email_pop_up_back_to_compose_email").on("click",function(){var t=$(this).attr("btn-from");"library"==t?($("#pop_up_attachment_library_container").hide(),$("#pop_up_email_compose_container").show()):"manual"==t?($("#pop_up_manual_attachment_container").hide(),$("#pop_up_email_compose_container").show()):($("#pop_up_attachment_library_container").hide(),$("#pop_up_manual_attachment_container").hide(),$("#pop_up_email_compose_container").show())}),$(".email_pop_up_select_lib_item").on("click",function(){var t=$(this).attr("item-sid");if(1==$(this).prop("checked")){var e=$(this).attr("item-category"),a=$(this).attr("item-type"),i=$(this).attr("item-title");$("#pop_up_email_attachment_list").show(),$("#pop_up_attachment_listing_data").prepend('<tr id="pop_up_lib_item_'+t+'"><input type="hidden" name="attachment['+t+'][item_type]" value="'+e+'"><input type="hidden" name="attachment['+t+'][record_sid]" value="'+t+'"><td class="text-center">'+i+'</td><td class="text-center">'+e+'</td><td class="text-center">'+a+'</td><td><a href="javascript:;" item-sid="'+t+'" attachment-type="library" item-type="'+e+'" class="btn btn-block btn-info js-pop-up-remove-attachment">Remove</a></td></tr>'),p.push(t.split("_")[1])}else{$("#pop_up_lib_item_"+t).remove();var o=p.indexOf(t);o>-1&&p.splice(o,1)}}),$(document).on("click",".js-pop-up-remove-attachment",function(){var t=$(this).attr("item-sid"),e=$(this).attr("attachment-type"),a=$(this).attr("item-type");"library"==e?($("#pop_up_lib_item_"+t).remove(),"Document"==a?$("#pop_up_doc_key_"+t).prop("checked",!1):$("#pop_up_med_key_"+t).prop("checked",!1)):$("#pop_up_man_item_"+t).remove()}),$(".pop_up_attach_item_source").on("click",function(){var t=$(this).val();"youtube"==t?($("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!1),$("#pop_up_attachment_yt_vm_video_input_container").show(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide()):"vimeo"==t?($("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!1),$("#pop_up_attachment_yt_vm_video_input_container").show(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide()):"upload_video"==t?($("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_yt_vm_video_input_container").hide(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!1),$("#pop_up_attachment_upload_video_input_container").show(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide()):"upload_audio"==t?($("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_yt_vm_video_input_container").hide(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!1),$("#pop_up_attachment_upload_audio_input_container").show(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_document_input_container").hide()):"upload_document"==t&&($("#pop_up_attachment_yt_vm_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_yt_vm_video_input_container").hide(),$("#pop_up_attachment_upload_video_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_video_input_container").hide(),$("#pop_up_attachment_upload_audio_input_container input").prop("disabled",!0),$("#pop_up_attachment_upload_audio_input_container").hide(),$("#pop_up_attachment_upload_document_input_container input").prop("disabled",!1),$("#pop_up_attachment_upload_document_input_container").show())});var n=1;$("#pop_up_save_attach_item").on("click",function(){var t,e,a,i,p=0,o=$('input[name="pop_up_attach_item_source"]:checked').val();if("youtube"==o)if(""!=$("#pop_up_attach_social_video").val()){var _=/(?:https?:\/\/)?(?:youtu\.be\/|(?:www\.)?youtube\.com\/watch(?:\.php)?\?.*v=)([a-zA-Z0-9\-_]+)/;$("#pop_up_attach_social_video").val().match(_)||(t="Not a Valid Youtube URL",p=1)}else t="Please provide a Valid Youtube URL",p=1;if("vimeo"==o)if(""!=$("#pop_up_attach_social_video").val()){var d=baseURL+"compliance_safety_reporting/validate_vimeo";$.ajax({type:"POST",url:d,data:{url:$("#pop_up_attach_social_video").val()},async:!1,success:function(e){0==e&&(t="Not a Valid Vimeo URLs",p=1)},error:function(t){}})}else t="Please provide a Valid Vimeo URL",p=1;if("upload_video"==o){var c=$("#pop_up_attach_video").val();if(c.length>0){$("#name_pop_up_attach_video").html(c.substring(0,45));var l=c.split(".").pop();l=l.toLowerCase();if("mp4"!=l&&"m4a"!=l&&"m4v"!=l&&"f4v"!=l&&"f4a"!=l&&"m4b"!=l&&"m4r"!=l&&"f4b"!=l&&"mov"!=l)$("#pop_up_attach_video").val(null),$("#name_pop_up_attach_video").html('<p class="red">Only (.mp4, .m4a, .m4v, .f4v, .f4a, .m4b, .m4r, .f4b, .mov) allowed!</p>'),t="Please select a valid video format.",p=1;else{var u=Number(($("#pop_up_attach_video")[0].files[0].size/1024/1024).toFixed(2)),m=Number(uploadVideoSize);m<u&&($("#pop_up_attach_video").val(null),$("#name_pop_up_attach_video").html(""),t=errorUploadVideoSize,p=1)}}else $("#name_pop_up_attach_video").html('<p class="red">Please select video</p>'),t="Please select video to upload",p=1}if("upload_audio"==o){c=$("#pop_up_attach_audio").val();if(c.length>0){$("#name_pop_up_attach_audio").html(c.substring(0,45));l=c.split(".").pop(),l=l.toLowerCase();if("mp3"!=l&&"m4a"!=l&&"mp4"!=l&&"ogg"!=l&&"flac"!=l&&"wav"!=l)$("#pop_up_attach_audio").val(null),$("#name_pop_up_attach_audio").html('<p class="red">Only (.mp3, .m4a, .mp4, .ogg, .flac, .wav) allowed!</p>'),t="Please select a valid audio format.",p=1;else{u=Number(($("#pop_up_attach_audio")[0].files[0].size/1024/1024).toFixed(2));var r=Number(uploadVideoSize);r<u&&($("#pop_up_attach_audio").val(null),$("#name_pop_up_attach_audio").html(""),t=errorUploadVideoSize,p=1)}}else $("#name_pop_up_attach_audio").html('<p class="red">Please select audio</p>'),t="Please select audio to upload",p=1}if("upload_document"==o){c=$("#pop_up_attach_document").val();if(c.length>0){$("#name_pop_up_attach_document").html(c.substring(0,45));l=c.split(".").pop(),l=l.toLowerCase();i=l.toUpperCase(),"pdf"!=l&&"doc"!=l&&"docx"!=l&&"jpg"!=l&&"jpe"!=l&&"jpeg"!=l&&"png"!=l&&"gif"!=l&&($("#pop_up_attach_document").val(null),$("#name_pop_up_attach_document").html('<p class="red">Only (.pdf, .doc, .docx, .jpg, .jpe, .jpeg, .png, .gif) allowed!</p>'),t="Please select a valid document format.",p=1)}else $("#name_pop_up_attach_document").html('<p class="red">Please select document</p>'),t="Please select document to upload",p=1}var s=$("#pop_up_attachment_item_title").val();if(""!=s&&0!=s.length||(t="Please provide a Video Title.",p=1),1==p)return alertify.alert(t),!1;new FormData;var h="";if("youtube"==o){e="Media",a="Youtube";var v=$("#pop_up_attach_social_video").val();h=v}else if("vimeo"==o){e="Media",a="Vimeo";var y=$("#pop_up_attach_social_video").val();h=y}else if("upload_video"==o){e="Media",a="Upload Video";var f=$("#pop_up_attach_video").prop("files")[0];h=f;var b=s.replace(/ /g,"");$("#pop_up_attach_video").clone().prop("id",b).insertAfter("div#pop_up_email_attachment_files:last"),$("#"+b).hide()}else if("upload_audio"==o){e="Media",a="Upload Audio";var g=$("#attach_audio").prop("files")[0];h=g;b=s.replace(/ /g,"");$("#pop_up_attach_audio").clone().prop("id",b).insertAfter("div#pop_up_email_attachment_files:last"),$("#"+b).hide()}else if("upload_document"==o){e="Document",a=i;var w=$("#attach_document").prop("files")[0];h=w;b=s.replace(/ /g,"");$("#pop_up_attach_document").clone().prop("id",b).insertAfter("div#pop_up_email_attachment_files:last"),$("#"+b).hide()}$("#pop_up_manual_attachment_container").hide(),$("#pop_up_email_compose_container").show(),$("#pop_up_email_attachment_list").show(),$("#pop_up_attachment_listing_data").prepend('<tr id="pop_up_man_item_'+n+'" class="pop_up_manual_upload_items" item-status="pending" row-id="man_item_'+n+'" item-title="'+s+'" item-source="'+o+'" item-data="'+h+'"><td class="text-center">'+s+'</td><td class="text-center">'+e+'</td><td class="text-center">'+a+'</td><td><a href="javascript:;" item-sid="'+n+'" attachment-type="manual" item-type="'+a+'" class="btn btn-block btn-info js-pop-up-remove-attachment">Remove</a></td></tr>'),++n}),$("#send_pop_up_email").on("click",function(){var e=0,a="",i=$("#pop_up_attachment_listing_data > .pop_up_manual_upload_items"),o=0;if(i.length)o=$("#pop_up_attachment_listing_data > .pop_up_manual_upload_items").length;var n=$("#send_email_subject").val(),_=CKEDITOR.instances.send_email_message.getData();if(""==n&&""==_?(a="All fields are required.",e=1):""==_?(a="Message body is required.",e=1):""==n&&(a="Subject is required.",e=1),o>0&&0==e)$("#send_email_modal").modal("hide"),$("#attachment_loader").show(),$("#pop_up_attachment_listing_data > .pop_up_manual_upload_items").each(function(e){var a=$(this).attr("item-status");if("pending"==a){var i=$(this).attr("row-id"),n=$(this).attr("item-title"),_=$(this).attr("item-source"),d=baseURL+"compliance_safety_reporting/save_email_manual_attachment",c=new FormData;if(c.append("attachment_title",n),"youtube"==_||"vimeo"==_){var l=$(this).attr("item-data");c.append("social_url",l)}else{var u=n.replace(/ /g,""),m=$("#"+u).prop("files")[0];if(c.append("file",m),"upload_document"==_){var r=$("#"+u).val(),s=r.split(".").pop();c.append("file_name",r.replace("C:\\fakepath\\","")),c.append("file_ext",s)}}c.append("file_type",_),c.append("user_type","manager"),c.append("report_sid",reportId),c.append("incident_sid",incidentId),c.append("item_sid",itemId),c.append("company_sid",companyId),c.append("uploaded_by",employeeId),$.ajax({url:d,cache:!1,contentType:!1,processData:!1,type:"post",data:c,success:function(e){var a=jQuery.parseJSON(e),n=a.item_sid,_=a.item_title,d=a.item_type,c=a.item_source;$("#pop_up_"+i).html('<input type="hidden" name="attachment['+n+'][item_type]" value="'+d+'"><input type="hidden" name="attachment['+n+'][record_sid]" value="'+n+'"><td class="text-center">'+_+'</td><td class="text-center">'+d+'</td><td class="text-center">'+c+'</td><td><a href="javascript:;" item-sid="'+n+'" attachment-type="library" item-type="'+d+'" class="btn btn-block btn-info js-remove-attachment">Remove</a></td>'),$("#pop_up_"+i).attr("item-status","done"),o-=1,p.push(n),0==o&&setTimeout(function(){t("popup")},1e3)},error:function(){}})}});else{if(1==e)return alertify.alert(a),!1;t("popup")}})});