$(function(){function e(){$(".js-tr").find('input[name="issues_ids[]"]').prop("checked",$(this).prop("checked"))}function t(){$(this).find('input[name="issues_ids[]"]').prop("checked",!$(this).find('input[name="issues_ids[]"]').prop("checked"))}function s(){null===l&&(ml(!0,"jsPageLoader"),l=$.ajax({url:baseUrl("compliance_safety_reporting/send_issue_reminder_email"),method:"POST",data:{issuesIds:n}}).always(function(){l=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){_success(e.message,function(){window.location.reload()})}))}function o(e){const t=$(".jsIssueSaveFileBtn");t.prop("disabled",!0);const s=new FormData;s.append("cspIssueId",d),s.append("title",e.title),s.append("file",e.file),l=$.ajax({url:baseUrl(`compliance_safety_reporting/issues/${d}/attach-file`),method:"POST",data:s,processData:!1,contentType:!1}).always(function(){l=null,t.prop("disabled",!1)}).fail(handleErrorResponse).done(function(e){_success("File attached successfully."),$("#jsIssueModalCommon").modal("hide")})}function a(e){if($("#jsIssueModalCommon").length<=0){const e='\n\t\t\t<div class=modal fade" id="jsIssueModalCommon" tabindex="-1" role="dialog" aria-hidden="true">\n\t\t\t\t<div class="modal-dialog modal-lg" role="document">\n\t\t\t\t\t<div class="modal-content">\n\t\t\t\t\t\t<div class="modal-header">\n\t\t\t\t\t\t\t<h5 class="modal-title"></h5>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-body">\n\t\t\t\t\t\t\t<div class="alert alert-info text-center">Generating a view please wait.</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-footer">\n\t\t\t\t\t\t\t<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n\t\t\t\t\t\t\t<button type="button" class="btn btn-orange hidden"></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t';$("body").append(e)}$("#jsIssueModalCommon").find(".modal-title").html(e.title),$("#jsIssueModalCommon").find(".btn-orange").html(e.save.text),$("#jsIssueModalCommon").find(".btn-orange").addClass(e.save.cl),$("#jsIssueModalCommon").find(".btn-orange").addClass("hidden"),$("#jsIssueModalCommon").modal({backdrop:"static",keyboard:!1}),$("#jsIssueModalCommon").modal("show")}function i(e){if(!e)return"Unknown";const t=e.name.toLowerCase(),s=e.type;let o="file";return s.startsWith("audio/")?o="audio":s.startsWith("video/")?o="video":s.startsWith("image/")?o="image":s.startsWith("application/")&&("application/pdf"===s||s.startsWith("application/msword")||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===s)&&(o="document"),"file"===o&&(t.match(/\.(pdf|doc|docx|txt|xls|xlsx|ppt|pptx)$/)?o="document":t.match(/\.(mp3|wav|ogg|flac|aac|m4a)$/)?o="audio":t.match(/\.(mp4|mkv|avi|mov|wmv|flv|webm)$/)&&(o="video")),o}let l=null,n=[],d=0;const r={document:{allowedTypes:["jpg","jpeg","png","gif","webp","rtf","pdf","doc","docx","pptx","ppt","xls","xlsx","csv","mov","mp4","webm","wav","mp3"],fileLimit:"200mb",allowLinks:!0,allowCapture:!0}};let c={};Highcharts.chart("jsProgressGraph",{chart:{type:"pie"},title:{text:"Compliance Progress",style:{fontSize:"14px"}},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},accessibility:{point:{valueSuffix:"%"}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{fontSize:"14px"}}}},legend:{itemStyle:{fontSize:"14px"}},series:[{name:"Tasks",colorByPoint:!0,data:JSON.parse(progressGraphData).map((e,t)=>({...e,color:JSON.parse(progressGraphColors)[t]}))}]}),Highcharts.chart("jsSeverityGraph",{chart:{type:"column"},title:{text:"Compliance Progress by Severity Levels",style:{fontSize:"14px"}},xAxis:{categories:JSON.parse(severityLevelGraph).categories,title:{text:"Severity Level",style:{fontSize:"14px"}},labels:{style:{fontSize:"14px"}}},yAxis:{min:0,title:{text:"Number of Issues",style:{fontSize:"14px"}},labels:{style:{fontSize:"14px"}}},tooltip:{pointFormat:"<b>{point.y}</b> issues at Severity Level {point.category}"},plotOptions:{column:{colorByPoint:!0,dataLabels:{enabled:!0,format:"{point.y}",style:{fontSize:"14px"}}}},legend:{itemStyle:{fontSize:"14px"}},series:[{name:"Issues",data:JSON.parse(severityLevelGraph).data,colors:JSON.parse(severityLevelGraph).colors}]}),$("#jsDateRangePicker").daterangepicker({showDropdowns:!0,autoApply:!0,locale:{format:"MM/DD/YYYY",separator:" - "}}),$(document).on("click",".js-check-all",e),$(document).on("click",".js-tr",t),$(".jsSendReminderEmails").click(function(e){if(e.preventDefault(),$.each($('input[name="issues_ids[]"]:checked'),function(){n.push(parseInt($(this).val()))}),!n.length)return alertify.alert("Please select an issue to send reminder email."),!1;_confirm("Are you sure you want to send emails to the selected employees and external recipients?",s)}),$(".jsIssueUploadFileBtn").click(function(e){e.preventDefault(),d=$(this).closest("tr").data("id"),a({title:"Attach file",save:{text:"Upload file",cl:"jsIssueSaveFileBtn"}});const t='\n                    <div class="row">\n                        <div class="col-lg-12">\n                            <div class="form-group">\n                                <label for="jsIssueFileUploadTitle">Title <strong class="text-danger">*</strong></label>\n                                <input type="text" class="form-control" id="jsIssueFileUploadTitle" name="jsIssueFileUploadTitle" />\n                            </div>\n                        </div>\n                    </div>\n                    <div class="row">\n                        <div class="col-lg-12">\n                            <div class="form-group">\n                                <input type="file" class="hidden" id="jsIssueFileUploadFile" name="jsIssueFileUploadFile" />\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            ';$("#jsIssueModalCommon").find(".modal-body").html(t),c=$("#jsIssueFileUploadFile").msFileUploader(r.document),$("#jsIssueModalCommon").find(".jsIssueSaveFileBtn").removeClass("hidden")}),$(document).on("click",".jsIssueSaveFileBtn",function(e){if(e.preventDefault(),null!==l)return;const t={title:$("#jsIssueFileUploadTitle").val().trim(),file:c.getValue()};t.title?0!==Object.keys(t.file).length?t.hasError&&"vimeo"===t.type?_error("Vimeo link is invalid."):t.hasError&&"youtube"===t.type?_error("YouTube link is invalid."):t.file.hasError?_error("Please select a valid file."):(t.fileType="vimeo"===t.file.type||"youtube"===t.file.type?"link":i(t.file.type).toLowerCase(),o(t)):_error("Please select a valid file."):_error("Please add a title of the file.")})});