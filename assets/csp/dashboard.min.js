$((function(){let e=null,t=[],s=0,a=0,o=0,i={},l=0;const n={allowedTypes:["jpg","jpeg","png","gif","webp","rtf","pdf","doc","docx","pptx","ppt","xls","xlsx","csv","mov","mp4","webm","wav","mp3"],fileLimit:"200mb",allowLinks:!0,allowCapture:!0};function d(){null===e&&(ml(!0,"jsPageLoader"),e=$.ajax({url:baseUrl("compliance_safety_reporting/send_issue_reminder_email"),method:"POST",data:{issuesIds:t}}).always((function(){e=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){_success(e.message,(function(){window.location.reload()}))})))}Highcharts.chart("jsProgressGraph",{chart:{type:"pie"},title:{text:"Compliance Progress",style:{fontSize:"14px"}},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},accessibility:{point:{valueSuffix:"%"}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{fontSize:"14px"}}}},legend:{itemStyle:{fontSize:"14px"}},series:[{name:"Tasks",colorByPoint:!0,data:JSON.parse(progressGraphData).map(((e,t)=>({...e,color:JSON.parse(progressGraphColors)[t]})))}]}),Highcharts.chart("jsSeverityGraph",{chart:{type:"column"},title:{text:"Compliance Progress by Severity Levels",style:{fontSize:"14px"}},xAxis:{categories:JSON.parse(severityLevelGraph).categories,title:{text:"Severity Level",style:{fontSize:"14px"}},labels:{style:{fontSize:"14px"}}},yAxis:{min:0,title:{text:"Number of Issues",style:{fontSize:"14px"}},labels:{style:{fontSize:"14px"}}},tooltip:{pointFormat:"<b>{point.y}</b> issues at Severity Level {point.category}"},plotOptions:{column:{colorByPoint:!0,dataLabels:{enabled:!0,format:"{point.y}",style:{fontSize:"14px"}}}},legend:{itemStyle:{fontSize:"14px"}},series:[{name:"Issues",data:JSON.parse(severityLevelGraph).data,colors:JSON.parse(severityLevelGraph).colors}]}),$("#jsDateRangePicker").daterangepicker({showDropdowns:!0,autoUpdateInput:!1,locale:{format:"MM/DD/YYYY",separator:" - ",cancelLabel:"clear"}}),$("#jsDateRangePicker").on("apply.daterangepicker",(function(e,t){$(this).val(t.startDate.format("MM/DD/YYYY")+" - "+t.endDate.format("MM/DD/YYYY"))})),$("#jsDateRangePicker").on("cancel.daterangepicker",(function(e,t){$(this).val("")})),$(document).on("click",".js-check-all",(function(){$(".jsIssueIds").prop("checked",$(this).prop("checked"))})),$(".jsSendReminderEmails").click((function(e){if(e.preventDefault(),$.each($(".jsIssueIds:checked"),(function(){t.push(parseInt($(this).val()))})),!t.length)return alertify.alert("Please select an issue to send reminder email."),!1;_confirm("Are you sure you want to send emails to the selected employees and external recipients?",d)})),$(".jsMarkIssueDone").click((function(e){e.preventDefault();const t=$(this).data("issue_id"),s=$(this);_confirm("Do you really want to mark this issue completed?",(function(){!function(e,t){const s=callButtonHook(t,!0);$.ajax({url:baseUrl("compliance_safety_reporting/issues/"+e+"/mark/done"),method:"POST",data:{status:"completed"}}).always((function(){callButtonHook(s,!1)})).fail(handleErrorResponse).done((function(s){t.remove(),$(`.jsStatusRow${e}`).html(s.view)}))}(t,s)}))})),$(".jsViewIssuesFiles").click((function(t){t.preventDefault(),function(t){if($("#jsIssueModalCommon").length<=0){const e='\n\t\t\t<div class=modal fade" id="jsIssueModalCommon" tabindex="-1" role="dialog" aria-hidden="true">\n\t\t\t\t<div class="modal-dialog modal-lg" role="document">\n\t\t\t\t\t<div class="modal-content">\n\t\t\t\t\t\t<div class="modal-header">\n\t\t\t\t\t\t\t<h5 class="modal-title"></h5>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-body">\n\t\t\t\t\t\t\t<div class="alert alert-info text-center">Generating a view please wait.</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-footer">\n\t\t\t\t\t\t\t<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t';$("body").append(e)}$("#jsIssueModalCommon").find(".modal-title").html(t.title),0==t.count?$("#jsIssueModalCommon").find(".modal-body").html('<div class="alert alert-info text-center">No file has been attached to this issue.</div>'):($("#jsIssueModalCommon").find(".modal-body").html('<div class="alert alert-info text-center">Generating a view please wait.</div>'),null===e&&(ml(!0,"jsPageLoader"),e=$.ajax({url:baseUrl("compliance_safety_reporting/get_attached_files/"+t.reportId+"/"+t.incidentId+"/"+t.issueId),method:"GET"}).always((function(){e=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){$("#jsIssueModalCommon").find(".modal-body").html(e.view),_success(e.message)}))));$("#jsIssueModalCommon").modal({backdrop:"static",keyboard:!1}),$("#jsIssueModalCommon").modal("show")}({title:"View File(s)",reportId:$(this).data("report_id"),incidentId:$(this).data("incident_id"),issueId:$(this).data("issue_id"),count:$(this).data("files_count")})})),$(document).on("click",".jsViewFile",(function(t){t.preventDefault();const s=$(this).closest(".jsFileBox").data("id");Modal({Id:"jsFileViewModal",Loader:"jsFileViewModalLoader",Title:'<span id="jsFileViewModalTitle"></span>',Body:'<div id="jsFileViewModalBody"></body>'},(function(){$("#jsIssueModalCommon").modal("hide"),function(t){$.ajax({url:baseUrl("compliance_safety_reporting/file/view/"+t),method:"GET"}).always((function(){e=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){$("#jsFileViewModalBody").html(e.view),$("#jsFileViewModalTitle").html(e.data.title),ml(!1,"jsFileViewModalLoader")}))}(s)}))})),$(document).on("click",".jsDeleteFile",(function(t){t.preventDefault();const s=$(this).data("file_id"),a=$(this).data("file_type");_confirm("Are you sure you want to remove this "+a+"? It will be removed from this issue permanently as well.",(function(){!function(t,s){null===e&&(ml(!0,"jsPageLoader"),e=$.ajax({url:baseUrl("compliance_safety_reporting/delete_file/"+t),method:"DELETE"}).always((function(){e=null,ml(!1,"jsPageLoader")})).fail(handleErrorResponse).done((function(e){_success("Removed "+s+" successfully",(function(){$(`button.jsDeleteFile[data-file_id="${t}"]`).closest(".jsFileBox").remove()}))})))}(s,a)}))})),$(".jsIssueUploadFileBtn").click((function(e){e.preventDefault(),s=$(this).data("report_id"),a=$(this).data("incident_id"),o=$(this).data("issue_id"),l=$(this).data("public"),function(e){if($("#jsIssueModalCommon").length<=0){const e='\n\t\t\t<div class=modal fade" id="jsIssueModalCommon" tabindex="-1" role="dialog" aria-hidden="true">\n\t\t\t\t<div class="modal-dialog modal-lg" role="document">\n\t\t\t\t\t<div class="modal-content">\n\t\t\t\t\t\t<div class="modal-header">\n\t\t\t\t\t\t\t<h5 class="modal-title"></h5>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-body">\n\t\t\t\t\t\t\t<div class="alert alert-info text-center">Generating a view please wait.</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-footer">\n\t\t\t\t\t\t\t<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n\t\t\t\t\t\t\t<button type="button" class="btn btn-orange hidden"></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t';$("body").append(e)}$("#jsIssueModalCommon").find(".modal-title").html(e.title),$("#jsIssueModalCommon").find(".btn-orange").html(e.save.text),$("#jsIssueModalCommon").find(".btn-orange").addClass(e.save.cl),$("#jsIssueModalCommon").find(".btn-orange").addClass("hidden"),$("#jsIssueModalCommon").modal({backdrop:"static",keyboard:!1}),$("#jsIssueModalCommon").modal("show")}({title:"Attach file",save:{text:"Upload file",cl:"jsIssueSaveFileBtn"}});$("#jsIssueModalCommon").find(".modal-body").html('\n                    <div class="row">\n                        <div class="col-lg-12">\n                            <div class="form-group">\n                                <label for="jsIssueFileUploadTitle">Title <strong class="text-danger">*</strong></label>\n                                <input type="text" class="form-control" id="jsIssueFileUploadTitle" name="jsIssueFileUploadTitle" />\n                            </div>\n                        </div>\n                    </div>\n                    <div class="row">\n                        <div class="col-lg-12">\n                            <div class="form-group">\n                                <input type="file" class="hidden" id="jsIssueFileUploadFile" name="jsIssueFileUploadFile" />\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            '),i=$("#jsIssueFileUploadFile").msFileUploader(n),$("#jsIssueModalCommon").find(".jsIssueSaveFileBtn").removeClass("hidden")})),$(document).on("click",".jsIssueSaveFileBtn",(function(t){if(t.preventDefault(),null!==e)return;const i={title:$("#jsIssueFileUploadTitle").val().trim(),file:$("#jsIssueFileUploadFile").msFileUploader("get")};i.title?0!==Object.keys(i.file).length?i.hasError&&"vimeo"===i.type?_error("Vimeo link is invalid."):i.hasError&&"youtube"===i.type?_error("YouTube link is invalid."):i.file.hasError?_error("Please select a valid file."):(i.fileType="vimeo"===i.file.type||"youtube"===i.file.type?"link":function(e){if(!e)return"Unknown";const t=e.name.toLowerCase(),s=e.type;let a="file";s.startsWith("audio/")?a="audio":s.startsWith("video/")?a="video":s.startsWith("image/")?a="image":s.startsWith("application/")&&("application/pdf"===s||s.startsWith("application/msword")||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===s)&&(a="document");"file"===a&&(t.match(/\.(pdf|doc|docx|txt|xls|xlsx|ppt|pptx)$/)?a="document":t.match(/\.(mp3|wav|ogg|flac|aac|m4a)$/)?a="audio":t.match(/\.(mp4|mkv|avi|mov|wmv|flv|webm)$/)&&(a="video"));return a}(i.file).toLowerCase(),function(t){const i=$(".jsIssueSaveFileBtn");i.prop("disabled",!0);const n=new FormData;n.append("reportId",s),n.append("incidentId",a),n.append("itemId",o),n.append("title",t.title),n.append("type",t.fileType),"youtube"===t.file.type||"vimeo"===t.file.type?n.append("link",t.file.link):n.append("file",t.file);e=$.ajax({url:baseUrl((l?"csp/":"compliance_safety_reporting")+"/add_file_to_incident_item"),method:"POST",data:n,processData:!1,contentType:!1}).always((function(){e=null,i.prop("disabled",!1)})).fail(handleErrorResponse).done((function(e){$("#jsIssueModalCommon").modal("hide"),alertify.success("File attached successfully."),0===$(`.jsFilesArea${o} .jsDocumentsArea .jsFirst`).length&&$(`.jsFilesArea${o}`).html('<div class="jsDocumentsArea"><div class="jsFirst"></div></div>'),$(`.jsFilesArea${o} .jsDocumentsArea .jsFirst`).prepend(e.view)}))}(i)):_error("Please select a valid file."):_error("Please add a title of the file.")})),$(".jsToggle").click((function(e){e.preventDefault(),$(".jsChildRows").addClass("hidden"),$(this).find(".jsToggleIcon").hasClass("fa-chevron-right")?($("."+$(this).data("target")).removeClass("hidden"),$(this).find(".jsToggleIcon").removeClass("fa-chevron-right"),$(this).find(".jsToggleIcon").addClass("fa-chevron-down")):($(this).find(".jsToggleIcon").removeClass("fa-chevron-down"),$(this).find(".jsToggleIcon").addClass("fa-chevron-right"))})),$(".jsToggle2").click((function(e){e.preventDefault(),$(".jsIssuesBody").addClass("hidden"),$(this).find(".jsToggleIcon").hasClass("fa-chevron-right")?($("#"+$(this).data("target")).removeClass("hidden"),$(this).find(".jsToggleIcon").removeClass("fa-chevron-right"),$(this).find(".jsToggleIcon").addClass("fa-chevron-down")):($(this).find(".jsToggleIcon").removeClass("fa-chevron-down"),$(this).find(".jsToggleIcon").addClass("fa-chevron-right"))})),$(".jsMarkIssueDonePublic").click((function(e){e.preventDefault();const t=$(this).data("issue_id"),s=$(this);_confirm("Do you really want to mark this issue completed?",(function(){!function(e,t){const s=callButtonHook(t,!0);$.ajax({url:baseUrl("csp/issues/"+e+"/mark/done"),method:"POST",data:{status:"completed"}}).always((function(){callButtonHook(s,!1)})).fail(handleErrorResponse).done((function(s){t.remove(),$(`.jsStatusRow${e}`).html(s.view)}))}(t,s)}))}))}));