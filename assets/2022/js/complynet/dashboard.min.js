$((function ComplyNet(){let companyId=0,companyName="",loaderRef="#jsMainLoader";function checkTheCompanyIntegration(){xhr=$.get(baseURI+"cn/check_company_status/"+companyId).success((function(resp){if($("#jsIntegrationView").html(" "),xhr=null,0===resp.length)return startIntegrationProcess();loadView()})).fail(handleFailure)}function startIntegrationProcess(){loader(!1),Modal({Id:"jsModal",Title:"ComplyNet Integration",Loader:"jsModalLoader",Body:'<div class="container"><div id="jsModalBody"></div></div>'},(function(){getIntegrationPage()}))}function getIntegrationPage(){xhr=$.get(baseURI+"cn/getting_started/"+companyId).success((function(resp){$("#jsModalBody").html(resp.view),$("#jsCICompanyName").select2(),$("#jsCIComplyNetCompanies").select2(),companyName=resp.companyName,ml(!1,"jsModalLoader")})).fail(handleFailure)}function getComplyNetCompanyLocations(complyCompanyId){xhr=$.get(baseURI+"cn/locations/"+complyCompanyId).success((function(resp){if(xhr=null,0===resp.length)return alertify.alert("Error!","Failed to fetch locations",CB);let options="";options+='<option value="0">[Select location]</option>',resp.map((function(record){options+='<option value="'+record.Id+'">'+record.Name+"</option>"})),$("#jsCIComplyNetLocations").html(options),$("#jsCIComplyNetLocations").select2(),$("#jsCIComplyNetLocations").closest(".row").removeClass("hidden"),$(".jsCIBTNBox").removeClass("hidden"),ml(!1,"jsModalLoader")})).fail(handleFailure)}function integrateCompany(integrationObject){xhr=$.post(baseURI+"cn/integrate",integrationObject).success((function(resp){return alertify.alert("Success","Integration process completed.",(function(){window.location.reload()}))})).fail(handleFailure)}function loadView(){loader(!0,"Please wait while we are generating view."),xhr=$.get(baseURI+"cn/integrate/view/"+companyId).success((function(resp){$("#jsIntegrationView").html(resp.view),loader(!1)})).fail(handleFailure)}function syncCompany(){loader(!0,"Please wait while we are syncing company."),xhr=$.post(baseURI+"cn/sync",{companyId:companyId}).success((function(resp){return loader(!1),alertify.alert("Success","Company is synced",(function(){loadView()}))})).fail(handleFailure)}function showComplyDepartments(){Modal({Id:"jsComplyModal",Title:"ComplyNet Departments",Loader:"jsComplyModalLoader",Body:'<div class="container"><div id="jsComplyModalBody"></div></div>'},(function(){$.get(baseURI+"cn/comply/departments/"+companyId).success((function(resp){$("#jsComplyModalBody").html(resp.view),ml(!1,"jsComplyModalLoader")})).fail(handleFailure)}))}function showComplyJobRoles(){Modal({Id:"jsComplyModal",Title:"ComplyNet Job Roles",Loader:"jsComplyModalLoader",Body:'<div class="container"><div id="jsComplyModalBody"></div></div>'},(function(){$.get(baseURI+"cn/comply/job_roles/"+companyId).success((function(resp){$("#jsComplyModalBody").html(resp.view),ml(!1,"jsComplyModalLoader")})).fail(handleFailure)}))}function startEmployeeSyncProcess(employeeId){loader(!0,"Please wait while we are syncing employee."),xhr=$.post(baseURI+"cn/"+companyId+"/employee/sync",{companyId:companyId,employeeId:employeeId}).success((function(resp){return loader(!1),resp.hasOwnProperty("errors")?alertify.alert("ERROR",resp.errors.join("<br />"),(function(){})):alertify.alert("Success","Employee is synced.",(function(){checkTheCompanyIntegration()}))})).fail(handleFailure)}function loader(cond,msg=""){cond?($(loaderRef).show(),$(loaderRef+" .jsLoaderText").html(msg||"Please wait, while we process your request.")):($(loaderRef).hide(),$(loaderRef+" .jsLoaderText").html("Please wait, while we process your request."))}function handleFailure(resp){if(xhr=null,401===resp.status)return alertify.alert("Error","Your login session expired. Please log in!",(function(){window.location.reload()}))}function CB(){}$("#jsCompany").select2(),$(".jsStartProcess").click((function(event){if(event.preventDefault(),companyId=parseInt($("#jsCompany").val().trim()),0===companyId)return alertify.alert("Please select a company.",CB);loader(!0),checkTheCompanyIntegration()})),$(document).on("change","#jsCIComplyNetCompanies",(function(){if(0===$(this).val())return alertify.alert("Warning!","Please select a valid ComplyNet company.",CB);ml(!0,"jsModalLoader"),$("#jsCIComplyNetLocations").closest(".row").addClass("hidden"),$(".jsCIBTNBox").addClass("hidden"),getComplyNetCompanyLocations($(this).val())})),$(document).on("click",".jsCISubmit",(function(event){event.preventDefault();let obj={companyId:companyId,companyName:companyName,complyCompanyId:$("#jsCIComplyNetCompanies").val(),complyLocationId:$("#jsCIComplyNetLocations").val()};return obj.complyCompanyId&&0!=obj.complyCompanyId?obj.complyLocationId&&0!=obj.complyLocationId?(obj.complyCompanyName=$("#jsCIComplyNetCompanies option:selected").text(),obj.complyLocationName=$("#jsCIComplyNetLocations option:selected").text(),ml(!0,"jsModalLoader"),void integrateCompany(obj)):alertify.alert("Warning!","Please select the ComplyNet location.",CB):alertify.alert("Warning!","Please select the ComplyNet company.",CB)})),$(document).on("click",".jsSyncCompany",(function(event){event.preventDefault(),syncCompany()})),$(document).on("click",".jsRefreshCompany",(function(event){event.preventDefault(),loadView()})),$(document).on("click",".jsShowAllDepartments",(function(event){event.preventDefault(),showComplyDepartments()})),$(document).on("click",".jsShowAllJobRoles",(function(event){event.preventDefault(),showComplyJobRoles()})),$(document).on("click",".jsSyncSingleEmployee",(function(event){event.preventDefault(),startEmployeeSyncProcess($(this).data("id"))}))}));