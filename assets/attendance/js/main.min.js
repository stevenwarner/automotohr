$((function(){var XHR=null,CBObj={cb:{},params:{}},locOBJ={lat:0,lon:0};function CheckPost(action){CBObj.cb=MarkAttendance,CBObj.params={},CBObj.params.action=action,CheckAndGetLatLon()}function CheckClock(){CBObj.cb=LoadClock,CBObj.params={},CheckAndGetLatLon()}function MarkAttendance(props){$(".jsAttendanceLoader").show(0),XHR=$.post(baseURI+"attendance/mark/attendance",props).done((function(resp){return $(".jsAttendanceLoader").hide(0),resp.errors?alertify.alert("Error!",resp.errors.join("<br />"),CB):alertify.alert("Success",resp.success,(function(){SetClock(props.action)}))})).fail(HandleError)}function LoadClock(){XHR=$.get(baseURI+"attendance/get/clock").done((function(resp){if(SetClock(resp.success.last_status),"clock_in"==resp.success.last_status||"break_out"==resp.success.last_status){var today=new Date,initialDate;SetClockCount(new Date(today.getFullYear(),today.getMonth(),today.getDate(),resp.success.hours,resp.success.minutes,resp.success.seconds))}})).fail(HandleError)}function SetClock(action){$(".jsAttendanceClockBTN").hide(0),$(".jsAttendanceBTN").addClass("dn"),"clock_in"==action||"break_out"==action?($('.jsAttendanceClockBTN[data-type="break_in"]').show(0),$('.jsAttendanceClockBTN[data-type="clock_out"]').show(0),$('.jsAttendanceBTN[data-type="break_in"]').removeClass("dn"),$('.jsAttendanceBTN[data-type="clock_out"]').removeClass("dn")):"break_in"==action?($('.jsAttendanceClockBTN[data-type="break_out"]').show(0),$('.jsAttendanceClockBTN[data-type="clock_out"]').show(0),$('.jsAttendanceBTN[data-type="break_out"]').removeClass("dn"),$('.jsAttendanceBTN[data-type="clock_out"]').removeClass("dn")):($('.jsAttendanceClockBTN[data-type="clock_in"]').show(0),$('.jsAttendanceBTN[data-type="clock_in"]').removeClass("dn")),$(".jsAttendanceLoader").hide(0)}function SetClockCount(initialDate){let hour=initialDate.getHours(),minutes=initialDate.getMinutes(),seconds=initialDate.getSeconds();$(".jsAttendanceClockHour").text(1==hour.toString().length?"0"+hour:hour),$(".jsAttendanceClockMinute").text(1==minutes.toString().length?"0"+minutes:minutes),$(".jsAttendanceClockSeconds").text(1==seconds.toString().length?"0"+seconds:seconds)}function InitClock(){if(void 0!==$(".jsAttendanceCurrentClockHour"))return setInterval(StartClock,1)}function StartClock(){var dt=new Date;$(".jsAttendanceCurrentClockHour").text(1===dt.getHours().toString().length?"0"+dt.getHours():dt.getHours()),$(".jsAttendanceCurrentClockMinutes").text(1===dt.getMinutes().toString().length?"0"+dt.getMinutes():dt.getMinutes()),$(".jsAttendanceCurrentClockSeconds").text(1===dt.getSeconds().toString().length?"0"+dt.getSeconds():dt.getSeconds())}function CheckAndGetLatLon(){navigator.geolocation?navigator.geolocation.getCurrentPosition(onSuccess,onFail):console.log("Geolocation is required for this page, but your browser doesn't support it. Try it with a browser that does")}function onSuccess(position){locOBJ.lat=position.coords.latitude,locOBJ.lon=position.coords.longitude,CBObj.params.lat=position.coords.latitude,CBObj.params.lon=position.coords.longitude,CBObj.cb(CBObj.params)}function onFail(){locOBJ.lat=0,locOBJ.lon=0,CBObj.cb(CBObj.param)}function HandleError(resp){XHR=null}function CB(){}$(document).on("click",".jsAttendanceClockBTN, .jsAttendanceBTN",(function(event){event.preventDefault(),CheckPost($(this).data("type"))})),$(document).on("click",".jsAttendanceViewLocation",(function(event){event.preventDefault();var data=$(this).closest(".jsAttendanceMyList").data();Model({Id:"jsAttendanceViewLocationModal",Title:"Location",Loader:"jsAttendanceViewLocationModalLoader",Body:'<div class="container"><iframe style="width:100%; height: 400px;" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://maps.google.com/maps?q='+data.lon+","+data.lat+'&hl=en&z=14&amp;output=embed"></iframe></div>'},(function(){ml(!1,"jsAttendanceViewLocationModalLoader")}))})),$(".jsDatePicker").datepicker({changeYear:!0,changeMonth:!0}),$(".jsAttendanceClockBTN").hide(0),$(".jsAttendanceBTN").addClass("dn"),CheckClock(),InitClock()}));