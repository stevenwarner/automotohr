$((function () { let t, e, i, o = { question_id: 0, question_title: "", question_required: !1, question_content: "", question_type: "text", choice_list: {}, video_type: "upload", video_file_name: "" }; $(document).on("click", ".jsModalCancel", (function () { i.close() })), $(document).on("change", "#jsEditQuestionType", (function () { $(".jsEditQuestionPlace").addClass("hidden"), "multiple_choice" === $(this).val() || "single_choice" === $(this).val() ? $(".jsEditQuestionChoice").removeClass("hidden") : "yes_no" === $(this).val() ? $(".jsEditQuestionYesNo").removeClass("hidden") : "rating" === $(this).val() && $(".jsEditQuestionRating").removeClass("hidden") })), $(document).on("change", ".jsEditQuestionVideoType", (function () { $(".jsEditQuestionUploadVideoBox").addClass("hidden"), $(".jsEditQuestionRecordVideoBox").addClass("hidden"), $(".jsEditQuestionLinkVideoBox").addClass("hidden"), i.close(), "upload" === $(this).val() ? $(".jsEditQuestionUploadVideoBox").removeClass("hidden") : "record" === $(this).val() ? ($(".jsEditQuestionRecordVideoBox").removeClass("hidden"), i.init()) : "link" === $(this).val() && $(".jsEditQuestionLinkVideoBox").removeClass("hidden") })), $(document).on("click", ".jsEditQuestionSaveBtn", (function (s) { s.preventDefault(), async function () { const s = []; o.question_required = $("#jsEditQuestionRequired").prop("checked"), o.question_title = $("#jsEditQuestionTitle").val().trim(), o.question_content = $("#jsEditQuestionHelp").val().trim(), o.question_type = $("#jsEditQuestionType").select2("val"), o.choice_list = {}, o.video_type = $(".jsEditQuestionVideoType:checked").val() || null, o.question_title || s.push('"Question" field is mandatory.'); o.question_type || s.push('"Question type" field is mandatory.'); "single_choice" === o.question_type || "multiple_choice" === o.question_type ? $(".csEditChoiceRow").map((function (t) { const e = { answer_choice: $(this).find(".jsEditQuestionChoiceAnswer").val().trim(), answer_score: $(this).find(".jsEditQuestionChoiceAnswerScore").val().trim(), answer_status: $(this).find(".jsEditQuestionChoiceAnswerStatus").val().trim() }; e.answer_choice || s.push('"Answer Choice" is missing for row ' + (t + 1) + "."), o.choice_list[t] = e })) : "yes_no" === o.question_type ? (o.choice_list.yes = { score: $("#jsEditQuestionYesNoYSelect option:checked").val(), status: $("#jsEditQuestionYesNoYStatus option:checked").val() }, o.choice_list.no = { score: $("#jsEditQuestionYesNoNSelect option:checked").val(), status: $("#jsEditQuestionYesNoNStatus option:checked").val() }) : "rating" === o.question_type && (o.choice_list = { rating: $("#jsEditQuestionRatingScale option:checked").val(), min: $("#jsEditQuestionRatingMinText").val() || "Very poor", max: $("#jsEditQuestionRatingMaxText").val() || "Very good" }); o.video_type || s.push('"Video type" field is mandatory.'); let n = {}, d = {}, l = !1; "upload" === o.video_type ? (n = $("#jsEditQuestionUploadVideo").msFileUploader("get"), Object.keys(n).length ? (n.errorCode && s.push(n.errorCode), l = !0) : o.video_file_name || s.push('"Video file" is mandatory. Please upload a file.')) : "record" === o.video_type ? (d = await i.getVideo(), 5 !== d.length || o.video_file_name ? l = !0 : s.push('"Video Recording" is mandatory. Please record a video.')) : "link" === o.video_type ? (o.video_file_name = $("#jsEditQuestionLink").val().trim(), o.video_file_name ? o.video_file_name.isValidYoutubeLink() || o.video_file_name.isValidVimeoLink() || s.push("Invalid YouTube / Vimeo link.") : s.push("YouTube / Vimeo link is required.")) : o.video_file_name = "none"; if (s.length) return alertify.alert("ERROR!", getErrorsStringFromArray(s), CB); if (t = callButtonHook($(".jsEditQuestionSaveBtn"), !0), l && "none" != o.video_type) { let e = {}; if ("upload" === o.video_type ? (e = await function (t) { const e = new FormData; return e.append("file", t), makeSecureCallToApiServer("uploader", { method: "POST", timeout: 0, processData: !1, mimeType: "multipart/form-data", contentType: !1, data: e }) }(n), "string" == typeof e && (e = JSON.parse(e))) : e = await (a = d, makeSecureCallToApiServer("uploader/stream", { method: "POST", timeout: 0, contentType: "application/json", data: JSON.stringify({ stream: a }) })), !Object.keys(e).length) return callButtonHook(t, !1), alertify.alert("ERROR!", "Failed to upload file.", CB); o.video_file_name = e.data } var a; i.close(), $("#jsEditQuestionUploadVideo").msFileUploader("clear"), callButtonHook(t, !1), e(o) }() })), $(document).on("click", ".jsEditChoiceAnswer", (function (t) { t.preventDefault(); $(".csEditChoiceBox").append('\n\t\t\x3c!-- secondary question row --\x3e\n\t\t<div class="csEditChoiceRow">\n\t\t\t<div class="row">\n\t\t\t\t<div class="col-xs-12 col-sm-5">\n\t\t\t\t\t<label>Answer Choice <strong class="text-danger">*</strong></label>\n\t\t\t\t\t<input type="text" class="form-control jsEditQuestionChoiceAnswer" />\n\t\t\t\t</div>\n\t\t\t\t<div class="col-xs-12 col-sm-3">\n\t\t\t\t\t<label>Question Score <strong class="text-danger">*</strong></label>\n\t\t\t\t\t<select class="form-control jsEditQuestionChoiceAnswerScore">\n\t\t\t\t\t\t<option value="0">Not acceptable - 0</option>\n\t\t\t\t\t\t<option value="1">Acceptable - 1</option>\n\t\t\t\t\t\t<option value="2">Good - 2</option>\n\t\t\t\t\t\t<option value="3">Very Good - 3</option>\n\t\t\t\t\t\t<option value="4">Excellent - 4</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="col-xs-12 col-sm-2">\n\t\t\t\t\t<label>Status <strong class="text-danger">*</strong></label>\n\t\t\t\t\t<select class="form-control jsEditQuestionChoiceAnswerStatus">\n\t\t\t\t\t\t<option value="pass">Pass</option>\n\t\t\t\t\t\t<option value="fail">Fail</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="col-xs-12 col-sm-1">\n\t\t\t\t\t<p>&nbsp;</p>\n\t\t\t\t\t<button class="btn btn-danger jsEditDeleteChoiceAnswer" type="button" title="Remove answer" placement="top">\n\t\t\t\t\t\t<i class="fa fa-times-circle" aria-hidden="true"></i>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<br />\n\t\t</div>\n\t\t\t\t') })), $(document).on("click", ".jsEditDeleteChoiceAnswer", (function (t) { t.preventDefault(), $(this).closest(".csChoiceRowEdit").remove() })), window.loadEditQuestionView = function (t, s) { if (o = t, e = s, i = new msVideoRecorder({ recorderPlayer: "jsEditQuestionRecordingLive", previewPlayer: "jsEditQuestionRecordingRecorded", recordButton: "jsEditQuestionRecordingStart", playRecordedVideoBTN: "jsEditQuestionRecordingPlay", pauseRecordedVideoBTN: "jsEditQuestionRecordingPause", resumeRecordedVideoBTN: "jsEditQuestionRecordingResume", removeRecordedVideoBTN: "jsEditQuestionRecordingRemove", errorSectionReference: "jsEditQuestionRecordingError" }), $("#jsEditQuestionUploadVideo").msFileUploader({ fileLimit: "200mb", allowedTypes: ["mp4", "mov"], placeholderImage: o.video_file_name }), $('#jsEditQuestionType option[value="' + o.question_type + '"]').prop("selected", !0), $("#jsEditQuestionType").select2({ minimumResultsForSearch: -1 }), $("#jsEditQuestionMultipleChoiceAnswer").select2({ minimumResultsForSearch: -1 }), $("#jsEditQuestionTitle").val(o.question_title), $("#jsEditQuestionRequired").prop("checked", o.question_required), $("#jsEditQuestionHelp").val(o.question_content), $('.jsEditQuestionVideoType[value="' + o.video_type + '"]').prop("checked", !0), "none" === o.video_type ? ($('.jsEditQuestionVideoType[value="' + o.video_type + '"]').prop("checked", !0), $(".jsEditQuestionUploadVideoBox").addClass("hidden"), $(".jsEditQuestionRecordVideoBox").addClass("hidden"), $(".jsEditQuestionLinkVideoBox").addClass("hidden"), $("#jsEditQuestionLink").val(o.video_file_name)) : "link" === o.video_type ? ($('.jsEditQuestionVideoType[value="' + o.video_type + '"]').prop("checked", !0), $(".jsEditQuestionUploadVideoBox").addClass("hidden"), $(".jsEditQuestionRecordVideoBox").addClass("hidden"), $(".jsEditQuestionLinkVideoBox").removeClass("hidden"), $("#jsEditQuestionLink").val(o.video_file_name)) : ($('.jsEditQuestionVideoType[value="upload"]').prop("checked", !0), $(".jsEditQuestionRecordVideoBox").addClass("hidden"), $(".jsEditQuestionUploadVideoBox").removeClass("hidden")), $('#jsEditQuestionYesNoYSelect option[value="0"]').prop("selected", !0), $('#jsEditQuestionYesNoYStatus option[value="pass"]').prop("selected", !0), $('#jsEditQuestionYesNoNSelect option[value="0"]').prop("selected", !0), $('#jsEditQuestionYesNoNStatus option[value="pass"]').prop("selected", !0), $(".csEditChoiceBox").html(""), $(".jsEditQuestionChoiceAnswer").val(""), $('#jsEditQuestionChoiceAnswerScore option[value="0"]').prop("selected", !0), $('#jsEditQuestionChoiceAnswerStatus option[value="pass"]').prop("selected", !0), $(".jsEditQuestionPlace").addClass("hidden"), "yes_no" === o.question_type) $(".jsEditQuestionYesNo").removeClass("hidden"), $('#jsEditQuestionYesNoYSelect option[value="' + o.choice_list.yes.score + '"]').prop("selected", !0), $('#jsEditQuestionYesNoYStatus option[value="' + o.choice_list.yes.status + '"]').prop("selected", !0), $('#jsEditQuestionYesNoNSelect option[value="' + o.choice_list.no.score + '"]').prop("selected", !0), $('#jsEditQuestionYesNoNStatus option[value="' + o.choice_list.no.status + '"]').prop("selected", !0); else if ("single_choice" === o.question_type || "multiple_choice" === o.question_type) { $(".jsEditQuestionChoice").removeClass("hidden"), $(".jsEditQuestionChoiceAnswerPrimary").val(o.choice_list[0].answer_choice), $('.jsEditQuestionChoiceAnswerPrimaryScore option[value="' + o.choice_list[0].answer_score + '"]').prop("selected", !0), $('.jsEditQuestionChoiceAnswerPrimaryStatus option[value="' + o.choice_list[0].answer_status + '"]').prop("selected", !0); for (const t in o.choice_list) 0 != t && $(".csEditChoiceBox").append(`\n\t\t\t\t\t\t\x3c!-- secondary question row --\x3e\n\t\t\t\t\t\t<div class="csEditChoiceRow">\n\t\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t\t<div class="col-xs-12 col-sm-5">\n\t\t\t\t\t\t\t\t\t<label>Answer Choice <strong class="text-danger">*</strong></label>\n\t\t\t\t\t\t\t\t\t<input type="text" class="form-control jsEditQuestionChoiceAnswer" value="${o.choice_list[t].answer_choice}" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="col-xs-12 col-sm-3">\n\t\t\t\t\t\t\t\t\t<label>Question Score <strong class="text-danger">*</strong></label>\n\t\t\t\t\t\t\t\t\t<select class="form-control jsEditQuestionChoiceAnswerScore">\n\t\t\t\t\t\t\t\t\t\t<option ${"0" === o.choice_list[t].answer_score ? "selected" : ""} value="0">Not acceptable - 0</option>\n\t\t\t\t\t\t\t\t\t\t<option ${"1" === o.choice_list[t].answer_score ? "selected" : ""} value="1">Acceptable - 1</option>\n\t\t\t\t\t\t\t\t\t\t<option ${"2" === o.choice_list[t].answer_score ? "selected" : ""} value="2">Good - 2</option>\n\t\t\t\t\t\t\t\t\t\t<option ${"3" === o.choice_list[t].answer_score ? "selected" : ""} value="3">Very Good - 3</option>\n\t\t\t\t\t\t\t\t\t\t<option ${"4" === o.choice_list[t].answer_score ? "selected" : ""} value="4">Excellent - 4</option>\n\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="col-xs-12 col-sm-2">\n\t\t\t\t\t\t\t\t\t<label>Status <strong class="text-danger">*</strong></label>\n\t\t\t\t\t\t\t\t\t<select class="form-control jsEditQuestionChoiceAnswerStatus">\n\t\t\t\t\t\t\t\t\t\t<option ${"pass" === o.choice_list[t].answer_status ? "selected" : ""} value="pass">Pass</option>\n\t\t\t\t\t\t\t\t\t\t<option ${"fail" === o.choice_list[t].answer_status ? "selected" : ""} value="fail">Fail</option>\n\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="col-xs-12 col-sm-1">\n\t\t\t\t\t\t\t\t\t<p>&nbsp;</p>\n\t\t\t\t\t\t\t\t\t<button class="btn btn-danger jsEditDeleteChoiceAnswer" type="button" title="Remove answer" placement="top">\n\t\t\t\t\t\t\t\t\t\t<i class="fa fa-times-circle" aria-hidden="true"></i>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t</div>\n\t\t\t\t`) } } }));