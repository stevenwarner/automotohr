<?php

class Department_management_model extends CI_Model {

    function __construct() {
        parent::__construct();
    }

    function fetch_all_company_employees($company_sid){
        $this->db->select('sid,first_name, last_name, email, job_title, access_level, access_level_plus, pay_plan_flag, is_executive_admin');
        $this->db->where('parent_sid', $company_sid);
        $this->db->where('active', 1);
        $this->db->where('terminated_status', 0);
        $this->db->order_by(SORT_COLUMN,SORT_ORDER);
        $result = $this->db->get('users')->result_array();
        return $result;
    }

    function get_all_departments($company_sid) {
        $this->db->select('*');
        $this->db->where('company_sid', $company_sid);
        $this->db->where('is_deleted', 0);
        $this->db->order_by('sort_order', 'asc');
        $record_obj = $this->db->get('departments_management');
        $record_arr = $record_obj->result_array();
        $record_obj->free_result();
        
        if (!empty($record_arr)) {
            return $record_arr;
        } else {
            return array();
        }
    }

    function get_department ($department_sid) {
        $this->db->select('*');
        $this->db->where('sid', $department_sid);
        $record_obj = $this->db->get('departments_management');
        $record_arr = $record_obj->result_array();
        $record_obj->free_result();
        
        if (!empty($record_arr)) {
            return $record_arr[0];
        } else {
            return array();
        }
    }

    function get_department_name ($department_sid) {
        $this->db->select('name');
        $this->db->where('sid', $department_sid);
        $record_obj = $this->db->get('departments_management');
        $record_arr = $record_obj->result_array();
        $record_obj->free_result();
        
        if (!empty($record_arr)) {
            return $record_arr[0]['name'];
        } else {
            return array();
        }
    }

    function get_team_name ($team_sid) {
        $this->db->select('name');
        $this->db->where('sid', $team_sid);
        $record_obj = $this->db->get('departments_team_management');
        $record_arr = $record_obj->result_array();
        $record_obj->free_result();
        
        if (!empty($record_arr)) {
            return $record_arr[0]['name'];
        } else {
            return array();
        }
    }

    function insert_department($data_to_insert) {
        $this->db->insert('departments_management', $data_to_insert);
    }

    function update_department($department_sid, $data_to_update) {
        $this->db->where('sid', $department_sid);
        $this->db->update('departments_management', $data_to_update);
    }

    function get_all_department_teams($company_sid, $department_sid) {
        $this->db->select('*');
        $this->db->where('company_sid', $company_sid);
        $this->db->where('department_sid', $department_sid);
        $this->db->where('is_deleted', 0);
        $this->db->order_by('sort_order', 'asc');
        $record_obj = $this->db->get('departments_team_management');
        $record_arr = $record_obj->result_array();
        $record_obj->free_result();
        
        if (!empty($record_arr)) {
            return $record_arr;
        } else {
            return array();
        }
    }

    function get_team ($team_sid) {
        $this->db->select('*');
        $this->db->where('sid', $team_sid);
        $record_obj = $this->db->get('departments_team_management');
        $record_arr = $record_obj->result_array();
        $record_obj->free_result();
        
        if (!empty($record_arr)) {
            return $record_arr[0];
        } else {
            return array();
        }
    }

    function insert_team($data_to_insert) {
        $this->db->insert('departments_team_management', $data_to_insert);
    }

    function update_team($team_sid, $data_to_update) {
        $this->db->where('sid', $team_sid);
        $this->db->update('departments_team_management', $data_to_update);
    }

    function delete_employees_from_team($department_sid, $team_sid) {
        $this->db->where('department_sid', $department_sid);
        $this->db->where('team_sid', $team_sid);
        $this->db->delete('departments_employee_2_team');
    }

    function assign_employee_to_team ($data_to_insert) {
        $this->db->insert('departments_employee_2_team', $data_to_insert);
    }
    function updateDepartmentTeamForEmployee ($departmentId, $teamId, $employeeId) {
        $this->db
        ->where('sid', $employeeId)
        ->update('users', array(
            'department_sid' => $departmentId,
            'team_sid' => $teamId
        ));
    }

    function get_all_employees_to_team($department_sid, $team_sid) {
        $this->db->select('employee_sid');
        $this->db->where('department_sid', $department_sid);
        $this->db->where('team_sid', $team_sid);
        $record_obj = $this->db->get('departments_employee_2_team');
        $record_arr = $record_obj->result_array();
        $record_obj->free_result();
        
        if (!empty($record_arr)) {
            return $record_arr;
        } else {
            return array();
        }
    }
}