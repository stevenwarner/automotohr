<?php if (!defined('BASEPATH')) exit('No direct script access allowed');

class Email_templates_model extends CI_Model {
    
    function get_all_templates($group) {
        $this->db->select('*');
        $this->db->where('group',$group);
        $this->db->from('email_templates');
        $this->db->order_by('sid', 'DESC');
        return $this->db->get()->result_array();
    }
    
    function get_all_templates_groups() {
        $this->db->distinct();
        $this->db->select('group');
        $this->db->group_by('group');
        $this->db->from('email_templates');
        return $this->db->get()->result_array();
    }
    
    
    public function save_template($data)
    {
        $this->db->insert('email_templates', $data);
        return ($this->db->affected_rows() != 1) ? $this->session->set_flashdata('message','<b>Failed: </b>Could not add new template, Please try Again!') : $this->session->set_flashdata('message','<b>Success: </b>New Email template added to system');
    }
  
    public function get_template()
    {
        $data =  $this->db->get('email_templates');
        return $data->result_object(); 
    }
    
    public function get_template_data($sid)
    {
        $this->db->select('*');
        $this->db->where('sid',$sid);
        $this->db->from('email_templates');
        return $this->db->get()->result_array(); 
    }
    
    public function update_email_template($sid, $data)
    {
       $this->db->where('sid', $sid);
       $result = $this->db->update('email_templates',$data);
       (!$result) ? $this->session->set_flashdata('message','<b>Error: </b>Update Failed, Please try Again!') : $this->session->set_flashdata('message', '<b>Success: </b>Email Template updated successfully');
       return true;    
    }
    
    public function delete_template($del_id)
    {
       $this->db->where('sid',$del_id);
       $this->db->delete('email_templates');
    }
    
    public function delete_image($del_id)
    {
     $data=array('file'=>'');
     $this->db->where('sid',$del_id);
     $this->db->update('email_templates',$data);
     }
}