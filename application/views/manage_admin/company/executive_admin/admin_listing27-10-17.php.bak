<?php defined('BASEPATH') OR exit('No direct script access allowed'); ?>
<div class="main">
    <div class="container-fluid">
        <div class="row">		
            <div class="inner-content">
                <?php $this->load->view('templates/_parts/admin_column_left_view'); ?>
                <div class="col-lg-9 col-md-9 col-xs-12 col-sm-9 no-padding">
                    <div class="dashboard-content">
                        <div class="dash-inner-block">
                            <div class="row">                                
                                <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12">
                                    <?php $this->load->view('templates/_parts/admin_flash_message'); ?>
                                    <div class="heading-title page-title">
                                        <h1 class="page-title"><i class="fa fa-users"></i><?php echo $page_title; ?></h1>
                                    </div>
                                    <?php if(check_access_permissions_for_view($security_details, 'manage_executive_admins')) { ?>
                                        <div class="add-new-promotions">
                                            <a class="btn btn-success" href="<?php echo base_url() . 'manage_admin/companies/add_executive_administrator/' ?>">Add New Executive Administrator</a>
                                        </div>
                                    <?php } ?>
                                    <div class="table-responsive hr-promotions">
                                        <div class="hr-displayResultsTable">
                                            <br>
                                            <form name="multiple_actions" id="multiple_actions_company" method="POST">
                                                <table class="table table-bordered table-hover table-striped">
                                                    <thead>
                                                        <tr>
                                                            <th>Contact Name</th>
                                                            <th>Username</th>
                                                            <th>Email</th>
                                                            <th>Job Title</th>
                                                            <th>Status</th>
                                                            <?php $function_names = array('manage_executive_admins', 'login_executive_admin'); ?>
                                                            <?php if(check_access_permissions_for_view($security_details, $function_names)) { ?>
                                                                <th colspan="4" class="text-center">Actions</th>
                                                            <?php } ?>
                                                        </tr> 
                                                    </thead>
                                                    <tbody>
                                                        <?php if(sizeof($administrators) > 0) { ?>
                                                        <?php foreach ($administrators as $admin) { ?>
                                                            <tr id='<?php echo $admin->sid; ?>'>
                                                                <td><?php echo $admin->first_name . ' ' . $admin->last_name; ?></td>
                                                                <td><?php echo $admin->username; ?></td>
                                                                <td><?php echo $admin->email; ?></td>
                                                                <td><?php echo $admin->job_title; ?></td>
                                                                <td id='status_<?php echo $admin->sid; ?>'>
                                                                    <?php
                                                                    if ($admin->active == '1') {
                                                                        echo 'Active';
                                                                    } else {
                                                                        echo 'Inactive';
                                                                    }
                                                                    ?>
                                                                </td>
                                                                <?php if(check_access_permissions_for_view($security_details, 'manage_executive_admins')) { ?>
                                                                    <td>
                                                                        <a class="btn btn-success btn-sm" href="<?php echo base_url() . 'manage_admin/companies/manage_executive_administrators/' . $admin->sid; ?>">
                                                                            Manage
                                                                        </a>
                                                                    </td>
                                                                <?php } ?>

                                                                <?php if(check_access_permissions_for_view($security_details, 'manage_executive_admins')) { ?>
                                                                    <td>
                                                                        <a class="btn btn-danger btn-sm" href="javascript:;" id='delete' name='delete' onclick='delete_administrator(<?php echo $admin->sid; ?>);'>
                                                                            Delete
                                                                        </a>
                                                                    </td>
                                                                <?php } ?>
                                                                <?php if(check_access_permissions_for_view($security_details, 'manage_executive_admins')) { ?>
                                                                <td>
                                                                    <a <?php if ($admin->active == '1') { ?> class="btn btn-danger btn-sm" <?php } else { ?> class="btn btn-success btn-sm" <?php } ?> href="javascript:;" id='activate_<?php echo $admin->sid; ?>' name='activate' onclick='activate_admin(<?php echo $admin->sid; ?>);'>
                                                                        <?php
                                                                        if ($admin->active == '1') {
                                                                            echo 'Deactivate';
                                                                        } else {
                                                                            echo 'Activate';
                                                                        }
                                                                        ?>
                                                                    </a>
                                                                </td>
                                                                <?php } ?>
                                                                <?php if(check_access_permissions_for_view($security_details, 'login_executive_admin')) { ?>
                                                                <td>
                                                                    <?php if($admin->active == '1') { ?>
                                                                        <form id="form_login_executive_admin_<?php echo $admin->sid; ?>" method="post" enctype="multipart/form-data" action="<?php echo current_url();?>">
                                                                            <input type="hidden" id="perform_action" name="perform_action" value="login_executive_admin" />
                                                                            <input type="hidden" id="executive_admin_sid" name="executive_admin_sid" value="<?php echo $admin->sid; ?>" />

                                                                            <button type="button" onclick="f_login_executive_admin(<?php echo $admin->sid; ?>);" class="btn btn-success btn-sm">Login</button>
                                                                        </form>
                                                                    <?php } else { ?>
                                                                        <button type="button" onclick="" class="btn btn-success btn-sm disabled">Login</button>
                                                                    <?php } ?>
                                                                </td>
                                                                <?php } ?>
                                                            </tr>
                                                        <?php } ?>
                                                        <?php } else { ?>
                                                            <tr>
                                                                <td colspan='6'>No administrator found.</td>
                                                            </tr>
                                                        <?php } ?>
                                                    </tbody>
                                                </table>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    function f_login_executive_admin(executive_admin_sid){
        var my_request;

        my_request = $.ajax({
            url: '<?php echo current_url();?>',
            method: 'POST',
            data: { 'executive_admin_sid': executive_admin_sid }
        });

        my_request.done(function (response) {
            if(response == 'session_created'){
                window.open('<?php echo STORE_PROTOCOL.$_SERVER['HTTP_HOST'].str_replace(basename($_SERVER['SCRIPT_NAME']), '', $_SERVER['SCRIPT_NAME']).'executive_admin/dashboard'; ?>');
            } else {
                alertify.error('Something Went Wrong!');
            }
        });
    }

    function delete_administrator(administrator_sid)
    {
        alertify.confirm("Delete Administrator", "Are you sure you want to delete this administrator?",
                function () {
                    var myUrl = "<?= base_url('manage_admin/companies/executive_admin_delete_ajax') ?>";

                    var myRequest;
                    myRequest = $.ajax({
                        url: myUrl,
                        type: 'post',
                        data: {'administrator_sid': administrator_sid}
                    });

                    myRequest.done(function (response) {
                        if (response)
                        {
                            $('#'+administrator_sid).hide();
                            alertify.notify('Administrator deleted successfully.', 'success');
                        }
                        else
                        {
                            alertify.error('An unknown error occurred. Please try again.');
                        }
                    });
                },
                function () {
                    alertify.error('Cancelled');
                });
    }

    function activate_admin(administrator_sid)
    {
        alertify.confirm("Change Administrator Status", "Are you sure you want to change status for this administrator?",
                function () {
                    var myUrl = "<?= base_url('manage_admin/companies/executive_admin_activation_ajax') ?>";

                    var myRequest;
                    myRequest = $.ajax({
                        url: myUrl,
                        type: 'post',
                        data: { 'administrator_sid': administrator_sid }
                    });

                    myRequest.done(function (response) {
                        if (response)
                        {
                            status = ($('#status_' + administrator_sid).text()).trim();
                            if (status == 'Active')
                            {
                                $('#status_' + administrator_sid).text('Inactive');
                                $('#activate_' + administrator_sid).text('Activate');
                                $('#activate_' + administrator_sid).removeClass("hr-delete-btn");
                                $('#activate_' + administrator_sid).addClass("hr-edit-btn");
                            }
                            else
                            {
                                $('#status_' + administrator_sid).text('Active');
                                $('#activate_' + administrator_sid).text('Deactivate');
                                $('#activate_' + administrator_sid).removeClass("hr-edit-btn");
                                $('#activate_' + administrator_sid).addClass("hr-delete-btn");
                            }

                            alertify.notify('Administrator status changed successfully.', 'success');

                            window.location.href = window.location.href;
                        }
                        else
                        {
                            alertify.error('An unknown error occurred. Please try again.');
                        }
                    });
                },
                function () {
                    alertify.error('Cancelled');
                });
    }
</script>