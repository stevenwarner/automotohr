<div class="main-content">
    <div class="dashboard-wrp">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-3 col-md-3 col-xs-12 col-sm-4">
                    <?php $this->load->view('main/manage_ems_left_view'); ?>
                </div>
                <div class="col-lg-9 col-md-9 col-xs-12 col-sm-8">
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12">
                            <?php $this->load->view('templates/_parts/admin_flash_message'); ?>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12">
                            <div class="page-header-area">
                                <span class="page-heading down-arrow">
                                    <a class="dashboard-link-btn" href="<?php echo base_url('learning_center'); ?>"><i class="fa fa-chevron-left"></i>Learning Center</a>
                                    <?php echo $title; ?>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <?php if (check_access_permissions_for_view($security_details, 'add_training_session')) { ?>
                            <div class="col-lg-3 col-md-3 col-xs-3 col-sm-3">
                                <a href="<?php echo base_url('learning_center/add_training_session'); ?>" class="btn btn-success btn-block">Add New Session</a>
                            </div>
                        <?php } ?>
                        <div class="col-lg-3 col-md-3 col-xs-3 col-sm-3"></div>
                        <div class="col-lg-3 col-md-3 col-xs-3 col-sm-3"></div>
                        <div class="col-lg-3 col-md-3 col-xs-3 col-sm-3"></div>
                    </div>
                    <hr />
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12">
                            <div class="table-responsive">
                                <table class="table table-bordered table-hover table-striped">
                                    <thead>
                                        <tr>
                                            <th rowspan="2" class="col-xs-5 valign-middle">Topic</th>
                                            <th rowspan="2" class="col-xs-1 text-center valign-middle">Date</th>
                                            <th colspan="2" class="col-xs-1 text-center valign-middle">Time</th>
                                            <?php if (check_access_permissions_for_view($security_details, 'status_ajax_responder')) { ?>
                                                <th rowspan="2" class="col-xs-2 text-center valign-middle">Status</th>
                                            <?php } ?>
                                            <?php if (check_access_permissions_for_view($security_details, 'edit_training_session') || check_access_permissions_for_view($security_details, 'delete_training_sessions')) { ?>
                                                <th rowspan="2" class="col-xs-2 text-center valign-middle" colspan="2">Actions</th>
                                            <?php } ?>
                                        </tr>
                                        <tr>
                                            <th class="col-xs-1 text-center valign-middle">Start</th>
                                            <th class="col-xs-1 text-center valign-middle">End</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <?php if (!empty($sessions)) { ?>
                                            <?php foreach ($sessions as $session) { ?>
                                                <tr>
                                                    <td><?php echo $session['session_topic']; ?></td>
                                                    <td class="text-center"><?php echo date('m-d-Y', strtotime($session['session_date'])); ?></td>
                                                    <td class="text-center"><?php echo date('H:i', strtotime($session['session_start_time'])); ?></td>
                                                    <td class="text-center"><?php echo date('H:i', strtotime($session['session_end_time'])); ?></td>
                                                    <?php if (check_access_permissions_for_view($security_details, 'status_ajax_responder')) { ?>
                                                        <td>
                                                            <div class="form-group-sm">
                                                                <?php $session_status = $session['session_status']; ?>
                                                                <select onchange="func_update_session_status(this);" data-session_sid="<?php echo $session['sid']; ?>" id="session_status" name="session_status" class="form-control">
                                                                    <?php $default_selected = $session_status == 'scheduled' ? true : false; ?>
                                                                    <option <?php echo set_select('session_status', 'scheduled', $default_selected); ?> value="scheduled">Scheduled</option>
                                                                    <?php $default_selected = $session_status == 'cancelled' ? true : false; ?>
                                                                    <option <?php echo set_select('session_status', 'cancelled', $default_selected); ?> value="cancelled">Cancelled</option>
                                                                    <?php $default_selected = $session_status == 'completed' ? true : false; ?>
                                                                    <option <?php echo set_select('session_status', 'completed', $default_selected); ?>  value="completed">Completed</option>
                                                                </select>
                                                            </div>
                                                        </td>
                                                    <?php } ?>
                                                    <?php if (check_access_permissions_for_view($security_details, 'edit_training_session')) { ?>
                                                        <td>
                                                            <a href="<?php echo base_url('learning_center/edit_training_session/' . $session['sid']); ?>" class="btn btn-block btn-success btn-sm">Edit</a>
                                                        </td>
                                                    <?php } if (check_access_permissions_for_view($security_details, 'delete_training_sessions')) { ?>
                                                        <td>
                                                            <form id="form_delete_training_session_<?php echo $session['sid']; ?>" method="post" enctype="multipart/form-data" action="<?php echo current_url(); ?>">
                                                                <input type="hidden" id="perform_action" name="perform_action" value="delete_training_session" />
                                                                <input type="hidden" id="session_sid" name="session_sid" value="<?php echo $session['sid']; ?>" />
                                                            </form>
                                                            <button onclick="func_delete_training_session(<?php echo $session['sid']; ?>);" class="btn btn-block btn-danger btn-sm">Delete</button>
                                                        </td>
                                                    <?php } ?>
                                                </tr>
                                            <?php } ?>
                                        <?php } else { ?>
                                            <tr>
                                                <td colspan="6">
                                                    <span class="no-data">No Sessions</span>
                                                </td>
                                            </tr>
                                        <?php } ?>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function func_delete_training_session(session_sid) {
        alertify.confirm(
                'Are you Sure?',
                'Are you sure you want to delete this training Session?',
                function () {
                    $('#form_delete_training_session_' + session_sid).submit();
                },
                function () {
                    alertify.error('Cancelled!');
                }
        );
    }

    function func_update_session_status(source) {
        var session_sid = $(source).attr('data-session_sid');
        var session_status = $(source).val();

        var my_request;

        $('select').prop('disabled', true);
        my_request = $.ajax({
            url: '<?php echo base_url('learning_center/ajax_responder'); ?>',
            type: 'POST',
            data: {
                'perform_action': 'update_session_status',
                'session_sid': session_sid,
                'session_status': session_status
            }
        });

        my_request.done(function (response) {
            $('select').prop('disabled', false);
            if (response == 'success') {
                alertify.success('Session Status Successfully Updated!');
            } else {
                alertify.error('Could Not Update Session Status!');
            }
        });
    }
</script>