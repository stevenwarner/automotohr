<?php

//$load_view = 'old';
//
//if ($this->session->userdata('logged_in')) {
//    if (!isset($session)) {
//        $session = $this->session->userdata('logged_in');
//    }
//    $access_level = $session['employer_detail']['access_level'];
//
//    if ($access_level == 'Employee') {
//        $load_view = 'new';
//    }
//}

?>
<?php if (!$load_view) { ?>

<div class="main-content">
    <div class="dashboard-wrp">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-9 col-md-9 col-xs-12 col-sm-8">
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12">
                            <?php $this->load->view('templates/_parts/admin_flash_message'); ?>

                            <?php $this->load->view('manage_employer/employee_management/employee_profile_ats_view_top'); ?>

                            <div class="page-header-area margin-top">
                                <span class="page-heading down-arrow">                                    <a class="dashboard-link-btn" href="<?php echo $return_title_heading_link; ?>"><i class="fa fa-chevron-left"></i><?php echo $return_title_heading; ?></a>
                                    <?php echo $title; ?></span>
                            </div>
                            <div class="dashboard-conetnt-wrp">
                                <div class="tagline-heading">
                                    <h4>Add a Spouse / Domestic Partner</h4>
                                </div>
                                <form id="dependantForm" action="" method="post">
                                    <div class="universal-form-style-v2">
                                        <ul>
                                            <li class="form-col-50-left">
                                                <label>First Name<span class="staric">*</span></label>
                                                <input name="first_name" value="<?php
                                                if (isset($dependant_info['first_name'])) {
                                                    echo $dependant_info['first_name'];
                                                }
                                                ?>" type="text" class="invoice-fields">
                                            </li>
                                            <li class="form-col-50-right">
                                                <label>Last Name<span class="staric">*</span></label>
                                                <input value="<?php
                                                if (isset($dependant_info['last_name'])) {
                                                    echo $dependant_info['last_name'];
                                                }
                                                ?>" name="last_name" type="text" class="invoice-fields">
                                            </li>
                                            <li class="form-col-50-left">
                                                <label>Address<span class="staric">*</span></label>
                                                <input value="<?php
                                                if (isset($dependant_info['address'])) {
                                                    echo $dependant_info['address'];
                                                }
                                                ?>" name="address" type="text" class="invoice-fields">
                                            </li>
                                            <li class="form-col-50-right">
                                                <label>Address Line 2</label>
                                                <input value="<?php
                                                if (isset($dependant_info['address_line'])) {
                                                    echo $dependant_info['address_line'];
                                                }
                                                ?>" name="address_line" type="text" class="invoice-fields">
                                            </li>
                                            <li class="form-col-50-left">
                                                <label>Country:</label>  
                                                <div class="hr-select-dropdown">								
                                                    <select class="invoice-fields" id="country" name="Location_Country" onchange="getStates(this.value, <?php echo $states; ?>)">
                                                        <option value="">Select Country</option>
                                                        <?php foreach ($active_countries as $active_country) { ?>
                                                            <option value="<?php echo $active_country["sid"]; ?>"
                                                            <?php
                                                            if ($dependant_info['Location_Country'] == $active_country["sid"]) {
                                                                echo "selected";
                                                            }
                                                            ?>>
                                                                        <?php echo $active_country["country_name"]; ?>
                                                            </option>
                                                        <?php } ?>
                                                    </select>
                                                </div>								
                                            </li>
                                            <p style="display: none"  id="state_id"><?php echo set_value('Location_State', $dependant_info['Location_State']); ?></p>
                                            <li class="form-col-50-right">
                                                <label>State:</label>  
                                                <div class="hr-select-dropdown">								
                                                    <select class="invoice-fields" name="Location_State" id="state">
                                                        <option value="">Select State</option>  
                                                        <option value="">Please Select your country</option> 
                                                    </select>
                                                </div>								
                                            </li>
                                            <li class="form-col-50-left">
                                                <label>City</label>
                                                <input value="<?php
                                                if (isset($dependant_info['city'])) {
                                                    echo $dependant_info['city'];
                                                }
                                                ?>" name="city" type="text" class="invoice-fields">
                                            </li>
                                            <li class="form-col-50-right">
                                                <label>Postal Code</label>
                                                <input value="<?php
                                                if (isset($dependant_info['postal_code'])) {
                                                    echo $dependant_info['postal_code'];
                                                }
                                                ?>" name="postal_code" type="text" class="invoice-fields">
                                            </li>
                                            <li class="form-col-50-left">
                                                <label>Phone<span class="staric">*</span></label>
                                                <input value="<?php
                                                if (isset($dependant_info['phone'])) {
                                                    echo $dependant_info['phone'];
                                                }
                                                ?>" name="phone" type="text" class="invoice-fields">
                                            </li>
                                            <li class="form-col-50-right">
                                                <label>Birth Date</label>
                                                <input value="<?php
                                                if (isset($dependant_info['birth_date'])) {
                                                    echo $dependant_info['birth_date'];
                                                }
                                                ?>" name="birth_date" type="text" readonly class="eventdate invoice-fields">
                                            </li>
                                            <li class="form-col-50-left">
                                                <label>Relationship<span class="staric">*</span></label>
                                                <input value="<?php
                                                if (isset($dependant_info['relationship'])) {
                                                    echo $dependant_info['relationship'];
                                                }
                                                ?>" name="relationship" type="text" class="invoice-fields">
                                            </li>
                                            <li class="form-col-50-right">
                                                <label>SSN#</label>
                                                <input value="<?php
                                                if (isset($dependant_info['ssn'])) {
                                                    echo $dependant_info['ssn'];
                                                }
                                                ?>" name="ssn" type="text" class="invoice-fields">
                                            </li>
                                            <li class="form-col-50-left">
                                                <label>Gender</label>
                                                <div class="hr-select-dropdown">
                                                    <select name="gender" class="invoice-fields">
                                                        <option <?php if (isset($dependant_info['gender']) && $dependant_info['gender'] == "male") { ?> selected <?php } ?>  value="male">Male</option>    
                                                        <option <?php if (isset($dependant_info['gender']) && $dependant_info['gender'] == "female") { ?> selected <?php } ?>  value="female">Female</option>   
                                                    </select>
                                                </div>
                                            </li>
                                            <li class="form-col-100 autoheight send-email">
                                                <input name="family_member" <?php if (isset($dependant_info['family_member']) && $dependant_info['family_member'] == 'on') { ?> checked <?php } ?>   type="checkbox" id="add_family_member">
                                                <label for="add_family_member">Add Family Members</label>
                                            </li>
                                            <div class="btn-panel">
                                                <input type="submit" class="submit-btn" onclick="validate_form()" value="Save">
                                                <input type="button" value="Cancel" class="submit-btn btn-cancel" onClick="document.location.href = '<?php echo base_url($cancel_url); ?>'" />
                                            </div>
                                        </ul>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <?php $this->load->view($left_navigation); ?>

            </div>
        </div>
    </div>
</div>
<script language = "JavaScript" type = "text/javascript" src = "<?= base_url('assets') ?>/js/jquery.validate.min.js" ></script>
<script language="JavaScript" type="text/javascript" src="<?= base_url('assets') ?>/js/additional-methods.min.js"></script>
<script type="text/javascript">
                                                    function validate_form() {
                                                        $("#dependantForm").validate({
                                                            ignore: ":hidden:not(select)",
                                                            rules: {
                                                                first_name: {
                                                                    required: true,
                                                                    pattern: /^[a-zA-Z0-9\- ]+$/
                                                                },
                                                                last_name: {
                                                                    required: true,
                                                                    pattern: /^[a-zA-Z0-9\- ]+$/
                                                                },
                                                                address: {
                                                                    required: true,
                                                                    pattern: /^[a-zA-Z0-9\-, ]+$/
                                                                },
                                                                phone: {
                                                                    required: true,
                                                                    pattern: /^[0-9\-+ ]+$/
                                                                },
                                                                relationship: {
                                                                    required: true,
                                                                    pattern: /^[a-zA-Z\-#,':;. ]+$/
                                                                }
                                                            },
                                                            messages: {
                                                                first_name: {
                                                                    required: 'First name is required',
                                                                    pattern: 'Please provide valid first name'
                                                                },
                                                                last_name: {
                                                                    required: 'Last name is required',
                                                                    pattern: 'Please provide valid last name'
                                                                },
                                                                address: {
                                                                    required: 'Address is required',
                                                                    pattern: 'Please provide valid address'
                                                                },
                                                                phone: {
                                                                    required: 'Phone Number is required',
                                                                    pattern: 'Numbers and dashes only please'
                                                                },
                                                                relationship: {
                                                                    required: 'Relationship is required',
                                                                    pattern: 'Please provide valid relation'
                                                                }
                                                            },
                                                            submitHandler: function (form) {
                                                                form.submit();
                                                            }
                                                        });
                                                    }


                                                    $(document).ready(function () {
                                                        var myid = $('#state_id').html();
                                                        setTimeout(function () {
                                                            $("#country").change();
                                                        }, 1000);
                                                        if (myid) {
                                                            setTimeout(function () {
                                                                $('#state').val(myid);
                                                            }, 1200);
                                                        }
                                                    });
                                                    function getStates(val, states) {
                                                        var html = '';
                                                        if (val == '') {
                                                            $('#state').html('<option value="">Select State</option><option value="">Please Select your country</option>');
                                                        } else {
                                                            allstates = states[val];
                                                            for (var i = 0; i < allstates.length; i++) {
                                                                var id = allstates[i].sid;
                                                                var name = allstates[i].state_name;
                                                                html += '<option value="' + id + '">' + name + '</option>';
                                                            }
                                                            $('#state').html(html);
                                                        }
                                                    }
</script>

<?php } else { ?>
    <?php $this->load->view('onboarding/edit_dependents'); ?>
<?php } ?>
