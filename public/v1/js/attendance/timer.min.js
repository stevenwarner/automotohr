!function(){let a,n=0;$(document).on("click",".jsModalCancel",t=>{t.preventDefault(),"yes"==$(t.target).data("ask")?alertify.confirm("Any unsaved changes will be lost.",()=>{$(t.target).closest(".csModal").fadeOut(300),$("body").css("overflow-y","auto"),$("#ui-datepicker-div").remove(),$(".jsMsModal").remove()}).set("labels",{ok:"LEAVE",cancel:"NO, I WILL STAY"}).set("title","Notice!"):($(t.target).closest(".csModal").fadeOut(300),$("body").css("overflow-y","auto"),$(".jsMsModal").remove(),$("#ui-datepicker-div").remove())}),window._ml=window.ml=function(t,e,o){e=void 0===e?".jsIPLoader":`.jsIPLoader[data-page="${e}"]`,void 0!==a&&document.getElementsByClassName("csModalBody").length&&(document.getElementsByClassName("csModalBody")[0].scrollTop=0),void 0!==a&&t&&$(".jsIPLoader").height($(`#${a}Body`).height()+n),void 0===t||!1===t?$(e).hide():$(e).show(),void 0!==o&&$(".jsIPLoaderText").html(o),t||$(".jsIPLoaderText").html("Please wait, while we are generating a preview.")},window.Model=window.Modal=function(t,e){var o=`
			<!-- Custom Modal -->
			<div class="csModal jsMsModal" id="${t.Id}">
				<div class="${t.Cl||"container"}">
					<div class="csModalHeader">
						<h3 class="csModalHeaderTitle">
							<span>${t.Title}</span>
							<span class="csModalButtonWrap">
							${void 0!==t.Buttons&&0!==t.Buttons.length?t.Buttons.join(""):""}
								<button class="btn btn-black btn-cancel csW jsModalCancel" ${void 0===t.Ask?"":'data-ask="no"'} title="Close this window">Cancel</button>
							</span>
							<div class="clearfix"></div>
						</h3>
					</div>
					<div class="csModalBody">
						<div class="csIPLoader jsIPLoader" data-page="${t.Loader}">
							<div class="csIPLoaderBox">
								<i class="fa fa-circle-o-notch fa-spin" aria-hidden="true"></i><br><br>
								<br>
								<span class="jsIPLoaderText">Please wait while we process your request.</span>
							</div>
						</div>
						${t.Body}
					</div>
					<div class="clearfix"></div>
				</div>
			</div>
			`;a=t.Id,n=$(`#${t.Id} .csModalHeader`).height()+50,$(".jsMsModal").remove(),$("#"+t.Id).remove(),$("body").append(o),$("#"+t.Id).fadeIn(300),$("body").css("overflow-y","hidden"),$(`#${t.Id} .csModalBody`).css("top",n),void 0!==e&&e()}}(),$(function(){let r=null,a,n,s,l,c,i={};function d(t){t||m(),$.ajax({url:baseUrl("v1/clock"),method:"GET"}).always(function(){r=null}).fail(handleErrorResponse).done(function(e){i=e,clearInterval(l),clearInterval(c),""===e.state||"clocked_out"==e.state?m():(a=e.clock_time,n=e.time,s=e.timezone,l=setInterval(h,1e3));{var o=e.state;let t="";"clocked_in"===o||"break_ended"===o?t=(t+=b("break_start"))+b("clocked_out"):"break_started"===o?t=(t+=b("break_end"))+b("clocked_out"):t+=b("clocked_in"),$(".jsAttendanceBTNs").html(t),$(".jsAttendanceClockHeaderBTNs").html(t)}"clocked_out"==e.state&&(o=function(t){t={hours:Math.floor(t/3600),minutes:Math.floor(t%3600/60),seconds:t%60};return t.hours=1===t.hours.toString().length?"0"+t.hours:t.hours,t.minutes=1===t.minutes.toString().length?"0"+t.minutes:t.minutes,t.seconds=1===t.seconds.toString().length?"0"+t.seconds:t.seconds,t}(o=e.time),$(".jsAttendanceClockHour").html(o.hours),$(".jsAttendanceClockMinute").html(o.minutes),$(".jsAttendanceClockSeconds").html(o.seconds),$(".jsAttendanceClockSeparator").html(":")),c=setInterval(k,1e3),e.blocked&&($(".jsAttendanceBTNs").html(""),$(".jsAttendanceClockHeaderBTNs").html(""))})}function u(e,o,a,n,t){if(null===r){const l=callButtonHook($(`.jsAttendanceBtn[data-type="${e}"]`),!0);var s={type:e,latitude:o,longitude:a,job_site:n};void 0!==t&&(s.confirmed=t),r=$.ajax({url:baseUrl("v1/clock/mark"),method:"POST",data:JSON.stringify(s),headers:{"content-type":"application/json"}}).always(function(){callButtonHook(l,!1),r=null}).fail(handleErrorResponse).done(function(t){if(console.log(t),t.confirm)return _confirm(t.msg,function(){u(e,o,a,n,!0)});_success("You have successfully "+f(e)+"."),d()})}}function m(){a="",n="",clearInterval(l),$(".jsAttendanceClockHour").html("00"),$(".jsAttendanceClockMinute").html("00"),$(".jsAttendanceClockSeconds").html("00"),$(".jsAttendanceClockSeparator").html(":"),$(".jsAttendanceBTNs").html(""),$(".jsAttendanceClockHeaderBTNs").html("")}function h(){var t,e;a?(e=moment.utc(a).tz(s).subtract(n,"seconds"),t=moment.utc().tz(s),console.log(t),t=t.diff(e),e=moment(t).utc().tz(s),$(".jsAttendanceClockHour").html(e.format("HH")),$(".jsAttendanceClockMinute").html(e.format("mm")),$(".jsAttendanceClockSeconds").html(e.format("ss"))):($(".jsAttendanceClockHour").html("00"),$(".jsAttendanceClockMinute").html("00"),$(".jsAttendanceClockSeconds").html("00")),$(".jsAttendanceClockSeparator").html(":")}function k(){var t=moment.tz(i.timezone),e=moment.tz(i.timerDateTime,i.timezone),t=t.diff(i.timerDateTime);e.add(t,"milliseconds"),$(".jsAttendanceCurrentClockDateTime").text(e.format("MMM D YYYY, ddd HH:mm:ss")),$(".jsAttendanceLoader").hide()}function b(t){let e="";return"clocked_in"===t?e=(e+='<button class="btn btn-orange jsAttendanceBtn" data-type="clocked_in">\t<i class="fa fa-play-circle csF16" aria-hidden="true"></i>')+"\t&nbsp;Clock in</button>":"clocked_out"===t?e=(e+='&nbsp;<button class="btn btn-red jsAttendanceBtn" data-type="clocked_out">\t<i class="fa fa-stop-circle csF16" aria-hidden="true"></i>')+"\t&nbsp;Clock out</button>":"break_start"===t?e=(e+='&nbsp;<button class="btn btn-black jsAttendanceBtn" data-type="break_started">\t<i class="fa fa-pause-circle csF16" aria-hidden="true"></i>')+"\t&nbsp;Break start</button>":"break_end"===t&&(e=(e+='&nbsp;<button class="btn btn-yellow jsAttendanceBtn" data-type="break_ended">\t<i class="fa fa-stop csF16" aria-hidden="true"></i>')+"\t&nbsp;Break end</button>"),e}function o(e,o=null){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){u(e,t.coords.latitude,t.coords.longitude,o)},function(){return alertify.alert("Location permission denied!",""+'<p>The "location" permission is denied on your browser. Please allow the location before you can mark your attendance \t\t\t\tPlease follow the following steps to allow location permission.</p><br /> \t\t\t\t<ol>   \t\t\t\t<li>On your computer, open Chrome <img src="//storage.googleapis.com/support-kms-prod/Y57p9LEW3v1cnw4Svh3a53DOnyRPFkiDfTDc" width="18" height="18" alt="Chrome" data-mime-type="image/png">.</li>   \t\t\t\t<li>At the top right, click More <img src="//lh3.googleusercontent.com/E2q6Vj9j60Dw0Z6NZFEx5vSB9yoZJp7C8suuvQXVA_2weMCXstGD7JEvNrzX3wuQrPtL=w36-h36" width="18" height="18" alt="More" data-mime-type="image/png" data-alt-src="//lh3.googleusercontent.com/E2q6Vj9j60Dw0Z6NZFEx5vSB9yoZJp7C8suuvQXVA_2weMCXstGD7JEvNrzX3wuQrPtL"> <img src="//lh3.googleusercontent.com/3_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw=w36-h36" width="18" height="18" alt="and then" data-mime-type="image/png" data-alt-src="//lh3.googleusercontent.com/3_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw"> <strong>Settings</strong>.</li>   \t\t\t\t<li>Click <strong>Privacy and security</strong>&nbsp;<img src="//lh3.googleusercontent.com/3_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw=w36-h36" width="18" height="18" alt="and then" data-mime-type="image/png" data-alt-src="//lh3.googleusercontent.com/3_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw">&nbsp;<strong>Site Settings</strong>.</li>   \t\t\t\t<li data-outlined="false" class="">Click <strong>Location</strong>.</li>   \t\t\t\t<li>Choose the option you want as your default setting.</li> \t\t\t</ol>')}):(u(e,0,0),console.log("Geolocation is required for this page, but your browser doesn't support it. Try it with a browser that does"))}function f(t){return{clocked_in:"Clocked In",clocked_out:"Clocked Out",break_started:"Started your break",break_ended:"Ended your break",clocked_in_confirm:"clock in",clocked_out_confirm:"clock out",break_started_confirm:"start your break",break_ended_confirm:"end your break"}[t]}$(document).on("click",".jsAttendanceBtn",function(t){t.preventDefault(),t.stopPropagation();const e=$(this).data("type");return _confirm("Do you want to "+f(e+"_confirm")+"?",function(){"clocked_in"===e&&i.job_sites.length?Modal({Id:"jsJobSiteModal",Title:"Select a job site.",Loader:"jsJobSiteModalLoader",Body:function(){let e="";return e=(e=(e=(e=(e=(e+='<div class="container" id="jsJobSiteModalBody">')+'\t<br /><div class="row">\t\t<div class="col-sm-12">')+'\t\t\t<form id="jsJobSiteModalForm">\t\t\t\t<div class="form-group">')+'\t\t\t\t\t<label class="tex-medium">\t\t\t\t\t\tPlease select a job site')+'\t\t\t\t\t\t<strong class="text-danger"></strong>\t\t\t\t\t</label>')+'\t\t\t\t\t<select class="form-control jsJobSiteModalSelect">\t\t\t\t\t\t<option value="0">Clock in without job site</option>',i.job_sites.map(function(t){e+='\t\t\t\t\t\t<option value="'+t.sid+'">'+t.site_name+"</option>"}),e=(e=(e=(e=(e=(e+="\t\t\t\t\t</select>")+'\t\t\t\t</div>\t\t\t\t<div class="form-group text-right">')+'\t\t\t\t\t<button class="btn btn-success">\t\t\t\t\t\tClock In')+"\t\t\t\t\t</button>\t\t\t\t</div>")+"\t\t\t</form>\t\t</div>")+"\t</div></div>"}()},function(){ml(!1,"jsJobSiteModalLoader"),$("#jsJobSiteModalBody").submit(function(t){t.preventDefault(),o("clocked_in",$(".jsJobSiteModalSelect option:selected").val()),$("#jsJobSiteModal").find(".jsModalCancel").click()})}):"break_started"===e&&i.allowed_breaks.length?Modal({Id:"jsBreaksModal",Title:"Select a break.",Loader:"jsBreaksModalLoader",Body:function(){let a="";return a=(a=(a=(a=(a+='<div class="container" id="jsBreaksModalBody">\t<br /><div class="row">')+'\t\t<div class="col-sm-12">\t\t\t<form id="jsBreaksModelForm">')+'\t\t\t\t<div class="form-group">\t\t\t\t\t<label class="tex-medium">')+'\t\t\t\t\t\tPlease select a break\t\t\t\t\t\t<strong class="text-danger"></strong>')+'\t\t\t\t\t</label>\t\t\t\t\t<select class="form-control jsBreaksModelSelect">',i.allowed_breaks.map(function(t){let e=t.duration+"m";t.start_time&&(e=t.start_time+" - "+t.end_time);var o=function(e){let o=!1;var a=i.breaks.length;for(let t=0;t<a;t++)if(i.breaks[t].id==e){o=!0;break}return o}(t.id);a+="\t\t\t\t\t\t<option "+(o?"disabled":"")+' value="'+t.id+'">'+t.break+" ("+e+")</option>"}),a=(a=(a=(a=(a=(a+="\t\t\t\t\t</select>")+'\t\t\t\t</div>\t\t\t\t<div class="form-group text-right">')+'\t\t\t\t\t<button class="btn btn-success">\t\t\t\t\t\tStart Break')+"\t\t\t\t\t</button>\t\t\t\t</div>")+"\t\t\t</form>\t\t</div>")+"\t</div></div>"}()},function(){ml(!1,"jsBreaksModalLoader"),$("#jsBreaksModalBody").submit(function(t){t.preventDefault();const e=$(".jsBreaksModelSelect option:selected").val();return i.allowed_breaks&&i.allowed_breaks.length==i.breaks?_error("You have already taken allowed breaks."):(t=i.allowed_breaks.filter(function(t){return t.id==e}))[0].start_time&&""!=t[0].start_time&&moment()<moment(t[0].start_time,"hh:mm a")?_error('You can not start break before "'+t[0].start_time+'".'):t[0].end_time&&""!=t[0].end_time&&moment()>moment(t[0].end_time,"hh:mm a")?_error('You can not start break after "'+t[0].end_time+'".'):(o("break_started",e),void $("#jsBreaksModal").find(".jsModalCancel").click())})}):o(e)})}),setInterval(function(){d(!0)},1e4),c=setInterval(k,1e3),d()});
