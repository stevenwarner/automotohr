$(function(){let s=null,n,a,r,l,c={};function i(t){t||u(),$.ajax({url:baseUrl("v1/clock"),method:"GET"}).always(function(){s=null}).fail(handleErrorResponse).done(function(e){c=e,clearInterval(r),clearInterval(l),""===e.state||"clocked_out"==e.state?u():(n=e.clock_time,a=e.time,r=setInterval(m,1e3));{var o=e.state;let t="";"clocked_in"===o||"break_ended"===o?t=(t+=h("break_start"))+h("clocked_out"):t+=h("break_started"===o?"break_end":"clocked_in"),$(".jsAttendanceBTNs").html(t),$(".jsAttendanceClockHeaderBTNs").html(t)}"clocked_out"==e.state&&(o=function(t){t={hours:Math.floor(t/3600),minutes:Math.floor(t%3600/60),seconds:t%60};return t.hours=1===t.hours.toString().length?"0"+t.hours:t.hours,t.minutes=1===t.minutes.toString().length?"0"+t.minutes:t.minutes,t.seconds=1===t.seconds.toString().length?"0"+t.seconds:t.seconds,t}(o=e.time),$(".jsAttendanceClockHour").html(o.hours),$(".jsAttendanceClockMinute").html(o.minutes),$(".jsAttendanceClockSeconds").html(o.seconds),$(".jsAttendanceClockSeparator").html(":")),l=setInterval(k,1e3)})}function d(e,o,n,a){if(null===s){let t=_showNotification("Please wait, while we are processing your request.");s=$.ajax({url:baseUrl("v1/clock/mark"),method:"POST",data:JSON.stringify({type:e,latitude:o,longitude:n,job_site:a}),headers:{"content-type":"application/json"}}).always(function(){closeAlert(t),s=null}).fail(handleErrorResponse).done(function(){_success("You have successfully "+b(e)+"."),i()})}}function u(){n="",a="",clearInterval(r),$(".jsAttendanceClockHour").html("00"),$(".jsAttendanceClockMinute").html("00"),$(".jsAttendanceClockSeconds").html("00"),$(".jsAttendanceClockSeparator").html(":"),$(".jsAttendanceBTNs").html(""),$(".jsAttendanceClockHeaderBTNs").html("")}function m(){var t;n?(t=moment.utc(n).subtract(a,"seconds"),t=moment.utc().diff(t),t=moment(t).utc(),$(".jsAttendanceClockHour").html(t.format("HH")),$(".jsAttendanceClockMinute").html(t.format("mm")),$(".jsAttendanceClockSeconds").html(t.format("ss"))):($(".jsAttendanceClockHour").html("00"),$(".jsAttendanceClockMinute").html("00"),$(".jsAttendanceClockSeconds").html("00")),$(".jsAttendanceClockSeparator").html(":")}function k(){$(".jsAttendanceCurrentClockDateTime").text(moment().format("MMM D YYYY, ddd HH:mm:ss")),$(".jsAttendanceLoader").hide()}function h(t){let e="";return"clocked_in"===t?e=(e+='<button class="btn btn-orange jsAttendanceBtn" data-type="clocked_in">\t<i class="fa fa-play-circle csF16" aria-hidden="true"></i>')+"\t&nbsp;Clock in</button>":"clocked_out"===t?e=(e+='&nbsp;<button class="btn btn-red jsAttendanceBtn" data-type="clocked_out">\t<i class="fa fa-stop-circle csF16" aria-hidden="true"></i>')+"\t&nbsp;Clock out</button>":"break_start"===t?e=(e+='&nbsp;<button class="btn btn-black jsAttendanceBtn" data-type="break_started">\t<i class="fa fa-pause-circle csF16" aria-hidden="true"></i>')+"\t&nbsp;Break start</button>":"break_end"===t&&(e=(e+='&nbsp;<button class="btn btn-yellow jsAttendanceBtn" data-type="break_ended">\t<i class="fa fa-stop csF16" aria-hidden="true"></i>')+"\t&nbsp;Break end & clock in</button>"),e}function o(e,o=null){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){d(e,t.coords.latitude,t.coords.longitude,o)},function(){return alertify.alert("Location permission denied!",""+'<p>The "location" permission is denied on your browser. Please allow the location before you can mark your attendance \t\t\t\tPlease follow the following steps to allow location permission.</p><br /> \t\t\t\t<ol>   \t\t\t\t<li>On your computer, open Chrome <img src="//storage.googleapis.com/support-kms-prod/Y57p9LEW3v1cnw4Svh3a53DOnyRPFkiDfTDc" width="18" height="18" alt="Chrome" data-mime-type="image/png">.</li>   \t\t\t\t<li>At the top right, click More <img src="//lh3.googleusercontent.com/E2q6Vj9j60Dw0Z6NZFEx5vSB9yoZJp7C8suuvQXVA_2weMCXstGD7JEvNrzX3wuQrPtL=w36-h36" width="18" height="18" alt="More" data-mime-type="image/png" data-alt-src="//lh3.googleusercontent.com/E2q6Vj9j60Dw0Z6NZFEx5vSB9yoZJp7C8suuvQXVA_2weMCXstGD7JEvNrzX3wuQrPtL"> <img src="//lh3.googleusercontent.com/3_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw=w36-h36" width="18" height="18" alt="and then" data-mime-type="image/png" data-alt-src="//lh3.googleusercontent.com/3_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw"> <strong>Settings</strong>.</li>   \t\t\t\t<li>Click <strong>Privacy and security</strong>&nbsp;<img src="//lh3.googleusercontent.com/3_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw=w36-h36" width="18" height="18" alt="and then" data-mime-type="image/png" data-alt-src="//lh3.googleusercontent.com/3_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw">&nbsp;<strong>Site Settings</strong>.</li>   \t\t\t\t<li data-outlined="false" class="">Click <strong>Location</strong>.</li>   \t\t\t\t<li>Choose the option you want as your default setting.</li> \t\t\t</ol>')}):(d(e,0,0),console.log("Geolocation is required for this page, but your browser doesn't support it. Try it with a browser that does"))}function b(t){return{clocked_in:"Clocked In",clocked_out:"Clocked Out",break_started:"Started your break",break_ended:"Ended your break",clocked_in_confirm:"clock in",clocked_out_confirm:"clock out",break_started_confirm:"start your break",break_ended_confirm:"end your break"}[t]}$(document).on("click",".jsAttendanceBtn",function(t){t.preventDefault();const e=$(this).data("type");return _confirm("Do you want to "+b(e+"_confirm")+"?",function(){"clocked_in"===e&&c.job_sites.length?Modal({Id:"jsJobSiteModal",Title:"Select a job site.",Loader:"jsJobSiteModalLoader",Body:function(){let e="";return e=(e=(e=(e=(e=(e+='<div class="container" id="jsJobSiteModalBody">')+'\t<br /><div class="row">\t\t<div class="col-sm-12">')+'\t\t\t<form id="jsJobSiteModalForm">\t\t\t\t<div class="form-group">')+'\t\t\t\t\t<label class="tex-medium">\t\t\t\t\t\tPlease select a job site')+'\t\t\t\t\t\t<strong class="text-danger"></strong>\t\t\t\t\t</label>')+'\t\t\t\t\t<select class="form-control jsJobSiteModalSelect">\t\t\t\t\t\t<option value="0">Clock in without job site</option>',c.job_sites.map(function(t){e+='\t\t\t\t\t\t<option value="'+t.sid+'">'+t.site_name+"</option>"}),e=(e=(e=(e=(e=(e+="\t\t\t\t\t</select>")+'\t\t\t\t</div>\t\t\t\t<div class="form-group text-right">')+'\t\t\t\t\t<button class="btn btn-success">\t\t\t\t\t\tClock In')+"\t\t\t\t\t</button>\t\t\t\t</div>")+"\t\t\t</form>\t\t</div>")+"\t</div></div>"}()},function(){ml(!1,"jsJobSiteModalLoader"),$("#jsJobSiteModalBody").submit(function(t){t.preventDefault(),o("clocked_in",$(".jsJobSiteModalSelect option:selected").val()),$("#jsJobSiteModal").find(".jsModalCancel").click()})}):"break_started"===e&&c.allowed_breaks.length?Modal({Id:"jsBreaksModal",Title:"Select a break.",Loader:"jsBreaksModalLoader",Body:function(){let n="";return n=(n=(n=(n=(n+='<div class="container" id="jsBreaksModalBody">\t<br /><div class="row">')+'\t\t<div class="col-sm-12">\t\t\t<form id="jsBreaksModelForm">')+'\t\t\t\t<div class="form-group">\t\t\t\t\t<label class="tex-medium">')+'\t\t\t\t\t\tPlease select a break\t\t\t\t\t\t<strong class="text-danger"></strong>')+'\t\t\t\t\t</label>\t\t\t\t\t<select class="form-control jsBreaksModelSelect">',c.allowed_breaks.map(function(t){let e=t.duration+"m";t.start_time&&(e=t.start_time+" - "+t.end_time);var o=function(e){let o=!1;var n=c.breaks.length;for(let t=0;t<n;t++)if(c.breaks[t].id==e){o=!0;break}return o}(t.id);n+="\t\t\t\t\t\t<option "+(o?"disabled":"")+' value="'+t.id+'">'+t.break+" ("+e+")</option>"}),n=(n=(n=(n=(n=(n+="\t\t\t\t\t</select>")+'\t\t\t\t</div>\t\t\t\t<div class="form-group text-right">')+'\t\t\t\t\t<button class="btn btn-success">\t\t\t\t\t\tStart Break')+"\t\t\t\t\t</button>\t\t\t\t</div>")+"\t\t\t</form>\t\t</div>")+"\t</div></div>"}()},function(){ml(!1,"jsBreaksModalLoader"),$("#jsBreaksModalBody").submit(function(t){t.preventDefault();const e=$(".jsBreaksModelSelect option:selected").val();return c.allowed_breaks&&c.allowed_breaks.length==c.breaks?_error("You have already taken allowed breaks."):(t=c.allowed_breaks.filter(function(t){return t.id==e}))[0].start_time&&moment()<moment(t[0].start_time,"hh:mm a")?_error('You can not start break before "'+t[0].start_time+'".'):t[0].end_time&&moment()>moment(t[0].end_time,"hh:mm a")?_error('You can not start break after "'+t[0].end_time+'".'):(o("break_started",e),void $("#jsBreaksModal").find(".jsModalCancel").click())})}):o(e)})}),setInterval(function(){i(!0)},1e4),l=setInterval(k,1e3),i()});
