!function(){let o,d=0;$(document).on("click",".jsModalCancel",e=>{e.preventDefault(),"yes"==$(e.target).data("ask")?alertify.confirm("Any unsaved changes will be lost.",()=>{$(e.target).closest(".csModal").fadeOut(300),$("body").css("overflow-y","auto"),$("#ui-datepicker-div").remove(),$(".jsMsModal").remove()}).set("labels",{ok:"LEAVE",cancel:"NO, I WILL STAY"}).set("title","Notice!"):($(e.target).closest(".csModal").fadeOut(300),$("body").css("overflow-y","auto"),$(".jsMsModal").remove(),$("#ui-datepicker-div").remove())}),window._ml=window.ml=function(e,t,a){t=void 0===t?".jsIPLoader":`.jsIPLoader[data-page="${t}"]`,void 0!==o&&document.getElementsByClassName("csModalBody").length&&(document.getElementsByClassName("csModalBody")[0].scrollTop=0),void 0!==o&&e&&$(".jsIPLoader").height($(`#${o}Body`).height()+d),void 0===e||!1===e?$(t).hide():$(t).show(),void 0!==a&&$(".jsIPLoaderText").html(a),e||$(".jsIPLoaderText").html("Please wait, while we are generating a preview.")},window.Model=window.Modal=function(e,t){var a=`
			<!-- Custom Modal -->
			<div class="csModal jsMsModal" id="${e.Id}">
				<div class="${e.Cl||"container"}">
					<div class="csModalHeader">
						<h3 class="csModalHeaderTitle">
							<span>${e.Title}</span>
							<span class="csModalButtonWrap">
							${void 0!==e.Buttons&&0!==e.Buttons.length?e.Buttons.join(""):""}
								<button class="btn btn-black btn-cancel csW jsModalCancel" ${void 0===e.Ask?"":'data-ask="no"'} title="Close this window">Cancel</button>
							</span>
							<div class="clearfix"></div>
						</h3>
					</div>
					<div class="csModalBody">
						<div class="csIPLoader jsIPLoader" data-page="${e.Loader}">
							<div class="csIPLoaderBox">
								<i class="fa fa-circle-o-notch fa-spin" aria-hidden="true"></i><br><br>
								<br>
								<span class="jsIPLoaderText">Please wait while we process your request.</span>
							</div>
						</div>
						${e.Body}
					</div>
					<div class="clearfix"></div>
				</div>
			</div>
			`;o=e.Id,d=$(`#${e.Id} .csModalHeader`).height()+50,$(".jsMsModal").remove(),$("#"+e.Id).remove(),$("body").append(a),$("#"+e.Id).fadeIn(300),$("body").css("overflow-y","hidden"),$(`#${e.Id} .csModalBody`).css("top",d),void 0!==t&&t()}}(),$(function(){let s=null,l={};function t(){console.log(l),Modal({Id:"jsTimeSheetModal",Loader:"jsTimeSheetModalLoader",Title:0===l.id?"Add":"Edit time sheet for "+moment(l.date).format("MM/DD/Y"),Body:'<div id="jsTimeSheetModalBody"></div>'},e)}function e(){null!==s&&s.abort(),s=$.ajax({url:baseUrl("v1/clock/timesheet/"+l.id+"/"+l.date),method:"get"}).always(function(){s=null}).fail(handleErrorResponse).done(function(e){$("#jsTimeSheetModalBody").html(e.view),ml(!1,"jsTimeSheetModalLoader"),$("#jsManageTimeSheetForm").validate({submitHandler:function(e){const t=[];$(".jsEventRow").length&&$(".jsEventRow").map(function(){var e={id:$(this).data("id")};e.startTime=$(this).find(`[name="start_time_${e.id}"]`).val(),e.eventType=$(this).find(`[name="event_type_${e.id}"] option:selected`).val(),e.endTime=$(this).find(`[name="end_time_${e.id}"]`).val(),t.push(e)});var a,o,d=callButtonHook($(".jsManageTimeSheetBtn"),!0,!0);a=t,o=d,null===s&&$.ajax({url:baseUrl("v1/clock/timesheet/"+l.id+"/"+l.date),method:"post",data:{logs:a}}).always(function(){s=null,callButtonHook(o,!1)}).fail(handleErrorResponse).done(function(e){return _success(e.msg,function(){window.location.reload()})})}}),$(".jsEventRow").length&&$(".jsEventRow").map(function(){var e=$(this).data("id");$(`[name="event_type_${e}"]`).rules("add",{required:!0}),$(`[name="start_time_${e}"]`).rules("add",{required:!0}),$(`[name="end_time_${e}"]`).rules("add",{required:!0})}),$(".jsAddEventRow").click(function(e){var t;e.preventDefault(),e=getRandomCode(),t=`
        <div class="row jsEventRow" data-id="${e}">
            <br>
            <div class="col-sm-3">
                <label>Event type</label>
                <select name="event_type_${e}" class="form-control">
                    <option value="clocked_in_out">
                        Clock in/out
                    </option>
                    <option value="clocked_in_out">
                        Break start/end
                    </option>
                </select>
            </div>
            <div class="col-sm-3">
                <label>Start time</label>
                <input type="text" name="start_time_${e}" class="form-control jsTimeField" />
            </div>
            <div class="col-sm-3">
                <label>End time</label>
                <input type="text" name="end_time_${e}" class="form-control jsTimeField" />
            </div>
			<div class="col-sm-3">
				<label><br /></label>
				<button class="btn btn-red jsDeleteEventRow" type="button">
					<i class="fa fa-trash"></i>
				</button>
			</div>
        `,t+="</div>",$("#jsTimeSheetModalBody .panel-body").append(t),$(`[name="event_type_${e}"]`).rules("add",{required:!0}),$(`[name="start_time_${e}"]`).rules("add",{required:!0}),$(`[name="end_time_${e}"]`).rules("add",{required:!0}),a()}),$(document).on("click",".jsDeleteEventRow",function(e){e.preventDefault();const a=$(this).closest(".row").data("id");return _confirm("Do you want to delete the selected event row? It is not revertible.",function(){var t;t=a,$.ajax({url:baseUrl("v1/clock/timesheet/log/"+t),method:"delete"}).fail(handleErrorResponse).done(function(e){$(`.jsEventRow[data-id="${t}"]`).remove()})})}),a()})}function a(){$(".jsTimeField").timepicker({timeFormat:"h:mm p",dynamic:!1,dropdown:!1,scrollbar:!1})}$(".jsEditTimeSheet").click(function(e){e.preventDefault(),l=$(this).closest("tr").data(),t()}),$(".jsAddTimeSheet").click(function(e){e.preventDefault(),(l=$(this).closest("tr").data()).id=0,t()})});
