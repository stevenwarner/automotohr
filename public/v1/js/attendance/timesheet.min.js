!function(){let a,l=0;$(document).on("click",".jsModalCancel",e=>{e.preventDefault(),"yes"==$(e.target).data("ask")?alertify.confirm("Any unsaved changes will be lost.",()=>{$(e.target).closest(".csModal").fadeOut(300),$("body").css("overflow-y","auto"),$("#ui-datepicker-div").remove(),$(".jsMsModal").remove()}).set("labels",{ok:"LEAVE",cancel:"NO, I WILL STAY"}).set("title","Notice!"):($(e.target).closest(".csModal").fadeOut(300),$("body").css("overflow-y","auto"),$(".jsMsModal").remove(),$("#ui-datepicker-div").remove())}),window._ml=window.ml=function(e,t,o){t=void 0===t?".jsIPLoader":`.jsIPLoader[data-page="${t}"]`,void 0!==a&&document.getElementsByClassName("csModalBody").length&&(document.getElementsByClassName("csModalBody")[0].scrollTop=0),void 0!==a&&e&&$(".jsIPLoader").height($(`#${a}Body`).height()+l),void 0===e||!1===e?$(t).hide():$(t).show(),void 0!==o&&$(".jsIPLoaderText").html(o),e||$(".jsIPLoaderText").html("Please wait, while we are generating a preview.")},window.Model=window.Modal=function(e,t){var o=`
			<!-- Custom Modal -->
			<div class="csModal jsMsModal" id="${e.Id}">
				<div class="${e.Cl||"container"}">
					<div class="csModalHeader">
						<h3 class="csModalHeaderTitle">
							<span>${e.Title}</span>
							<span class="csModalButtonWrap">
							${void 0!==e.Buttons&&0!==e.Buttons.length?e.Buttons.join(""):""}
								<button class="btn btn-black btn-cancel csW jsModalCancel" ${void 0===e.Ask?"":'data-ask="no"'} title="Close this window">Cancel</button>
							</span>
							<div class="clearfix"></div>
						</h3>
					</div>
					<div class="csModalBody">
						<div class="csIPLoader jsIPLoader" data-page="${e.Loader}">
							<div class="csIPLoaderBox">
								<i class="fa fa-circle-o-notch fa-spin" aria-hidden="true"></i><br><br>
								<br>
								<span class="jsIPLoaderText">Please wait while we process your request.</span>
							</div>
						</div>
						${e.Body}
					</div>
					<div class="clearfix"></div>
				</div>
			</div>
			`;a=e.Id,l=$(`#${e.Id} .csModalHeader`).height()+50,$(".jsMsModal").remove(),$("#"+e.Id).remove(),$("body").append(o),$("#"+e.Id).fadeIn(300),$("body").css("overflow-y","hidden"),$(`#${e.Id} .csModalBody`).css("top",l),void 0!==t&&t()}}(),$(function(){let s=null,n={};function t(){Modal({Id:"jsTimeSheetModal",Loader:"jsTimeSheetModalLoader",Title:0===n.id?"Add":"Edit time sheet for "+moment(n.date).format("MM/DD/Y"),Body:'<div id="jsTimeSheetModalBody"></div>'},e)}function e(){null!==s&&s.abort(),s=$.ajax({url:baseUrl("v1/clock/timesheet/"+n.id+"/"+n.date),method:"get"}).always(function(){s=null}).fail(handleErrorResponse).done(function(e){$("#jsTimeSheetModalBody").html(e.view),ml(!1,"jsTimeSheetModalLoader"),$("#jsManageTimeSheetForm").validate({submitHandler:function(e){const t=[];$(".jsEventRow").length&&$(".jsEventRow").map(function(){var e={id:$(this).data("id")};e.startTime=$(this).find(`[name="start_time_${e.id}"]`).val(),e.eventType=$(this).find(`[name="event_type_${e.id}"] option:selected`).val(),e.endTime=$(this).find(`[name="end_time_${e.id}"]`).val(),e.employeeId=profileUserInfo.userId,t.push(e)});var o,a,l=callButtonHook($(".jsManageTimeSheetBtn"),!0,!0);o=t,a=l,null===s&&$.ajax({url:baseUrl("v1/clock/timesheet/"+n.id+"/"+n.date),method:"post",data:{logs:o}}).always(function(){s=null,callButtonHook(a,!1)}).fail(handleErrorResponse).done(function(e){return _success(e.msg,function(){window.location.reload()})})}}),$(".jsEventRow").length&&$(".jsEventRow").map(function(){var e=$(this).data("id");$(`[name="event_type_${e}"]`).rules("add",{required:!0}),$(`[name="start_time_${e}"]`).rules("add",{required:!0}),$(`[name="end_time_${e}"]`).rules("add",{required:!0})}),$(".jsAddEventRow").click(function(e){var t;e.preventDefault(),e=getRandomCode(),t=`
        <div class="row jsEventRow" data-id="${e}">
            <br>
            <div class="col-sm-3">
                <label>Event type</label>
                <select name="event_type_${e}" class="form-control">
                    <option value="clocked_in_out">
                        Clock in/out
                    </option>
                    <option value="clocked_in_out">
                        Break start/end
                    </option>
                </select>
            </div>
            <div class="col-sm-3">
                <label>Start time</label>
                <input type="text" name="start_time_${e}" class="form-control jsTimeField" />
            </div>
            <div class="col-sm-3">
                <label>End time</label>
                <input type="text" name="end_time_${e}" class="form-control jsTimeField" />
            </div>
			<div class="col-sm-3">
				<label><br /></label>
				<button class="btn btn-red jsDeleteEventRow" type="button">
					<i class="fa fa-trash"></i>
				</button>
			</div>
        `,t+="</div>",$("#jsTimeSheetModalBody .panel-body").append(t),$(`[name="event_type_${e}"]`).rules("add",{required:!0}),$(`[name="start_time_${e}"]`).rules("add",{required:!0}),$(`[name="end_time_${e}"]`).rules("add",{required:!0}),o()}),$(document).on("click",".jsDeleteEventRow",function(e){e.preventDefault();const o=$(this).closest(".row").data("id");return _confirm("Do you want to delete the selected event row? It is not revertible.",function(){var t;t=o,$.ajax({url:baseUrl("v1/clock/timesheet/log/"+t),method:"delete"}).fail(handleErrorResponse).done(function(e){$(`.jsEventRow[data-id="${t}"]`).remove()})})}),o()})}function o(){$(".jsTimeField").timepicker({timeFormat:"h:mm p",dynamic:!1,dropdown:!1,scrollbar:!1})}function a(e){if(0===$(".jsSingleSelect:checked").length)return _success("Please select at least one employee.");const t=[];if($(".jsSingleSelect:checked").map(function(){t.push($(this).val())}),null===s){const o=callButtonHook(1==e?$(".jsApproveTimeSheet"):$(".jsUnApproveTimeSheet"),!0);$.ajax({url:baseUrl("v1/clock/timesheet/status"),method:"post",data:{ids:t,status:e}}).always(function(){s=null,callButtonHook(o,!1)}).fail(handleErrorResponse).done(function(e){return _success(e.msg,function(){window.location.reload()})})}}function i(e){var t=new google.maps.Marker(e);e.markers.push(t),e.coords.push({lat:e.position.lat,lng:e.position.lng})}$(".jsEditTimeSheet").click(function(e){e.preventDefault(),n=$(this).closest("tr").data(),t()}),$(".jsAddTimeSheet").click(function(e){e.preventDefault(),(n=$(this).closest("tr").data()).id=0,t()}),$(".jsViewTimeSheet").click(function(e){var t;e.preventDefault(),t=$(this).closest("tr").data(),Modal({Id:"jsTimeSheetHistoryModal",Loader:"jsTimeSheetHistoryModalLoader",Title:"History for "+moment(t.date).format("MM/DD/Y"),Body:'<div id="jsTimeSheetHistoryModalBody"></div>'},function(){var e=t;null!==s&&s.abort(),s=$.ajax({url:baseUrl("v1/clock/timesheet/history/"+e.id),method:"get"}).always(function(){s=null}).fail(handleErrorResponse).done(function(e){$("#jsTimeSheetHistoryModalBody").html(e.view),null!=e.locations&&0<e.locations.length&&e.locations.forEach(e=>{var t=e.target,o=[],a=[],l=[],s=(e.lat=parseFloat(e.lat),e.lng=parseFloat(e.lng),e.lat_2&&!isNaN(e.lat_2)&&(e.lat_2=parseFloat(e.lat_2),e.lng_2=parseFloat(e.lng_2)),t=new google.maps.Map(document.getElementById(t),{center:{lat:e.lat,lng:e.lng},mapTypeId:google.maps.MapTypeId.ROADMAP}),i({markers:o,coords:a,map:t,position:{lat:e.lat,lng:e.lng},title:e.title}),l.push(new google.maps.LatLng(e.lat,e.lng)),e.lat_2&&!isNaN(e.lat_2)&&(i({markers:o,coords:a,map:t,position:{lat:e.lat_2,lng:e.lng_2},title:e.title}),l.push(new google.maps.LatLng(e.lat_2,e.lng_2)),new google.maps.Polyline({path:a,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2}).setMap(t)),new google.maps.LatLngBounds);for(let e=0;e<l.length;e++)s.extend(l[e]);t.fitBounds(s),google.maps.event.trigger(t,"resize")}),ml(!1,"jsTimeSheetHistoryModalLoader")})})}),$(".jsSelectAll").click(function(){$(".jsSingleSelect").prop("checked",$(".jsSelectAll").prop("checked"))}),$(".jsSingleSelect").click(function(){$(".jsSelectAll").prop("checked",$(".jsSingleSelect:checked").length===$(".jsSingleSelect").length)}),$(".jsApproveTimeSheet").click(function(e){e.preventDefault(),a(1)}),$(".jsUnApproveTimeSheet").click(function(e){e.preventDefault(),a(0)}),$(document).on("click",".jsToggleMapView",function(e){e.preventDefault();e=$(this).data("id");$(".mapRow"+e).toggleClass("hidden")})});
