$(function(){let o,s,i=[],r=[],t=null,e=null,l=[],a=[];function n(){null!==t&&t.abort(),ml(!0,"jsWeekGraph",""),t=$.ajax({url:baseUrl("v1/clock/graphs/week_worked_time"),method:"GET",cache:!1}).always(function(){t=null,ml(!1,"jsWeekGraph")}).fail(handleErrorResponse).done(function(t){if(Object.keys(t).length){let o=[],l=[],a=[],n=0;$.each(t,function(t,e){o.push(parseFloat((e?.workedTotalTime?.totalInnMinutes||0).toFixed(2))),l.push(parseFloat((e?.breakTotalTime?.totalInnMinutes||0).toFixed(2))),a.push(parseFloat((e?.totalTime?.totalInnMinutes||0).toFixed(2))),n+=e?.totalTime?.totalInnMinutes||0}),n=n.toFixed(0),Highcharts.chart("container",{chart:{type:"column"},legend:{itemStyle:{fontSize:"12px"}},title:{text:`You have worked for ${d(60*n)}.`,align:"left",style:{fontSize:"16px"}},xAxis:{categories:Object.keys(t).map(function(t){return moment(t,"YYYY-MM-DD").format("MMM DD YYYY, ddd")}),crosshair:!0,accessibility:{description:"Week days"},labels:{style:{fontSize:"12px"}}},yAxis:{min:0,title:{text:"# of worked minutes",style:{fontSize:"14px"}},labels:{style:{fontSize:"12px"}}},tooltip:{style:{fontSize:"12px"},valueSuffix:"m",formatter(t){var{x:e,y:o,colorIndex:l}=this;return 0===l?`You have consumed breaks for ${d(60*o)} on `+e:`You have worked for ${d(60*o)} on `+e}},plotOptions:{series:{dataLabels:{style:{fontSize:"20px"}}},column:{}},series:[{name:"Break minutes",data:l,column:{labels:{style:{fontSize:"40px"}}}},{name:"Worked minutes",data:o,column:{labels:{style:{fontSize:"40px"}}}}],colors:["red","#fd7a2a"]})}})}function c(){null!==e&&e.abort(),e=$.ajax({url:baseUrl("v1/clock/my/footprints/today"),method:"GET",cache:!1}).always(function(){e=null}).fail(handleErrorResponse).done(function(t){t.logs?l.toString()!==t.logs.locations.toString()&&(l=t.logs.locations,function t(e){"undefined"==typeof google?o=setInterval(function(){t(e)},3e3):(clearInterval(o),e())}(p)):$("#map").html('<p class="alert alert-info text-center">No footprints yet!</p>'),a=t.logs?t.logs.logs:[];{let o="";if(a.length){let e=0;a.forEach(function(t){e+=parseFloat(t.duration),o=(o=(o=(o=(o=(o+='<tr data-id="'+t.sid+'">')+'\t<td class="csVerticalAlignMiddle">\t\t<p>')+t.text)+"\t\t</p>\t</td>")+'\t<td class="csVerticalAlignMiddle text-right">\t\t<p>')+moment(t.startTime,"YYYY-MM-DD HH:mm:ss").format("hh:mm a")+"\t\t - ",t.endTime?o+=moment(t.endTime,"YYYY-MM-DD HH:mm:ss").format("hh:mm a"):o+="\t\tMissing",o+="\t\t</p>\t</td>",o=(o=(o=(o=t.location.onSiteFlag?(o=(o+='\t<td class="csVerticalAlignMiddle text-center ">')+'\t\t<p><i class="fa fa-check-circle text-success"></i>')+"\t\t</p>\t</td>":(o=(o=(o+='\t<td class="csVerticalAlignMiddle text-center">')+'\t\t<p><i class="fa fa-times-circle text-danger"></i><br />')+t.location.text)+"\t\t</p>\t</td>")+'\t<td class="csVerticalAlignMiddle text-right">\t\t<p>')+t.durationText+"\t\t</p>")+"\t</td></tr>"}),$(".jsTimeEntriesBox tbody").html(o),o=(o=(o=(o="<tr>")+'\t<th scope="col" colspan="4" class="csVerticalAlignMiddle text-right">\tTotal: ')+d(e))+"\t</th></tr>",$(".jsTimeEntriesBox tfoot").html(o)}else $(".jsTimeEntriesBox tbody").html('<tr><td colspan="4"><p class="alert alert-info text-center">No time entries yet!</p></td></tr>')}})}function p(){s=new google.maps.Map(document.getElementById("map"),{center:{lat:parseFloat(l[0].lat),lng:parseFloat(l[0].lng)},mapTypeId:"roadmap"});const n=[];l.map(function(t,e){var o,l,a;t.lat&&t.lat&&(o={map:s,position:{lat:parseFloat(t.lat),lng:parseFloat(t.lng)},title:t.title},0===e&&(o.icon="http://maps.google.com/mapfiles/ms/icons/green-dot.png"),e=o,l=new google.maps.Marker(e),i.push(l),r.push({lat:e.position.lat,lng:e.position.lng}),t.constraint&&(l=new google.maps.Circle({map:s,center:{lat:parseFloat(t.constraint.lat),lng:parseFloat(t.constraint.lng)},radius:parseInt(5e4),strokeColor:"red",strokeOpacity:.8,strokeWeight:2,fillColor:"red",fillOpacity:.35}),a=new google.maps.InfoWindow({content:t.constraint.title}),google.maps.event.addListener(l,"click",function(t){a.setPosition(t.latLng),a.open(this.map)}),n.push(new google.maps.LatLng(parseFloat(t.constraint.lat),parseFloat(t.constraint.lng)))),n.push(new google.maps.LatLng(o.position.lat,o.position.lng)))}),new google.maps.Polyline({path:r,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2}).setMap(s);let e=new google.maps.LatLngBounds;n.forEach(t=>{e.extend(t)}),s.fitBounds(e)}function d(t){var e=Math.floor(t/3600),t=Math.floor(t%3600/60);return e+"h"+(0<t?" "+t+"m":"")}setInterval(n,3e4),setInterval(c,2e4),n(),c()});
