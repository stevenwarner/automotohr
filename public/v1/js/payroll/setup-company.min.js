$(function(){let l=0,a="jsCreatePartnerCompanyModal",o=null,t={checkRequirements:function(){null!==o&&o.abort();o=$.ajax({url:window.location.origin+"/payroll/company/"+l+"/requirements",method:"GET"}).success(function(){o=null,t.welcomeStep()}).fail(r)},welcomeStep:function(){if(null!==o)return!1;o=$.ajax({url:window.location.origin+"/payroll/cpc/1/"+l,method:"GET"}).success(function(e){if(o=null,$(`#${a}Body`).html(e.view),void 0!==e.onboard){if("terms"===e.onboard)return t.gustoTerms();window.location.reload()}_ml(!1,a+"Loader"),$(".jsPayrollLoadSelectEmployees").click(function(e){e.preventDefault(),_ml(!0,a+"Loader"),t.employeeListingStep()})}).fail(r)},employeeListingStep:function(){if(null!==o)return!1;o=$.ajax({url:window.location.origin+"/payroll/cpc/2/"+l,method:"GET"}).success(function(e){o=null,$(`#${a}Body`).html(e.view),_ml(!1,a+"Loader"),$(".jsPayrollLoadOnboard").click(function(e){e.preventDefault(),n=[],$(".jsEmployeesList:checked").map(function(){n.push($(this).val())}),n.length?(_ml(!0,a+"Loader"),t.adminStep()):alertify.alert("ERROR","Please select at least one employee.",CB)}),$(".jsBackToStep1").click(function(e){e.preventDefault(),_ml(!0,a+"Loader"),t.welcomeStep()})}).fail(r)},adminStep:function(){if(null!==o)return!1;o=$.ajax({url:window.location.origin+"/payroll/cpc/3/"+l,method:"GET"}).success(function(e){o=null,$(`#${a}Body`).html(e.view),_ml(!1,a+"Loader"),$(".jsPayrollSetAdmin").click(function(e){e.preventDefault(),null===o&&(o=$.ajax({url:window.location.origin+"/payroll/cpc/4/"+l,method:"GET"}).success(function(e){o=null,$(`#${a}Body`).html(e.view),_ml(!1,a+"Loader")}).fail(r))}),$(".jsBackToStep2").click(function(e){e.preventDefault(),_ml(!0,a+"Loader"),t.employeeListingStep()})}).fail(r)},createPartnerCompany:e},n=[];function e(){o=$.ajax({url:window.location.origin+"/payroll/cpc/7/"+l,method:"POST",data:{employees:n}}).success(function(){o=null,gustoServiceAgreement(l)}).fail(i)}function i(e){return _ml(!1,a+"Loader"),o=null,handleErrorResponse(e)}function r(e){return $(`#${a} .jsModalCancel`).trigger("click"),handleErrorResponse(e)}$(document).on("click",".jsModalCancel",function(){o=null}),$(".jsCreatePartnerCompanyBtn").click(function(e){if(e.preventDefault(),0===(l=parseInt($(this).data("cid"))))return alertify.alert("ERROR","Company code is missing.",CB);Modal({Id:a,Title:"",Loader:a+"Loader",Body:`<div id="${a}Body"></div>`},t.checkRequirements)}),$(document).on("click",".jsPayrollViewAdminDetails",function(e){e.preventDefault(),_ml(!0,a+"Loader"),o=$.ajax({url:window.location.origin+"/payroll/cpc/6/"+l,method:"GET"}).success(function(e){o=null,$(`#${a}Body`).html(e.view),_ml(!1,a+"Loader")}).fail(r)}),$(document).on("click",".jsPayrollSaveAdmin",function(e){e.preventDefault();var e={firstName:$(".jsAdminFirstName").val().trim(),lastName:$(".jsAdminLastName").val().trim(),email:$(".jsAdminEmailAddress").val().trim()},n=[];e.firstName||n.push('"First name" is missing.'),e.lastName||n.push('"Last name" is missing.'),e.email||n.push('"Email" is missing.'),e.email.verifyEmail()||n.push('"Email" is invalid.'),n.length?alertify.alert("ERROR",getErrorsStringFromArray(n),CB):(_ml(!0,a+"Loader"),o=$.ajax({url:window.location.origin+"/payroll/cpc/5/"+l,method:"POST",data:e}).success(function(){return o=null,alertify.alert("SUCCESS","Congratulations! You have successfully added a payroll admin for the company.",function(){t.adminStep()})}).fail(i))}),$(document).on("click",".jsBackToStep3",function(e){e.preventDefault(),_ml(!0,a+"Loader"),t.adminStep()}),$(document).on("click",".jsCreatePartnerCompanyProcessBtn",function(e){e.preventDefault(),_ml(!0,a+"Loader","Please wait patiently while we set up the payroll system. This procedure may take a few minutes."),t.createPartnerCompany()})});
