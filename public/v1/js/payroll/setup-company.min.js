$(function(){let l=0,o="jsCreatePartnerCompanyModal",a=null,i={checkRequirements:function(){null!==a&&a.abort();a=$.ajax({url:window.location.origin+"/payroll/company/"+l+"/requirements",method:"GET"}).success(function(){a=null,i.welcomeStep()}).fail(r)},welcomeStep:function(){if(null!==a)return!1;a=$.ajax({url:window.location.origin+"/payroll/cpc/1/"+l,method:"GET"}).success(function(e){if(a=null,$(`#${o}Body`).html(e.view),void 0!==e.onboard){if("terms"===e.onboard)return i.gustoTerms();window.location.reload()}_ml(!1,o+"Loader"),$(".jsPayrollLoadSelectEmployees").click(function(e){e.preventDefault(),_ml(!0,o+"Loader"),i.employeeListingStep()})}).fail(r)},employeeListingStep:function(){if(null!==a)return!1;a=$.ajax({url:window.location.origin+"/payroll/cpc/2/"+l,method:"GET"}).success(function(e){a=null,$(`#${o}Body`).html(e.view),_ml(!1,o+"Loader"),$(".jsPayrollLoadOnboard").click(function(e){e.preventDefault(),n=[],$(".jsEmployeesList:checked").map(function(){n.push($(this).val())}),n.length?(_ml(!0,o+"Loader"),i.adminStep()):alertify.alert("ERROR","Please select at least one employee.",CB)}),$(".jsBackToStep1").click(function(e){e.preventDefault(),_ml(!0,o+"Loader"),i.welcomeStep()})}).fail(r)},adminStep:function(){if(null!==a)return!1;a=$.ajax({url:window.location.origin+"/payroll/cpc/3/"+l,method:"GET"}).success(function(e){a=null,$(`#${o}Body`).html(e.view),_ml(!1,o+"Loader"),$(".jsPayrollSetAdmin").click(function(e){e.preventDefault(),null===a&&(a=$.ajax({url:window.location.origin+"/payroll/cpc/4/"+l,method:"GET"}).success(function(e){a=null,$(`#${o}Body`).html(e.view),_ml(!1,o+"Loader")}).fail(r))}),$(".jsBackToStep2").click(function(e){e.preventDefault(),_ml(!0,o+"Loader"),i.employeeListingStep()})}).fail(r)},createPartnerCompany:e},n=[];function e(){a=$.ajax({url:window.location.origin+"/payroll/cpc/7/"+l,method:"POST",data:{employees:n}}).success(function(){if(a=null,"undefined"==typeof gustoServiceAgreement)return window.location.reload();gustoServiceAgreement(l)}).fail(t)}function t(e){return _ml(!1,o+"Loader"),a=null,handleErrorResponse(e)}function r(e){return $(`#${o} .jsModalCancel`).trigger("click"),handleErrorResponse(e)}$(document).on("click",".jsModalCancel",function(){a=null}),$(document).on("click",".jsSelectAll",function(){$(".jsSingleEmployee").prop("checked",!0)}),$(document).on("click",".jsUnSelectAll",function(){$(".jsSingleEmployee").prop("checked",!1)}),$(".jsCreatePartnerCompanyBtn").click(function(e){if(e.preventDefault(),0===(l=parseInt($(this).data("cid"))))return alertify.alert("ERROR","Company code is missing.",CB);Modal({Id:o,Title:"",Loader:o+"Loader",Body:`<div id="${o}Body"></div>`},i.checkRequirements)}),$(document).on("click",".jsPayrollViewAdminDetails",function(e){e.preventDefault(),_ml(!0,o+"Loader"),a=$.ajax({url:window.location.origin+"/payroll/cpc/6/"+l,method:"GET"}).success(function(e){a=null,$(`#${o}Body`).html(e.view),_ml(!1,o+"Loader")}).fail(r)}),$(document).on("click",".jsPayrollSaveAdmin",function(e){e.preventDefault();var e={firstName:$(".jsAdminFirstName").val().trim(),lastName:$(".jsAdminLastName").val().trim(),email:$(".jsAdminEmailAddress").val().trim(),id:$(".jsAdminUserId").val().trim()},n=[];e.firstName||n.push('"First name" is missing.'),e.lastName||n.push('"Last name" is missing.'),e.email||n.push('"Email" is missing.'),e.email.verifyEmail()||n.push('"Email" is invalid.'),n.length?alertify.alert("ERROR",getErrorsStringFromArray(n),CB):(_ml(!0,o+"Loader"),a=$.ajax({url:window.location.origin+"/payroll/cpc/5/"+l,method:"POST",data:e}).success(function(){return a=null,_ml(!1,o+"Loader"),alertify.alert("SUCCESS","Congratulations! You have successfully added a payroll admin for the company.",function(){i.adminStep()})}).fail(t))}),$(document).on("click",".jsBackToStep3",function(e){e.preventDefault(),_ml(!0,o+"Loader"),i.adminStep()}),$(document).on("click",".jsCreatePartnerCompanyProcessBtn",function(e){e.preventDefault(),_ml(!0,o+"Loader","Please wait patiently while we set up the payroll system. This procedure may take a few minutes."),i.createPartnerCompany()}),$(document).on("change","#jsEmployeeChoose",function(){var e=$(this).val();0!=e&&(ml(!0,"jsCreateLoader"),e=e,ml(!0,"jsCreateLoader","Please wait, while we are generating view."),$.ajax({url:baseUrl("/payrolls/employees/"+e+"/get"),method:"GET"}).success(function(e){$(".jsAdminFirstName").val(e.first_name||""),$(".jsAdminLastName").val(e.last_name||""),$(".jsAdminEmailAddress").val(e.email||""),$(".jsAdminUserId").val(e.id||0)}).fail(function(e){return window.scrollTo(0,0),$(".jsErrorDiv").html(getErrorsStringFromArray((e.responseJSON||JSON.parse(e.responseText)).errors)).removeClass("hidden")}).always(function(){ml(!1,"jsCreateLoader")}))})});
