$(function(){let i=null;function a(){$.ajax({url:baseUrl("benefits/all"),method:"GET",cache:!1}).always(function(){ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){$("#jsBenefitArea").html(e.view)})}function t(){$.ajax({url:baseUrl("benefits/add"),method:"GET",cache:!1}).always(function(){ml(!1,"jsAddBenefitModalLoader")}).fail(handleErrorResponse).done(function(e){$("#jsAddBenefitModalBody").html(e.view)})}function l(e){$.ajax({url:baseUrl("benefits/"+e+"/employees/listing"),method:"GET",cache:!1}).always(function(){ml(!1,"jsEmployeeBenefitListingModalLoader")}).fail(handleErrorResponse).done(function(e){$("#jsEmployeeBenefitListingModalBody").html(e.view)})}$(document).on("click",".jsAddBenefit",function(e){e.preventDefault(),Modal({Id:"jsAddBenefitModal",Loader:"jsAddBenefitModalLoader",Body:'<div id="jsAddBenefitModalBody"></div>',Title:"Add benefit"},t)}),$(document).on("click",".jsSaveBenefit",function(e){e.preventDefault();var e={description:$(".jsName").val().trim(),benefit_type:$(".jsType option:selected").val(),employer_taxes:$(".jsEmployerTaxes option:selected").val(),employee_w2:$(".jsEmployeeW2 option:selected").val(),active:$(".jsActive option:selected").val()},t=[];if(e.description||t.push('"Name" is required.'),t.length)return _error(getErrorsStringFromArray(t));t=e,null===i&&(ml(!0,"jsAddBenefitModalLoader","Please wait while we are saving the benefit."),i=$.ajax({url:baseUrl("benefits/add"),method:"POST",data:t,cache:!1}).always(function(){i=null,ml(!1,"jsAddBenefitModalLoader")}).fail(handleErrorResponse).done(function(e){a(),$(".jsModalCancel").trigger("click"),_success(e.message)}))}),$(document).on("click",".jsEditBenefit",function(e){e.preventDefault();let t=$(this).closest("tr").data("id");Modal({Id:"jsEditBenefitModal",Loader:"jsEditBenefitModalLoader",Body:'<div id="jsEditBenefitModalBody"></div>',Title:"Edit benefit"},function(){var e;e=t,$.ajax({url:baseUrl("benefits/edit/"+e),method:"GET",cache:!1}).always(function(){ml(!1,"jsEditBenefitModalLoader")}).fail(handleErrorResponse).done(function(e){$("#jsEditBenefitModalBody").html(e.view)})})}),$(document).on("click",".jsUpdateBenefit",function(e){e.preventDefault();var e={description:$(".jsName").val().trim(),active:$(".jsActive option:selected").val()},t=$(".jsKey").val(),n=[];if(e.description||n.push('"Name" is required.'),t||n.push('"Key" is required.'),n.length)return _error(getErrorsStringFromArray(n));n=e,e=t,null===i&&(ml(!0,"jsEditBenefitModalLoader","Please wait while we are updating the benefit."),i=$.ajax({url:baseUrl("benefits/edit/"+e),method:"POST",data:n,cache:!1}).always(function(){i=null,ml(!1,"jsEditBenefitModalLoader")}).fail(handleErrorResponse).done(function(e){a(),$(".jsModalCancel").trigger("click"),_success(e.message)}))}),$(document).on("click",".jsDeleteBenefit",function(e){e.preventDefault();let t=$(this).closest("tr").data("id");return _confirm("<p><strong>This action is not revertible</strong></p><br /><p>The following must be true in order to delete a company benefit</p><br /><p>There are no employee benefits associated with the company benefit</p><p>There are no payroll items associated with the company benefit</p>",function(){var e;e=t,null===i&&(ml(!0,"jsPageLoader","Please wait while we are deleting the selected benefit."),i=$.ajax({url:baseUrl("benefits/"+e),method:"DELETE",cache:!1}).always(function(){i=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){a(),_success(e.message)}))})}),$(document).on("click",".jsEditEmployeesBenefit",function(e){e.preventDefault();let t=$(this).data("id");Modal({Id:"jsEditEmployeeBenefitModal",Loader:"jsEditEmployeeBenefitModalLoader",Body:'<div id="jsEditEmployeeBenefitModalBody"></div>',Title:"Manage benefit employees"},function(){var e;e=t,$.ajax({url:baseUrl("benefits/employees/"+e),method:"GET",cache:!1}).always(function(){ml(!1,"jsEditEmployeeBenefitModalLoader")}).fail(handleErrorResponse).done(function(e){$("#jsEditEmployeeBenefitModalBody").html(e.view)})})}),$(document).on("click",".jsSelectAll",function(e){e.preventDefault(),$('[name="employees[]"]').prop("checked",!0)}),$(document).on("click",".jsDeSelectAll",function(e){e.preventDefault(),$('[name="employees[]"]').prop("checked",!1)}),$(document).on("click",".jsUpdateBenefitEmployees",function(e){if(e.preventDefault(),!$('input[name="employees[]"]:checked').length)return _error("Please select at least one employee.");var t,e=$(this).data("key");let n={employees:[],employee_deductions:0,company_contribution:0,company_contribution_annual_maximum:"",limit_option:"",catch_up:"false",coverage_amount:"",coverage_salary_multiplier:"0.00",deduction_reduces_taxable_income:null};return $('input[name="employees[]"]:checked').map(function(){n.employees.push($(this).val())}),n.employee_deductions=$(".jsDeduction").val().trim(),n.company_contribution=$(".jsCompanyContribution").val().trim(),n.company_contribution_annual_maximum=$(".jsCompanyContributionAnnualMaximum").val().trim(),n.limit_option=$(".jsCompanyLimitOption").val().trim(),n.catch_up=$(".jsCompanyCatchUp option:selected").val().trim(),n.coverage_amount=$(".jsCoverageAmount").val().trim(),n.coverage_salary_multiplier=$(".jsCoverageSalaryMultiplier").val().trim(),n.deduction_reduces_taxable_income=$(".jsDeductionReducesTaxableIncome option:selected").val().trim(),!n.employee_deductions&&!n.company_contribution||0==n.employee_deductions&&0==n.company_contribution?_error("Employee deduction or company contribution is required."):(t=n,e=e,void(null===i&&(ml(!0,"jsEditEmployeeBenefitModalLoader","Please wait while we are updating the benefit employees."),i=$.ajax({url:baseUrl("benefits/edit/"+e+"/employees"),method:"POST",data:t,cache:!1}).always(function(){i=null,ml(!1,"jsEditEmployeeBenefitModalLoader")}).fail(handleErrorResponse).done(function(e){a(),$(".jsModalCancel").trigger("click"),_success(e.message)}))))}),$(document).on("click",".jsBenefitEmployeesListing",function(e){e.preventDefault();let t=$(this).closest("tr").data("id");Modal({Id:"jsEmployeeBenefitListingModal",Loader:"jsEmployeeBenefitListingModalLoader",Body:'<div id="jsEmployeeBenefitListingModalBody"></div>',Title:"Manage employees"},function(){l(t)})}),$(document).on("click",".jsBenefitEmployeesListingWithin",function(e){e.preventDefault(),l($(this).data("key"))}),$(document).on("click",".jsEditEmployeeBenefit",function(e){e.preventDefault(),e=$(this).closest("tr").data("id"),ml(!0,"jsEmployeeBenefitListingModalLoader","Please wait while we are generating a preview."),$.ajax({url:baseUrl("benefits/employees/"+e+"/edit"),method:"GET",cache:!1}).always(function(){ml(!1,"jsEmployeeBenefitListingModalLoader")}).fail(handleErrorResponse).done(function(e){$("#jsEmployeeBenefitListingModalBody").html(e.view)})}),$(document).on("click",".jsUpdateBenefitEmployee",function(e){e.preventDefault();var t,e=$(".jsKey").val(),n=$(".jsBenefitEmployeesListingWithin").data("key"),i={employee_deductions:$(".jsDeduction").val().trim()||0,company_contribution:$(".jsCompanyContribution").val().trim()||0,active:$(".jsActive option:selected").val(),company_contribution_annual_maximum:$(".jsCompanyContributionAnnualMaximum").val().trim()||0,limit_option:$(".jsCompanyLimitOption").val().trim(),catch_up:$(".jsCompanyCatchUp option:selected").val().trim(),coverage_amount:$(".jsCoverageAmount").val().trim(),coverage_salary_multiplier:$(".jsCoverageSalaryMultiplier").val().trim(),deduction_reduces_taxable_income:$(".jsDeductionReducesTaxableIncome option:selected").val().trim()},o=[];if(e||o.push('"Key" is required.'),(!i.employee_deductions&&!i.company_contribution||0==i.employee_deductions&&0==i.company_contribution)&&o.push("Employee deduction or company contribution is required."),o.length)return _error(getErrorsStringFromArray(o));o=e,t=n,e=i,ml(!0,"jsEmployeeBenefitListingModalLoader","Please wait while we are updating the benefit."),$.ajax({url:baseUrl("benefits/employees/"+o),method:"POST",data:e,cache:!1,employeeBenefitId:o}).always(function(){ml(!1,"jsEmployeeBenefitListingModalLoader")}).fail(handleErrorResponse).done(function(e){a(),l(t),_success(e.message)})}),$(document).on("click",".jsRemoveEmployeeFromBenefit",function(e){e.preventDefault();let t=$(this).closest("tr").data("id");return _confirm("This will stop all deductions and contributions for this employee. This action cannot be undone.",function(){var e;e=t,ml(!0,"jsEmployeeBenefitListingModalLoader","Please wait while we are deleting employee from benefit."),$.ajax({url:baseUrl("benefits/employees/"+e),method:"DELETE",cache:!1}).always(function(){ml(!1,"jsEmployeeBenefitListingModalLoader")}).fail(handleErrorResponse).done(function(e){a(),l(e.key),_success(e.message)})})}),a()});
