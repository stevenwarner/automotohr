!function(){let o,a=0;$(document).on("click",".jsModalCancel",e=>{e.preventDefault(),"yes"==$(e.target).data("ask")?alertify.confirm("Any unsaved changes will be lost.",()=>{$(e.target).closest(".csModal").fadeOut(300),$("body").css("overflow-y","auto"),$("#ui-datepicker-div").remove(),$(".jsMsModal").remove()}).set("labels",{ok:"LEAVE",cancel:"NO, I WILL STAY"}).set("title","Notice!"):($(e.target).closest(".csModal").fadeOut(300),$("body").css("overflow-y","auto"),$(".jsMsModal").remove(),$("#ui-datepicker-div").remove())}),window._ml=window.ml=function(e,t,s){t=void 0===t?".jsIPLoader":`.jsIPLoader[data-page="${t}"]`,void 0!==o&&document.getElementsByClassName("csModalBody").length&&(document.getElementsByClassName("csModalBody")[0].scrollTop=0),void 0!==o&&e&&$(".jsIPLoader").height($(`#${o}Body`).height()+a),void 0===e||!1===e?$(t).hide():$(t).show(),void 0!==s&&$(".jsIPLoaderText").html(s),e||$(".jsIPLoaderText").html("Please wait, while we are generating a preview.")},window.Model=window.Modal=function(e,t){var s=`
			<!-- Custom Modal -->
			<div class="csModal jsMsModal" id="${e.Id}">
				<div class="${e.Cl||"container"}">
					<div class="csModalHeader">
						<h3 class="csModalHeaderTitle">
							<span>${e.Title}</span>
							<span class="csModalButtonWrap">
							${void 0!==e.Buttons&&0!==e.Buttons.length?e.Buttons.join(""):""}
								<button class="btn btn-black btn-cancel csW jsModalCancel" ${void 0===e.Ask?"":'data-ask="no"'} title="Close this window">Cancel</button>
							</span>
							<div class="clearfix"></div>
						</h3>
					</div>
					<div class="csModalBody">
						<div class="csIPLoader jsIPLoader" data-page="${e.Loader}">
							<div class="csIPLoaderBox">
								<i class="fa fa-circle-o-notch fa-spin" aria-hidden="true"></i><br><br>
								<br>
								<span class="jsIPLoaderText">Please wait while we process your request.</span>
							</div>
						</div>
						${e.Body}
					</div>
					<div class="clearfix"></div>
				</div>
			</div>
			`;o=e.Id,a=$(`#${e.Id} .csModalHeader`).height()+50,$(".jsMsModal").remove(),$("#"+e.Id).remove(),$("body").append(s),$("#"+e.Id).fadeIn(300),$("body").css("overflow-y","hidden"),$(`#${e.Id} .csModalBody`).css("top",a),void 0!==t&&t()}}(),$(function(){let t=null,s=getSegment(2),i={},n={};function o(e,t,s,o,a){t&&e.find("."+t).length&&(a?e.find("."+t).text(""+a+_cur(o)):e.find("."+t).text(_cur(o)+" hrs")),s&&e.find("."+s).length&&e.find("."+s).val(o)}function a(e){var t=n.employees[e],s=i[e],s=function(e,t){let s=e;"year"==(t=t.toLowerCase())?s=e/52/40:"month"==t?s=12*e/52/40:"week"==t&&(s=e/40);return s}(s.compensation.rate,s.compensation.payment_unit),o=$('tr[data-id="'+e+'"]');let a=0,l=(a+=parseFloat(t.hourly_compensations.regular_hours.hours*s*t.hourly_compensations.regular_hours.compensation_multiplier),o.find(".jsOvertimeText").length&&(a+=parseFloat(t.hourly_compensations.overtime.hours*s*t.hourly_compensations.overtime.compensation_multiplier)),o.find(".jsDoubleOvertimeText").length&&(a+=parseFloat(t.hourly_compensations.double_overtime.hours*s*t.hourly_compensations.double_overtime.compensation_multiplier)),0);$.each(n.employees[e].fixed_compensations,function(e,t){l+=parseFloat(t.amount)}),a+=parseFloat(l),a=_cur(a,!0),o.find(".jsShowTotal").text("$"+a)}function l(e){var t="";return t+('<div class="jsReimbursementRow" data-id="'+(e.id||getRandomCode())+'">')+'<div class="row">'+'\t<div class="col-sm-6 col-xs-12">'+'\t\t<label class="csF16">Description</label>'+('<input type="text" class="form-control jsReimbursementDescription csF16" placeholder="Additional amount" value="'+e.description+'" />')+"\t</div>"+'\t<div class="col-sm-5 col-xs-12">'+'\t\t<label class="csF16">Amount</label>'+'\t\t<div class="input-group">'+'\t\t\t<div class="input-group-addon">$</div>'+('\t\t\t<input type="number" class="form-control csF1 jsReimbursementAmount" placeholder="0.0" value="'+parseFloat(e.amount)+'" />')+"\t\t</div>"+"\t</div>"+'\t<div class="col-sm-1 col-xs-12 text-right">'+'\t\t<label class="csF16">Action</label>'+'\t\t<button class="btn btn-danger csF16 jsReimbursementDeleteBtn">'+'\t\t\t<i class="fa fa-times-circle csF16"></i>'+"\t\t</button>"+"\t</div>"+"</div>"+"\t<hr />"+"</div>"}$(document).on("click",".jsBoxSwitch",function(e){e.preventDefault(),$(this).addClass("hidden"),$(this).parent().find(".jsBoxField").removeClass("hidden")}),$(document).on("click",".jsAdditionalEarningBtn",function(e){e.preventDefault(),$(this).find("button").addClass("hidden"),$(this).find(".jsBoxField").removeClass("hidden"),e=$(this).closest("tr").data("id"),Modal({Id:"jsAdditionalEarning",Title:"Other Earnings",Body:`<div class="container"><div id="jsAdditionalEarningBody">${function(e){let t=i[e],s=n.employees[e],o="";return o=(o=(o=(o+='<br /><p class="csF16 text-danger">')+"<strong><em>")+t.name+" will be paid the amounts below in addition to their regular wages.</em>")+"</strong></em>",$.each(s.fixed_compensations,function(e,t){"reimbursement"!=e&&"bonus"!=e&&null===e.match("time_off")&&(o=(o=(o=(o=(o+='<div class="form-group">')+'<label class="csF16">'+t.name+"</label>")+'<div class="input-group"><div class="input-group-addon">$</div>')+'<input type="number" class="form-control jsAdditionalEarningFields" data-key="'+e+'" placeholder="0.0" value="'+t.amount+'" />')+"</div></div>")}),o=(o+='<div class="form-group text-right"><button class="btn btn-black jsModalCancel">Cancel</button>&nbsp;')+'<button class="btn btn-orange jsSaveAdditionalEarningsBtn" data-id="'+e+'">Save</button></div>'}(e)}</div></div>`,Loader:"jsAdditionalEarningLoader"},function(){_ml(!1,"jsAdditionalEarningLoader")})}),$(document).on("click",".jsCancelRH",function(){$(this).closest("tr.jsRegularPayrollEmployeeRow").data("id");$(this).closest("tr.jsRegularPayrollEmployeeRow").find(".jsRegularHoursBox").find(".jsBoxSwitch").removeClass("hidden"),$(this).closest("tr.jsRegularPayrollEmployeeRow").find(".jsRegularHoursBox").find(".jsBoxField").addClass("hidden")}),$(document).on("click",".jsCancelOT",function(){$(this).closest("tr.jsRegularPayrollEmployeeRow").data("id");$(this).closest("tr.jsRegularPayrollEmployeeRow").find(".jsOvertimeBox").find(".jsBoxSwitch").removeClass("hidden"),$(this).closest("tr.jsRegularPayrollEmployeeRow").find(".jsOvertimeBox").find(".jsBoxField").addClass("hidden")}),$(document).on("click",".jsCancelDOT",function(){$(this).closest("tr.jsRegularPayrollEmployeeRow").data("id");$(this).closest("tr.jsRegularPayrollEmployeeRow").find(".jsDoubleOvertimeBox").find(".jsBoxSwitch").removeClass("hidden"),$(this).closest("tr.jsRegularPayrollEmployeeRow").find(".jsDoubleOvertimeBox").find(".jsBoxField").addClass("hidden")}),$(document).on("click",".jsCancelBonus",function(){$(this).closest("tr.jsRegularPayrollEmployeeRow").data("id");$(this).closest("tr.jsRegularPayrollEmployeeRow").find(".jsBonusBox").find(".jsBoxSwitch").removeClass("hidden"),$(this).closest("tr.jsRegularPayrollEmployeeRow").find(".jsBonusBox").find(".jsBoxField").addClass("hidden")}),$(document).on("keyup",".jsRegularHoursValue",function(){var e=$(this).val().trim()||0,t=$(this).closest("tr.jsRegularPayrollEmployeeRow").data("id");$(this).closest("tr.jsRegularPayrollEmployeeRow").find(".jsRegularHoursText").text(e+" hrs"),n.employees[t].hourly_compensations.regular_hours.hours=parseFloat(e),a(t)}),$(document).on("keyup",".jsOvertimeValue",function(){var e=$(this).val().trim()||0,t=$(this).closest("tr.jsRegularPayrollEmployeeRow").data("id");$(this).closest("tr.jsRegularPayrollEmployeeRow").find(".jsOvertimeText").text(e+" hrs"),n.employees[t].hourly_compensations.overtime.hours=parseFloat(e),a(t)}),$(document).on("keyup",".jsDoubleOvertimeValue",function(){var e=$(this).val().trim()||0,t=$(this).closest("tr.jsRegularPayrollEmployeeRow").data("id");$(this).closest("tr.jsRegularPayrollEmployeeRow").find(".jsDoubleOvertimeText").text(e+" hrs"),n.employees[t].hourly_compensations.double_overtime.hours=parseFloat(e),a(t)}),$(document).on("keyup",".jsBonusValue",function(){var e=$(this).val().trim()||0,t=$(this).closest("tr.jsRegularPayrollEmployeeRow").data("id");$(this).closest("tr.jsRegularPayrollEmployeeRow").find(".jsBonusText").text("$"+e),n.employees[t].fixed_compensations.bonus.amount=parseFloat(e),a(t)}),$(document).on("click",".jsSaveAdditionalEarningsBtn",function(e){e.preventDefault();let t=$(this).data("id"),s=0;$(".jsAdditionalEarningFields").map(function(){var e=parseFloat($(this).val().trim()||0);n.employees[t].fixed_compensations[$(this).data("key")].amount=parseFloat(e),s+=e}),$('tr.jsRegularPayrollEmployeeRow[data-id="'+t+'"]').find(".jsAdditionalEarningValue").val(s),a(t),$(".jsModalCancel").trigger("click")}),$(document).on("click",".jsReimbursementBtn",function(e){var t;e.preventDefault(),t=$(this).closest("tr").data("id"),Modal({Id:"jsReimbursement",Title:"Employee Reimbursement",Body:`<div class="container"><div id="jsReimbursementBody">${function(e){let s="",t=n.employees[e].data.reimbursement_json||[];s=(s=(s=(s=(s=(s=(s=(s=(s=(s+='<br /><p class="csF16 text-danger">\t<strong>')+"\t\t<em>Below are all reimbursements to be paid to this employee this pay period. You can edit recurring reimbursements by going to the People tab and selecting this employee.")+"\t\t</em>\t</strong>")+'</p><div class="panel panel-default">')+'\t<div class="panel-heading">\t\t<div class="row">')+'\t\t\t<div class="col-sm-8 col-xs-12">\t\t\t\t<p class="csF16"><strong>One-time reimbursements</strong></p>')+'\t\t\t</div>\t\t\t<div class="col-sm-4 col-xs-12 text-right">')+'\t\t\t\t<p class="csF16"><strong class="jsReimbursementTotal">$0.00</strong></p>\t\t\t</div>')+"\t\t</div>\t</div>")+'\t<div class="panel-body">\t\t<div class="csReimbursementBox">',t.data&&$.each(t.data,function(e,t){s+=l(t)});return s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s+="\t\t</div>")+'\t\t<div class="row">\t\t\t<div class="col-sm-12 col-xs-12 text-center">')+'\t\t\t\t<button class="btn btn-orange jsAddReimbursement" data-id="'+e+'">Add reimbursement</button>\t\t\t</div>')+"\t\t</div>\t</div>")+'</div><div class="panel panel-default">')+'\t<div class="panel-heading">\t\t<div class="row">')+'\t\t\t<div class="col-sm-8 col-xs-12">\t\t\t\t<p class="csF16"><strong>Total</strong></p>')+'\t\t\t</div>\t\t\t<div class="col-sm-4 col-xs-12 text-right">')+'\t\t\t\t<p class="csF16"><strong class="jsReimbursementTotal">$0.00</strong></p>\t\t\t</div>')+"\t\t</div>\t</div>")+'</div>\t\t<div class="row">')+'\t\t\t<div class="col-sm-12 col-xs-12 text-right"><button class="btn btn-black jsModalCancel">Cancel</button>&nbsp;')+'<button class="btn btn-orange jsSaveReimbursementBtn" data-id="'+e+'">Save</button>\t\t\t</div>')+"\t\t</div>\t</div>"}(t)}</div></div>`,Loader:"jsReimbursementLoader"},function(){$(".jsReimbursementTotal").text("$"+_cur(n.employees[t].data.reimbursement_json&&n.employees[t].data.reimbursement_json.total||0,!0)),_ml(!1,"jsReimbursementLoader")})}),$(document).on("click",".jsAddReimbursement",function(e){e.preventDefault(),$(".csReimbursementBox").append(l({description:"Additional amount",amount:0}))}),$(document).on("keyup",".jsReimbursementAmount",function(){($(this).val().trim()||0)<=0&&$(this).val(0);let e=0;$(".jsReimbursementAmount").map(function(){e+=parseFloat($(this).val().trim()||0)}),$(".jsReimbursementTotal").text("$"+_cur(e,!0))}),$(document).on("click",".jsReimbursementDeleteBtn",function(e){e.preventDefault(),$(this).closest(".jsReimbursementRow").remove();let t=0;$(".jsReimbursementAmount").map(function(){t+=parseFloat($(this).val().trim()||0)}),$(".jsReimbursementTotal").text("$"+t)}),$(document).on("click",".jsSaveReimbursementBtn",function(e){e.preventDefault();e=$(this).data("id");_ml(!0,"jsReimbursementLoader");let t={total:0,data:{}};$(".jsReimbursementRow").map(function(){t.total+=parseFloat($(this).find(".jsReimbursementAmount").val().trim()||0),t.data[$(this).data("id")]={id:$(this).data("id"),description:$(this).find(".jsReimbursementDescription").val().trim()||"Additional amount",amount:parseFloat($(this).find(".jsReimbursementAmount").val().trim()||0)}}),n.employees[e].fixed_compensations.reimbursement.amount=parseFloat(t.total),n.employees[e].data.reimbursement_json=t,$(".jsModalCancel").trigger("click"),0!=t.total?($('.jsRegularPayrollEmployeeRow[data-id="'+e+'"]').find(".jsReimburmentTotal").text("R $"+_cur(t.total,!0)),$('.jsRegularPayrollEmployeeRow[data-id="'+e+'"]').find(".jsReimbursementTotalBox").removeClass("hidden"),$('.jsRegularPayrollEmployeeRow[data-id="'+e+'"]').find(".jsReimbursementTotalBoxBtn").addClass("hidden")):($('.jsRegularPayrollEmployeeRow[data-id="'+e+'"]').find(".jsReimbursementTotalBox").addClass("hidden"),$('.jsRegularPayrollEmployeeRow[data-id="'+e+'"]').find(".jsReimbursementTotalBoxBtn").removeClass("hidden")),a(e)}),$(document).on("change",".jsPaymentMethod",function(){var e=$(this).closest(".jsRegularPayrollEmployeeRow").data("id");n.employees[e].payment_method=$(this).val()}),$(document).on("click",".jsSkipEmployeeFromPayroll",function(e){e.preventDefault();var e=$(this).closest(".jsRegularPayrollEmployeeRow"),t=e.data("id");$(this).addClass("hidden"),e.find(".jsAddEmployeeFromPayroll").removeClass("hidden"),e.find(".jsSkipPayroll").addClass("hidden"),n.employees[t].excluded=!0}),$(document).on("click",".jsAddEmployeeFromPayroll",function(e){e.preventDefault();var e=$(this).closest(".jsRegularPayrollEmployeeRow"),t=e.data("id");$(this).addClass("hidden"),e.find(".jsSkipEmployeeFromPayroll").removeClass("hidden"),e.find(".jsSkipPayroll").removeClass("hidden"),n.employees[t].excluded=!1}),$(document).on("click",".jsRegularPayrollStep1Save",function(e){e.preventDefault(),ml(!0,"jsPageLoader","Please wait, while we are saving data."),null===t&&(t=$.ajax({url:baseUrl("payrolls/regular/"+s+"/save/1"),method:"POST",data:{payrollId:s,employees:n.employees},cache:!1}).always(function(){t=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){return _success(e.message,function(){ml(!0,"jsPageLoader","Please wait while we are processing your request."),window.location.href=baseUrl("payrolls/regular/"+s)})}))}),null===t&&(ml(!0,"jsPageLoader","Please wait, while we are generating view."),t=$.ajax({url:baseUrl("payrolls/regular/"+s+"/view/1"),method:"GET",cache:!1}).always(function(){t=null,ml(!1,"jsPageLoader")}).fail(handleErrorResponse).done(function(e){i=e.employees,n=e.payroll,$("tbody").html(e.view),n&&(e=(e="")+'\t\t<a href="'+baseUrl("payrolls/regular")+'" class="btn btn-black">\t\t\t<i class="fa fa-times-circle " aria-hidden="true"></i>\t\t\t&nbsp;Cancel\t\t</a>\t\t<button class="btn btn-red jsRegularPayrollStep1Save">\t\t\t<i class="fa fa-refresh csF16" aria-hidden="true"></i>\t\t\t&nbsp;Discard\t\t</button>\t\t<button class="btn btn-orange jsRegularPayrollStep1Save">\t\t\t<i class="fa fa-save csF16" aria-hidden="true"></i>\t\t\t&nbsp;Save & Calculate\t\t</button>',$(".jsRegularPayrollPanel").html(e).removeClass("hidden"),$(".jsRegularPayrollEmployeeRow").map(function(){var e=$(this).data("id"),t=n.employees[e];if(t){o($(this),"jsRegularHoursText","jsRegularHoursValue",t.hourly_compensations.regular_hours.hours),t.hourly_compensations.overtime&&o($(this),"jsOvertimeText","jsOvertimeValue",t.hourly_compensations.overtime.hours),t.hourly_compensations.double_overtime&&o($(this),"jsDoubleOvertimeText","jsDoubleOvertimeValue",t.hourly_compensations.double_overtime.hours),t.fixed_compensations.bonus&&o($(this),"jsBonusText","jsBonusValue",t.fixed_compensations.bonus.amount,"Bonus $"),$(this).find('.jsPaymentMethod option[value="'+t.payment_method+'"]').prop("selected",!0);let s=0;$.each(t.fixed_compensations,function(e,t){"bonus"!=e&&"reimbursement"!=e&&(s+=parseFloat(t.amount))}),o($(this),"jsAdditionalEarningText","jsAdditionalEarningValue",s,"AE $"),t.data&&t.data.reimbursement_json&&0!=t.data.reimbursement_json.total?(o($(this),"jsReimburmentTotal","",t.data.reimbursement_json.total,"R $"),$(this).find(".jsReimbursementTotalBox").removeClass("hidden"),$(this).find(".jsReimbursementTotalBoxBtn").addClass("hidden")):($(this).find(".jsReimbursementTotalBox").addClass("hidden"),$(this).find(".jsReimbursementTotalBoxBtn").removeClass("hidden")),t.excluded&&"false"!==t.excluded?($(this).find(".jsSkipEmployeeFromPayroll").addClass("hidden"),$(this).find(".jsAddEmployeeFromPayroll").removeClass("hidden"),$(this).find(".jsSkipPayroll").addClass("hidden")):($(this).find(".jsSkipEmployeeFromPayroll").removeClass("hidden"),$(this).find(".jsAddEmployeeFromPayroll").addClass("hidden"),$(this).find(".jsSkipPayroll").removeClass("hidden")),a(e)}}))}))});
