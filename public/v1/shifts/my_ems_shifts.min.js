$(function(){const o=getSearchParam("mode")||"month";let i=null;const a="jsModalPage",l=a+"Loader",s=a+"Body";function d(){$(".jsTimeField").timepicker({timeFormat:"h:mm p",dynamic:!1,dropdown:!1,scrollbar:!1})}function e(){let e="";var t;return e="month"===o?(t=getSearchParam("year")||moment().format("YYYY"),(getSearchParam("month")||moment().format("MM"))+"/01/"+t):getSearchParam("start_date")||moment().weekday(1).format("MM/DD/YYYY")}$(".jsWeekDaySelect").daterangepicker({opens:"center",singleDatePicker:!0,showDropdowns:!0,autoApply:!0,startDate:e(),locale:{format:"MM/DD/YYYY"},isInvalidDate:function(e){return"month"===o?"01"!==e.format("DD"):1!==e.day()}}),$(".jsWeekDaySelect").on("apply.daterangepicker",function(e,t){var a=("month"===o?t.startDate.clone().startOf("month"):t.startDate.clone()).format("MM/DD/YYYY");let r=0;r="week"===o?6:"two_week"===o?13:t.startDate.endOf("month").format("MM/DD/YYYY");var n=t.startDate.add(r,"days").format("MM/DD/YYYY");if("month"==o)return window.location.href=baseUrl("shifts/my?mode="+o+"&year="+t.startDate.clone().format("YYYY")+"&month="+t.startDate.clone().format("MM"));window.location.href=baseUrl("shifts/my?mode="+o+"&start_date="+a+"&end_date="+n)}),$(".schedule-employee-row").map(function(){$(".schedule-column-"+$(this).data("id")).height($(this).height())}),$(".item-openshift").click(function(e){e.preventDefault(),e.stopPropagation(),e=$(this).data("id");var t="Claim Shift",r="open_single_shift_claim",n=e,o=function(e){ml(!1,l),d(),validatorRef=$("#jsPageCreateSingleShiftForm").validate({rules:{shift_date:{required:!0},start_time:{required:!0,timeIn12Format:!0},end_time:{required:!0,timeIn12Format:!0}},errorPlacement:function(e,t){($(t).parent().hasClass("input-group")?$(t).parent():$(t)).after(e)},submitHandler:function(t){var t=formArrayToObj($(t).serializeArray()),a=$(".jsPageCreateSingleShiftBtn"),r="settings/shifts/opensingle/claim",n=function(e){_success(e.msg,function(){window.location.reload()})};if(null===i){let e;a&&(e=callButtonHook(a,!0)),i=$.ajax({url:baseUrl(r),method:"POST",data:t,processData:!1,contentType:!1}).always(function(){a&&callButtonHook(e,!1),i=null}).fail(handleErrorResponse).done(function(e){return validatorRef?.destroy(),n(e)})}}})};Modal({Id:a,Title:t,Body:'<div id="'+s+'"></div>',Loader:l},function(){var e=r,t=n,a=o;null!==i&&i.abort(),i=$.ajax({url:baseUrl("settings/page/"+e+"/"+t),method:"GET"}).always(function(){i=null}).fail(handleErrorResponse).done(function(e){$("#"+s).html(e.view),a(e)})})}),$(document).on("click",".jsAddBreak",function(e){e.preventDefault();e=getRandomCode();$(".jsBreakContainer").append(generateBreakHtml(e)),$('[name="breaks['+e+'][break]"]').rules("add",{required:!0}),$('[name="breaks['+e+'][duration]"]').rules("add",{required:!0,number:!0,digits:!0,greaterThanZero:!0}),d()}),$("#shift_date_from").daterangepicker({opens:"center",singleDatePicker:!0,showDropdowns:!0,autoApply:!0,startDate:e(),locale:{format:"MM/DD/YYYY"}},function(e,t,a){$("#shift_date_to").data("daterangepicker").setStartDate(e)}),$("#shift_date_to").daterangepicker({opens:"center",singleDatePicker:!0,showDropdowns:!0,autoApply:!0,startDate:function(e){let t="";var a;return t="week"===o?getSearchParam("end_date")||moment(e,"MM/DD/YYYY").endOf("week").add(1,"day").format("MM/DD/YYYY"):"two_week"===o?getSearchParam("end_date")||moment(e,"MM/DD/YYYY").add(2,"week").subtract(1,"days").format("MM/DD/YYYY"):(e=getSearchParam("year")||moment().format("YYYY"),a=getSearchParam("month")||moment().format("MM"),moment(e+"-"+a+"-01").endOf("month").format("MM/DD/YYYY"))}(),locale:{format:"MM/DD/YYYY"}}),$(".jsNavigateRightMy").click(function(e){e.preventDefault();var e=$(".jsWeekDaySelect").data("daterangepicker").startDate;let t="",a=1;return t="week"===o?e.clone().add(1,"week"):"two_week"===o?(a=2,e.clone().add(2,"week")):e.clone().endOf("month"),"month"!==o?window.location.href=baseUrl("shifts/my?mode="+o+"&start_date="+t.clone().format("MM/DD/YYYY")+"&end_date="+t.clone().add(a,"week").subtract(1,"day").format("MM/DD/YYYY")):(e=t.clone().add(1,"month"),window.location.href=baseUrl("shifts/my?mode="+o+"&year="+e.clone().format("YYYY")+"&month="+e.clone().format("MM")))}),$(".jsNavigateLeftMy").click(function(e){e.preventDefault();var e=$(".jsWeekDaySelect").data("daterangepicker").startDate;return"month"!==o?window.location.href=baseUrl("shifts/my?mode="+o+"&start_date="+e.clone().subtract("week"===o?1:2,"week").format("MM/DD/YYYY")+"&end_date="+e.clone().subtract(1,"day").format("MM/DD/YYYY")):(e=e.clone().subtract(1,"month"),window.location.href=baseUrl("shifts/my?mode="+o+"&year="+e.clone().format("YYYY")+"&month="+e.clone().format("MM")))}),$(".jsFilterBtn").click(function(e){e.preventDefault(),$(".jsFilterRow").toggleClass("hidden")}),$(".jsFilterResetBtn").click(function(e){return e.preventDefault(),window.location.href=baseUrl("shifts/my?mode=month")}),$(".jsFilterApplyBtn").click(function(e){e.preventDefault();var e=$("#start_date").val(),t=$("#end_date").val();return e?t?window.location.href=baseUrl("shifts/my?mode=week&start_date="+e+"&end_date="+t):_error("Please select a end date."):_error("Please select a start date.")}),getSearchParam("start_date")&&$(".jsFilterBtn").trigger("click")});
