$(function(){let r=null;const t="jsModalPage",a=t+"Loader",s=t+"Body",c=getSearchParam("mode")||"month";function m(){let e="";var t;return e="month"===c?(t=getSearchParam("year")||moment().format("YYYY"),(getSearchParam("month")||moment().format("MM"))+"/01/"+t):getSearchParam("start_date")||moment().weekday(1).format("MM/DD/YYYY")}$(".jsWeekDaySelect").daterangepicker({opens:"center",singleDatePicker:!0,showDropdowns:!0,autoApply:!0,startDate:m(),locale:{format:"MM/DD/YYYY"},isInvalidDate:function(e){return"month"===c?"01"!==e.format("DD"):1!==e.day()}}),$(".jsWeekDaySelect").on("apply.daterangepicker",function(e,t){var a=("month"===c?t.startDate.clone().startOf("month"):t.startDate.clone()).format("MM/DD/YYYY");let n=0;n="week"===c?6:"two_week"===c?13:t.startDate.endOf("month").format("MM/DD/YYYY");var o=t.startDate.add(n,"days").format("MM/DD/YYYY");if("month"==c)return window.location.href=baseUrl("settings/shifts/manage?mode="+c+"&year="+t.startDate.clone().format("YYYY")+"&month="+t.startDate.clone().format("MM"));window.location.href=baseUrl("settings/shifts/manage?mode="+c+"&start_date="+a+"&end_date="+o)}),$(".jsNavigateLeft").click(function(e){e.preventDefault();var e=$(".jsWeekDaySelect").data("daterangepicker").startDate;return"month"!==c?window.location.href=baseUrl("settings/shifts/manage?mode="+c+"&start_date="+e.clone().subtract("week"===c?1:2,"week").format("MM/DD/YYYY")+"&end_date="+e.clone().subtract(1,"day").format("MM/DD/YYYY")):(e=e.clone().subtract(1,"month"),window.location.href=baseUrl("settings/shifts/manage?mode="+c+"&year="+e.clone().format("YYYY")+"&month="+e.clone().format("MM")))}),$(".jsNavigateRight").click(function(e){e.preventDefault();var e=$(".jsWeekDaySelect").data("daterangepicker").startDate;let t="",a=1;return t="week"===c?e.clone().add(1,"week"):"two_week"===c?(a=2,e.clone().add(2,"week")):e.clone().endOf("month"),"month"!==c?window.location.href=baseUrl("settings/shifts/manage?mode="+c+"&start_date="+t.clone().format("MM/DD/YYYY")+"&end_date="+t.clone().add(a,"week").subtract(1,"day").format("MM/DD/YYYY")):(e=t.clone().add(1,"month"),window.location.href=baseUrl("settings/shifts/manage?mode="+c+"&year="+e.clone().format("YYYY")+"&month="+e.clone().format("MM")))}),$(".schedule-employee-row").map(function(){$(".schedule-column-"+$(this).data("id")).height($(this).height())}),$(".schedule-column-clickable").click(function(e){var t;e.preventDefault(),e=$(this).data("eid"),t=$(this).closest(".schedule-column-container").data("date"),alert(e+"  "+t)}),$(".jsApplyTemplate").click(function(e){var n,o,l;e.preventDefault(),e="Apply shift template",n="apply_shift_templates",o=0,l=function(){ml(!1,a),$(".jsSelectScheduleTemplate").click(function(e){e.preventDefault(),$(".jsSelectScheduleTemplate").removeClass("active"),$(this).addClass("active")}),$(".jsSelectAll").click(function(e){e.preventDefault(),$(".jsPageApplyTemplateEmployees").prop("checked",!0)}),$(".jsRemoveAll").click(function(e){e.preventDefault(),$(".jsPageApplyTemplateEmployees").prop("checked",!1)}),$("#jsPageApplyShiftTemplateForm").submit(function(e){e.preventDefault();const t={start_date:m(),schedule_id:$(".jsSelectScheduleTemplate.active").data("id"),employees:[]};if(t.end_date=function(e){let t="";{var a;t="week"===c?getSearchParam("end_date")||moment(e,"MM/DD/YYYY").endOf("week").add(1,"day").format("MM/DD/YYYY"):"two_week"===c?getSearchParam("end_date")||moment(e,"MM/DD/YYYY").add(2,"week").subtract(1,"days").format("MM/DD/YYYY"):(e=getSearchParam("year")||moment().format("YYYY"),a=getSearchParam("month")||moment().format("MM"),moment(e+"-"+a+"-01").endOf("month").format("MM/DD/YYYY"))}return t}(t.start_date),$(".jsPageApplyTemplateEmployees:checked").map(function(){t.employees.push($(this).val())}),!t.schedule_id)return _error("Please select a schedule.");if(!t.employees.length)return _error("Please select at least one employee.");var e=t,a=$(".jsPageApplyShiftTemplateBtn"),n="settings/shifts/template/apply",o=function(e){let a="";0<Object.keys(e.list).length&&$.each(e.list,function(e,t){a=(a=(a+="<p>")+$('.jsPageApplyTemplateEmployees[value="'+e+'"]').parent().text().trim())+" has already shift on the following dates;</p>",t.dates.map(function(e){a+="<span>"+moment(e,"YYYY-MM-DD").format("MM/DD/YYYY")+"</span>, "}),a+="<br /><br />"}),_success(e.msg+a,function(){window.location.href=baseUrl("settings/shifts/manage"+window.location.search)})};if(null===r){const l=callButtonHook(a,!0);r=$.ajax({url:baseUrl(n),method:"POST",data:e,processData:!0}).always(function(){callButtonHook(l,!1),r=null}).fail(handleErrorResponse).done(function(e){return o(e)})}})},Modal({Id:t,Title:e,Body:'<div id="'+s+'"></div>',Loader:a},function(){var e=n,t=o,a=l;null!==r&&r.abort(),r=$.ajax({url:baseUrl("settings/page/"+e+"/"+t),method:"GET"}).always(function(){r=null}).fail(handleErrorResponse).done(function(e){$("#"+s).html(e.view),a(e)})})})});
