const modalId="jsModalPage",modalLoader=modalId+"Loader",modalBody=modalId+"Body";let shiftsIds=[];$(function(){let o=null,i=null;function s(e){shiftsIds=e,t("Swap Shifts","trade_shift",0)}function n(t,a,s,n){if(null===o){let e;a&&(e=callButtonHook(a,!0)),o=$.ajax({url:baseUrl(s),method:"POST",data:t,processData:!1,contentType:!1}).always(function(){a&&callButtonHook(e,!1),o=null}).fail(handleErrorResponse).done(function(e){return i?.destroy(),n(e)})}}function t(e,s,n,i){Modal({Id:modalId,Title:e,Body:'<div id="'+modalBody+'"></div>',Loader:modalLoader},function(){var e=s,t=n,a=i;params="params?shiftsIds="+shiftsIds,callUrl=""!=shiftsIds?baseUrl("settings/page/"+e+"/"+t+"/"+params):baseUrl("settings/page/"+e+"/"+t),null!==o&&o.abort(),o=$.ajax({url:callUrl,method:"GET"}).always(function(){o=null}).fail(handleErrorResponse).done(function(e){$("#"+modalBody).html(e.view),a(e)})})}$(".jsDateRangePicker").daterangepicker({showDropdowns:!0,autoApply:!0,locale:{format:"MM/DD/YYYY",separator:" - "}}),$("#check_all").click(function(){$("#check_all").is(":checked")?$(".my_checkbox:checkbox").each(function(){this.checked=!0}):$(".my_checkbox:checkbox").each(function(){this.checked=!1})}),$(".jsTradeShifts").click(function(e){e.preventDefault();let t=[];var a;$(".my_checkbox:checked").each(function(){""!=(a=$(this).data("status"))&&"rejected"!=a&&"cancelled"!=a||t.push($(this).val())}),0<t.length?s(t):alertify.alert("Error! Not selected","Please Select at-least one shift ")}),$(".jsCancelTradeShifts").click(function(e){e.preventDefault();let t=[];$(".my_checkbox:checked").each(function(){"awaiting confirmation"==$(this).data("status")&&t.push($(this).val())}),0<t.length?alertify.confirm("Are You Sure?","Are you sure you want to cancel the shift swap?",function(){var e=new FormData;e.append("shiftids",t),n(e,"","settings/shifts/tradeshiftscancel",function(e){_success(e.msg,function(){window.location.reload()})})},function(){}):alertify.alert("Error! Not selected","Please Select at-least one shift ")}),$(".jsTradeShift").click(function(e){e.preventDefault();e=[];e.push($(this).data("shiftid")),s(e)}),$(".jsCancelTradeShift").click(function(e){e.preventDefault();var t=$(this).data("id"),a=$(this).data("employee");alertify.confirm("Are You Sure?","Are you sure you want to cancel the shift swap?",function(){var e=new FormData;e.append("shiftId",t),e.append("employeeId",a),n(e,"","settings/shifts/trade_single_shift_cancel",function(e){_success(e.msg,function(){window.location.reload()})})},function(){})}),$(".jsConfirmTradeShifts").click(function(e){e.preventDefault();let t=[];$(".my_checkbox:checked").each(function(){"awaiting confirmation"==$(this).data("status")&&t.push($(this).val())}),0<t.length?alertify.confirm("Are You Sure?","Are you sure want to Confirm shifts?",function(){var e=new FormData;e.append("shiftids",t),e.append("shiftstatus","confirmed"),n(e,"","settings/shifts/my_trade_change_status",function(e){_success(e.msg,function(){window.location.reload()})})},function(){}):alertify.alert("Error! Not selected","Please Select at-least one shift ")}),$(".jsRejectTradeShifts").click(function(e){e.preventDefault();let t=[];var a;$(".my_checkbox:checked").each(function(){"awaiting confirmation"!=(a=$(this).data("status"))&&"confirmed"!=a||t.push($(this).val())}),0<t.length?alertify.confirm("Are You Sure?","Are you sure want to Reject shifts?",function(){var e=new FormData;e.append("shiftids",t),e.append("shiftstatus","rejected"),n(e,"","settings/shifts/my_trade_change_status",function(e){_success(e.msg,function(){window.location.reload()})})},function(){}):alertify.alert("Error! Not selected","Please Select at-least one shift ")}),$(".jsRejectTradeShift").click(function(e){e.preventDefault();let t=[];t.push($(this).data("shiftid")),alertify.confirm("Are You Sure?","Are you sure want to reject shifts?",function(){var e=new FormData;e.append("shiftids",t),e.append("shiftstatus","rejected"),n(e,"","settings/shifts/my_trade_change_status",function(e){_success(e.msg,function(){window.location.reload()})})},function(){})}),$(".jsConfirmTradeShift").click(function(e){e.preventDefault();let t=[];t.push($(this).data("shiftid")),alertify.confirm("Are You Sure?","Are you sure want to Confirm shifts?",function(){var e=new FormData;e.append("shiftids",t),e.append("shiftstatus","confirmed"),n(e,"","settings/shifts/my_trade_change_status",function(e){_success(e.msg,function(){window.location.reload()})})},function(){})}),$(document).on("click",".jsApproveTradeShift",function(e){e.preventDefault();let t=[],a=$(this).data("shiftid"),s=$(this).data("toemployeeid");alertify.confirm("Are You Sure?","Are you sure want to approve shift swap request?",function(){var e=new FormData;t.push(a),e.append("shiftids",t),e.append("toEmployeeId",s),n(e,"","settings/shifts/tradeshiftsapprove",function(e){_success(e.msg,function(){window.location.reload()})})},function(){})}),$(document).on("click",".jsAdminApproveTradeShifts",function(e){e.preventDefault();let t=[];$(".my_checkbox:checked").each(function(){t.push($(this).val())}),0<t.length?alertify.confirm("Are You Sure?","Are you sure want to approve shift swap requests?",function(){var e=new FormData;e.append("shiftids",t),n(e,"","settings/shifts/tradeshiftsapprove",function(e){_success(e.msg,function(){window.location.reload()})})},function(){}):alertify.alert("Error! Not selected","Please Select at-least one shift ")}),$(document).on("click",".jsAdminRejectTradeShift",function(e){e.preventDefault();let t=[],a=$(this).data("shiftid"),s=$(this).data("toemployeeid");alertify.confirm("Are You Sure?","Are you sure want to reject shift swap request?",function(){var e=new FormData;t.push(a),e.append("shiftids",t),e.append("toEmployeeId",s),n(e,"","settings/shifts/tradeshiftsreject",function(e){_success(e.msg,function(){window.location.reload()})})},function(){})}),$(".jsAdminRejectTradeShifts").click(function(e){e.preventDefault();let t=[];$(".my_checkbox:checked").each(function(){t.push($(this).val())}),0<t.length?alertify.confirm("Are You Sure?","Are you sure want to reject shift swap requests?",function(){var e=new FormData;e.append("shiftids",t),n(e,"","settings/shifts/tradeshiftsreject",function(e){_success(e.msg,function(){window.location.reload()})})},function(){}):alertify.alert("Error! Not selected","Please Select at-least one shift ")}),$("#jsApplyFilter").click(function(e){e.preventDefault(),a.Requests.Main.type=$(".csActiveTab").find("a").data("key"),a.Requests.Main.filter.dateRange=$(".jsDateRangePicker").val(),l()});let a={Requests:{Main:{action:"get_requests",type:"all",filter:{dateRange:""}}}},r=null,e=baseUrl("settings/handler");function l(){null==r&&(ml(!0,"requests"),$(".js-error-row").remove(),r=$.post(e,a.Requests.Main,function(e){if(!(r=null)===e.Redirect)alertify.alert("WARNING!","Your session expired. Please, re-login to continue.",()=>{window.location.reload()});else{if(!1===e.Status&&1==a.Balances.Main.page)alert("asdasdasd"),$(".js-ip-pagination").html(""),$("#js-data-area").html(`<tr class="js-error-row"><td colspan="${$(".js-table-head").find("th").length}"><p class="alert alert-info text-center">${e.Response}</p></td></tr>`);else if(!1!==e.Status){let a="";0==e.Data.length?$("#js-data-area").html('<tr><td colspan="7"><p class="alert alert-info text-center">No Request found.</p></td></tr>'):($("#jsAllRequests").html("("+e.allRequests+")"),$("#jsPendingRequests").html("("+e.pendingRequests+")"),$("#jsApprovedRequests").html("("+e.approvedRequests+")"),$("#jsRejectedRequests").html("("+e.rejectedRequests+")"),("all"==e.requestsType||"confirmed"==e.requestsType)&&0<e.pendingRequests?$("#jsApprovedRejectBtn").show():$("#jsApprovedRejectBtn").hide(),"all"==e.requestsType?$("#jsTableHeading").text("All Approval(s)"):"confirmed"==e.requestsType?$("#jsTableHeading").text("Pending Approval(s)"):"approved"==e.requestsType?$("#jsTableHeading").text("Approved Approval(s)"):$("#jsTableHeading").text("Rejected Approval(s)"),$.each(e.Data,function(e,t){a+="<tr><td>",""+t.request_status!="Approved"&&""+t.request_status!="Admin Rejected"&&""+t.request_type!="open"&&(a=(a=(a+='<label class="control control--checkbox">')+`<input type="checkbox" name="checkit[]" value="${t.shift_sid}" class="my_checkbox" data-status="" >`)+'<div class="control__indicator"></div></label>'),a=(a=(a=(a=(a=(a=(a+="</td>")+`<td style="vertical-align: middle;">${t.shift_date} `+"<br> "+t.start_time+"</td>")+'<td style="vertical-align: middle;">'+("Admin Rejected"==t.request_status?"Rejected":t.request_status)+"<br> "+t.updated_at+"</td>")+'<td style="vertical-align: middle;">'+t.created_at+"</td>")+'<td style="vertical-align: middle;">'+t.from_employee+"</td>")+'<td style="vertical-align: middle;">'+t.to_employee+"</td>")+'<td><div class="col-sm-12 text-right">',""+t.request_status!="Approved"&&""+t.request_status!="Admin Rejected"&&(a=(a=a+`<button class="btn btn-red jsAdminRejectTradeShift" data-shiftid="${t.shift_sid}" data-toemployeeid="${t.to_employee_sid}">Reject`+"</button>")+`<button class="btn btn-orange jsApproveTradeShift" data-shiftid="${t.shift_sid}" data-toemployeeid="${t.to_employee_sid}">Approve`+"</button>"),a=(a+="</div>")+"</td></tr>"}),$("#js-data-area").html(a))}else $(".js-ip-pagination").html("");ml(!1,"requests")}}))}function t(e,t,a){Modal({Id:modalId,Title:e,Body:'<div id="'+modalBody+'"></div>',Loader:modalLoader},function(){params="params?dateFilter="+$(".jsDateRangePicker").val(),callUrl=baseUrl("settings/page/"+t+"/"+a+"/"+params),null!==o&&o.abort(),o=$.ajax({url:callUrl,method:"GET"}).always(function(){o=null}).fail(handleErrorResponse).done(function(e){$("#"+modalBody).html(e.view)})})}$(".jsReportTab").click(function(e){e.preventDefault(),a.Requests.Main.type=$(this).data("key"),a.Requests.Main.filter.dateRange=$(".jsDateRangePicker").val(),$(".jsReportTab").parent().removeClass("active").removeClass("csActiveTab"),$(this).parent().addClass("active").addClass("csActiveTab"),l()}),$('.jsReportTab[data-key="all"]').trigger("click"),$(".jsSwapMyShift").click(function(e){e.preventDefault(),t("Send Shift","send_shift_new",0)})});
