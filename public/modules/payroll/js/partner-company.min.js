$(function(){let a=0,l="jsCreatePartnerCompanyModal",r=null,t={checkRequirements:function(){null!==r&&r.abort();r=$.ajax({url:baseUrl("payroll/company/"+a+"/requirements"),method:"GET"}).always(function(){r=null}).fail(i).success(function(){r=null,t.welcomeStep()})},welcomeStep:function(){if(null!==r)return!1;r=$.ajax({url:baseUrl("payroll/company/"+a+"/partner/welcome"),method:"GET"}).success(function(e){if(r=null,$(`#${l}Body`).html(e.view),void 0!==e.onboard){if("terms"===e.onboard)return t.gustoTerms();window.location.refresh()}_ml(!1,l+"Loader"),$(".jsPayrollLoadSelectEmployees").click(function(e){e.preventDefault(),_ml(!0,l+"Loader"),t.employeeListingStep()})}).fail(i)},employeeListingStep:function(){if(null!==r)return!1;r=$.ajax({url:baseUrl("payroll/company/"+a+"/partner/employees"),method:"GET"}).always(function(){r=null}).fail(i).success(function(e){r=null,$(`#${l}Body`).html(e.view),_ml(!1,l+"Loader"),$(".jsPayrollLoadOnboard").click(function(e){e.preventDefault(),n=[],$(".jsEmployeesList:checked").map(function(){n.push($(this).val())}),n.length?(_ml(!0,l+"Loader"),t.adminStep()):_error("Please select at least one employee.")}),$(".jsBackToStep1").click(function(e){e.preventDefault(),_ml(!0,l+"Loader"),t.welcomeStep()})})},adminStep:function(){if(null!==r)return!1;r=$.ajax({url:baseUrl("payroll/company/"+a+"/partner/admin"),method:"GET"}).always(function(){r=null}).fail(i).success(function(e){r=null,$(`#${l}Body`).html(e.view),_ml(!1,l+"Loader"),$(".jsPayrollSetAdmin").click(function(e){e.preventDefault(),null===r&&(r=$.ajax({url:baseUrl("payroll/company/"+a+"/partner/admin/add"),method:"GET"}).always(function(){r=null}).fail(i).success(function(e){r=null,$(`#${l}Body`).html(e.view),_ml(!1,l+"Loader")}))}),$(".jsBackToStep2").click(function(e){e.preventDefault(),_ml(!0,l+"Loader"),t.employeeListingStep()})})},createPartnerCompany:e},n=[];function e(){r=$.ajax({url:baseUrl(`payroll/company/${a}/partner/create`),method:"POST",data:{employees:n}}).always(function(){r=null}).fail(o).success(function(){if(r=null,"undefined"==typeof gustoServiceAgreement)return window.location.reload();gustoServiceAgreement(a)})}function o(e){return _ml(!1,l+"Loader"),r=null,handleErrorResponse(e)}function i(e){return $(`#${l} .jsModalCancel`).trigger("click"),handleErrorResponse(e)}$(document).on("click",".jsModalCancel",function(){r=null}),$(document).on("click",".jsSelectAll",function(){$(".jsSingleEmployee").prop("checked",!0)}),$(document).on("click",".jsUnSelectAll",function(){$(".jsSingleEmployee").prop("checked",!1)}),$(".jsCreatePartnerCompanyBtn").click(function(e){if(e.preventDefault(),0===(a=parseInt($(this).data("cid"))))return _error("ERROR","Company code is missing.");Modal({Id:l,Title:"",Loader:l+"Loader",Body:`<div id="${l}Body"></div>`},t.checkRequirements)}),$(document).on("click",".jsPayrollViewAdminDetails",function(e){e.preventDefault(),_ml(!0,l+"Loader"),r=$.ajax({url:baseUrl(`payroll/company/${a}/partner/admin/view`),method:"GET"}).always(function(){r=null}).fail(i).success(function(e){r=null,$(`#${l}Body`).html(e.view),_ml(!1,l+"Loader")})}),$(document).on("click",".jsPayrollSaveAdmin",function(e){e.preventDefault();var e={firstName:$(".jsAdminFirstName").val().trim(),lastName:$(".jsAdminLastName").val().trim(),email:$(".jsAdminEmailAddress").val().trim(),id:$(".jsAdminUserId").val().trim()},n=[];e.firstName||n.push('"First name" is missing.'),e.lastName||n.push('"Last name" is missing.'),e.email||n.push('"Email" is missing.'),e.email.verifyEmail()||n.push('"Email" is invalid.'),n.length?_error(getErrorsStringFromArray(n)):(_ml(!0,l+"Loader"),r=$.ajax({url:baseUrl("payroll/company/"+a+"/partner/admin/add"),method:"POST",data:e}).success(function(){return r=null,_ml(!1,l+"Loader"),_success("Congratulations! You have successfully added a payroll admin for the company.",function(){t.adminStep()})}).fail(o))}),$(document).on("click",".jsBackToStep3",function(e){e.preventDefault(),_ml(!0,l+"Loader"),t.adminStep()}),$(document).on("click",".jsCreatePartnerCompanyProcessBtn",function(e){e.preventDefault(),_ml(!0,l+"Loader","Please wait patiently while we set up the payroll system. This procedure may take a few minutes."),t.createPartnerCompany()}),$(document).on("change","#jsEmployeeChoose",function(){var e=$(this).val();0!=e&&(ml(!0,"jsCreateLoader"),e=e,ml(!0,"jsCreateLoader","Please wait, while we are generating view."),$.ajax({url:baseUrl("/payrolls/employees/"+e+"/get"),method:"GET"}).success(function(e){$(".jsAdminFirstName").val(e.first_name||""),$(".jsAdminLastName").val(e.last_name||""),$(".jsAdminEmailAddress").val(e.email||""),$(".jsAdminUserId").val(e.id||0)}).fail(function(e){return window.scrollTo(0,0),$(".jsErrorDiv").html(getErrorsStringFromArray((e.responseJSON||JSON.parse(e.responseText)).errors)).removeClass("hidden")}).always(function(){ml(!1,"jsCreateLoader")}))})});
